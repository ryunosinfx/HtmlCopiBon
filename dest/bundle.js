!function(t){var e={};function i(r){if(e[r])return e[r].exports;var s=e[r]={i:r,l:!1,exports:{}};return t[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(r,s,function(e){return t[e]}.bind(null,s));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/dest/",i(i.s=23)}([function(t,e,i){"use strict";i.d(e,"a",function(){return r});class r{static binaryString2ArrayBuffer(t){return r.binaryString2Uint8Array(t).buffer}static arrayBuffer2BinaryString(t){return r.uint8Array2BinaryString(new Uint8Array(t))}static arrayBuffer2base64(t){return btoa(r.uint8Array2BinaryString(new Uint8Array(t)))}static arrayBuffer2DataURI(t,e="application/octet-stream"){return"data:"+e+";base64,"+btoa(r.arrayBuffer2BinaryString(t))}static binaryString2Uint8Array(t){t.split("");const e=t.length,i=new Uint8Array(new ArrayBuffer(e));for(let r=0;r<e;r++)i[r]=t.charCodeAt(r);return i}static uint8Array2BinaryString(t){let e=[];for(let i of t)e.push(String.fromCharCode(i));return e.join("")}static binaryString2DataURI(t,e="application/octet-stream"){return"data:"+e+";base64,"+btoa(t)}static base642DataURI(t,e="application/octet-stream"){return"data:"+e+";base64,"+t}static base642binaryString(t){return atob(t)}static base642ArrayBuffer(t){return r.binaryString2ArrayBuffer(atob(t))}static dataURI2BinaryString(t){return atob(t.split(",")[1])}static dataURI2ArrayBuffer(t){return r.binaryString2Uint8Array(atob(t.split(",")[1])).buffer}static uintArray2ArrayBuffer(t){return t.buffer}static arrayBuffer2Uint8Array(t){return new Uint8Array(t)}static arrayBuffer2Uint16Array(t){return new Uint16Array(t)}static arrayBuffer2Uint32Array(t){return new Uint32Array(t)}static ArrayBuffer2Blob(t,e="application/octet-stream"){return new Blob([t],{type:e})}static readBlob(t){const e=new FileReader,i=new Promise((t,i)=>{e.onload=(i=>{t(e.result)}),e.onerror=(t=>{i(e.error)})});return{asArrayBuffer:()=>(e.readAsArrayBuffer(t),i),asBinaryString:()=>(e.readAsBinaryString(t),i),asDataURL:()=>(e.readAsDataURL(t),i),asText:()=>(e.readAsText(t),i)}}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});class r{static trimByte(t){const e=Math.floor(t),i=e>255?255:e;return i<0?0:i}}},function(t,e,i){"use strict";i.d(e,"a",function(){return s});const r="worker.js";class s{constructor(t=r){this.worker=new Worker(t)}postMessage(t,e){return new Promise((i,r)=>{const{transObject:a,tranceArray:n}=s.buildPostObj(t,e);try{this.worker.postMessage(a,n),this.worker.onmessage=(t=>{const e=t.data;i(e)}),this.worker.onerror=(t=>{console.log(t);const e=t;console.error(e.currentTarget),console.error(e.returnValue),console.error(e.srcElement),console.error(e.target),console.error(e.type),console.error(e.eventPhase),console.error(e.timeStamp),console.error(e.message),console.error(e.lineno),console.error(e.error),r(t)})}catch(t){console.error(t),console.error(t.stack)}})}static buildPostObj(t,e){const i=[];return e&&"object"==typeof e?e.key=t:e={key:t},s.buildPostObjExec(e,i),{transObject:e,tranceArray:i}}static buildPostObjExec(t,e){if(t)if(Array.isArray(t)){let i=0;for(let r of t)s.buildPostObjExecParValue(i,r,e),i++}else if("object"==typeof t&&Object.keys(t).length>0)for(let i in t){const r=t[i];void 0!==r&&s.buildPostObjExecParValue(i,r,e)}else s.buildPostObjExecParValue(null,t,e)}static buildPostObjExecParValue(t,e,i){console.log("trance buildPostObjExecParValue currentKey:"+t+"/"+i.length);const r=typeof e;let a=!1;e?e.buffer?(i.push(e.buffer),a=!0):e.byteLength?(i.push(e),a=!0):e instanceof ImageData?(i.push(e.data.buffer),a=!0):"boolean"!==r&&"number"!==r&&"string"!==r||(a=!0):a=!0,!a&&t&&s.buildPostObjExec(e,i)}close(){this.worker.terminate()}}},function(t,e,i){"use strict";i.d(e,"a",function(){return s});var r=i(4);class s extends r.a{constructor(){super("ImageMerger"),this.margeReplace=this.margeReplace,this.margeLinninr=this.margeLinninr,this.margeMultiplication=this.margeMultiplication}trimByte(t){const e=Math.floor(t),i=e>255?255:e;return i<0?0:i}async margeReplace(t,e,i,r){await this.margeExc(t,e,i,r,"margeReplace",this.replace())}async margeLinninr(t,e,i,r){await this.margeExc(t,e,i,r,"margeLinninr",this.linier())}async margeMultiplication(t,e,i,r){await this.margeExc(t,e,i,r,"margeMultiplication",this.multiplication())}async margeExc(t,e,i,r,s,a){let n=!0;e||r||(e=t.images,i=t.isBaseWhite,t=t.imageDataBase);const o=[];if(e)for(let t of e)t&&t.data&&t.data.length>0&&(n=!1,o.push(this.convertImageDataToObj(t)));if(!n){if(r){this.threadInit();const e={imageDataBase:t,images:o,isBaseWhite:i};return await this.execute(s,e).catch(t=>{console.log(t),console.error(t.stack)})}this.beWhiteImage(t,i),this.mergeImages(t,e,a)}}beWhiteImage(t,e){if(e){const e=t.data.length;for(let i=0;i<e;i++)t.data[i]=255}}mergeImages(t,e,i){const{data:r,width:s,height:a}=t;for(let t of e){const e=t.data,n=t.width,o=t.height,l=t.offsetY,c=t.offsetX,h=t.offsetY&&t.offsetY>0&&t.offsetY<a?t.offsetY:!t.offsetY||t.offsetY<a?0:a,d=t.offsetX&&t.offsetX>0&&t.offsetX<s?t.offsetX:!t.offsetX||t.offsetX<s?0:s,u=h+o,p=u>a?a:u,g=d+n,m=g>s?s:g;let f=0,y=0,w=0;for(let t=h;t<p;t++){const a=t-l;f=a;for(let o=d;o<m;o++){const l=o-c;w++,i(r,t*s+o,e,a*n+l),y=l}}}}replace(){return(t,e,i,r)=>{const s=4*e,a=4*r;t[s]=i[a],t[s+1]=i[a+1],t[s+2]=i[a+2],t[s+3]=255}}linier(){return(t,e,i,r)=>{const s=4*e,a=4*r;t[s]=t[s]+addOaddOffsetXne[a],t[s+1]=t[s+1]+i[a+1],t[s+2]=t[s+2]+i[a+2]}}multiplication(){return(t,e,i,r)=>{const s=4*e,a=4*r;t[s]=this.trimByte(t[s]*i[a]/255),t[s+1]=this.trimByte(t[s+1]*i[a+1]/255),t[s+2]=this.trimByte(t[s+2]*i[a+2]/255)}}}},function(t,e,i){"use strict";i.d(e,"a",function(){return n});var r=i(2);const s={},a="ImageWorker";class n{constructor(t){this.key=t,s[t]=this,this.workerKey}threadInit(){}async execute(t,e,i){e.methodName=t,e.className=this.key;const s={};for(let t in e){const i=e[t];i instanceof ImageData&&(s[t]=i),e[t]=this.convertImageDataToObj(i)}const n=new r.a,o=await n.postMessage(a,e).catch(t=>{console.error(t)});if(o)for(let t in e){const i=o[t];if(!i||!i.data||void 0===i.data.byteLength)continue;const r=e[t];r&&r.data&&void 0!==r.data.byteLength&&(i.data.byteLength>0&&r.data.byteLength<1&&(r.data=i.data))}return o}getClassName(){return this.key}static loadInstance(t){return s(t)}convertImageDataToObj(t){return t&&t.data&&t.data.length>0&&t instanceof ImageData?{width:t.width,height:t.height,data:t.data,offsetX:t.offsetX,offsetY:t.offsetY}:t}}},function(t,e,i){"use strict";i.d(e,"a",function(){return n});var r=i(1),s=i(4);i(0);const a=4;class n extends s.a{constructor(){super("ImageResizer"),this.resizeAsLanczos=this.resizeAsLanczos,this.resizeAsByCubic=this.resizeAsByCubic}culcWeightByCubic(t){return e=>{let i=0;return e<=1?i=(t+2)*e*e*e-(t+3)*e*e+1:e<=2&&(i=t*e*e*e-5*t*e*e+8*t*e-4*t),i}}sincLanczos(t){return Math.sin(t*Math.PI)/(t*Math.PI)}lanczosWeight(t=3){return e=>0===e?1:Math.abs(e)<t?this.sincLanczos(e)*this.sincLanczos(e/t):0}async resizeAsLanczos(t,e,i){return await this.resizeExc(t,e,i,"resizeAsLanczos").catch(t=>{console.log(t),console.error(t.stack)})}async resizeAsByCubic(t,e,i){return await this.resizeExc(t,e,i,"resizeAsByCubic").catch(t=>{console.error("resizeAsByCubic resizeExcWithThreadï¼›iamegData"),console.error(t.stack),console.error(t),console.error(t.currentTarget),console.error(t.returnValue),console.error(t.srcElement),console.error(t.target),console.error(t.type),console.error(t.eventPhase),console.error(t.timeStamp),console.error(t.message),console.error(t.lineno),console.error(t.error)})}async resizeExc(t,e,i,r){if(i){return e||(e=t.distImage,t=t.iamegData),this.threadInit(),await this.execute(r,{iamegData:t,distImage:e}).catch(t=>{console.log(t),console.error(t.stack)})}{let i=null,s=null;if(!e){if(!t.rowCount){return await this.resizeExcWithThread(t,e,r).catch(t=>{console.log(t),console.error(t.stack)})}i=t.rowCount,s=t.offsetY,e=t.distImage,t=t.iamegData}if("resizeAsByCubic"===r)return this.resizeAsByCubicExe(t,e,s,i);if("resizeAsLanczos"===r)return this.resizeAsLanczosExe(t,e,s,i)}}resizeExcWithThread(t,e,i){return new Promise((r,s)=>{e=t.distImage,t=t.iamegData,this.threadInit();const n=e.data,o=e.width,l=e.height,c=t.data,h=t.width,d=t.height,u=[];let p=0;const g=Math.floor(l/a);for(let t=0;t<a;t++){const e=a-1===t?l-p:g,r={data:new Uint8ClampedArray(4*o*e),width:o,height:l},s=c.length,n=new Uint8ClampedArray(s);for(let t=0;t<s;t++)n[t]=c[t];const m={data:n,width:h,height:d},f=this.execute(i,{iamegData:m,distImage:r,offsetY:p,rowCount:e});p+=e,u.push(f)}Promise.all(u).then(t=>{for(let e of t){const{data:t,width:i,height:r,offsetY:s,rowCount:a}=e.distImage,l=4*s*o;n.set(t,l)}r(n.buffer)}).catch(t=>{console.error(t.stack),console.error(t),console.error(t.currentTarget),console.error(t.returnValue),console.error(t.srcElement),console.error(t.target),console.error(t.type),console.error(t.eventPhase),console.error(t.timeStamp),console.error(t.message),console.error(t.lineno),console.error(t.error),s(t)})})}resizeAsLanczosExe(t,e,i,r){const{data:s,width:a,height:n}=t,o=e.data,l=e.width,c=e.height;e.offsetY=i,e.rowCount=r;new Uint8ClampedArray(this.resizeLanczos(s,a,n,l,c,o,i,r));return e}resizeAsByCubicExe(t,e,i,r){const{data:s,width:a,height:n}=t,o=e.data,l=e.width,c=e.height;e.offsetY=i,e.rowCount=r;new Uint8ClampedArray(this.resizeByCubic(s,a,n,l,c,o,i,r));return e}resize(t,e,i,r){const{data:s,width:a,height:n}=t,o=r.data;new Uint8ClampedArray(this.resizeByCubic(s,a,n,e,i,o));return r}resizeLanczos(t,e,i,r,s,a,n,o){return this.resizeExecute(t,e,i,r,s,this.lanczosWeight(3),6,a,n,o)}resizeByCubic(t,e,i,r,s,a,n,o){return this.resizeExecute(t,e,i,r,s,this.culcWeightByCubic(-1),4,a,n,o)}resizeExecute(t,e,i,s,a,n,o,l,c,h){const d=Math.floor(s),u=Math.floor(a),p=Math.floor(e),g=4*p,m=p-1,f=Math.floor(i),y=f-1,w=p/d,b=f/u,A=t,v=l||new Uint8Array(d*u*4),x=o/2,P=x-1,S=c||0,D=S+(h||u);for(let t=S;t<D;t++){const e=b*t,i=Math.floor(e),s=i-P,a=i+x,o=4*(t-S)*d;for(let t=0;t<d;t++){const l=w*t,c=Math.floor(l);let h=0,d=0,u=0;const p=c-P,f=c+x;for(let t=s;t<=a;t++){const r=n(Math.abs(e-t)),s=g*(t<0||t>y?i:t);for(let t=p;t<=f;t++){const e=n(Math.abs(l-t))*r;if(0===e)continue;const i=s+4*(t<0||t>m?c:t);h+=A[i]*e,d+=A[i+1]*e,u+=A[i+2]*e}}const b=o+4*t;v[b]=r.a.trimByte(h),v[b+1]=r.a.trimByte(d),v[b+2]=r.a.trimByte(u),v[b+3]=255}}return v.buffer}}},function(t,e,i){"use strict";function r(t,e,i,r,s){return{sel:t,data:e,children:i,text:r,elm:s,key:void 0===e?void 0:e.key}}Object.defineProperty(e,"__esModule",{value:!0}),e.vnode=r,e.default=r},function(t,e,i){"use strict";function r(t,e){var i,r,s=e.elm,a=t.data.class,n=e.data.class;if((a||n)&&a!==n){for(r in a=a||{},n=n||{},a)n[r]||s.classList.remove(r);for(r in n)(i=n[r])!==a[r]&&s.classList[i?"add":"remove"](r)}}Object.defineProperty(e,"__esModule",{value:!0}),e.classModule={create:r,update:r},e.default=e.classModule},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r="undefined"!=typeof window&&window.requestAnimationFrame||setTimeout,s=function(t){r(function(){r(t)})},a=!1;function n(t,e,i){s(function(){t[e]=i})}function o(t,e){var i,r,s=e.elm,a=t.data.style,o=e.data.style;if((a||o)&&a!==o){a=a||{},o=o||{};var l="delayed"in a;for(r in a)o[r]||("-"===r[0]&&"-"===r[1]?s.style.removeProperty(r):s.style[r]="");for(r in o)if(i=o[r],"delayed"===r&&o.delayed)for(var c in o.delayed)i=o.delayed[c],l&&i===a.delayed[c]||n(s.style,c,i);else"remove"!==r&&i!==a[r]&&("-"===r[0]&&"-"===r[1]?s.style.setProperty(r,i):s.style[r]=i)}}e.styleModule={pre:function(){a=!1},create:o,update:o,destroy:function(t){var e,i,r=t.elm,s=t.data.style;if(s&&(e=s.destroy))for(i in e)r.style[i]=e[i]},remove:function(t,e){var i=t.data.style;if(i&&i.remove){a||(getComputedStyle(document.body).transform,a=!0);var r,s=t.elm,n=0,o=i.remove,l=0,c=[];for(r in o)c.push(r),s.style[r]=o[r];for(var h=getComputedStyle(s)["transition-property"].split(", ");n<h.length;++n)-1!==c.indexOf(h[n])&&l++;s.addEventListener("transitionend",function(t){t.target===s&&--l,0===l&&e()})}else e()}},e.default=e.styleModule},function(t,e,i){"use strict";function r(t,e){var i,r,s=e.elm,a=t.data.props,n=e.data.props;if((a||n)&&a!==n){for(i in a=a||{},n=n||{},a)n[i]||delete s[i];for(i in n)r=n[i],a[i]===r||"value"===i&&s[i]===r||(s[i]=r)}}Object.defineProperty(e,"__esModule",{value:!0}),e.propsModule={create:r,update:r},e.default=e.propsModule},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r="http://www.w3.org/1999/xlink",s="http://www.w3.org/XML/1998/namespace",a=58,n=120;function o(t,e){var i,o=e.elm,l=t.data.attrs,c=e.data.attrs;if((l||c)&&l!==c){for(i in l=l||{},c=c||{}){var h=c[i];l[i]!==h&&(!0===h?o.setAttribute(i,""):!1===h?o.removeAttribute(i):i.charCodeAt(0)!==n?o.setAttribute(i,h):i.charCodeAt(3)===a?o.setAttributeNS(s,i,h):i.charCodeAt(5)===a?o.setAttributeNS(r,i,h):o.setAttribute(i,h))}for(i in l)i in c||o.removeAttribute(i)}}e.attributesModule={create:o,update:o},e.default=e.attributesModule},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=/[A-Z]/g;function s(t,e){var i,s=e.elm,a=t.data.dataset,n=e.data.dataset;if((a||n)&&a!==n){a=a||{},n=n||{};var o=s.dataset;for(i in a)n[i]||(o?i in o&&delete o[i]:s.removeAttribute("data-"+i.replace(r,"-$&").toLowerCase()));for(i in n)a[i]!==n[i]&&(o?o[i]=n[i]:s.setAttribute("data-"+i.replace(r,"-$&").toLowerCase(),n[i]))}}e.datasetModule={create:s,update:s},e.default=e.datasetModule},function(t,e,i){"use strict";function r(t,e){var i=t.type,r=e.data.on;r&&r[i]&&function t(e,i,r){if("function"==typeof e)e.call(i,r,i);else if("object"==typeof e)if("function"==typeof e[0])if(2===e.length)e[0].call(i,e[1],r,i);else{var s=e.slice(1);s.push(r),s.push(i),e[0].apply(i,s)}else for(var a=0;a<e.length;a++)t(e[a])}(r[i],e,t)}function s(t,e){var i,s=t.data.on,a=t.listener,n=t.elm,o=e&&e.data.on,l=e&&e.elm;if(s!==o){if(s&&a)if(o)for(i in s)o[i]||n.removeEventListener(i,a,!1);else for(i in s)n.removeEventListener(i,a,!1);if(o){var c=e.listener=t.listener||function t(e){r(e,t.vnode)};if(c.vnode=e,s)for(i in o)s[i]||l.addEventListener(i,c,!1);else for(i in o)l.addEventListener(i,c,!1)}}}Object.defineProperty(e,"__esModule",{value:!0}),e.eventListenersModule={create:s,update:s,destroy:s},e.default=e.eventListenersModule},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(6),s=i(21);function a(t,e,i){var a,n,o,l={};if(void 0!==i?(l=e,s.array(i)?a=i:s.primitive(i)?n=i:i&&i.sel&&(a=[i])):void 0!==e&&(s.array(e)?a=e:s.primitive(e)?n=e:e&&e.sel?a=[e]:l=e),void 0!==a)for(o=0;o<a.length;++o)s.primitive(a[o])&&(a[o]=r.vnode(void 0,void 0,void 0,a[o],void 0));return"s"!==t[0]||"v"!==t[1]||"g"!==t[2]||3!==t.length&&"."!==t[3]&&"#"!==t[3]||function t(e,i,r){if(e.ns="http://www.w3.org/2000/svg","foreignObject"!==r&&void 0!==i)for(var s=0;s<i.length;++s){var a=i[s].data;void 0!==a&&t(a,i[s].children,i[s].sel)}}(l,a,t),r.vnode(t,l,a,n,void 0)}e.h=a,e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(6),s=i(22);function a(t,e){var i,n=void 0!==e?e:s.default;if(n.isElement(t)){var o,l=t.id?"#"+t.id:"",c=t.getAttribute("class"),h=c?"."+c.split(" ").join("."):"",d=n.tagName(t).toLowerCase()+l+h,u={},p=[],g=void 0,m=void 0,f=t.attributes,y=t.childNodes;for(g=0,m=f.length;g<m;g++)"id"!==(o=f[g].nodeName)&&"class"!==o&&(u[o]=f[g].nodeValue);for(g=0,m=y.length;g<m;g++)p.push(a(y[g],e));return r.default(d,{attrs:u},p,void 0,t)}return n.isText(t)?(i=n.getTextContent(t),r.default(void 0,void 0,void 0,i,t)):n.isComment(t)?(i=n.getTextContent(t),r.default("!",{},[],i,t)):r.default("",{},[],void 0,t)}e.toVNode=a,e.default=a},function(t,e){
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */(function(){"use strict";var t=void 0,e=!0,i=this;function r(e,r){var s,a=e.split("."),n=i;!(a[0]in n)&&n.execScript&&n.execScript("var "+a[0]);for(;a.length&&(s=a.shift());)a.length||r===t?n=n[s]?n[s]:n[s]={}:n[s]=r}var s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function a(t,e){if(this.index="number"==typeof e?e:0,this.f=0,this.buffer=t instanceof(s?Uint8Array:Array)?t:new(s?Uint8Array:Array)(32768),2*this.buffer.length<=this.index)throw Error("invalid index");this.buffer.length<=this.index&&n(this)}function n(t){var e,i=t.buffer,r=i.length,a=new(s?Uint8Array:Array)(r<<1);if(s)a.set(i);else for(e=0;e<r;++e)a[e]=i[e];return t.buffer=a}a.prototype.b=function(t,e,i){var r,s=this.buffer,a=this.index,o=this.f,l=s[a];if(i&&1<e&&(t=8<e?(u[255&t]<<24|u[t>>>8&255]<<16|u[t>>>16&255]<<8|u[t>>>24&255])>>32-e:u[t]>>8-e),8>e+o)l=l<<e|t,o+=e;else for(r=0;r<e;++r)l=l<<1|t>>e-r-1&1,8==++o&&(o=0,s[a++]=u[l],l=0,a===s.length&&(s=n(this)));s[a]=l,this.buffer=s,this.f=o,this.index=a},a.prototype.finish=function(){var t,e=this.buffer,i=this.index;return 0<this.f&&(e[i]<<=8-this.f,e[i]=u[e[i]],i++),s?t=e.subarray(0,i):(e.length=i,t=e),t};var o,l=new(s?Uint8Array:Array)(256);for(o=0;256>o;++o){for(var c=d=o,h=7,d=d>>>1;d;d>>>=1)c<<=1,c|=1&d,--h;l[o]=(c<<h&255)>>>0}var u=l;function p(e){var i,r=t,s="number"==typeof r?r:r=0,a=e.length;for(i=-1,s=7&a;s--;++r)i=i>>>8^m[255&(i^e[r])];for(s=a>>3;s--;r+=8)i=(i=(i=(i=(i=(i=(i=(i=i>>>8^m[255&(i^e[r])])>>>8^m[255&(i^e[r+1])])>>>8^m[255&(i^e[r+2])])>>>8^m[255&(i^e[r+3])])>>>8^m[255&(i^e[r+4])])>>>8^m[255&(i^e[r+5])])>>>8^m[255&(i^e[r+6])])>>>8^m[255&(i^e[r+7])];return(4294967295^i)>>>0}var g=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],m=s?new Uint32Array(g):g;function f(t){this.buffer=new(s?Uint16Array:Array)(2*t),this.length=0}function y(t,e){this.k=b,this.l=0,this.input=s&&t instanceof Array?new Uint8Array(t):t,this.e=0,e&&(e.lazy&&(this.l=e.lazy),"number"==typeof e.compressionType&&(this.k=e.compressionType),e.outputBuffer&&(this.c=s&&e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.e=e.outputIndex)),this.c||(this.c=new(s?Uint8Array:Array)(32768))}f.prototype.getParent=function(t){return 2*((t-2)/4|0)},f.prototype.push=function(t,e){var i,r,s,a=this.buffer;for(i=this.length,a[this.length++]=e,a[this.length++]=t;0<i&&(r=this.getParent(i),a[i]>a[r]);)s=a[i],a[i]=a[r],a[r]=s,s=a[i+1],a[i+1]=a[r+1],a[r+1]=s,i=r;return this.length},f.prototype.pop=function(){var t,e,i,r,s,a=this.buffer;for(e=a[0],t=a[1],this.length-=2,a[0]=a[this.length],a[1]=a[this.length+1],s=0;!((r=2*s+2)>=this.length)&&(r+2<this.length&&a[r+2]>a[r]&&(r+=2),a[r]>a[s]);)i=a[s],a[s]=a[r],a[r]=i,i=a[s+1],a[s+1]=a[r+1],a[r+1]=i,s=r;return{index:t,value:e,length:this.length}};var w,b=2,A=[];for(w=0;288>w;w++)switch(e){case 143>=w:A.push([w+48,8]);break;case 255>=w:A.push([w-144+400,9]);break;case 279>=w:A.push([w-256+0,7]);break;case 287>=w:A.push([w-280+192,8]);break;default:throw"invalid literal: "+w}y.prototype.g=function(){var i,r,n,o,l=this.input;switch(this.k){case 0:for(n=0,o=l.length;n<o;){var c,h,d,u=r=s?l.subarray(n,n+65535):l.slice(n,n+65535),p=(n+=r.length)===o,g=t,m=t,f=this.c,y=this.e;if(s){for(f=new Uint8Array(this.c.buffer);f.length<=y+u.length+5;)f=new Uint8Array(f.length<<1);f.set(this.c)}if(c=p?1:0,f[y++]=0|c,d=65536+~(h=u.length)&65535,f[y++]=255&h,f[y++]=h>>>8&255,f[y++]=255&d,f[y++]=d>>>8&255,s)f.set(u,y),y+=u.length,f=f.subarray(0,y);else{for(g=0,m=u.length;g<m;++g)f[y++]=u[g];f.length=y}this.e=y,this.c=f}break;case 1:var w=new a(s?new Uint8Array(this.c.buffer):this.c,this.e);w.b(1,1,e),w.b(1,2,e);var v,x,S,B=P(this,l);for(v=0,x=B.length;v<x;v++)if(S=B[v],a.prototype.b.apply(w,A[S]),256<S)w.b(B[++v],B[++v],e),w.b(B[++v],5),w.b(B[++v],B[++v],e);else if(256===S)break;this.c=w.finish(),this.e=this.c.length;break;case b:var I,E,C,K,N,L,T,O,M,R,z,U,F,_,V,j=new a(s?new Uint8Array(this.c.buffer):this.c,this.e),W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Z=Array(19);for(I=b,j.b(1,1,e),j.b(I,2,e),E=P(this,l),T=k(L=D(this.p,15)),M=k(O=D(this.o,7)),C=286;257<C&&0===L[C-1];C--);for(K=30;1<K&&0===O[K-1];K--);var X,Y,H,G,J,q,Q=C,$=K,tt=new(s?Uint32Array:Array)(Q+$),et=new(s?Uint32Array:Array)(316),it=new(s?Uint8Array:Array)(19);for(X=Y=0;X<Q;X++)tt[Y++]=L[X];for(X=0;X<$;X++)tt[Y++]=O[X];if(!s)for(X=0,G=it.length;X<G;++X)it[X]=0;for(X=J=0,G=tt.length;X<G;X+=Y){for(Y=1;X+Y<G&&tt[X+Y]===tt[X];++Y);if(H=Y,0===tt[X])if(3>H)for(;0<H--;)et[J++]=0,it[0]++;else for(;0<H;)(q=138>H?H:138)>H-3&&q<H&&(q=H-3),10>=q?(et[J++]=17,et[J++]=q-3,it[17]++):(et[J++]=18,et[J++]=q-11,it[18]++),H-=q;else if(et[J++]=tt[X],it[tt[X]]++,3>--H)for(;0<H--;)et[J++]=tt[X],it[tt[X]]++;else for(;0<H;)(q=6>H?H:6)>H-3&&q<H&&(q=H-3),et[J++]=16,et[J++]=q-3,it[16]++,H-=q}for(i=s?et.subarray(0,J):et.slice(0,J),R=D(it,7),_=0;19>_;_++)Z[_]=R[W[_]];for(N=19;4<N&&0===Z[N-1];N--);for(z=k(R),j.b(C-257,5,e),j.b(K-1,5,e),j.b(N-4,4,e),_=0;_<N;_++)j.b(Z[_],3,e);for(_=0,V=i.length;_<V;_++)if(U=i[_],j.b(z[U],R[U],e),16<=U){switch(_++,U){case 16:F=2;break;case 17:F=3;break;case 18:F=7;break;default:throw"invalid code: "+U}j.b(i[_],F,e)}var rt,st,at,nt,ot,lt,ct,ht,dt=[T,L],ut=[M,O];for(ot=dt[0],lt=dt[1],ct=ut[0],ht=ut[1],rt=0,st=E.length;rt<st;++rt)if(at=E[rt],j.b(ot[at],lt[at],e),256<at)j.b(E[++rt],E[++rt],e),nt=E[++rt],j.b(ct[nt],ht[nt],e),j.b(E[++rt],E[++rt],e);else if(256===at)break;this.c=j.finish(),this.e=this.c.length;break;default:throw"invalid compression type"}return this.c};var v=function(){function t(t){switch(e){case 3===t:return[257,t-3,0];case 4===t:return[258,t-4,0];case 5===t:return[259,t-5,0];case 6===t:return[260,t-6,0];case 7===t:return[261,t-7,0];case 8===t:return[262,t-8,0];case 9===t:return[263,t-9,0];case 10===t:return[264,t-10,0];case 12>=t:return[265,t-11,1];case 14>=t:return[266,t-13,1];case 16>=t:return[267,t-15,1];case 18>=t:return[268,t-17,1];case 22>=t:return[269,t-19,2];case 26>=t:return[270,t-23,2];case 30>=t:return[271,t-27,2];case 34>=t:return[272,t-31,2];case 42>=t:return[273,t-35,3];case 50>=t:return[274,t-43,3];case 58>=t:return[275,t-51,3];case 66>=t:return[276,t-59,3];case 82>=t:return[277,t-67,4];case 98>=t:return[278,t-83,4];case 114>=t:return[279,t-99,4];case 130>=t:return[280,t-115,4];case 162>=t:return[281,t-131,5];case 194>=t:return[282,t-163,5];case 226>=t:return[283,t-195,5];case 257>=t:return[284,t-227,5];case 258===t:return[285,t-258,0];default:throw"invalid length: "+t}}var i,r,s=[];for(i=3;258>=i;i++)r=t(i),s[i]=r[2]<<24|r[1]<<16|r[0];return s}(),x=s?new Uint32Array(v):v;function P(i,r){function a(t,i){var r,s,a,n,o=t.n,l=[],c=0;switch(r=x[t.length],l[c++]=65535&r,l[c++]=r>>16&255,l[c++]=r>>24,e){case 1===o:s=[0,o-1,0];break;case 2===o:s=[1,o-2,0];break;case 3===o:s=[2,o-3,0];break;case 4===o:s=[3,o-4,0];break;case 6>=o:s=[4,o-5,1];break;case 8>=o:s=[5,o-7,1];break;case 12>=o:s=[6,o-9,2];break;case 16>=o:s=[7,o-13,2];break;case 24>=o:s=[8,o-17,3];break;case 32>=o:s=[9,o-25,3];break;case 48>=o:s=[10,o-33,4];break;case 64>=o:s=[11,o-49,4];break;case 96>=o:s=[12,o-65,5];break;case 128>=o:s=[13,o-97,5];break;case 192>=o:s=[14,o-129,6];break;case 256>=o:s=[15,o-193,6];break;case 384>=o:s=[16,o-257,7];break;case 512>=o:s=[17,o-385,7];break;case 768>=o:s=[18,o-513,8];break;case 1024>=o:s=[19,o-769,8];break;case 1536>=o:s=[20,o-1025,9];break;case 2048>=o:s=[21,o-1537,9];break;case 3072>=o:s=[22,o-2049,10];break;case 4096>=o:s=[23,o-3073,10];break;case 6144>=o:s=[24,o-4097,11];break;case 8192>=o:s=[25,o-6145,11];break;case 12288>=o:s=[26,o-8193,12];break;case 16384>=o:s=[27,o-12289,12];break;case 24576>=o:s=[28,o-16385,13];break;case 32768>=o:s=[29,o-24577,13];break;default:throw"invalid distance"}for(r=s,l[c++]=r[0],l[c++]=r[1],l[c++]=r[2],a=0,n=l.length;a<n;++a)f[y++]=l[a];b[l[0]]++,A[l[3]]++,w=t.length+i-1,p=null}var n,o,l,c,h,d,u,p,g,m={},f=s?new Uint16Array(2*r.length):[],y=0,w=0,b=new(s?Uint32Array:Array)(286),A=new(s?Uint32Array:Array)(30),v=i.l;if(!s){for(l=0;285>=l;)b[l++]=0;for(l=0;29>=l;)A[l++]=0}for(b[256]=1,n=0,o=r.length;n<o;++n){for(l=h=0,c=3;l<c&&n+l!==o;++l)h=h<<8|r[n+l];if(m[h]===t&&(m[h]=[]),d=m[h],!(0<w--)){for(;0<d.length&&32768<n-d[0];)d.shift();if(n+3>=o){for(p&&a(p,-1),l=0,c=o-n;l<c;++l)g=r[n+l],f[y++]=g,++b[g];break}0<d.length?(u=S(r,n,d),p?p.length<u.length?(g=r[n-1],f[y++]=g,++b[g],a(u,0)):a(p,-1):u.length<v?p=u:a(u,0)):p?a(p,-1):(g=r[n],f[y++]=g,++b[g])}d.push(n)}return f[y++]=256,b[256]++,i.p=b,i.o=A,s?f.subarray(0,y):f}function S(t,e,i){var r,s,a,n,o,l,c=0,h=t.length;n=0,l=i.length;t:for(;n<l;n++){if(r=i[l-n-1],a=3,3<c){for(o=c;3<o;o--)if(t[r+o-1]!==t[e+o-1])continue t;a=c}for(;258>a&&e+a<h&&t[r+a]===t[e+a];)++a;if(a>c&&(s=r,c=a),258===a)break}return new function(t,e){this.length=t,this.n=e}(c,e-s)}function D(t,e){var i,r,a,n,o,l=t.length,c=new f(572),h=new(s?Uint8Array:Array)(l);if(!s)for(n=0;n<l;n++)h[n]=0;for(n=0;n<l;++n)0<t[n]&&c.push(n,t[n]);if(i=Array(c.length/2),r=new(s?Uint32Array:Array)(c.length/2),1===i.length)return h[c.pop().index]=1,h;for(n=0,o=c.length/2;n<o;++n)i[n]=c.pop(),r[n]=i[n].value;for(a=function(t,e,i){function r(t){var i=g[t][m[t]];i===e?(r(t+1),r(t+1)):--u[i],++m[t]}var a,n,o,l,c,h=new(s?Uint16Array:Array)(i),d=new(s?Uint8Array:Array)(i),u=new(s?Uint8Array:Array)(e),p=Array(i),g=Array(i),m=Array(i),f=(1<<i)-e,y=1<<i-1;for(h[i-1]=e,n=0;n<i;++n)f<y?d[n]=0:(d[n]=1,f-=y),f<<=1,h[i-2-n]=(h[i-1-n]/2|0)+e;for(h[0]=d[0],p[0]=Array(h[0]),g[0]=Array(h[0]),n=1;n<i;++n)h[n]>2*h[n-1]+d[n]&&(h[n]=2*h[n-1]+d[n]),p[n]=Array(h[n]),g[n]=Array(h[n]);for(a=0;a<e;++a)u[a]=i;for(o=0;o<h[i-1];++o)p[i-1][o]=t[o],g[i-1][o]=o;for(a=0;a<i;++a)m[a]=0;for(1===d[i-1]&&(--u[0],++m[i-1]),n=i-2;0<=n;--n){for(l=a=0,c=m[n+1],o=0;o<h[n];o++)(l=p[n+1][c]+p[n+1][c+1])>t[a]?(p[n][o]=l,g[n][o]=e,c+=2):(p[n][o]=t[a],g[n][o]=a,++a);m[n]=0,1===d[n]&&r(n)}return u}(r,r.length,e),n=0,o=i.length;n<o;++n)h[i[n].index]=a[n];return h}function k(t){var e,i,r,a,n=new(s?Uint16Array:Array)(t.length),o=[],l=[],c=0;for(e=0,i=t.length;e<i;e++)o[t[e]]=1+(0|o[t[e]]);for(e=1,i=16;e<=i;e++)l[e]=c,c+=0|o[e],c<<=1;for(e=0,i=t.length;e<i;e++)for(c=l[t[e]],l[t[e]]+=1,r=n[e]=0,a=t[e];r<a;r++)n[e]=n[e]<<1|1&c,c>>>=1;return n}function B(t){t=t||{},this.files=[],this.d=t.comment}var I=[80,75,1,2],E=[80,75,3,4],C=[80,75,5,6];function K(t,e){var i,r=65535&t[2]|2;return i=r*(1^r)>>8&255,N(t,e),i^e}function N(t,e){t[0]=(m[255&(t[0]^e)]^t[0]>>>8)>>>0,t[1]=1+(6681*(20173*(t[1]+(255&t[0]))>>>0)>>>0)>>>0,t[2]=(m[255&(t[2]^t[1]>>>24)]^t[2]>>>8)>>>0}function L(t,e){var i,s,a,n;if(Object.keys)i=Object.keys(e);else for(s in i=[],a=0,e)i[a++]=s;for(a=0,n=i.length;a<n;++a)r(t+"."+(s=i[a]),e[s])}B.prototype.m=function(t,i){i=i||{};var r,a=t.length,n=0;if(s&&t instanceof Array&&(t=new Uint8Array(t)),"number"!=typeof i.compressionMethod&&(i.compressionMethod=8),i.compress)switch(i.compressionMethod){case 0:break;case 8:n=p(t),t=new y(t,i.deflateOption).g(),r=e;break;default:throw Error("unknown compression method:"+i.compressionMethod)}this.files.push({buffer:t,a:i,j:r,r:!1,size:a,h:n})},B.prototype.q=function(t){this.i=t},B.prototype.g=function(){var i,r,a,n,o,l,c,h,d,u,g,m,f,w,b,A,v,x,P,S,D,k,B,L,T=this.files,O=0,M=0;for(D=0,k=T.length;D<k;++D){if(f=(i=T[D]).a.filename?i.a.filename.length:0,w=i.a.comment?i.a.comment.length:0,!i.j)switch(i.h=p(i.buffer),i.a.compressionMethod){case 0:break;case 8:i.buffer=new y(i.buffer,i.a.deflateOption).g(),i.j=e;break;default:throw Error("unknown compression method:"+i.a.compressionMethod)}if(i.a.password!==t||this.i!==t){var R,z=i.a.password||this.i,U=[305419896,591751049,878082192],F=t;for(s&&(U=new Uint32Array(U)),F=0,R=z.length;F<R;++F)N(U,255&z[F]);for(S=U,x=i.buffer,s?((P=new Uint8Array(x.length+12)).set(x,12),x=P):x.unshift(0,0,0,0,0,0,0,0,0,0,0,0),B=0;12>B;++B)x[B]=K(S,11===D?255&i.h:256*Math.random()|0);for(L=x.length;B<L;++B)x[B]=K(S,x[B]);i.buffer=x}O+=30+f+i.buffer.length,M+=46+f+w}for(r=new(s?Uint8Array:Array)(O+M+(22+(this.d?this.d.length:0))),a=0,o=(n=O)+M,D=0,k=T.length;D<k;++D){if(f=(i=T[D]).a.filename?i.a.filename.length:0,w=i.a.comment?i.a.comment.length:0,l=a,r[a++]=E[0],r[a++]=E[1],r[a++]=E[2],r[a++]=E[3],r[n++]=I[0],r[n++]=I[1],r[n++]=I[2],r[n++]=I[3],r[n++]=20,r[n++]=i.a.os||0,r[a++]=r[n++]=20,c=r[a++]=r[n++]=0,(i.a.password||this.i)&&(c|=1),r[a++]=r[n++]=255&c,r[a++]=r[n++]=c>>8&255,h=i.a.compressionMethod,r[a++]=r[n++]=255&h,r[a++]=r[n++]=h>>8&255,d=i.a.date||new Date,r[a++]=r[n++]=(7&d.getMinutes())<<5|d.getSeconds()/2|0,r[a++]=r[n++]=d.getHours()<<3|d.getMinutes()>>3,r[a++]=r[n++]=(d.getMonth()+1&7)<<5|d.getDate(),r[a++]=r[n++]=(d.getFullYear()-1980&127)<<1|d.getMonth()+1>>3,u=i.h,r[a++]=r[n++]=255&u,r[a++]=r[n++]=u>>8&255,r[a++]=r[n++]=u>>16&255,r[a++]=r[n++]=u>>24&255,g=i.buffer.length,r[a++]=r[n++]=255&g,r[a++]=r[n++]=g>>8&255,r[a++]=r[n++]=g>>16&255,r[a++]=r[n++]=g>>24&255,m=i.size,r[a++]=r[n++]=255&m,r[a++]=r[n++]=m>>8&255,r[a++]=r[n++]=m>>16&255,r[a++]=r[n++]=m>>24&255,r[a++]=r[n++]=255&f,r[a++]=r[n++]=f>>8&255,r[a++]=r[n++]=0,r[a++]=r[n++]=0,r[n++]=255&w,r[n++]=w>>8&255,r[n++]=0,r[n++]=0,r[n++]=0,r[n++]=0,r[n++]=0,r[n++]=0,r[n++]=0,r[n++]=0,r[n++]=255&l,r[n++]=l>>8&255,r[n++]=l>>16&255,r[n++]=l>>24&255,b=i.a.filename)if(s)r.set(b,a),r.set(b,n),a+=f,n+=f;else for(B=0;B<f;++B)r[a++]=r[n++]=b[B];if(A=i.a.extraField)if(s)r.set(A,a),r.set(A,n),a+=0,n+=0;else for(B=0;B<w;++B)r[a++]=r[n++]=A[B];if(v=i.a.comment)if(s)r.set(v,n),n+=w;else for(B=0;B<w;++B)r[n++]=v[B];if(s)r.set(i.buffer,a),a+=i.buffer.length;else for(B=0,L=i.buffer.length;B<L;++B)r[a++]=i.buffer[B]}if(r[o++]=C[0],r[o++]=C[1],r[o++]=C[2],r[o++]=C[3],r[o++]=0,r[o++]=0,r[o++]=0,r[o++]=0,r[o++]=255&k,r[o++]=k>>8&255,r[o++]=255&k,r[o++]=k>>8&255,r[o++]=255&M,r[o++]=M>>8&255,r[o++]=M>>16&255,r[o++]=M>>24&255,r[o++]=255&O,r[o++]=O>>8&255,r[o++]=O>>16&255,r[o++]=O>>24&255,w=this.d?this.d.length:0,r[o++]=255&w,r[o++]=w>>8&255,this.d)if(s)r.set(this.d,o);else for(B=0,L=w;B<L;++B)r[o++]=this.d[B];return r},r("Zlib.Zip",B),r("Zlib.Zip.prototype.addFile",B.prototype.m),r("Zlib.Zip.prototype.compress",B.prototype.g),r("Zlib.Zip.prototype.setPassword",B.prototype.q),L("Zlib.Zip.CompressionMethod",{STORE:0,DEFLATE:8}),L("Zlib.Zip.OperatingSystem",{MSDOS:0,UNIX:3,MACINTOSH:7})}).call(this)},function(t,e,i){var r=i(17);"string"==typeof r&&(r=[[t.i,r,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0};i(19)(r,s);r.locals&&(t.exports=r.locals)},function(t,e,i){(t.exports=i(18)(!1)).push([t.i,'html, body {\n  min-height: 100%;\n  max-height: 100%;\n  height: 100%;\n  width: 100%;\n  padding: 0;\n  margin: 0;\n}\ndiv {\n  box-sizing: border-box;\n}\n\ndiv.frame {\n  display:flex;\n  justify-content: center;\n  min-height: 100%;\n  max-height: 100%;\n  width: 100%;\n  margin-left: auto;\n  margin-right: auto;\n  margin: 0;\n  background-color: #c9d5de;\n}\ndiv.frame>div{\n    max-width:940px;\n}\ndiv.frame>div.ModalWindow{\n    max-width:100%;\n}\n\ndiv.footer {\n  position: fixed;\n  bottom: 0;\n  height: 3em;\n  width: 100%;\n  border: solid 0px red;\n  padding: 0.5em;\n  z-index: 500;\n  color: white;\n  background-color: #2c3440\n}\n\ndiv.copyright {\ncolor: #266abd;\n  width: 100%;\n  padding: 0.5em;\n  text-align: center;\n  letter-spacing: 10px;\n  font-size: 0.8em;\n}\n\ndiv.header {\n  position: fixed;\n  top: 0;\n  height: 4.5em;\n  width: 100%;\n  border: solid 1px #052240;\n  border-bottom-width: 3.2em;\n  z-index: 500;\n  background-color: #e8eeef;\n}\n\ndiv.title {\n  font-size: 2em;\n  font-weight: bold;\n  padding: 0.5em 0.9em ;\n  line-height: 0.5em;\n  color: #1664a2;\n}\n\ndiv.title span.Version {\n  font-size: 40%;\n  font-weight: bold;\n  padding: 0em;\n  color: rgb(0, 232, 249);\n}\n\ndiv.title:after {\n  font-size: 0.4em;\n  padding: 0.5em;\n  font-weight: normal;\n  content: ":The Images Converter For Book Made By Copy Machine!";\n  color: #2196f3\n}\n\ndiv.FileUploadArea input {\n  position: absolute;\n  left: -100;\n}\n\ndiv.FileUploadArea {\n  display: block;\n  min-height: 10em;\n  height: 20em;\n  width: 100%;\n  border: dotted 1px black;\n  background-color: #a8bae0;\n  padding: 0.1em;\n}\n\ndiv.FileUploadArea>div.FileUploadAreaA {\n  display: block;\n  min-height: 9.8em;\n  ;\n  height: 9.8em;\n  width: 100%;\n  border: dotted 3px rgb(100, 94, 153);\n  background-color: #a8bae0;\n  padding-top: 4em;\n  padding-bottom: 4em;\n  text-align: center;\n  color: rgb(100, 94, 153);\n  font-size: 2em;\n}\n\ninput.FileUploadFile {\n  position: absolute;\n  top: -10em;\n  left: 10em;\n  visibility: hidden;\n}\n\ndiv.FilesArea {\n  min-height: 100%;\n  width: 100%;\n  border: dotted 1px black;\n  background-color: rgb(52, 158, 226);\n  padding-top: 0.2em;\n  padding-bottom: 0.2em;\n  text-align: center;\n  font-size: 2em;\n}\n\ndiv.FilesArea>div {\n  min-width: 470px;\n}\n\nspan.imageDataLine {\n  display: inline-block;\n  font-size: 50%;\n  padding: 0.2em;\n}\n\ndiv.delButton {\n  display: inline-block;\n  font-size: 50%;\n  width: 3em;\n  padding: 0.2em;\n  line-height: 1em;\n  text-align: center;\n  cursor: pointer;\n  background-color: #675275;\n}\n\ndiv.delButton:active {\n  color: red;\n}\n\ndiv.delButton:hover {\n  color: #d48a60;\n  background-color: #7b4f99;\n}\n\ncanvas.hidden {\n  position: absolute;\n  top: -10000px;\n}\n\n[draggable] {\n  user-select: none;\n}\n\n.column {\n  height: 150px;\n  width: 150px;\n  float: left;\n  border: 2px solid #666666;\n  background-color: #ccc;\n  margin-right: 5px;\n  border-radius: 10px;\n  box-shadow: inset 0 0 3px #000;\n  text-align: center;\n  cursor: move;\n}\n\n.column.over {\n  border: 2px dashed #000;\n}\n\n.column header {\n  color: #fff;\n  text-shadow: #000 0 1px;\n  box-shadow: 5px;\n  border-bottom: 1px solid #ddd;\n  border-top-left-radius: 10px;\n  border-top-right-radius: 10px;\n}\n\n.FilesArea>div {\n  width: 100%;\n  min-width: 630px;\n  display: flex;\n  flex-wrap: nowrap;\n  flex-direction: row;\n}\n\n.FilesArea>div>div {\n  display: flex;\n  min-width: 115px;\n  overflow: hidden;\n}\n\n.FilesArea>div>div.PageImages {\n  min-width: 225px;\n  width: 225px;\n  max-width: 50%;\n}\n\n.FilesArea>div>div.ImageDetail {\n  width:100%;\n  /* max-width: calc(100% - 320px); */\n}\n\n.ImageDetail>div {\n  width: 100%;\n}\n\n.ImageDetail .ImageDetailA {\n  width: 100%;\n}\n\n.ImageDetail .ImageDetailTitle {\n  position: relative;\n  font-size: 12px;\n  background-color: #44cec7;\n  text-align: left;\n  padding: 10px;\n  width: 100%;\n  z-index: 900;\n  display:flex;;\n  flex-direction: row;\n  flex-wrap: wrap;\n}\n.ImageDetail .ImageDetailTitle>div {\n  width:40px;\n  padding:0.5em;\n  border-radius: 5px;\n  background-color: gray;\n  color:white;\n  margin: 0.2em;\n  margin-left: 0.5em;\n  text-align: center;\n  cursor:pointer;\n}\n.ImageDetail .ImageDetailTitle>div.active {\n  background-color: black;\n  color:white;\n  font-weight: bold;\n}\n.image_detail_block.WINDOW>div>img{\n  max-width:100%;\n}\n.image_detail_block.DOUBLE>div>img{\n  max-width:200%;\n}\n.image_detail_block.QUAD>div>img{\n  max-width:400%;\n}\n.image_detail_block.HELF>div>img{\n  max-width:50%;\n}\n.image_detail_block.FULL>div:first-child{\n  position:fixed;\n  z-index: 9999;\n  min-width:100%;\n  min-height:100%;\n  top:0;\n  left:0;\n  background-color: rgba(17, 19, 21, 0.44);\n}\n.image_detail_block.FULL>div>img{\n  position:fixed;\n  z-index: 10000;\n  top:5px;\n  left:5px;\n  width:calc(100% - 10px);\n  cursor: pointer;\n}\n.Thumnails {\n  flex-direction: column;\n  padding-right: 0.2em;\n  background-color: rgba(200, 200, 200, 0);\n}\n\n.Thumnails .thumbnails_block {\n  padding: 1px;\n  background-color: rgba(220, 220, 220, 1);\n  border: 0px dotted #cad2b1;\n  height: 100%;\n}\n\n.Thumnails .thumbnails_block.over {\n  background-color: rgba(190, 190, 190, 0.8);\n  border: 2px dotted #cad2b1;\n}\n\n.thumbnail_block {\n  display: flex;\n  flex-direction: column;\n  background-color: rgb(182, 175, 209);\n  border: 1px solid #fdd;\n  width: 110px;\n  height: 110px;\n  cursor: pointer;\n  background-repeat: no-repeat;\n  background-size: 110, 110, contain;\n  background-position: center;\n  margin-bottom: 1.8em;\n}\n\n.thumnailsImageArea .thumbnail_block {}\n\n.thumbnail_block.over {\n  background-color: #0bd5d8;\n  width: 110px;\n  border: 2px dotted #cad2b1;\n}\n\n.thumbnail_block span.delButton {\n  width: 30px;\n  height:30px;\n  margin-bottom: 77px;\n}\n\n.thumbnail_block div {\n  display: flex;\n  height: auto;\n  margin: auto;\n}\n\n.thumbnail_block div.page_block {\n  height: 110px;\n}\n\n.thumbnail_block div.options_block {\n  height: 5px;\n  font-size: 0.2em;\n  padding: 0.2em;\n}\n\n.thumbnail_block div.options_block .checkForceColor.enable {\n  background-color: rgb(236, 145, 145);\n}\n\n.thumbnail_block div.options_block .checkForceColor.disable {\n  background-color: rgb(241, 241, 241);\n}\n\n.thumbnail_block div.options_block .checkNoCropping.enable {\n  background-color: rgb(233, 220, 134);\n}\n\n.thumbnail_block div.options_block .checkNoCropping.disable {\n  background-color: rgb(241, 241, 241);\n}\n\n.thumbnail_block div.options_block .checkForceColor.enable::after, .thumbnail_block div.options_block .checkNoCropping.enable::after {\n  content: "On";\n  color: black;\n}\n\n.thumbnail_block div.options_block .checkForceColor.disable::after, .thumbnail_block div.options_block .checkNoCropping.disable::after {\n  content: "Off";\n  color: gray;\n}\n\n.thumbnail_text {\n  display: block;\n  background-color: rgb(0, 103, 135);\n  border: 0 solid #fdd;\n  color: rgb(189, 193, 201);\n  font-size: 0.3em;\n  padding: 0.3em;\n  min-height: 50px;\n}\n\n.image_detail_block {\n  position: relative;\n  top: -10px;\n  left: -30px;\n}\n\n.ProgressBar, .Preview {\n  top: 0;\n  left: 0;\n  position: fixed;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(118, 118, 118, 0.80);\n  z-index: 1001;\n  display: none;\n}\n\n.ProgressBar>div {\n  position: fixed;\n  top: 50%;\n  left: 5%;\n  margin: 0 auto;\n  width: 90%;\n  height: 7em;\n  background-color: rgba(238, 118, 238, 1);\n  z-index: 1000;\n  padding: 10px\n}\n\n.ProgressBar>div .progeressTitle {\n  padding-bottom: 5px;\n}\n\n.ProgressBar>div .progeressFrame {\n  margin: 0 auto;\n  width: 95%;\n  height: 3em;\n  background-color: rgb(193, 165, 200);\n  z-index: 1000;\n  padding: 0px\n}\n\n.ProgressBar>div .progeressInfo {\n  padding-top: 5px;\n}\n\n.ProgressBar>div .progeressInfo>div {\n  width: 70%;\n  float: left;\n}\n\n.ProgressBar>div .progeressInfo>div.progeressPoints {\n  width: 5em;\n}\n\n.progeress {\n  position: relative;\n  top: 0;\n  left: 0;\n  height: 3em;\n  background-color: rgb(120, 231, 194);\n}\n\n.Preview>div {\n  position: fixed;\n  top: 2%;\n  left: 2%;\n  margin: 0 auto;\n  width: 96%;\n  height: 96%;\n  background-color: rgb(197, 206, 213);\n  z-index: 1000;\n  padding: 0px\n}\n\n.Preview>div div.img {\n  max-width: 100%;\n  max-height: calc(100% - 72px);\n}\n.Preview>div div.img.right {\n  text-align: left;\n}\n.Preview>div div.img.left {\n  text-align: right;\n}\n.Preview>div div.img>img {\n  max-width: 100%;\n  max-height: 100%;\n}\n\n.Preview>div .previewLeft, .Preview>div .previewRight {\n  cursor: pointer;\n  padding: 10px;\n  background-color: rgba(95, 161, 212, 0.58);\n}\n.Preview>div .previewLeft>.Dummy, .Preview>div .previewRight>.close {\n  display: inline-block;\n  width:1em;\n  height:1em;\n}\n\n.Preview>div .previewInfo {\n  font-size: 60%;\n  padding: 10px 10px 0 10px;\n  color: rgb(43, 176, 218)\n}\n\n.Preview>div .preview_dual {\n  display: flex;\n}\n\n.Preview>div .preview_dual .previewImageFrame {\n  width: 50%;\n}\n.Preview>div .previewImageFrame {\n    display: flex;\n    flex-direction: column;\n}\n\n.previewInfo .options {\n  display: flex;\n  flex-wrap: wrap;\n  margin-top: 0.2em;\n}\n\n.previewInfo .options>div {\n  width: 10em;\n  padding: 0.2em 0.2em 0.2em 0.2em;\n  cursor: pointer;\n  font-size: 0.7em;\n  color: rgb(29, 154, 114);\n}\n\n.previewInfo .options .checkForceColor.enable {\n  background-color: rgb(236, 145, 145);\n}\n\n.previewInfo .options .checkForceColor.disable {\n  background-color: rgb(241, 241, 241);\n}\n\n.previewInfo .options .checkNoCropping.enable {\n  background-color: rgb(233, 220, 134);\n}\n\n.previewInfo .options .checkNoCropping.disable {\n  background-color: rgb(241, 241, 241);\n}\n\n.previewInfo .options .checkForceColor.enable::after, .previewInfo .options .checkNoCropping.enable::after {\n  content: "On";\n  color: black;\n}\n\n.previewInfo .options .checkForceColor.disable::after, .previewInfo .options .checkNoCropping.disable::after {\n  content: "Off";\n  color: gray;\n}\n\n.Preview>div .preview_dual .previewImageFrame.dummy {\n  background-color: rgb(174, 181, 184);\n}\n\n.TitleSettings {\n  background-color: rgb(159, 117, 242);\n  padding: 0.5em;\n  margin: 0.1em 0;\n  margin-top: 1em;\n}\n\n.TitleSettingsTitle {\n  padding: 0.3em;\n  margin-bottom: 0.3em;\n  font-weight: bold;\n  font-size: 110%;\n  width: 100%;\n  text-align: center;\n  background-color: rgb(139, 87, 242);\n}\n\n.TitleSettingsFrame {\n  display: flex;\n}\n\n.TitleSettingsFrame>div {\n  width: 50%;\n}\n\n.TitleSettingsRow>span, .TitleSettingsRow>input {\n  display: inline-flex;\n  width: 40%;\n}\n\n.TitleSettingsUpdate {\n  width: 70%;\n  background-color: rgb(3, 21, 186);\n  color: white;\n  font-weight: bold;\n  text-align: center;\n  margin: 0.5em auto;\n  padding: 0.5em;\n  border-radius: 1em;\n  cursor: pointer;\n}\n\n.previewFrame {\n  display: flex;\n}\n.previewFrame.right {\n  justify-content: right;\n}\n.previewFrame.left {\n  justify-content: left;\n}\n\n.previewFrame>div.button {\n  width: 2em;\n}\n\n.previewFrame>div.button span.button {\n  display: block;\n  width: 20px;\n  text-align: center;\n}\n\n.previewFrame>div.button span.button.symbol {\n  font-size: 150%;\n}\n\n.previewFrame>div.button span.button.text {\n  font-size: 50%;\n}\n.previewFrame>div.button span.button.dummy {\n  font-size: 100%;\n  height:25px;\n}\n\n.previewFrame>div.button span.button.close {\n  font-size: 85%;\n  font-weight: bold;\n  text-align: center;\n  background-color: #2d3031;\n  color: #babdce;\n  height:35px;\n  width:35px;\n  border-radius: 22px;\n  border: 5px solid #babdce;\n  margin-top:-18px;\n  margin-right:-18px;\n  margin-bottom:3px;\n  margin-left:18px;\n}\n.previewFrame>div.button span.button.close:hover {\n  color: white;\n  border: 5px solid white;\n}\n\n\n.previewCallButton {\n  width: 110px;\n  background-color: #0b47b5;\n  font-size: 50%;\n  padding: 10px;\n  margin: 1px;\n  cursor: pointer;\n  border-radius: 5px;\n}\n\n.previewCallButton:hover {\n  background-color: #072763;\n  color: #9a98de;\n  font-weight: bold;\n}\n\n.pageFrameHeader {\n  font-size: 60%;\n  background-color: rgb(4, 29, 56);\n  color: white;\n  padding: 5px;\n}\n\n.pageFrameHeaderLeft {\n  text-align: left;\n}\n\n.pageFrameHeaderRight {\n  text-align: right;\n}\n\n.PageFrame {\n  display: inline-block;\n  display: flex;\n  background-color: rgb(90, 123, 144);\n  width: 220px;\n  height: 150px;\n  font-size: 1em;\n  margin: 0.1em auto;\n  padding: 0.1em 0em;\n}\n\n.PageFrame .Page {\n  width: 110px;\n  border: 2px solid rgb(126, 100, 113);\n  background-color: rgb(172, 148, 185);\n  height: 140px;\n  margin: 0.0em auto;\n}\n\n.PageFrame .Dummy {\n  background-color: rgb(108, 110, 115);\n  color: rgb(108, 110, 115);\n}\n\n.PageFrame .Page .thumbnail_block {\n  height: 110px;\n  width: 106px;\n  margin: 0.0em auto;\n  background-color: rgb(227, 209, 238);\n}\n\n.thumbnail_block .image_block {\n  height: 110px;\n  width: 106px;\n  margin: 0.0em auto;\n  background-color: rgb(227, 209, 238);\n  cursor: pointer;\n  background-repeat: no-repeat;\n  background-size: contain;\n  background-position: center;\n}\n\n.ExportArea .ExportArea {\n  background-color: rgb(195, 240, 204);\n  border: 1px solid rgb(87, 158, 17);\n  padding: 1em;\n  margin-bottom: 0.2em;\n}\n\n.ExportOrdrList .ExportOrdersListTitle {\n  background-color: rgb(162, 233, 176);\n  padding: 10px;\n  margin-bottom: 0.3em;\n}\n\n.ExportOrdrList .ExportOrdrListFrame {\n  background-color: rgb(222, 232, 219);\n  padding: 15px;\n  border: 1px solid rgb(87, 158, 17);\n  margin-bottom: 0.5em;\n}\n\n.ExportOrdrList .ExportOrdrs {\n  margin-bottom: 0.5em;\n}\n\n.ExportButtons {\n  display: flex;\n  flex-direction: row;\n  flex-wrap: wrap;\n}\n\ndiv.button>div.exportedState {\n  background-color: rgb(148, 222, 164);\n  padding: 0.2em;\n  font-size: 60%;\n  max-width:100%;\n  word-wrap: break-word;\n}\n\n.ExportButtons>div {\n  display: flex;\n  width: 144px;\n  padding: 15px;\n  margin: 2px;\n  border: 1px solid rgb(87, 158, 17);\n  cursor: pointer;\n  border-radius: 3px;\n  background-color: rgb(141, 233, 159);\n}\n\n.ExportButtons>div>div{\n  max-width:100%;\n}\n\ndiv.DownloadLastExportZipButtonFrame, div.DownloadLastExportPdfButtonFrame {\n  padding: 0em;\n}\n\ndiv.button.disable, div.button.enable {\n  background-color: rgb(104, 131, 116);\n  padding: 1em;\n  margin: 0em;\n  width: 100%;\n}\n\ndiv.button.enable {\n  background-color: rgb(148, 219, 86);\n}\n\n.ExportArea .ExportAreaTitle {\n  margin-bottom: 0.2em;\n  text-align: center;\n  padding: 0.3em;\n  font-weight: bold;\n  background-color: rgb(151, 238, 143);\n}\n\n.ExportArea .ExportOrdrs>div {\n  margin: 0.1em;\n  padding: 0.4em;\n  padding-left: 2em;\n  border: 1px solid #aaa;\n  cursor: pointer;\n  background-color: rgb(232, 242, 229);\n}\n\n.ExportArea .ExportOrdrs>div:active {\n  border: 1px solid #666;\n  background-color: rgb(242, 252, 239);\n}\n\n.ExportArea .ExportOrdrs>div:hover {\n  border: 1px solid #999;\n  background-color: rgb(237, 247, 234);\n}\n\n.ExportArea .ExportOrdrs>div.active {\n  font-weight: bold;\n  color: rgb(223, 238, 218);\n  background-color: rgb(70, 187, 35);\n}\n\n.ExportArea .ExportOrdrs>label {\n  display: inline-block;\n  line-height: 2em;\n  margin: 0.1em;\n  padding: 0.4em 0.6em;\n  border: 0px solid #aaa;\n  cursor: pointer;\n  background-color: rgb(232, 242, 229);\n}\n\n.ExportArea .ExportOrdrs>label:active {\n  background-color: rgb(174, 223, 160);\n}\n\n.ExportArea .ExportOrdrs>label:hover {\n  background-color: rgb(237, 247, 234);\n}\n\n.TitleMng {\n  padding: 10px;\n  background-color: rgb(255, 165, 162);\n}\n\n.TitleMng .name {\n  padding-top: 0.5em;\n  padding-bottom: 0.5em;\n  font-weight: bold;\n  background-color: rgb(255, 113, 82);\n}\n\n.TitleMng>.StorageMeter {\n  margin: 0.5em;\n  padding: 0.5em;\n  background-color: rgb(255, 155, 124);\n}\n\n.TitleListFrame, .StorageInitializerFrame, .TitleMng>.TitleNewone {\n  margin: 0.5em;\n  padding: 0.5em;\n  background-color: rgb(255, 155, 124);\n}\n\n.TitleMng .StorageMeterFrame, .StorageInitializerFrame {\n  display: flex;\n  padding: 0.1em;\n  height: 2em;\n}\n\n.TitleMng .StorageMeterFrame div.StorageMeter {\n  line-height: 1.8em;\n  height: 2em;\n  margin-right: 0.5em;\n}\n\n.TitleMng .StorageMeterFrame span.button, .TitleRowRow .button, .TitleNewone .button, .StorageInitializerFrame div.button {\n  display: inline-block;\n  margin-left: 1em;\n  background-color: gray;\n  cursor: pointer;\n  padding: 0.5em 2em;\n  border-radius: 3px;\n}\n\n.TitleMng .StorageMeterFrame span.button {\n  padding: 0.2em 2em;\n}\n\n.TitleRowRow>div, .StorageInitializerFrame>div {\n  padding: 0.2em;\n}\n\n.TitleNewoneRow {\n  margin-left: 1em;\n}\n\n.TitleRowRow {\n  display: flex;\n}\ndiv#menu{\n  position: fixed;\n  top: 4.6em;\n  z-index: 500;\n  width: 100%;\n}\n.MenuFrame {\n  display: flex;\n  width: 100%;\n  max-width: 940px;\n  align-items: stretch;\n}\n\n.MenuFrame a {\n  flex-grow:0;\n  display: inline-block;\n  width: 20%;\n  cursor: pointer;\n  text-decoration: none;\n  min-height: 2.5em;\n  padding: 5px 10px;\n  margin: 2px 1px 0 1px;\n  border: 0px solid rgb(83, 122, 134);\n  border-radius: 5px;\n  background-color: rgb(170, 185, 210);\n  color: rgb(222, 240, 222);\n}\n\na.dummy {\n  display: inline-block;\n  width: 50px;\n  text-decoration: none;\n}\n\n.MenuFrame>a.MenuButton.active:nth-child(1) {\n  background-color: rgb(249, 111, 52);\n}\n\n.MenuFrame>a.MenuButton.active:nth-child(2) {\n  background-color: rgb(104, 65, 199);\n}\n\n.MenuFrame>a.MenuButton.active:nth-child(3) {\n  background-color: rgb(72, 159, 222);\n}\n\n.MenuFrame>a.MenuButton.active:nth-child(4) {\n  background-color: rgb(123, 193, 68);\n}\n\n.MenuFrame>a.MenuButton.active:nth-child(5) {\n  background-color: rgb(80, 50, 60);\n}\n\n.MenuFrame>a.MenuButton.active {\n  font-weight: bold;\n  border-width: 0;\n}\n\nnav, div.scroll-container {\n  display: block;\n  margin: 0 auto;\n  text-align: center;\n}\n\ndiv.main-container {\n  width: 100%;\n  height: 100%;\n}\n\ndiv.main-container {\n  position: absolute;\n  top: 0;\n  padding-top: 8em;\n  height: 100%;\n  padding-bottom: 3em;\n}\n\ndiv.scroll-container {\n  display: block;\n  width: 100%;\n  height: 100%;\n  overflow: auto;\n  scroll-behavior: smooth;\n}\n\ndiv.Splash {\n  position: fixed;\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: 100%;\n  background-color: rgb(241, 253, 255);\n  z-index: 1200;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-direction: column;\n}\n\ndiv.Splash>div.splashTitle {\n  width:360px;\n  height:300px;\n  background-color: #e8eeef;\n  border: solid 1px #052240;\n  padding:1em;\n  border-bottom:203px solid #052240;\n}\n\ndiv.Splash div.appTitle {\n  color: #1664a2;\n  font-size: 500%;\n  padding-top: 30px;\n  letter-spacing: -0.05em;\n  padding-left: 1%;\n  font-weight: bold;\n}\n\ndiv.Splash div.appVerion {\n  font-size: 100%;\n  padding-top: 0%;\n  padding-left: 50%;\n  color: rgb(0, 232, 249);\n}\n\ndiv.Splash div.message {\n  font-size: 200%;\n  padding-top: 10%;\n}\n\ndiv.Splash div.message>div {\n  text-align: center;\n}\n\ndiv.loader {\n  text-align: center;\n  font-family: \'Nunito\', sans-serif;\n  font-size: 1em;\n  color: transparent;\n  letter-spacing: 0.01em;\n}\n\n.loader span {\n  text-shadow:\n    0 0 2px rgba(204, 208, 212, 0.9),\n    0 15px 25px rgba(0, 0, 0, 0.3),\n    0 -2px 3px rgba(0, 0, 0, 0.1),\n    0 -5px 10px rgba(255, 255, 255, 0.5),\n    0 5px 10px rgba(0, 0, 0, 0.3),\n    0 3px 4px rgba(255, 255, 255, 0.2),\n    0 0 20px rgba(255, 255, 255, 0.45);\n  animation: loading 0.95s ease-in-out infinite alternate;\n}\n\n@keyframes loading {\n  to {\n    text-shadow:\n      0 0 2px rgba(204, 208, 212, 0.2),\n      0 0 3px rgba(0, 0, 0, 0.02),\n      0 0 0 rgba(0, 0, 0, 0),\n      0 0 0 rgba(255, 255, 255, 0),\n      0 0 0 rgba(0, 0, 0, 0),\n      0 0 0 rgba(255, 255, 255, 0),\n      0 0 0 rgba(255, 255, 255, 0);\n  }\n}\n\n.loader span:nth-child(2) {\n  animation-delay: 0.15s;\n}\n\n.loader span:nth-child(3) {\n  animation-delay: 0.30s;\n}\n\n.loader span:nth-child(4) {\n  animation-delay: 0.45s;\n}\n\n.loader span:nth-child(5) {\n  animation-delay: 0.60s;\n}\n\n.loader span:nth-child(6) {\n  animation-delay: 0.75s;\n}\n\n.loader span:nth-child(7) {\n  animation-delay: 0.90s;\n}\n\n\n#Dialog{\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  position: fixed;\n  top:0;\n  left: 0;\n  z-index: 1200;\n  width: 100%;\n  height: 100%;\n  background-color:rgba(10, 10, 10, 0.5);\n}\n#Dialog>div{\n  width: 320px;\n  height: 300px;\n\n  background-color:#dce4e8;\n}\n#Dialog>div div.dialogTitle{\n  height:3em;\n  padding:0.5em;\n}\n#Dialog>div div.dialogInfo{\n  height:13em;\n  padding:0.5em;\n}\n#Dialog>div div.dialogDeside{\n  height:3em;\n  padding:0.2em;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-direction: row;\n}\n#Dialog>div div.dialogDeside>div{\n  cursor: pointer;\n  padding: 0.2em;\n  width:130px;\n  background-color: #96e8d8;\n  margin: 0 0.2em;\n  border-radius: 3px;\n}\n.display_none {\n  display: none;\n}\n',""])},function(t,e){t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var i=function(t,e){var i=t[1]||"",r=t[3];if(!r)return i;if(e&&"function"==typeof btoa){var s=function(t){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t))))+" */"}(r),a=r.sources.map(function(t){return"/*# sourceURL="+r.sourceRoot+t+" */"});return[i].concat(a).concat([s]).join("\n")}return[i].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+i+"}":i}).join("")},e.i=function(t,i){"string"==typeof t&&(t=[[null,t,""]]);for(var r={},s=0;s<this.length;s++){var a=this[s][0];"number"==typeof a&&(r[a]=!0)}for(s=0;s<t.length;s++){var n=t[s];"number"==typeof n[0]&&r[n[0]]||(i&&!n[2]?n[2]=i:i&&(n[2]="("+n[2]+") and ("+i+")"),e.push(n))}},e}},function(t,e,i){var r={},s=function(t){var e;return function(){return void 0===e&&(e=t.apply(this,arguments)),e}}(function(){return window&&document&&document.all&&!window.atob}),a=function(t){var e={};return function(t){if("function"==typeof t)return t();if(void 0===e[t]){var i=function(t){return document.querySelector(t)}.call(this,t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}e[t]=i}return e[t]}}(),n=null,o=0,l=[],c=i(20);function h(t,e){for(var i=0;i<t.length;i++){var s=t[i],a=r[s.id];if(a){a.refs++;for(var n=0;n<a.parts.length;n++)a.parts[n](s.parts[n]);for(;n<s.parts.length;n++)a.parts.push(f(s.parts[n],e))}else{var o=[];for(n=0;n<s.parts.length;n++)o.push(f(s.parts[n],e));r[s.id]={id:s.id,refs:1,parts:o}}}}function d(t,e){for(var i=[],r={},s=0;s<t.length;s++){var a=t[s],n=e.base?a[0]+e.base:a[0],o={css:a[1],media:a[2],sourceMap:a[3]};r[n]?r[n].parts.push(o):i.push(r[n]={id:n,parts:[o]})}return i}function u(t,e){var i=a(t.insertInto);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=l[l.length-1];if("top"===t.insertAt)r?r.nextSibling?i.insertBefore(e,r.nextSibling):i.appendChild(e):i.insertBefore(e,i.firstChild),l.push(e);else if("bottom"===t.insertAt)i.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var s=a(t.insertInto+" "+t.insertAt.before);i.insertBefore(e,s)}}function p(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=l.indexOf(t);e>=0&&l.splice(e,1)}function g(t){var e=document.createElement("style");return void 0===t.attrs.type&&(t.attrs.type="text/css"),m(e,t.attrs),u(t,e),e}function m(t,e){Object.keys(e).forEach(function(i){t.setAttribute(i,e[i])})}function f(t,e){var i,r,s,a;if(e.transform&&t.css){if(!(a=e.transform(t.css)))return function(){};t.css=a}if(e.singleton){var l=o++;i=n||(n=g(e)),r=w.bind(null,i,l,!1),s=w.bind(null,i,l,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",m(e,t.attrs),u(t,e),e}(e),r=function(t,e,i){var r=i.css,s=i.sourceMap,a=void 0===e.convertToAbsoluteUrls&&s;(e.convertToAbsoluteUrls||a)&&(r=c(r));s&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */");var n=new Blob([r],{type:"text/css"}),o=t.href;t.href=URL.createObjectURL(n),o&&URL.revokeObjectURL(o)}.bind(null,i,e),s=function(){p(i),i.href&&URL.revokeObjectURL(i.href)}):(i=g(e),r=function(t,e){var i=e.css,r=e.media;r&&t.setAttribute("media",r);if(t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}.bind(null,i),s=function(){p(i)});return r(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;r(t=e)}else s()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=s()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var i=d(t,e);return h(i,e),function(t){for(var s=[],a=0;a<i.length;a++){var n=i[a];(o=r[n.id]).refs--,s.push(o)}t&&h(d(t,e),e);for(a=0;a<s.length;a++){var o;if(0===(o=s[a]).refs){for(var l=0;l<o.parts.length;l++)o.parts[l]();delete r[o.id]}}}};var y=function(){var t=[];return function(e,i){return t[e]=i,t.filter(Boolean).join("\n")}}();function w(t,e,i,r){var s=i?"":r.css;if(t.styleSheet)t.styleSheet.cssText=y(e,s);else{var a=document.createTextNode(s),n=t.childNodes;n[e]&&t.removeChild(n[e]),n.length?t.insertBefore(a,n[e]):t.appendChild(a)}}},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var i=e.protocol+"//"+e.host,r=i+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(t,e){var s,a=e.trim().replace(/^"(.*)"$/,function(t,e){return e}).replace(/^'(.*)'$/,function(t,e){return e});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(a)?t:(s=0===a.indexOf("//")?a:0===a.indexOf("/")?i+a:r+a.replace(/^\.\//,""),"url("+JSON.stringify(s)+")")})}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.array=Array.isArray,e.primitive=function(t){return"string"==typeof t||"number"==typeof t}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.htmlDomApi={createElement:function(t){return document.createElement(t)},createElementNS:function(t,e){return document.createElementNS(t,e)},createTextNode:function(t){return document.createTextNode(t)},createComment:function(t){return document.createComment(t)},insertBefore:function(t,e,i){t.insertBefore(e,i)},removeChild:function(t,e){t.removeChild(e)},appendChild:function(t,e){t.appendChild(e)},parentNode:function(t){return t.parentNode},nextSibling:function(t){return t.nextSibling},tagName:function(t){return t.tagName},setTextContent:function(t,e){t.textContent=e},getTextContent:function(t){return t.textContent},isElement:function(t){return 1===t.nodeType},isText:function(t){return 3===t.nodeType},isComment:function(t){return 8===t.nodeType}},e.default=e.htmlDomApi},function(t,e,i){"use strict";i.r(e);i(16);class r{constructor(){}static getCurrentPointedElm(t){const e=t.touches,i=e?e[0]?e[0].pageX:0:t.pageX,r=e?e[0]?e[0].pageY:0:t.pageY,s=window.pageXOffset,a=window.pageYOffset;return document.elementFromPoint(i-s,r-a)}static clearSideElmClass(t,e){if(!t||!t.style)return;t.style.opacity="1";const i=t.parentNode.childNodes;for(let t=0;t<i.length;t++){i[t].classList.remove(e)}}static create(t,e,i){return r.ce("div",t,e,i)}static createInput(t,e,i){return r.ce("input",t,e,i)}static createText(t,e,i){return r.ce("text",t,e,i)}static createFile(t,e,i){return r.ce("input",t,e,i,"file")}static createCanvas(t,e,i){return r.ce("canvas",t,e,i)}static createImage(t,e,i){return r.ce("img",t,e,i)}static createUl(t,e,i){return r.ce("ul",t,e,i)}static createLabel(t,e,i,s){const a=r.ce("label",t,e,i);return a.setAttribute("for",s),a}static createLi(t,e,i){return r.ce("li",t,e,i)}static createSpan(t,e,i){return r.ce("span",t,e,i)}static createStrong(t,e,i){return r.ce("strong",t,e,i)}static createA(t,e,i){return r.ce("a",t,e,i)}static ce(t,e,i,r,s){const a=document.createElement(t);return a.className=i,e&&(a.id=e),"input"===t&&r?(a.setAttribute("value",r),s&&a.setAttribute("type",s)):r&&(a.textContent=r),a}static on(t,e,i){t.addEventListener(e,i,!1)}static off(t,e,i){t.removeEventListener(e,i,!1)}static append(t,e){t.appendChild(e)}static insertFirst(t,e){t.hasChildNodes()?t.insertBefore(e,t.childNodes[0]):t.appendChild(e)}static getBodyElm(){return document.getElementsByTagName("body")[0]}static attachBody(t){document.getElementsByTagName("body")[0].appendChild(t)}static detacthBodyById(t){const e=documet.getElementById(t);document.getElementsByTagName("body")[0].removeChild(e)}static removeChild(t){t.parentNode.removeChild(t)}static remove(t){const e=documet.getElementById(t);e.parentNode&&e.parentNode.removeChild(e)}static removeChildren(t){const e=documet.getElementById(t);for(;e.firstChild;)e.removeChild(e.firstChild)}static setStyles(t,e){for(let i in e)t.style[i]=e[i]}static text(t,e){t.textContent=e}static emit(t,e,i=!0,r=!0){const s=document.createEvent("HTMLEvents");return s.initEvent(e,i,r),t.dispatchEvent(s)}}var s=i(7),a=i.n(s),n=i(8),o=i.n(n),l=i(9),c=i.n(l),h=i(10),d=i.n(h),u=i(11),p=i.n(u),g=i(12),m=i.n(g),f=i(13),y=i.n(f),w=i(14),b=i.n(w);let A=i(24);console.log(A);const v=y.a,x=(b.a,A.init([a.a,o.a,c.a,d.a,p.a,m.a])),P=[];class S{static addBaseCLassese(t){if(t)if(Array.isArray(t))for(let e of t)P.push(e);else P.push(t)}static deepClone(t){const e=new MessageChannel,i=e.port1,r=e.port2;return new Promise(e=>{i.onmessage=(t=>{e(t.data)}),r.postMessage(t)})}static simpleDeepCloneSerialized(t){return JSON.parse(JSON.stringify(t))}static simpleDeepClone(t,e,i=0){const r=i+1,s=e||(Array.isArray(t)?[]:{});if(r>10)return console.log(t),console.log(r),s;for(let e in t){const i=t[e];if(i&&"object"==typeof i&&!i.byteLength){let t=null;for(let e of P)if(i instanceof e){t=new e;break}s[e]=S.simpleDeepClone(i,t,r)}else try{s[e]=i}catch(t){throw console.error(t),console.log(s),t}}return s}static singleDeepClone(t){const e={};for(let i in t){let r=t[i];e[i]=r}return e}static singleDeepCloneWithoutFuncs(t){const e={};for(let i in t){let r=t[i];"function"!=typeof r&&(e[i]=r)}return e}static deepVnodeClone(t){if(!t)return t;const e={sel:t.sel,data:S.simpleDeepClone(t.data),children:void 0,text:t.text,elm:t.elm,key:t.key};for(let i in t.data)t.data[i]&&(e.data[i]=t.data[i]);if(t.children&&t.children.length>0){e.children=[];for(let i of t.children)e.children.push(S.deepVnodeClone(i))}return e}static async recalcSize(t,e,i=0,r=0,s){let a=0;if(!e)return 1;if(e.byteLength&&e.byteLength>0){a+=i+e.byteLength+1+r}else if("function"==typeof e)continu;else if("number"==typeof e)a+=i+4+1+r;else if("string"==typeof e){a+=1*i+1*e.length+1+1*r}else if("object"==typeof e&&Array.isArray(e)){let n=0;a+=2+r;for(let i in e){const r=e[i];a+=await S.recalcSize(t,r,0,0,s)+n,n=1}a+=i+1+r}else if("object"==typeof e){a+=i+await S.calcSize(t,e,s)+1+r}return 1*a}static async calcSize(t,e,i={size:0}){if(!e)return 1;let r=0;for(let s in e){const a=e[s];if("pk"===s&&0===a.indexOf("Binary-")){const e=1*(s+"").length,n=await t.get(a);i.size+=await S.recalcSize(t,n,e,r,i);continue}const n=1*(s+"").length;i.size+=await S.recalcSize(t,a,n,r,i),r=1}return 1*i.size}}class D{constructor(){this.selectorMap=new Map}getElementById(t,e){let i=this.getElements(t,"#"+e);return i.length<1?null:i[0]}getElementsByClass(t,e){return this.getElements(t,"."+e)}patch(t,e,i){if(!i&&"string"==typeof e)return console.log("patch00a â˜…ERRORâ˜… of Patch newNode:"+i+"/selector:"+e),t;if(!i){this.isValidNode(t,"vnode");x(t,e);return e}if(!e){this.isValidNode(t,"vnode");x(t,i);return i}const r=this.prePatch(t,e,i);x(t,r),this.getElements(r,e,!1,new Map,null);return this.isValidNode(r,"cloneNode"),r}isValidNode(t,e,i,r){if(t){if(t.elm&&!t.elm.parentNode){if(i){i.childNodes.length>r?t.elm=i.childNodes[r]:i.appendChild(t.elm)}}else if(!t.elm&&i){const e=i.childNodes.length;e>r?t.elm=i.childNodes[r]:console.warn("â˜…â˜…â˜…invalid parent index!"+r+"/length:"+e+"/vnode.sel:"+t.sel)}if(t.children)for(let i in t.children){let r=t.children[i];r&&this.isValidNode(r,e+"_c_",t.elm?t.elm.parentNode:null,i)}}else console.log("â˜…â˜…null node!"+e+"/parentNode:"+i)}log(t){this.isShowLog&&console.log(t)}prePatch(t,e,i){const r=S.deepVnodeClone(t),s=new Map;this.log("prepatch01aa:"+JSON.stringify(t));const a=this.getElements(r,e,!1,s,null);let n=!1;this.log("prepatch01aã€€nodesï¼š"+a),this.log(a),this.log(s.size+"/"+r.children);for(let t of a){this.log("prepatch01a");let e=S.deepVnodeClone(i);this.log("prepatch01b");for(let[i,r]of s)if(this.log(i+"/"+t),i===t){let i=r.children;for(let r in i){let s=i[r];if(s===t){i[r]=e,n=!0,this.log("â˜…patch01c AS REPLACE! children.length:"+i.length+"/index:"+r+"/target.sel:"+s.sel+"/newOne.sel:"+e.sel+"/text:"+e.text);break}this.log("-patch01d ! children.length:"+i.length+"/index:"+r+"/target.sel:"+s.sel)}break}}return this.log("patch02 END of prePatch"),n?r:t}getElements(t,e,i=!1,r=new Map,s){let a=[];if(!e||"string"!=typeof e)return this.log("getElements selector:"+e),a;let n=e.split(/ |>/),o=e;if(n.length>=1){let l=n.shift();if(this.log(l),!l)return a;if(this.isMatch(t.sel,l)){if(this.log("selectors.length:"+n.length),n.length<1)return a.push(t),this.log(s),s&&r.set(t,s),this.log(a),a;o=e.substring(l.length+1,e.length),this.log("nextSelector:"+o)}else{if(i)return a;o=e}if(!t.children)return this.log("getElements 01a"),a;let c=">"===e.substring(l.length,l.length+1);for(let e of t.children)a=a.concat(this.getElements(e,o,c,r,t))}return a}getSelectorMap(t){let e=this.selectorMap.get(t);if(e)return e;if(e=new Map,!t)return e;const i=t.split(/\.|#/g),r=t.indexOf("#")>=0?t.split(/#/g)[1].split(/\./g)[0]:"",s=[];let a="",n="";for(let e of i)r===e?a=e:t.indexOf("."+e)>=0?s.push(e):n=e;return e.set("id",a),e.set("class",s),e.set("tag",n),this.selectorMap.set(t,e),e}isMatch(t,e){this.isShowLog&&console.log("isMatch sel:"+t+"/selector:"+e);const i=this.getSelectorMap(t),r=this.getSelectorMap(e),s=r.get("tag"),a=r.get("id");if(this.isShowLog&&console.log("isMatch tagName:"+s+"/id:"+a),""!==s&&i.get("tag")!==s)return this.isShowLog&&console.log("false:01 sel:"+t+"/selector:"+e),!1;if(""!==a&&i.get("id")!==a)return this.isShowLog&&console.log("false:02 sel:"+i.get("id")+"/selector:"+a),!1;const n=i.get("class"),o=r.get("class");for(let i of o){let r=!1;for(let t of n)i===t&&(r=!0);if(!1===r)return this.isShowLog&&console.log("false:03 sel:"+t+"/selector:"+e),!1}return""===e?(this.isShowLog&&console.log("false:04 sel:"+t+"/selector:"+e),!1):(this.isShowLog&&console.log("isMatch!!!! sel:"+t+"/selector:"+e),!0)}}const k=["Attach"];class B{constructor(){}static getBaseActions(){return k}static createAction(t,e,i=null){return{type:t,data:e,storeKey:i}}static createBaseAction(t,e,i,r=null){const s=i&&"object"==typeof i?i:{};return s.targetView=e,s.selector=e?e.id:null,s.storeKey=r,{type:t,data:s}}static creatAttachAction(t,e,i,r=null){const s=i&&"object"==typeof i?i:{};return s.parentView=t,s.selector=e.id,s.storeKey=r,{type:"Attach",data:s}}static createShowViewAction(t,e,i,r,s=null){return B.createGoOtherViewAction(t,null,e,i,r,s)}static createGoOtherViewAction(t,e,i,r,s,a=null){let n=s;return e||i?(s||(n={}),n.view=e,n.oldVnode=i,n.selector=r,{type:t,data:n,storeKey:a}):(console.warn("createGoOtherViewAction is null!"),{type:t,data:n,storeKey:a})}static isEquals(t,e){return!(!t||!e||t.type!==e.type)}}const I={},E=[];class C{constructor(){this.queue=[]}addActiveView(t,e,i){const r=t.id,s=e.id,a=this.findActivViews(I,r);if(a&&a.primaryView){const t=a[s];t&&t.primaryView?(t.primaryView=e,t.parent=a):i?(i.parent=a,a[s]=i):a[s]={primaryView:e,parent:a}}else I[s]=i||{primaryView:e,parent:I};this.loadAllActiveViews()}changeActiveView(t,e,i){const r=t.id,s=this.findActivViews(I,r);if(!s)return;const a=s.parent;delete a[r];const n=e.id;return i&&i.primaryView?(a[n]=i,i.primaryView=e,i.parent=a):a[n]={primaryView:e,parent:a},this.loadAllActiveViews(),s}removeActiveView(t){const e=t.id,i=this.findActivViews(I,e);if(i)return delete i.parent[e],this.loadAllActiveViews(),i}findActivViews(t,e,i,r){let s=null;const a=r?r+1:1;if(a>5)return null;if(t)for(let r in t){if(void 0===r||"undefined"===r||"parent"===r||"primaryView"===r)continue;const n=t[r];n.primaryView&&n.parent&&(i&&i(n),r===e?s=n:n&&"view"!==r&&"0"!==r&&(s=this.findActivViews(n,e,i,a)))}return s}loadAllActiveViews(){const t=[];this.findActivViews(I,"all",e=>{t.push(e)});const e=E.length;for(let t=0;t<e;t++)E.pop();for(let e of t)e.primaryView&&e.parent&&E.push(e.primaryView);return E}getActiveViewList(){return E}}const K=new Map,N=new Map,L="aaa";class T{constructor(t){}static cloneStore(t,e){return N.set(e,t),S.simpleDeepClone(t)}static getTemp(t=L,e){return N.has(e)?N.get(e):null}static getStore(t=L,e){const i=K.has(t)?K.get(t):null,r=i?S.simpleDeepClone(i):{};return r.oldVnode=i?i.oldVnode:null,r}static setStore(t,e=L,i){const r=t?S.simpleDeepClone(t):{},s=K.has(e)?K.get(e):null;for(let t in s){const e=r[t];s[t];(e||null!==e&&void 0!==e)&&(s[t]=e)}for(let t in s){const e=r[t],i=s[t];!e&&null!==e&&i&&(r[t]=i)}r.oldVnode=t?t.oldVnode:null,K.set(e,r)}}const O=new C,M=new Map;class R{constructor(t){this.view=t,this.updateMap=new Map,this.updateQueue=[]}static add(t,e){if(!t)return!1;const i=t.type;if(!i)return!1;if(M.has(i)){const t=M.get(i);if(t.includes(e))return!1;t.push(e)}else M.set(i,[e]);return!0}static remove(t){const e=t.type;if(!e)return!1;if(M.has(e)){const t=M.get(e);if(t.includes(reducer))return!1;{const e=t.indexof(reducer);t.splice(e,1)}}return!0}dispatch(t){return new Promise((e,i)=>{setTimeout(()=>{this.dispatchExecute(t).then(t=>{e(t)},t=>{i(t)})})})}async dispatchExecute(t){const e=t.type;if(!e)return!1;const i=t.data,r=t.storeKey,s=t.constructor;let a=T.getStore(r,s),n=this.view;if(M.has(e)){const i=M.get(e);for(let t of i){const e=t.getInitializeKeys();for(let t of e)a[t]=null;break}for(let e of i)await e.preReduce(a,t).catch(t=>{console.error(t)}),await e.reduce(a,t).catch(t=>{console.error(t)}),await e.postReduce(a,t).catch(t=>{console.error(t)})}const o=T.cloneStore(a,t);let l=null;if(a.isOrverride&&t.data.view){if(n=t.data.views,!1===this.view.onViewHide(n,i))return;l=await this.callUpdate(n,i,r,t).catch(t=>{console.error(t)}),await this.view.onViewHidden(n,i)}else l=await this.callUpdate(n,i,r,t).catch(t=>{console.error(t)});return T.setStore(o,r,s),!0}callUpdate(t,e,i,r){return new Promise((s,a)=>{const n=[],o=O.getActiveViewList();for(let s of o){const o=T.getTemp(i,r);if(t===s){const i=t.updateReactiveTheTargetView(o,e,r);if(i){if(!i.then)return alert("your view has override method name 'updateReactiveTheTargetView'! activeView.id):"+s.id),void a(i);n.push(i.then(()=>{},t=>{console.error(t)}))}}else{const t=s.updateReactive(o,e);if(t){if(!t.then)return alert("your view has override method name 'updateReactive'! activeView.id):"+s.id),void a(t);n.push(t.then(()=>{},t=>{console.error(t)}))}}}n.length>0?Promise.all(n).then(s,a):s(t)})}}class z{constructor(){}static create(t){return new R(t)}static createStandAlone(){return new R(!1)}}const U=(t,e)=>{let i={};t&&"object"==typeof t?(t.props||(t.props={}),i=t):i={props:{}};for(let t in e)i.props[t]=e[t];return i},F=(t,e,i,r={},s,a)=>{const n=t+(e&&"string"==typeof e?"#"+e:"")+(i?Array.isArray(i)&&i.length>0&&"string"==typeof i[0]?"."+i.join("."):Array.isArray(e)&&e.length>0&&"string"==typeof e[0]?"."+e.join("."):"":""),o=s&&Array.isArray(s)?s:r&&Array.isArray(r)?r:Array.isArray(i)&&i.length>0&&"object"==typeof i[0]?i:[],l=a||(s&&"string"==typeof s?s:r&&"string"==typeof r?r:i&&"string"==typeof i?i:"");let c="string"==typeof r||Array.isArray(r)?{}:r;void 0!==s&&void 0===a&&i&&!Array.isArray(i)&&"object"==typeof i?c=i:void 0===s&&void 0===a&&e&&!Array.isArray(e)&&"object"==typeof e&&(c=e);Object.prototype.toString;const h=o.length>0?o:l;return v(n,c,h)},_=(t,e,i,r,s)=>F("a",t,e,U(r,{href:i}),s,null),V=(t,e,i,r,s)=>F("div",t,e,i,r,s),j=(t,e,i,r,s)=>F("span",t,e,i,r,s),W=(t,e,i,r,s)=>F("img",t,e,U(s,{alt:i,src:r}),null,null),Z=(t,e,i,r,s)=>F("input",t,e,U(i,{type:"file"}),null,s),X=(t,e,i,r,s)=>F("input",t,e,U(i,{type:r,value:s}),null,s),Y=(t,e,i,r)=>F("input",t,e,U(i,{type:"checkbox",value:r}),null,r),H=(t,e,i,r,s)=>F("label",t,e,i,r,s),G=(t,e,i,r,s)=>F("option",t,e,i,r,s),J=(t,e,i,r,s,a,n="")=>{const o=[],l=Array.isArray(r);for(let t in r){const e=r[t];if(!l&&t===s||l&&e+""==s+""){const i=G("",[""],{attrs:{value:l?e:t,selected:"true"}},e+n);o.push(i)}else{const i=G("",[""],{attrs:{value:l?e:t}},e+n);o.push(i)}}const c={props:{name:i}};return a&&(c.on=a),((t,e,i,r,s)=>F("select",t,e,i,r,s))(t,e,c,o)};class q{constructor(){}static getGotoAnotherViewAction(t,e,i){return t||console.log("getGotoAnotherViewAction view:"+t),B.createGoOtherViewAction("GotoAnotherView",t,null,e,i)}static getShowViewAction(t,e,i){return t||console.log("getShowViewAction oldVnode:"+t),B.createShowViewAction("ShowView",t,e,i)}}const Q=[];class ${constructor(t){if(this.isBaseUse=t,t){const t=B.getBaseActions();for(let e in t){const i=t[e];this.atatch({type:i})}}}addInitializeKey(t){Q.push(t)}getInitializeKeys(){const t=[];for(let e of Q)t.push(e);return t}atatch(t){R.add(t,this)}detach(t){R.delete(t,this)}async preReduce(t,e){return t.isOrverride=!1,t}async reduce(t,e){return t.isOrverride=!0,t.oldVnode=e.data.oldVnode,t.selector="#"+e.data.selector,t}async postReduce(t,e){return t}}new $(!0);new class extends ${constructor(){super(),this.atatch(q.getGotoAnotherViewAction()),this.atatch(q.getShowViewAction())}async reduce(t,e){return B.isEquals(q.getGotoAnotherViewAction(),e)||B.isEquals(q.getShowViewAction(),e)&&(t.isOrverride=!0,t.oldVnode=e.data.oldVnode,t.selector="#"+e.data.selector),t}};const tt=new C,et={rootVnode:null,ms:null};class it{constructor(t,e,i=!1){this.dispatcher=z.create(this),this.id=t,this.className=e,this.isNotRenderWrap=i,this.ms=et.ms,this.es=new D;const r=T.getStore();this.onViewLoad(r),this.currentVnode=null,this.onViewLoaded(r),this.updateReactiveCallCount=0,this.updateReactiveCallTimer=null,this.updateReactivePromise=new Map,this.updateCount=0}static ModalWindowClass(){return"ModalWindow"}static setRootVnode(t){et.rootVnode=t}static setMainService(t){t&&(et.ms=t)}patch(t,e){return this.patchFromOtherVnode(et.rootVnode,t,e)}initialPatch(){document.getElementsByTagName("body")[0].innerHTML='<div id="rootNodeA"><p>ï½˜</p></div>';let t=document.getElementById("rootNodeA");this.updateCount<1&&(this.patchFromOtherVnode(t,null,this.render()),this.updateReactiveTheTargetView({oldVnode:this.currentVnode,selector:null,isOrverride:!0}).catch(t=>{console.error(t)}))}patchFromOtherVnode(t,e,i){let r=null!==e?et.rootVnode:t;const s=this.es.patch(r,e,i);return s.data.name=this.name+Date.now(),et.rootVnode=s,this.currentVnode=this.es.getElements(s,"#"+this.id)[0],s}prePatch(t,e,i){return this.currentVnode||(this.currentVnode=this.es.getElements(et.rootVnode,"#"+this.id)[0]),this.currentVnode||console.error("!!!!prePatch nodeFrame.rootVnode: "+JSON.stringify(et.rootVnode)),this.currentVnode.data.name=this.name+Date.now(),this.es.isShowLog=i,this.currentVnode=this.es.prePatch(this.currentVnode,t,e),this.es.isShowLog=null,this.currentVnode}async updateReactiveTheTargetView(t,e,i){const r=t.oldVnode,s=t.selector,a=t.isOrverride;a?(this.onPreViewBuild(r,t),this.currentVnode=this.currentVnode?this.currentVnode:this.renderWrap(t)):this.currentVnode=this.es.getElements(et.rootVnode,"#"+this.id)[0],await this.onViewShow(t,e).catch(t=>{console.error(t)}),a?r?this.patchFromOtherVnode(r,s,this.currentVnode):this.patchFromOtherVnode(null,"#"+this.id,this.currentVnode):this.patch("#"+this.id,this.currentVnode),this.updateCount++,this.updateCount<=2&&(!i||"Attach"===i.type)?(this.updateCount++,await this.onAfterAttachWrap(t,e)):setTimeout(()=>{this.updateCount=0},2e3),await this.onViewShown(t,e).catch(t=>{console.error(t)})}updateReactive(t,e){return new Promise((i,r)=>{if(this.updateReactiveCallTimer){const t=this.updateReactiveCallTimer,e=this.updateReactivePromise.get(t);clearTimeout(this.updateReactiveCallTimer),e.resolve(),setTimeout(()=>{this.updateReactivePromise.delete(t)})}this.updateReactiveCallTimer=setTimeout(()=>{t.oldVnode,t.selector,t.isOrverride;this.currentVnode=this.es.getElements(et.rootVnode,"#"+this.id)[0],this.onViewShow(t,e).then(()=>{this.patch("#"+this.id,this.currentVnode),this.onViewShown(t,e).then(()=>{i()},t=>{console.error(t),r(t)})},t=>{console.error(t),r(t)})}),this.updateReactivePromise.set(this.updateReactiveCallTimer,{resolve:i,reject:r})})}init(){}async attach(t=this.parentView,e,i){this.parentView=t;let r=e;if(e||(r=this.id),this.isAttached())return void alert("attached!!!");const s=T.getStore();this.onPreViewBuild(s),this.activeViewTree=tt.addActiveView(t,this,this.activeViewTree);const a=B.creatAttachAction(t,this,i);await this.dispatch(a)}isAttached(){return this.es.getElements(et.rootVnode,"#"+this.id)[0]===this.currentVnode}async dispatch(t){await this.dispatcher.dispatch(t)}getElementById(t){const e=this.es.getElements(this.currentVnode,"#"+t);return e&&e.length>0?e[0]:null}async onAfterAttachWrap(t,e){this.updateCount>2||await this.onAfterAttach(t,e)}async onAfterAttach(t,e){this.currentVnode}changeAnotherView(t,e,i){this.onViewHide(i,store,actionData);const r=B.creatAttachAction(t,this,data);this.dispatch(r),this.onViewHidden(i,store,actionData)}onViewLoad(t,e){}onViewLoaded(t,e){}onPreViewBuild(t,e){}async onViewShow(t,e){}async onViewShown(t,e){}async onViewHide(t,e,i){return!0}async onViewHidden(t,e,i){}render(){return r.create("BaseView","BaseView")}renderWrap(t,e){const i=this.className?Array.isArray(this.className)?this.className:[this.className]:[];return this.isNotRenderWrap?this.render(t,e):V(this.id,i,{},[this.render(t,e)])}getAnker(){return this.elm}show(){this.currentVnode.elm.style.display=""}close(){this.currentVnode.elm.style.display="none"}}class rt extends it{constructor(t){super("header","header"),this.titleText=this.ms.getAppTitle(),this.Version=this.ms.getAppVersion()}render(){const t=j("",["MainTitle"],this.titleText),e=j("",["Version"],this.Version);return V("aaa",{style:{color:"#000"}},[V("title",["title"],[t,e])])}}class st{constructor(){}static creatSelectAction(t,e,i=null){return B.createBaseAction("selectMenu",t,e,i)}static getStoreKey(){return"menuSelect"}}var at={dbName:"CopiBon",ua:navigator.userAgent.replace(/[\.0-9]+/g,"x"),domain:window.location};class nt{static currentTables(t,e){return e||[t]}static isMutch(t,e){if(void 0===e||null===e)return!1;if(Array.isArray(e)){for(let i of e)if(nt.isMutch(t,i))return!0;return!1}for(let i in e){let r=e[i];if("object"==typeof r){if(nt.isMutch(t,r))return!0}else{if(t[i]!==r)return!1}}return!0}static makeKeyRange(t,e,i,r){return void 0===i&&void 0===r?IDBKeyRange.bound(t,e,!1,!1):IDBKeyRange.bound(t,e,i,r)}static makeKeyRangeUpper(t,e){return!0!==e?IDBKeyRange.upperBound(t):IDBKeyRange.upperBound(t,e)}static makeKeyRangeLower(t,e){return!0!==isNotEqualStart?KeyRange.lowerBound(t):IDBKeyRange.lowerBound(t,e)}static makeKeyRangeOnly(t){return!0!==isNotEqualStart?IDBKeyRange.only(t):IDBKeyRange.lowerBound(end,isNotEqualEnd)}static buildKeyPath(t,e,i,r,s){let a=[];return void 0!==t&&a.push((t+"").split("&").join("&amp;").split(".").join("&#046;")),void 0!==e&&a.push((e+"").split("&").join("&amp;").split(".").join("&#046;")),void 0!==i&&a.push((i+"").split("&").join("&amp;").split(".").join("&#046;")),void 0!==r&&a.push((r+"").split("&").join("&amp;").split(".").join("&#046;")),void 0!==s&&a.push((s+"").split("&").join("&amp;").split(".").join("&#046;")),a.join("")}}const ot="readonly",lt="readwrite";class ct{constructor(t){this.IDBKeyRange=window.IDBKeyRange,this.indexedDB=window.indexedDB,this.dbName=t,this.keyPathMap={},this.db=null,this.lastVersion=null,this.isUpdateOpen=!1,this.timer=null,this.isDBClosed=!0,this.tableCache={}}getOpenDB(t){return new Promise((e,i)=>{if(this.lastVersion=t,this.lastVersion&&this.db)this.db.close(),this.isUpdateOpen=!0;else{if(this.db&&!1===this.isDBClosed)return void e(this.db);this.lastVersion?this.isUpdateOpen=!0:this.isUpdateOpen=!1}let r=this.indexedDB.open(this.dbName,t);r.onsuccess=(t=>{this.db=t.target.result,this.isDBClosed=!1,e(this.db)}),r.onupgradeneeded=(t=>{this.db=t.target.result,this.isDBClosed=!1,e(this.db)}),r.onabort=(t=>{e(t)}),r.onerror=(t=>{i(t)})})}closeDB(){this.isUpdateOpen?(this.db.close(),this.isDBClosed=!0):(this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.db.close(),this.isDBClosed=!0},1e3))}cacheClear(){const t=[];for(let e in this.tableCache)t.push(e);for(let e of t){const t=this.tableCache[e];for(let e in t)delete t[e]}}setCache(t,e,i){if(!i||!i.data)return;const r=i.data;for(let t in r){const e=r[t];if(e&&e.byteLength)return}this.tableCache[t]||(this.tableCache[t]={}),this.tableCache[t][e]=i}getCache(t,e){const i=this.tableCache[t];return i?i[e]:null}getObjectStore(t,e,i,r){r===ot&&this.cacheClear();let s=t.transaction(i,r);return s.oncomplete=(t=>{this.closeDB()}),s.onerror=(t=>{this.closeDB()}),s.objectStore(e)}throwNewError(t){return e=>{throw console.error(e),e.stack?console.log(e.stack):console.log(e.message,e),console.error(t||"/"+e),new Error(e)}}getKeyPathByMap(t){return this.keyPathMap[t]}async getKeyPath(t){let e=this.keyPathMap[t];if(void 0!==e&&null!==e)return e;const i=await this.getOpenDB().catch(this.throwNewError("getKeyPath->getOpenDB"));let r=this.getObjectStore(i,t,[t],ot);this.closeDB();let s=r.keyPath;return this.keyPathMap[t]=s,s}async getCurrentVersion(){const t=(await this.getOpenDB().catch(this.throwNewError("getCurrentVersion->getOpenDB"))).version;return this.closeDB(),t}async selectAll(t){let{tableName:e,range:i,condetions:r}=t;return await this._selectAll(e,i,r)}async _selectAll(t,e,i){const r=await this.getOpenDB().catch(this.throwNewError("_selectAll->getOpenDB tableName:"+t));let s=this.getObjectStore(r,t,[t],ot);return await this._selectAllExecute(s,e)}_selectAllExecute(t,e,i){return new Promise((r,s)=>{const a=[];let n=void 0===e?t.openCursor():t.openCursor(e);n.onsuccess=(t=>{let e=t.target.result;if(e){if(console.log(e.value),a.push(e.value),i)return void r(a[0]);e.continue()}else r(a)}),n.onerror=(t=>{s(t)})})}async selectByKey(t){let{tableName:e,key:i}=t;return await this._selectByKey(e,i)}async _selectByKey(t,e){const i=await this.getOpenDB().catch(this.throwNewError("_selectByKey->getOpenDB tableName:"+t));return await this._selectByKeyOnTran(i,t,e).catch(this.throwNewError("_selectByKey->_selectByKeyOnTran tableName:"+t))}_selectByKeyOnTran(t,e,i,r,s=ot){return new Promise((r,a)=>{const n=e+"_"+s,o=this.getCache(n,i);if(o)r(o);else{let o=this.getObjectStore(t,e,[e],s).get(i);o.onsuccess=(t=>{const e=o.result;r(e),this.setCache(n,i,e)}),o.onerror=(t=>{a(t)})}})}async selectByKeys(t){let{tableName:e,keys:i}=t;return await this._selectByKeys(e,i)}async _selectByKeys(t,e){const i=await this.getOpenDB().catch(this.throwNewError("_selectByKeys->getOpenDB tableName:"+t));return await this._selectByKeysOnTran(i,t,e).catch(this.throwNewError("_selectByKeys->_selectByKeyOnTran tableName:"+t))}async _selectByKeysOnTran(t,e,i,r){let s=this.getObjectStore(t,e,[e],ot);const a={};for(let t of i){const i=this.getCache(e,t),r=i||await this._getByKeyFromeObjectStore(s,t);i||this.setCache(e,t,r),a[t]=r}return a}_getByKeyFromeObjectStore(t,e){return new Promise((i,r)=>{e||i(null);let s=t.get(e);s.onsuccess=(t=>{i(s.result)}),s.onerror=(t=>{r(t)})})}async selectFirstOne(t){let{tableName:e,range:i,direction:r}=t;return await this._selectFirstOne(e,i,r)}async _selectFirstOne(t,e,i){const r=await this.getOpenDB().catch(this.throwNewError("_selectFirstOne->getOpenDB tableName:"+t));let s=this.getObjectStore(r,t,[t],ot);return await this._selectAllExecute(s,e,!0)}async insertUpdate(t){let{tableName:e,data:i,callback:r}=t;const s=this.getKeyPathByMap();return await this._insertUpdate(e,s,i,r).catch(this.throwNewError("insertUpdate->_insertUpdate tableName:"+e))}async _insertUpdate(t,e,i,r){const s=i[e],a=await this.getOpenDB().catch(this.throwNewError("_insertUpdate->getOpenDB tableName:"+t)),n=nt.currentTables(t),o=await this._selectByKeyOnTran(a,t,s,n,lt).catch(this.throwNewError("_insertUpdate->_selectByKeyOnTran tableName:"+t));return r&&r(o,i),void 0===o?await this._insertExecute(a,t,s,i,n).catch(this.throwNewError("_insertUpdate->_insertExecute tableName:"+t)):await this._updateExecute(a,t,s,i,n).catch(this.throwNewError("_insertUpdate->_updateExecute tableName:"+t))}_insertExecute(t,e,i,r,s){let a=this.getObjectStore(t,e,s,lt);return new Promise((t,e)=>{let s=a.add(r);s.onsuccess=(e=>{t({data:r,key:i})}),s.onerror=(t=>{console.error(t),e(t)})})}_updateExecute(t,e,i,r,s){return new Promise((a,n)=>{let o=this.getObjectStore(t,e,s,lt).put(r);o.onsuccess=(t=>{a({data:r,key:i})}),o.onerror=(t=>{console.error(t),a(t)})})}async deleteWithRange(t){let{tableName:e,range:i,condetions:r}=t;return await this._deleteWithRange(e,i,r)}async _deleteWithRange(t,e,i){const r=await this.getOpenDB().catch(this.throwNewError("_deleteWithRange->getOpenDB tableName:"+t)),s=nt.currentTables(t);return await this._deleteWithRangeExecute(r,t,e,i,s)}_deleteWithRangeExecute(t,e,i,r,s){return new Promise((a,n)=>{let o=this.getObjectStore(t,e,s,lt),l=o.openCursor(i);l.onsuccess=(t=>{let e=t.target.result,i=[];if(e){let t=e.value;if(nt.isMutch(t,r)){let r=o.delete(e.key);r.onsuccess=(e=>{i.push(t)}),r.onerror=(t=>{})}e.continue()}else a(i)}),l.onerror=(t=>{n(t)})})}async delete(t){let{tableName:e,key:i}=t;return await this._delete(e,i)}async _delete(t,e){const i=await this.getOpenDB().catch(this.throwNewError("_delete->getOpenDB tableName:"+t)),r=nt.currentTables(t);return await this._deleteOnTran(i,t,e,r)}_deleteOnTran(t,e,i,r){return new Promise((s,a)=>{let n=this.getObjectStore(t,e,r,lt).delete(i+"");n.onsuccess=(t=>{s({tableName:e,key:i})}),n.onerror=(t=>{console.error(t),a(t)})})}async truncate(t){let{tableName:e}=t;return await this._truncate(e)}async _truncate(t){const e=await this.getOpenDB().catch(this.throwNewError("_truncate->getOpenDB tableName:"+t)),i=nt.currentTables(t);return await this._truncateExecute(e,t,i)}_truncateExecute(t,e,i){return new Promise((r,s)=>{let a=this.getObjectStore(t,e,i,lt).clear();a.onsuccess=(t=>{r()}),a.onerror=(t=>{s(t)})})}async getObjectStoreNames(){const t=(await this.getOpenDB().catch(this.throwNewError("getObjectStoreNames->getOpenDB"))).objectStoreNames;return this.closeDB(),t}async isExistsObjectStore(t){const e=await this.getOpenDB().catch(this.throwNewError("isExistsObjectStore->getOpenDB tableName:"+t));let i=!1;for(let r of e.objectStoreNames)if(r===t){i=!0;break}return this.closeDB(),i}async createStore(t){let{tableName:e,keyPathName:i,isAutoIncrement:r}=t;return await this._createStore(e,i,r)}async _createStore(t,e,i){if(!1===await this.isExistsObjectStore()){const i=await this.getCurrentVersion()+1,r=await this.getOpenDB(i).catch(this.throwNewError("_createStore->getOpenDB tableName:"+t));let s=!1;for(let e of r.objectStoreNames)if(e===t){s=!0;break}!1===s&&r.createObjectStore(t,{keyPath:e}),this.closeDB()}}async dropStore(t){let{tableName:e}=t;return await this._dropStore(e)}async _dropStore(t){const e=await this.getCurrentVersion()+1;(await this.getOpenDB(e).catch(this.throwNewError("_dropStore->getOpenDB tableName:"+t))).deleteObjectStore(t),this.closeDB()}}class ht{constructor(t,e="pk"){void 0===at.idbh&&(at.idbh=new ct(at.dbName)),this.idbh=at.idbh,this.keyPathName=e,this.objectStoreName=t}init(){return new Promise((t,e)=>{this.idbh._createStore(this.objectStoreName,this.keyPathName).then(()=>{t(!0)},t=>{throw e(t),t})})}isFished(){return new Promise((t,e)=>{this.firstPromise.then(()=>{t(!0)},t=>{throw t})})}async saveDataDefault(t,e,i){let r={pk:t,data:e};await this.saveData(r,void 0,i)}async saveData(t,e,i){let r=t;void 0===t[this.keyPathName]&&((r={data:t})[this.keyPathName]=e);await this.idbh._insertUpdate(this.objectStoreName,this.keyPathName,r,i)}async loadDataMap(t){if(void 0!==t){return await this.idbh._selectByKeys(this.objectStoreName,t)}return null}async loadData(t){if(void 0!==t){return await this.idbh._selectByKey(this.objectStoreName,t)}return null}async loadDataDefault(t){let e=await this.loadData(t);return void 0===e||null===e?null:e.data}async loadAllData(){return await this.idbh._selectAll(this.objectStoreName)}async deleteData(t){return void 0!==t?await this.idbh._delete(this.objectStoreName,t):null}async getOsNames(){return await this.idbh.getObjectStoreNames()}}const dt="default",ut=new Map;class pt{constructor(t){this.entityClass=t,this.targetObj="string"==typeof t?t:new t,this.idbAccessor=null,this.entityName=this.targetObj.getEntityName?this.targetObj.getEntityName():t}getStoreNameKey(t=dt){return t+"_"+this.targetObj.getEntityName()}async createStore(t=dt){const e=this.getStoreNameKey(t);return await this.createStoreByName(e,t)}async createStoreByName(t,e=dt){const i=ut.has(t)?ut.get(t):new ht(t);return await i.init().catch(t=>{console.log(t)}),ut.set(t,i),this.idbAccessor=i,i}async setStore(t=dt){this.idbAccessor=await this.createStore(t)}async save(t,e){let i=e;return e.toObj&&(i=e.toObj()),await this.idbAccessor.saveDataDefault(t,i),e}async loadAll(){const t=await this.idbAccessor.loadAllData(),e=[];for(let i of t){const t=this.getEntity(i);e.push(t)}return e}async getAsMap(t){const e=[];for(let i of t){const t=i&&i.pk?i.pk:i;e.push(t)}const i=await this.idbAccessor.loadDataMap(e),r={};for(let t in i){const e=i[t];r[t]=this.getEntity(e)}return r}async get(t){const e=t&&t.pk?t.pk:t,i=await this.idbAccessor.loadData(e);return this.getEntity(i)}getEntity(t){if(!t||!t.data)return t;if(t.data&&!this.targetObj.getEntityName)return t.data;const e=new this.entityClass;return e.load(t.data),e}async delete(t){return await this.idbAccessor.deleteData(t)}}const gt=[];class mt{constructor(t="BaseEntity",e="oid"){this.pk=e,this.entitiyName=t,this.refs=[]}isEntitiy(){return!0}getEntityName(){return this.entitiyName}create(){}update(){}setPk(t){return this[this.pk]=t}getPk(){return this[this.pk]}include(t){}exclude(t){}async deepClone(){return await S.deepClone(this)}load(t){for(let e in t)this[e]=t[e]}toObj(){let t=S.singleDeepCloneWithoutFuncs(this);return delete t.pk,delete t.refs,this.exclude(t),t}calcSize(){return 0}getRefCols(){return gt}}const ft="Binary";class yt extends mt{constructor(t){super(ft),this._ab=t,this.createDate=Date.now(),this.updateDate=Date.now()}static getEnitiyName(){return ft}set ab(t){buffer&&!buffer.byteLength&&alert("not arrayBuffer!"),this._ab=t}get ab(){return this._ab}load(t){super.load(t),this._ab=new Uint8Array(this._ab).buffer}create(){return new yt}}const wt="-";class bt{constructor(t){this.pk=t}static getDelimiter(){return"-"}static assemblePK(t,e){return t.getEntityName()+wt+e}static isPrimaryKey(t){return t&&"string"==typeof t&&2===t.split(wt).length}static getPrimaryKey(t){return t?bt.isPrimaryKey(t)?t:t.getEntityName&&t.getPk?t.getPk():t.oid?t.oid:t.pk?t.pk:null:t}static getEntityName(t){return bt.getPrimaryKey(t).split(wt)[0]}}var At=i(0);const vt="default",xt="pk_increment",Pt="pk_row";class St{constructor(t){this.ss=new pt(t+"_"+xt)}async acquirePKNo(t=vt,e,i=Pt){e.getEntityName();await this.ss.createStoreByName(t+"_"+xt,t);let r=await this.ss.get(i),s=this.countUpUint32(r?r.data:0);r||(r={data:s});let{data:a,keyPath:n}=await this.ss.save(i,r,(t,e)=>{let i=this.countUpUint32(e.data);t.data=i});return At.a.arrayBuffer2base64(a)}countUpUint32(t){let e=t;e||(e=new ArrayBuffer(4)),e.data&&(e=e.data);let i=new DataView(e),r=0|i.getUint32(0);return r++,i.setInt32(0,r>>>0),i.buffer}}const Dt="default",kt="BINALY_PK_ROW",Bt={},It=new yt;class Et{constructor(t,e,i=Dt){this.userId=i,this.entityClass=e,this.entity=new e,this.entityName=this.entity.getEntityName(),this.isBinary=It.getEntityName()===this.entityName,this.ss=new pt(e),this.pkais=new St(i),this.em=t}async init(){return await this.ss.setStore(this.userId)}async save(t){const e=await this.saveExecute(t,!1);if(this.isBinary){const t=e.getPk();let i=await S.recalcSize(this,e);Bt[t]=i}return e}async saveWithBinary(t){return await this.saveExecute(t,!0)}async saveExecute(t,e){if(!t||!t.getEntityName||!t.getPk||t.getEntityName()!==this.entityName)return void console.log("EntityManagerImpl save!!Z!! data:"+t.getEntityName()+"/this.entityName:"+this.entityName+"/data.getPk:"+t.getPk);let i=t.getPk();return i||(i=bt.assemblePK(this.entity,await this.pkais.acquirePKNo(this.userId,this.entity))),e||await this.saveArrayBufferCols(t),t.setPk(i),await this.ss.save(i,t)}async saveArrayBufferCols(t){if(It.getEntityName()!==t.getEntityName())for(let e in t){const i=t[e];if(i)if(Array.isArray(i))for(let t of i){const e=i[t];if(!e||e.byteLength)continue;const r=await this.saveArrayBufferData(e);i[t]=new bt(r)}else if(i.byteLength){const r=await this.saveArrayBufferData(i);t[e]=new bt(r)}}}async saveArrayBufferData(t){if(!t.getEntityName&&t.byteLength){const e=new yt(t),i=await this.getBinaryPK();return e.setPk(i),await this.em.Binary.saveWithBinary(e),i}if(t.getEntityName&&"PrimaryKey"===t.getEntityName())return t;if(t.getEntityName&&"Binary"===t.getEntityName()){const e=t.getPk();if(e)return t.setPk(e),await this.em.Binary.saveWithBinary(t),e;{const e=await this.getBinaryPK();return t.setPk(e),await this.em.Binary.saveWithBinary(t),e}}}async getBinaryPK(){const t=await this.pkais.acquirePKNo(this.userId,It,kt);return bt.assemblePK(It,t)}async loadAll(){return await this.ss.loadAll(this.entity)}async getAsMap(t){return await this.ss.getAsMap(t,this.entity)}async get(t,e){if(e&&Bt[t])return 1*Bt[t];const i="EntityManagerImpl.get pk:"+t+"/entityName:"+this.entityName;console.time(i);const r=await this.ss.get(t,this.entity);if(console.timeEnd(i),this.isBinary){let e=await S.recalcSize(this,r);Bt[t]=e}return r}async delete(t){return this.isBinary&&delete Bt[t],await this.ss.delete(t)}}const Ct="default";class Kt{constructor(){}async initAsNewUser(t,e=Ct){for(let i of t)await this.initParEntity(i,e);await this.initParEntity(yt,e)}async initParEntity(t,e){S.addBaseCLassese(t);const i=(new t).getEntityName();this[i]=new Et(this,t,e),await this[i].init()}isPrimaryKey(t){return!(!t||"PrimaryKey"!==t.getEntityName())}async getAsMap(t){if(!t||t.length<1)return console.error("keys:"+t),alert("keys:"+t),null;const e=t[0],i=bt.getPrimaryKey(e);if(!bt.isPrimaryKey(i))return console.log(i),null;const r=bt.getEntityName(i);return await this[r].getAsMap(t,this.entity)}async get(t){if(!t)return console.error("pk:"+t),alert("pk:"+t),null;const e=bt.getPrimaryKey(t);if(!bt.isPrimaryKey(e))return console.log(e),null;const i=bt.getEntityName(e);return await this[i].get(e)}async delete(t){if(!t)return alert(t),null;const e=bt.getEntityName(t);return await this[e].delete(t)}}const Nt=["images","setting","series","pages","outputsPars","exports"];class Lt extends mt{constructor(t,e,i){super("Title"),this.id=t,this.prefix=e,this.name=i,this.target="",this.no="",this.date="",this.pageNo=0,this.setting=null,this.series=null,this.pageNum=-1,this.images=[],this.pages=[],this.outputsPars=[],this.exports=[],this.direction="r2l",this.createDate=Date.now(),this.updateDate=Date.now(),this.listing=0}getRefCols(){return Nt}}const Tt=["binary","thumbnail"];class Ot extends mt{constructor(){super("Images"),this.name=null,this.binary=null,this.type=null,this.thumbnail=null,this.modifyDate=null,this.width=null,this.height=null,this.createDate=Date.now(),this.updateDate=Date.now(),this.listing=0}getRefCols(){return Tt}}const Mt=["binary"];class Rt extends mt{constructor(){super("Thumbnales"),this.name=null,this.binary=null,this.type=null,this.width=null,this.height=null,this.createDate=Date.now(),this.updateDate=Date.now(),this.listing=0}getRefCols(){return Mt}}const zt=["target"];class Ut extends mt{constructor(t){super("Series"),this.name=t,this.target=null,this.no="",this.date="",this.pageNo=0}getRefCols(){return zt}}class Ft{constructor(){}static asc(t,e){const i=Ft.execute([{colName:e,isDESC:!1}]);t.sort(i)}static desc(t,e){const i=Ft.execute([{colName:e,isDESC:!0}]);t.sort(i)}static orderBy(t,e){const i=Ft.execute(e);t.sort(i)}static execute(t){return(e,i)=>{for(let r of t){const{colName:t,isDESC:s}=r;if(e===i)return 0;if(!e)return s?1:-1;if(!i)return s?-1:1;let a=e[t],n=i[t];if(a<n)return s?1:-1;if(a>n)return s?-1:1}return 0}}static thinningNullData(t){const e=[];for(let i in t){const r=t[i];null!==r&&void 0!==r&&e.push(r)}const i=t.length;for(let e=0;e<i;e++)t.pop();for(let i in e){const r=e[i];t.push(r)}}static typeof(){}}class _t{constructor(){}static creatAddAction(t,e,i=null){return B.createBaseAction("addProgressBar",t,e,i)}static creatRemoveAction(t,e,i=null){return B.createBaseAction("removeProgressBar",t,e,i)}static creatUpdateAction(t,e,i=null){return B.createBaseAction("updateProgressBar",t,e,i)}static creatCompleatAction(t,e,i=null){return B.createBaseAction("compleatProgressBar",t,e,i)}}class Vt{constructor(){this.actionDispatcher=z.createStandAlone(),this.name="FileUploader",this.ms=Se.getInstance()}async readAsArrayBuffer(t){return await this.read(t,"ArrayBuffer")}async readAsBinaryString(t){return await this.read(t,"BinaryString")}async readAsDataURL(t){return await this.read(t,"DataURL")}async readAsText(t){return await this.read(t,"text")}read(t,e="binaryString"){return new Promise((i,r)=>{this.reader=new FileReader,this.reader.onerror=(t=>{r(this.errorHandler(t))}),this.reader.onprogress=(t=>{this.updateProgress(t)}),this.reader.onabort=(t=>{alert("File read cancelled")}),this.reader.onloadstart=(t=>{this.onLoadStart(t)}),this.reader.onload=(t=>{i(this.onload(t))}),"ArrayBuffer"===e?this.reader.readAsArrayBuffer(t):"BinaryString"===e?this.reader.readAsBinaryString(t):"DataURL"===e?this.reader.readAsDataURL(t):this.reader.readAsText(t)})}abortRead(){this.reader&&this.reader.abort(),this.actionDispatcher.dispatch(_t.creatRemoveAction())}errorHandler(t){switch(t.target.error.code){case t.target.error.NOT_FOUND_ERR:alert("File Not Found!");break;case t.target.error.NOT_READABLE_ERR:alert("File is not readable");break;case t.target.error.ABORT_ERR:break;default:alert("An error occurred reading this file.")}}updateProgress(t){const e=Math.round(t.loaded/t.total*100);e<100&&this.actionDispatcher.dispatch(_t.creatUpdateAction(null,{progress:e}))}onload(t){return this.actionDispatcher.dispatch(_t.creatCompleatAction()),this.reader.result}onLoadStart(){this.actionDispatcher.dispatch(_t.creatAddAction())}}const jt="CopiBon",Wt="DefaultName",Zt="title_";class Xt{constructor(t,e){this.em=t,this.ms=Se.getInstance(),this.ip=this.ms.ip,this.im=this.ms.im,this.tbm=this.ms.tbm,this.sm=this.ms.sm,console.log("title is new!!"+this.tbm)}async loadCurrent(){return this.currentTitle}async isExist(t){return!!t&&!!await this.em.Title.get(t)}async load(t=jt){if(!t)return null;if(this.currentTitle&&this.currentTitle.getPk()===t)return this.currentTitle;let e=await this.em.Title.get(t);return e||(e=await this.createTitle(t)),this.currentTitle=e,e}async createTitle(t=jt,e=Zt,i=Wt){const r=new Lt(t,e,i);return r.setPk(t),r.setting=t,await this.sm.createDefault(t),await this.em.Title.save(r),r}async changeTitle(t){this.currentTitle=await this.loadTitle(t),this.currentTitle||(this.currentTitle=await this.createTitle(jt,Zt,Wt))}async loadTitleList(){return await this.em.Title.loadAll()}async saveTitle(t){if(t){t.updateDate=Date.now();const e=t.images;Ft.thinningNullData(e);for(let t in e){const i=e[t];bt.isPrimaryKey(i)||(e[t]=bt.getPrimaryKey(i))}this.currentTitle=await this.em.Title.save(t)}}async deleteTitleCascade(){this.titelId,this.titelPrefix}async addImageFiles(t){const e=await this.loadCurrent(),i=e.images;Ft.thinningNullData(i);const r=[];let s=i.length;for(let e of t){let{imagePk:t,imageEntity:a}=await this.im.saveImageFile(e,s);s++,i.push(t),r.push(a)}return await this.saveTitle(e),r}async addImage(t,e){}async removeImage(t){const e=await this.load(),i=e.images;for(let e in i){const r=i[e];bt.getPrimaryKey(r)===t&&(await this.im.remove(t),delete i[e])}await this.saveTitle(e)}async getExports(){const t=await this.loadCurrent();return t&&t.exports&&Array.isArray(t.exports)?t.exports:(t.exports=[],await this.saveTitle(t),t.exports)}async getCurrentTitleName(){return(await this.loadCurrent()).name}async saveCurrent(){const t=await this.loadCurrent();await this.saveTitle(t)}async loadSettings(){const t=(await this.loadCurrent()).getPk(),e=await this.sm.loadByPk(t);if(!e){return await this.sm.createDefault(t)}return e}async loadThumbnails(){const t=await this.loadCurrent();return await this.im.loadThumbnails(t.images)}async updateImagesListing(t){const e=await this.loadCurrent();return await this.im.updateImagesListing(e.images,t)}}class Yt{constructor(t){this.em=t}async load(t){console.time("BinaryManager.load");let e=t;t||(e=bt.getPrimaryKey(t));const i=await this.em.Binary.get(e);return console.timeEnd("BinaryManager.load"),i}async remove(t){let e=t;return t||(e=bt.getPrimaryKey(t)),await this.em.Binary.delete(e)}async save(t,e,i,r){console.time("BinaryManager.save");let s=null;if(t&&(s=await this.em.Binary.get(t)),s?(s.updateDate=Date.now(),s._ab=i):s=new yt(i),r&&"object"==typeof r)for(let t in r)s[t]=r[t];const a=await this.em.Binary.save(s);return console.timeEnd("BinaryManager.save"),bt.getPrimaryKey(a)}}const Ht=["previewThumbnail","outputImage","outputExpandImage","outputDualImage","thumbnail","baseImage"];class Gt extends mt{constructor(){super("Pages"),this.previewThumbnail=null,this.outputImage=null,this.outputExpandImage=null,this.outputDualImage=null,this.thumbnail=null,this.baseImage=null,this.isForceColor=!1,this.isNoCropping=!1,this.createDate=Date.now(),this.updateDate=Date.now(),this.listing=0}getRefCols(){return Ht}}class Jt{constructor(t){this.em=t}setTitleManager(t){this.tm=t}async loadFromImagePk(t){const e=bt.getPrimaryKey(t),i=await this.em.get(e);if(!i||!i.thumbnail)return null;const r=bt.getPrimaryKey(i.thumbnail),s=await this.em.get(r);return s.parentPk=e,s}async remove(t){const e=await this.em.Pages.get(t);e&&(e.previewThumbnail&&await this.em.Binary.delete(e.previewThumbnail),e.outputImage&&await this.em.Binary.delete(e.outputImage),await this.em.Pages.delete(t))}async removeImage(t){const e=await this.em.Pages.get(t);e&&(e.previewThumbnail&&await this.em.Binary.delete(e.previewThumbnail),e.outputImage&&await this.em.Binary.delete(e.outputImage),e.outputDualImage&&await this.em.Binary.delete(e.outputDualImage),e.outputExpandImage&&await this.em.Binary.delete(e.outputExpandImage),e.baseImage=null,e.thumbnail=null,e.outputDualImage=null,e.outputExpandImage=null,e.previewThumbnail=null,e.outputImage=null,await this.em.Pages.save(e))}async addPage(t,e){const i=(await this.tm.load()).pages,r=[];for(let s in i){const a=i[s];if(!a)continue;const n=await this.em.get(a);if(a===e){const e=await this.em.get(t),i=await this.em.get(e.thumbnail);await this.em.get(i.binary);n.thumbnail=e.thumbnail,n.baseImage=t,await this.em.Pages.save(n)}r.push(n)}return r}async move(t,e){const i=await this.em.Pages.get(t),r=await this.em.Pages.get(e);if(!i||!r)return;const s=i.previewThumbnail,a=r.previewThumbnail,n=i.outputImage,o=r.outputImage,l=i.thumbnail,c=r.thumbnail,h=i.baseImage,d=r.baseImage;i.previewThumbnail=a,r.previewThumbnail=s,i.outputImage=o,r.outputImage=n,i.thumbnail=c,r.thumbnail=l,i.baseImage=d,r.baseImage=h,await this.em.Pages.save(i),await this.em.Pages.save(r)}async loadAll(){const t=[],e=this.em.Pages.loadAll();for(let i of e)t.push(i);return t}async load(t){return await this.em.Pages.get(t)}async save(t,e=null,i=null,r=null,s=null,a=0,n=null){let o=null;t&&(o=await this.em.Pages.get(t));let l=n?bt.getPrimaryKey(n):null;return o?o.updateDate=Date.now():o=new Gt,o.previewThumbnail=e||null===e?e:o.previewThumbnail,o.outputImage=l||n,o.outputImage=i||null===i?i:o.outputImage,o.thumbnail=r||null===r?r:o.thumbnail,o.baseImage=s||null===s?s:o.baseImage,o.listing=a||null===a?a:o.listing,await this.em.Pages.save(o)}}const qt=["outputProfile"];class Qt extends mt{constructor(){super("Settings"),this.name="",this.pageNum=0,this.startPage="l",this.pageDelection=0,this.outputProfile=null,this.createDate=Date.now(),this.updateDate=Date.now(),this.listing=0}getRefCols(){return qt}}class $t{constructor(t,e){this.em=t,this.opm=e}async loadByPk(t){return await this.em.Settings.get(t)}async loadAll(){const t=[],e=this.em.Pages.loadAll();for(let i of e)t.push(i);return t}async createDefault(t){const e=new Qt;return e.setPk(t),e.pageNum=8,e.startPage="l",e.pageDelection="r2l",e.outputProfile=this.opm.getDefaultPk(),e.listing=0,await this.em.Settings.save(e)}async save(t,e,i,r,s,a,n=0){let o=null;return t&&(o=await this.em.Settings.get(t)),o?o.updateDate=Date.now():o=new Qt,o.name=e||null===e?e:o.name,o.pageNum=i||8,o.startPage=r||null===r?r:o.startPage,o.pageDirection=s||null===s?s:o.pageDirection,o.outputProfile=a||null===a?a:o.outputProfile,o.listing=n||null===n?n:o.listing,await this.em.Settings.save(o)}}const te=[];class ee extends mt{constructor(t,e,i){super("OutputProfiles"),this.id=t,this.prefix=e,this.pageSize="A5",this.direction="r2l",this.createDate=Date.now(),this.updateDate=Date.now(),this.listing=0}getRefCols(){return te}}const ie="copibondefa";class re{constructor(t){this.em=t,this.createDefault()}getDefaultPk(){return ie}async loadAll(){const t=[],e=await this.em.OutputProfiles.loadAll();for(let i of e)t.push(i);return t.length<1&&t.push(await this.createDefault()),t}async loadByPk(t){const e=bt.getPrimaryKey(t);if(e){return await this.em.OutputProfiles.get(e)}return await this.em.OutputProfiles.get(t)}async createDefault(){const t=await this.loadByPk(ie);if(t)return t;const e=new ee;return e.setPk(ie),await this.em.OutputProfiles.save(e)}async save(t,e,i,r,s,a,n=0){let o=null;t&&(o=await this.em.OutputProfiles.get(t));let l=bt.getPrimaryKey(i);return o?o.updateDate=Date.now():o=new Setting,o.name=e||null===e?e:o.name,o.binary=l||i,o.type=r||null===r?r:o.type,o.width=s||null===s?s:o.width,o.height=a||null===a?a:o.height,o.listing=n||null===n?n:o.listing,await this.em.Thumbnales.save(o)}}const se=["binary","thumbnail"];class ae extends mt{constructor(){super("ImageOutputs"),this.name=null,this.binary=null,this.type=null,this.thumbnail=null,this.orderName="",this.size=0,this.createDate=Date.now(),this.updateDate=Date.now(),this.listing=0}getRefCols(){return se}}class ne{constructor(t){this.em=t}async load(t){let e=t;return t||(e=bt.getPrimaryKey(t)),await this.em.ImageOutputs.get(e)}async remove(t){const e=await this.em.ImageOutputs.get(t);e&&(e.binary&&await this.em.Binary.delete(e.binary),await this.em.ImageOutputs.delete(t))}async save(t,e,i,r,s,a,n=0){let o=null;t&&(o=await this.em.ImageOutputs.get(t));let l=bt.getPrimaryKey(i);o?o.updateDate=Date.now():o=new ae,o.name=e||null===e?e:o.name,o.binary=l||i,o.type=r||null===r?r:o.type,o.orderName=s||null===s?s:o.orderName,o.size=a||null===a?a:o.size,o.listing=n||null===n?n:o.listing;const c=await this.em.ImageOutputs.save(o);return bt.getPrimaryKey(c)}}const oe=new Map;class le{constructor(t){this.ms=Se.getInstance(),this.em=t,this.ip=this.ms.ip,this.tbm=this.ms.tbm}setTitleManager(t){this.tm=t}async load(t){let e=t;return"string"!=typeof t&&(e=bt.getPrimaryKey(t)),await this.em.Images.get(e)}async reloadLoadedImages(){return await this.createRetList(this.getEntitisAsList())}async loadImages(){const t=(await this.tm.load()).images,e=[];for(let i in t){const r=t[i];if(!r)continue;const s=await this.em.get(r);e.push(s)}return await this.createRetList(e)}async remove(t){const e=await this.em.get(t);console.log("removeImage imageEntity.thumbnail:"+e.thumbnail);const i=bt.getPrimaryKey(e.binary);console.log("removeImage binaryPk:"+i);const r=bt.getPrimaryKey(e.thumbnail);if(console.log("removeImage thumbnailPk:"+r),r){const t=await this.em.get(r);console.log("removeImage thumbnailEntity:"+t);const e=bt.getPrimaryKey(t.binary);console.log("removeImage thumbnailBinaryPk:"+e),await this.em.delete(e),await this.em.delete(r)}await this.em.delete(i),await this.em.delete(t)}async saveImageFile(t,e=0){const i=new Vt,r=await i.readAsArrayBuffer(t),s={name:t.name,ab:r,type:t.type},a=await this.ip.createImageNodeByData(s),n=await this.ip.createThumbnail(r,100,100,t.type),o=At.a.dataURI2ArrayBuffer(n),l=await this.ip.createImageNodeByData({name:t.name,ab:o,type:t.type}),c=await this.tbm.save(null,t.name,o,t.type,l.width,l.height,0);console.log("addImageFiles thumbnailEntity:"+c);const h=bt.getPrimaryKey(c);console.log("addImageFiles thumbnailPk:"+h);const d=await this.save(null,t.name,r,t.type,a.width,a.height,h,e);return console.log("addImageFiles imageEntity:"+d),{imagePk:d.getPk(),imageEntity:d}}async save(t,e,i,r,s,a,n,o=0){let l=null;t&&(l=await this.em.Images.get(t)),console.log("ImageManager save!!9!! binary:"+i);let c=bt.getPrimaryKey(i);l?l.updateDate=Date.now():l=new Ot,console.log("ImageManager save!!A!! image:"+l),l.name=e||null===e?e:l.name,l.binary=c||i,l.type=r||null===r?r:l.type,l.width=s||null===s?s:l.width,l.height=a||null===a?a:l.height,l.thumbnail=n||null===n?n:bt.getPrimaryKey(l.thumbnail),l.listing=o||null===o?o:l.listing;const h=await this.em.Images.save(l);return console.log("ImageManager save!!B!! image:"+h),h}async loadThumbnails(t){const e=[],i=[];for(let e of t){const t=bt.getPrimaryKey(e),r=await this.load(t);i.push(r)}Ft.orderBy(i,[{colName:"listing",isDESC:!1}]);for(let t of i){const i=bt.getPrimaryKey(t),r=await this.tbm.loadFromImagePk(i);e.push(r)}return e}async createRetList(t){Ft.orderBy(t,[{colName:"listing",isDESC:!1},{colName:"updateDate",isDESC:!0}]);const e=[];for(let i of t){const t=i&&i.getPk?i.getPk():null;if(oe.has(t)){const i=oe.get(t);e.push(i)}else if(t){const r=await this.processParImage(i);oe.set(t,r),e.push(r)}else e.push(null)}return e}async processParImage(t){t.getPk();const e=await this.em.get(t.thumbnail),i=await this.em.get(e.binary),r=(await this.ip.createImageNodeByData({name:t.name,ab:i.ab,type:t.type}),i.ab?new Uint8Array(i.ab).length:0);return{imageEntity:t,binaryEntity:i,size:r,imageText:escape(t.name)+" ("+(t.type||"n/a")+") - "+r+"bytes, last modified: "+t.modifyDate+" size:"+t.width+"x"+t.height,isOnPage:!1}}removeLoaded(t){oe.delete(t)}getRetObjsAsList(){const t=[];for(let[e,i]of oe.entries())t.push(i);return t}getEntitisAsList(){const t=[];for(let[e,i]of oe.entries())t.push(i.imageEntity);return t}getFromLoaded(t){return oe.get(t)}}class ce{constructor(t){this.em=t}async loadFromImagePk(t){const e=bt.getPrimaryKey(t),i=await this.em.get(e);if(!i||!i.thumbnail)return null;const r=bt.getPrimaryKey(i.thumbnail),s=await this.em.get(r);return s.parentPk=e,s}async load(t){let e=t;return t||(e=bt.getPrimaryKey(t)),await this.em.Thumbnales.get(e)}async save(t,e,i,r,s,a,n=0){let o=null;t&&(o=await this.em.Thumbnales.get(t));let l=bt.getPrimaryKey(i);return o?o.updateDate=Date.now():o=new Rt,o.name=e||null===e?e:o.name,o.binary=l||i,o.type=r||null===r?r:o.type,o.width=s||null===s?s:o.width,o.height=a||null===a?a:o.height,o.listing=n||null===n?n:o.listing,await this.em.Thumbnales.save(o)}}navigator.userAgent.replace(/[\.0-9]+/g,"x"),window.location;const he={pageStart:{l:"fromLeft",r:"fromRight"},pageDirection:{l2r:"LeftToRight",r2l:"RightToLeft"},pageNums:[1,2,4,6,8,10,12,16]},de={dpi72:72,dpi150:150,dpi300:300,dpi350:350,dpi600:600,dpi1200:1200,same:0},ue={none:0,conbini:5},pe={B6:{target:"B6",frame:"B6",multiple:1},A5:{target:"A5",frame:"A5",multiple:1},B5:{target:"B5",frame:"B5",multiple:1},A4:{target:"A4",frame:"A4",multiple:1},B4:{target:"B4",frame:"B4",multiple:1},A3:{target:"A3",frame:"A3",multiple:1},mangaPaperB5:{target:"A5",frame:"B5",multiple:1},mangaPaperA4:{target:"B5",frame:"A4",multiple:1},mangaPaperA4ExpandTatikiri:{target:"B5",frame:"A4",multiple:274/257},mangaPaperB4:{target:"A4",frame:"B4",multiple:1},mangaPaperA3:{target:"B4",frame:"A3",multiple:1},pure_fit:{target:"same",frame:"same",multiple:1}},ge={A6:{x:105,y:148},B6:{x:128,y:182},A5:{x:148,y:210},B5:{x:182,y:257},A4:{x:210,y:297},B4:{x:257,y:364},A3:{x:297,y:420}},me=[{orderName:"B6 none croping",basePaper:"B6"},{orderName:"A5 none croping",basePaper:"A5"},{orderName:"B5 none croping",basePaper:"B5"},{orderName:"A4 none croping",basePaper:"A4"},{orderName:"B4 none croping",basePaper:"B4"},{orderName:"A3 none croping",basePaper:"A3"},{orderName:"Manga Paper B5 Tatikiri to A5",basePaper:"mangaPaperB5"},{orderName:"Manga Paper A4 Tatikiri to B5",basePaper:"mangaPaperA4"},{orderName:"Manga Paper B4 Tatikiri to A4",basePaper:"mangaPaperB4"},{orderName:"Manga Paper A4 ExpandTatikiriSpecial",basePaper:"mangaPaperA4ExpandTatikiri"}];class fe{constructor(){this.paparSize={}}calcClopOffsetPixcel(t,e){const i=this.calcClopOffsetMm(t);return{x:-1*this.calcPixcel(e,i.x),y:-1*this.calcPixcel(e,i.y)}}calcClopOffsetMm(t){const e=pe[t],i={x:0,y:0};if(!e||"same"===e.target)return i;const r=this.getPaperSizeMm(e.target),s=this.getPaperSizeMm(e.frame),a=r.x*e.multiple,n=r.y*e.multiple;return i.x=(s.x-a)/2,i.y=(s.y-n)/2,i}getTargetPaperSizeMm(t){return t?this.getPaperSizeMm(t):{x:0,y:0}}getTargetPaperSize(t,e){const i=pe[t],r={x:0,y:0};if(!i||"same"===i.target)return r;const s=this.getTargetPaperSizeMm(i.target),a=this.getDpi(e);return r.x=this.calcPixcel(s.x,a),r.y=this.calcPixcel(s.y,a),r}calcPixcel(t,e){return Math.floor(e*t/25.4)}calcDpi(t,e){return t/e*25.4}getPaperFrameSizeMm(t){const e=pe[t];return ge[e.frame]}getTragetPaper(t){return pe[t].target}getPaperSizeMm(t){return ge[t]}getPrintMargin(t){return ue[t]}getDpi(t){return de[t]}getOffset(t,e){const i=this.getPrintMargin(e),r=this.getDpi(t)/25.4;return Math.floor(r*i)}getPixcelSizeBySelected(t,e,i="none"){const r=this.getPaperSizeMm(t),s=this.getPrintMargin(i),a=this.getDpi(e);return this.getPixcelSizeWithMargin(a,r.x,r.y,s)}getPixcelSize(t,e,i){const r=t/25.4;return{width:Math.floor(r*e),height:Math.floor(r*i)}}getPixcelSizeWithMargin(t,e,i,r){const s=2*r;return this.getPixcelSize(t,e-s,i-s)}}var ye=i(3),we=i(5);const be=/^image\/.+|application\/octet-stream/;class Ae{constructor(){this.canvas=r.createCanvas(null,"hidden"),this.ctx=this.canvas.getContext("2d"),this.paper=new fe,this.imageMerger=new ye.a,this.imageResizer=new we.a,window.onload=(()=>{document.body.appendChild(this.canvas)})}setDataURI(t){this.dataURI=t}async resize(t,e,i){const r=await this.getImageDataFromArrayBuffer(t);return this.resizeInMaxSize(r,e,i)}async resizeAsPaper(t,e,i,r){const s=await this.getImageDataFromArrayBuffer(t),a=this.paper.getPixcelSizeBySelected(e,i);let n=this.ctx.createImageData(a.width,a.height);const o=this.paper.getPixcelSizeBySelected(e,i,r),l=this.resizeInMaxSize(s,o.width,o.height),c=this.paper.getOffset(i,r),h={offsetY:c,offsetX:c,data:l.data,width:l.width,height:l.height},d=l.data.length;for(let t=0;t<d;t++)n.data[t]=l.data[t];this.canvas.width=n.width,this.canvas.height=n.height,await this.imageMerger.margeReplace(n,[h],!0),this.ctx.putImageData(n,0,0),n=void 0;let u=this.canvas.toDataURL();console.time("resize copy");const p=At.a.dataURI2ArrayBuffer(u);return u=void 0,console.timeEnd("resize copy"),p}resizeInMaxSize(t,e,i){const{data:r,width:s,height:a}=t,n=s/a>=e/i,o=n?e/s:i/a,l=n?e:s*o,c=n?a*o:i;return this.resizeExecute(t,l,c)}resizeExecute(t,e,i){console.time("resize");const r=this.ctx.createImageData(e,i);return this.imageResizer.resize(t,e,i,r),console.timeEnd("resize"),r}getImageDataFromArrayBuffer(t){return new Promise((e,i)=>{let r=At.a.arrayBuffer2DataURI(t);t=null;const s=new Image;s.src=r,s.onload=(()=>{r=null;const t=s.width,i=s.height;this.canvas.width=t,this.canvas.height=i,this.ctx.drawImage(s,0,0);const a=this.ctx.getImageData(0,0,t,i);e(a)}),s.onerror=(t=>{i(t)})})}getArrayBufferFromImageBitmapDataAsJpg(t,e){const i={type:"image/jpeg",quority:e};return this.getArrayBufferFromImageBitmapData(t,i)}getArrayBufferFromImageBitmapDataAsPng(t){return this.getArrayBufferFromImageBitmapData(t)}getArrayBufferFromImageBitmapData(t,e){console.time("resize getArrayBufferFromImageBitmapData"),this.canvas.width=Math.floor(t.width),this.canvas.height=Math.floor(t.height);let i=this.ctx.createImageData(t.width,t.height);const r=t.data.length;for(let e=0;e<r;e++)i.data[e]=t.data[e];this.ctx.putImageData(i,0,0);let s=e?this.canvas.toDataURL(e.type,e.quority):this.canvas.toDataURL();const a=At.a.dataURI2ArrayBuffer(s);return i=void 0,console.timeEnd("resize getArrayBufferFromImageBitmapData"),a}create(t,e,i,r){return new Promise((s,a)=>{const n=new Image;n.src=At.a.arrayBuffer2DataURI(t,r),n.onload=(()=>{const t=e/n.width,r=i/n.height,a=t<=r?t:r;this.canvas.height=Math.floor(n.height*a),this.canvas.width=Math.floor(n.width*a),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.scale(a,a),this.ctx.drawImage(n,0,0),s(this.exportPng())}),n.onerror=(t=>{console.log("å¤±æ•—"),console.error(t),a(null)})})}exportPng(){return this.canvas.toDataURL()}exportJpeg(t=1){return this.canvas.toDataURL("image/jpeg",t)}createImageNodeByData(t){return new Promise((e,i)=>{let{name:s,ab:a,type:n}=t,o=r.createImage();if(o.alt=escape(s),n||(n="application/octet-stream"),n&&n.match(be))return o.src=At.a.arrayBuffer2DataURI(a,n),o.onload=(()=>{t.height=o.height,t.width=o.width,e(o)}),void(o.onerror=(t=>{console.log("å¤±æ•—"),console.error(t),i(t)}));e(o)})}}class ve{constructor(){this.ip=new Ae}async createThumbnail(t,e){return await this.ip.create(t,100,100,e)}async createImageNodeByData(t){return await this.ip.createImageNodeByData(t)}async resize(t,e,i){return await this.ip.resize(t,e,i)}async resizeAsPaperB5_72(t){return await this.ip.resizeAsPaper(t,"B5","dpi72","conbini")}async getImageDataFromArrayBuffer(t){return await this.ip.getImageDataFromArrayBuffer(t)}getArrayBufferFromImageBitmapData(t,e){console.time("ImageProcessService.getArrayBuffer From ImageBitmapData");const i=this.ip.getArrayBufferFromImageBitmapData(t,e);return console.timeEnd("ImageProcessService.getArrayBuffer From ImageBitmapData"),i}getArrayBufferFromImageBitmapDataAsJpg(t,e){console.time("ImageProcessService.getArrayBufferFromImageBitmapDataAsJpg");const i=this.ip.getArrayBufferFromImageBitmapDataAsJpg(t,e);return console.timeEnd("ImageProcessService.getArrayBufferFromImageBitmapDataAsJpg"),i}getArrayBufferFromImageBitmapDataAsPng(t){return this.ip.getArrayBufferFromImageBitmapDataAsPng(t)}}var xe=i(2);const Pe=new class{constructor(){this.em=new Kt,this.ip=new ve}async init(t,e){this.appTitle=t,this.appVersion=e,await this.em.initAsNewUser([Ot,Ut,Rt,Lt,Gt,Qt,ee,ae]),this.ip=new ve,this.bm=new Yt(this.em),this.tbm=new ce(this.em),this.pb=new ce(this.em),this.tbm=new ce(this.em),this.im=new le(this.em),this.pm=new Jt(this.em),this.opm=new re(this.em),this.iom=new ne(this.em),this.sm=new $t(this.em,this.opm),this.tm=new Xt(this.em),this.im.setTitleManager(this.tm),this.pm.setTitleManager(this.tm),await this.tm.load()}getAppTitle(){return this.appTitle}getAppVersion(){return this.appVersion}};class Se{static getInstance(){return(new xe.a).postMessage("WASMcaller",""),Pe}async init(t,e){await Pe.init(t,e)}}let De=null;class ke extends ${constructor(){super(),this.menuSelectAction=st.creatSelectAction(),this.atatch(this.menuSelectAction),this.storeKey=st.getStoreKey(),this.addInitializeKey(this.storeKey)}static register(){De||(De=new ke)}async reduce(t,e){return this.menuSelectAction.type===e.type&&(t[this.storeKey]=e.data.id),t}}class Be extends it{constructor(){super("menu","Menu"),this.text="Menu",this.storeKey=st.getStoreKey(),this.menuButtonClass="MenuButton",this.selected="",this.steps=[],this.steps.push({id:"step0",ancker:"#TitleMng",label:"Step0 Select or New",targets:["TitleMng"]}),this.steps.push({id:"step1",ancker:"#TitleSettings",label:"Step1 Work Setting",targets:["TitleSettings"]}),this.steps.push({id:"step2",ancker:"#fuaPArent",label:"Step2 Select Files",targets:["fuaPArent","FilesArea"]}),this.steps.push({id:"step3",ancker:"#ExportArea",label:"Step3 Export",targets:["ExportArea"]}),this.steps.push({id:"step4",ancker:"#step4",label:"Step4 Pref",targets:[""]}),this.isSelectByManual=!1}render(){return V(this.id+"Frame",["MenuFrame"],this.createButtons())}async onAfterAttach(t,e){ke.register()}async onViewShow(t,e){if(t[this.storeKey]){const e=t[this.storeKey];this.hilightMenu(e)}}onClick(t){return e=>{this.isSelectByManual=!0,this.hilightMenu(t),setTimeout(()=>{this.isSelectByManual=!1},1e3)}}hilightMenu(t){const e=document.getElementById(this.id+"Frame");if(this.isSelectByManual){for(let i of this.steps)if(i.id===t){for(let t of e.children)t.classList.remove("active");return void document.getElementById(i.id).classList.add("active")}}else{for(let t of e.children)t.classList.remove("active");for(let e of this.steps)for(let i of e.targets)if(i===t)return void document.getElementById(e.id).classList.add("active")}}createButtons(){const t=[];for(let e of this.steps)t.push(_(e.id,[this.menuButtonClass],e.ancker,{on:{click:this.onClick(e.id)}},e.label));return t}}class Ie{constructor(){}}class Ee{constructor(){}static creatAddAction(t,e,i=null){return B.createBaseAction("addImage",t,e,i)}static creatRemoveAction(t,e,i=null){return B.createBaseAction("removeImage",t,e,i)}static creatLoadImagesAction(t,e,i=null){return B.createBaseAction("loadImages",t,e,i)}static creatSortImagesAction(t,e,i=null){return B.createBaseAction("sortImages",t,e,i)}static creatChangeTitleImagesAction(t,e,i=null){return B.createBaseAction("changeTitle",t,e,i)}static creatDetailAction(t,e,i=null){return B.createBaseAction("detail",t,e,i)}static getStoreImagesKey(){return"imagesData"}}class Ce{constructor(){}static creatAddPageAction(t,e,i=null){return B.createBaseAction("addPage",t,e,i)}static creatRemovePageAction(t,e,i=null){return B.createBaseAction("removePage",t,e,i)}static creatResetPagesAction(t,e,i=null){return B.createBaseAction("resetPages",t,e,i)}static creatSortPagesAction(t,e,i=null){return B.createBaseAction("sortPages",t,e,i)}static getStorePagesKey(){return"pagesData"}}class Ke{constructor(){this.ms=Se.getInstance(),this.em=this.ms.em,this.pm=this.ms.pm,this.tm=this.ms.tm}async resetPagesFull(){const t=(await this.tm.loadSettings()).pageNum;return await this.resetPages(t)}async resetPages(t){const e=await this.tm.load(),i=e.pages,r=[],s=[],a={};if(i.length>t){const e=await this.em.getAsMap(i);for(let n in i){const o=i[n];if(!o||"string"!=typeof o){a[n]=!0;continue}const l=e[o];l?(r.push(l),n>=t&&s.push(o)):a[n]=!0}for(let t in s){const e=s[t];for(let t in i){if(e===i[t]){delete i[t],this.pm.remove(e);break}}}for(let e in a){const r=1*e;if(r<t){const t=await this.pm.save(null,null,null,null,null,r);i[r]=t.getPk()}}}else{i.length;for(let e=i.length;e<t;e++){const t=await this.pm.save(null,null,null,null,null,e);i.push(t.getPk())}}for(let e=0;e<t;e++){if(e>=i.length){const t=await this.pm.save(null,null,null,null,null,e);i.push(t.getPk());continue}const t=i[e];if(t&&"string"==typeof t)if(await this.em.get(t));else{const t=await this.pm.save(null,null,null,null,null,e);i[e]=t.getPk()}else{const t=await this.pm.save(null,null,null,null,null,e);i[e]=t.getPk()}}await this.tm.saveTitle(e)}async loadPages(){const t=(await this.tm.load()).pages,e=[];for(let i in t){const r=t[i];if(!r)continue;const s=await this.em.get(r);e.push(s)}return e}async move(t,e){await this.pm.move(t,e)}async add(t,e){await this.pm.addPage(t,e)}async remove(t){await this.pm.removeImage(t)}}let Ne=null;class Le extends ${constructor(){super(),this.ms=Se.getInstance(),this.em=this.ms.em,this.im=this.ms.im,this.tm=this.ms.tm,this.imagAddAction=Ee.creatAddAction(),this.imageRemoveAction=Ee.creatRemoveAction(),this.imagesLoadAction=Ee.creatLoadImagesAction(),this.imagesSortAction=Ee.creatSortImagesAction(),this.imagesChangeTitleAction=Ee.creatChangeTitleImagesAction(),this.imagesDetailAction=Ee.creatDetailAction(),this.atatch(this.imagAddAction),this.atatch(this.imageRemoveAction),this.atatch(this.imagesLoadAction),this.atatch(this.imagesSortAction),this.atatch(this.imagesChangeTitleAction),this.atatch(this.imagesDetailAction),this.pp=new Ke,this.storeImagesKey=Ee.getStoreImagesKey(),this.storePagesKey=Ce.getStorePagesKey()}static register(){Ne||(Ne=new Le)}async reduce(t,e){return this.imagAddAction.type===e.type?(t[this.storeImagesKey]=await this.saveFiles(e.data.files),t[this.storePagesKey]=await this.loadPages()):this.imageRemoveAction.type===e.type?(t[this.storeImagesKey]=await this.remove(e.data.imagePKforDelete),t[this.storePagesKey]=await this.loadPages()):this.imagesLoadAction.type===e.type?(t[this.storeImagesKey]=await this.loadImages(),t[this.storePagesKey]=await this.loadPages()):this.imagesSortAction.type===e.type?(t[this.storeImagesKey]=await this.sort(e.data.imagePKmove,e.data.imagePKdrop),t[this.storePagesKey]=await this.loadPages()):this.imagesChangeTitleAction.type===e.type?t[this.storePagesKey]=await this.loadPages():this.imagesDetailAction.type===e.type&&(t.imagesDetailData=await this.loadAImage(e.data.imagePK)),t}async loadPages(){return await this.pp.loadPages()}async saveFiles(t){const e=await this.tm.addImageFiles(t),i=this.im.getEntitisAsList();for(let t of e)i.unshift(t);return await this.im.createRetList(i)}async sort(t,e){const i=this.im.getEntitisAsList();for(let t in i){const e=i[t];e.getPk();e.listing=t}Ft.orderBy(i,[{colName:"listing",isDESC:!1},{colName:"updateDate",isDESC:!0}]);const r={};r[t]=e,r[e]=t;for(let t in i){const e=i[t],s=e.getPk();console.log("sort pk:"+s+"/index:"+t+"/imageEntity.listing:"+e.listing);const a=r[s]?r[s]:s;if(a!==s){const e=this.im.getFromLoaded(a).imageEntity;e.listing=t,e.updateDate=Date.now(),await this.em.Images.save(e)}else e.listing=t}return await this.im.createRetList(i)}async loadAImage(t){if(!t)return;const e=await this.em.get(t),i=await this.em.get(e.binary),r=i._ab.byteLength;return{imageEntity:e,binaryEntity:i,imageText:escape(e.name)+" ("+(e.type||"n/a")+") - "+r+"bytes, last modified: "+e.modifyDate+" size:"+e.width+"x"+e.height}}async loadImages(){await this.pp.resetPagesFull();return await this.im.loadImages()}async remove(t){return await this.tm.removeImage(t),this.im.removeLoaded(t),this.im.getRetObjsAsList()}}class Te extends Ie{constructor(t){super(),this.name="FileUploader",Le.register()}handleFileSelect(t){return e=>{e.stopPropagation(),e.preventDefault();const i=e.target.files;this.handleFiles(t,i)}}handleDrop(t){return e=>{e.stopPropagation(),e.preventDefault();const i=e.dataTransfer.files;this.handleFiles(t,i)}}handleFiles(t,e){const i=Ee.creatAddAction(t,{files:e});t.dispatch(i)}async areadParFile(t){return await areadParFile(t)}}const Oe="Drop image file";class Me extends it{constructor(){super("fuaPArent","FileUploadArea",!0),this.fu=new Te}render(){return this.FileUploadFile=Z("FileUploadFile",["FileUploadFile"],{on:{change:this.fu.handleFileSelect(this)}}),this.fileUploadArea=V("FileUploadArea",["FileUploadAreaA"],Oe),V(this.id,["FileUploadArea"],{on:{dragover:this.fu.handleDrop(this),drop:this.fu.handleDrop(this),click:t=>{this.getElementById("FileUploadFile").elm.click()}}},[this.fileUploadArea,this.FileUploadFile])}async onAfterAttach(t,e){}}const Re=/yyyy/,ze=/MM/,Ue=/dd/,Fe=/hh/,_e=/mm/,Ve=/ss/,je=(t,e="yyyy-MM-dd hh:mm:ss")=>{const i=new Date(t),r=i.getFullYear(),s=("0"+(1*i.getMonth()+1)).slice(-2),a=("0"+i.getDate()).slice(-2),n=("0"+i.getHours()).slice(-2),o=("0"+i.getMinutes()).slice(-2),l=("0"+i.getSeconds()).slice(-2);return e.replace(Re,r).replace(ze,s).replace(Ue,a).replace(Fe,n).replace(_e,o).replace(Ve,l)},We=()=>(new Date).getTime();class Ze{constructor(){}static creatAction(t,e,i=null){return B.createBaseAction("creatSetting",t,e,i)}static creatRemoveAction(t,e,i=null){return B.createBaseAction("removeSetting",t,e,i)}static creatLoadAction(t,e,i=null){return B.createBaseAction("loadSetting",t,e,i)}static creatUpdateAction(t,e,i=null){return B.createBaseAction("updateSetting",t,e,i)}static getStoreKey(){return"settings"}static getStoreKeyOpm(){return"settingsOpm"}}let Xe=null;class Ye extends ${constructor(){super(),this.ms=Se.getInstance(),this.tm=this.ms.tm,this.sm=this.ms.sm,this.im=this.ms.im,this.opm=this.ms.opm,this.creatAction=Ze.creatAction(),this.creatRemoveAction=Ze.creatRemoveAction(),this.creatLoadAction=Ze.creatLoadAction(),this.creatUpdateAction=Ze.creatUpdateAction(),this.atatch(this.creatAction),this.atatch(this.creatRemoveAction),this.atatch(this.creatLoadAction),this.atatch(this.creatUpdateAction),this.storeKey=Ze.getStoreKey(),this.storeKeyOpm=Ze.getStoreKeyOpm(),this.pp=new Ke,this.storeImagesKey=Ee.getStoreImagesKey(),this.storePagesKey=Ce.getStorePagesKey()}static register(){Xe||(Xe=new Ye)}async reduce(t,e){if(this.creatAction.type===e.type)t[this.storeKey]=await this.load().catch(t=>{console.error(t)}),t[this.storeKeyOpm]=await this.opm.loadAll().catch(t=>{console.error(t)});else if(this.creatRemoveAction.type===e.type)t[this.storeKey]=await this.reset(e.data).catch(t=>{console.error(t)}),t[this.storeKeyOpm]=await this.opm.loadAll().catch(t=>{console.error(t)});else if(this.creatLoadAction.type===e.type)t[this.storeKey]=await this.load().catch(t=>{console.error(t)}),t[this.storeKeyOpm]=await this.opm.loadAll().catch(t=>{console.error(t)});else if(this.creatUpdateAction.type===e.type){t[this.storeKey]=await this.update(e.data).catch(t=>{console.error(t)}),t[this.storeKeyOpm]=await this.opm.loadAll().catch(t=>{console.error(t)});const i=await this.pp.resetPagesFull().catch(t=>{console.error(t)});t[this.storePagesKey]=await this.pp.loadPages(i).catch(t=>{console.error(t)}),t[this.storeImagesKey]=await this.im.loadImages().catch(t=>{console.error(t)})}}async update(t){const e=(await this.tm.load()).getPk();await this.sm.save(e,t.name,t.pageNum,t.startPage,t.pageDirection,t.outputProfile,t.listing);if(!await this.sm.loadByPk(e)){return await this.sm.createDefault(e)}return this.tm.loadSettings()}async reset(){const t=(await this.tm.load()).getPk();return await this.sm.createDefault(t)}async load(){return this.tm.loadSettings()}}class He extends it{constructor(){super("TitleSettings","TitleSettings"),this.text="TitleSettingsAAA",this.bodyId=this.id+"Child",this.storeKey=Ze.getStoreKey(),this.getStoreKeyOpm=Ze.getStoreKeyOpm()}render(){return V(this.bodyId,["TitleSettings"],this.text)}async onAfterAttach(t,e){Ye.register();const i=Ze.creatLoadAction(this,{});await this.dispatch(i)}async onViewShow(t,e){t[this.storeKey]&&await this.showSettings(t[this.storeKey],t[this.getStoreKeyOpm])}update(){return t=>{const e=document.getElementById(this.id+"NameInput").value,i=document.getElementById(this.id+"PageNumInput").value,r=document.getElementById(this.id+"StartPageInput").value,s=document.getElementById(this.id+"PageDirectionInput").value,a=document.getElementById(this.id+"OutputProfileInput").value,n=Ze.creatUpdateAction(this,{name:e,pageNum:i,startPage:r,pageDirection:s,outputProfile:a,listing:0});this.dispatch(n)}}async showSettings(t,e){const i=this.id+"Label",r=this.id+"Input",s=V("",[this.id+"Title"],"Setting for Output"),a=j("",[i],"name:"),n=X(this.id+"NameInput",[this.id+"NameInput"],{props:{name:this.id+"NameInput"}},"text",t.name),o=V("",[this.id+"Row"],[a,n]),l=j("",[i],"pageNum:"),c=this.id+"PageNumInput",h=J(c,[r,c],c,he.pageNums,t.pageNum),d=V("",[this.id+"Row"],[l,h]),u=j("",[i],"startPage:"),p=this.id+"StartPageInput",g=J(p,[r,p],p,he.pageStart,t.startPage),m=V("",[this.id+"Row"],[u,g]),f=j("",[i],"pageDirection:"),y=this.id+"PageDirectionInput",w=J(y,[r,y],y,he.pageDirection,t.pageDirection),b=V("",[this.id+"Row"],[f,w]),A=j("",[i],"outputProfile:"),v=this.id+"OutputProfileInput",x=X(v,[r,v],{props:{name:v}},"text",t.outputProfile),P=V("",[this.id+"Row"],[A,x]),S=V("",[this.id+"FrameL"],[o,d]),D=V("",[this.id+"FrameR"],[m,b,P]),k=[s,V("",[this.id+"Frame"],[S,D]),V("",[this.id+"Update"],{on:{click:this.update()}},"Save! LastUpdae:"+je(t.updateDate))];this.prePatch("#"+this.bodyId,V(this.bodyId,["TitleSettings"],k))}}class Ge{constructor(){}static createExecuteAction(t,e,i=null){return B.createBaseAction("executeExport",t,e,i)}static creatExecuteAllAction(t,e,i=null){return B.createBaseAction("executeExportAll",t,e,i)}static creatRemoveAction(t,e,i=null){return B.createBaseAction("removeExported",t,e,i)}static creatLoadAction(t,e,i=null){return B.createBaseAction("loadExported",t,e,i)}static createDownloadAction(t,e,i=null){return B.createBaseAction("downloadExport",t,e,i)}static createExecutePdfAction(t,e,i=null){return B.createBaseAction("executePdfExport",t,e,i)}static createDownloadPdfAction(t,e,i=null){return B.createBaseAction("downloadPdfExport",t,e,i)}static createDownloadImgAction(t,e,i=null){return B.createBaseAction("downloadUploadedImgZip",t,e,i)}static createDownloadFullBKAction(t,e,i=null){return B.createBaseAction("downloadFullBackup",t,e,i)}static createSelectOrderAction(t,e,i=null){return B.createBaseAction("selectOrderExport",t,e,i)}static getStoreKey(){return"exports"}static getStorePdfDLKey(){return"exportPdfDL"}static getStoreZipDLKey(){return"exportZipDL"}static getStoreUploadedImgZipDLKey(){return"exportUploadedImgZipDL"}static getStoreFullBackupZipDLKey(){return"exportFullBackupZipDL"}static getStoreRemoveResultKey(){return"exportRemoveResult"}static getStoreExportResultKey(){return"exportExportResult"}static getStoreSelectedOrderKey(){return"exportSelectedOrder"}}class Je{constructor(){this.imageMerger=new ye.a}async cropImage(t,e,i,r,s){const a={data:new Uint8ClampedArray(e*i*4),width:e,height:i};return t.offsetX=r,t.offsetY=s,await this.imageMerger.margeReplace(a,[t],!1),a}async corpImageToData(t,e,i){t.offsetX=i.x,t.offsetY=i.y,await this.imageMerger.margeReplace(e,[t],!1)}}var qe=i(1);class Qe{constructor(){}beGrascale(t){const e=t.data,i=t.width,r=t.height;for(let t=0;t<r;t++)for(let r=0;r<i;r++){const s=4*(t*i+r),a=qe.a.trimByte((e[s]+e[s+1]+e[s+2])/3);e[s]=a,e[s+1]=a,e[s+2]=a}return t}}class $e{static surrogatePairToCodePoint(t,e){return((1023&t)<<10)+(1023&e)+65536}static stringToCodePointArray(t){const e=[],i=t.length;for(let r=0;r<i;r++){const i=t.charCodeAt(r);55296==(63488&i)?e.push($e.surrogatePairToCodePoint(i,t.charCodeAt(++r))):e.push(i)}return console.log(e),e}static codePointArrayToString(t){let e="";const i=t.length;for(let r=0;r<i;++r){let i=null;const s=t[r];if(s>65535){const t=s-65536;i=[55296+(t>>10),56320+(1023&t)]}else i=[s];e+=String.fromCharCode.apply(String,i)}return e}static encodeUTF8(t){const e=$e.stringToCodePointArray(t),i=e.length,r=[];for(let t=0;t<i;t++){const i=e[t];i<=127?r.push(i):i<=2047?r.push(192|i>>>6,128|191&i):i<=65535?r.push(224|i>>>12,128|i>>>6&191,128|191&i):i<=131071&&r.push(240|i>>>18,128|i>>>12&191,128|i>>>6&191,128|191&i)}return new Uint8Array(r)}static encodeUTF16(t,e){const i=$e.stringToCodePointArray(t),r=i.length,s=e?"LE"===e?[255,254]:[254,255]:[];for(let t=0;t<r;t++){const r=i[t];"LE"===e?s.push(255&r,r>>>8&255):s.push(r>>>8&255,255&r)}return new Uint8Array(s)}decodeUTF8(t){let e="";const i=t.length;for(let r=0;r<i;r++){const i=t[r];e+=i<=127?String.fromCharCode(i):i<=223&&i>=194?String.fromCharCode((31&i)<<6|63&t[++r]):i<=239&&i>=224?String.fromCharCode((15&i)<<12|(63&t[++r])<<6|63&t[++r]):i<=247&&i>=240?String.fromCharCode(55296|((7&i)<<8|(63&t[++r])<<2|t[++r]>>>4&3)-64,56320|(15&t[r++])<<6|63&t[r]):String.fromCharCode(65533)}return e}decodeUTF16(t){let e="BE",i=0;const r=t.length;let s="";for(t[0]*t[1]==64770&&(e=255===t[0]?"LE":"BE",i=2);i<r;i+=2)s+=String.fromCharCode("LE"===e?t[i+1]<<8|t[i]:t[i]<<8|t[i+1]);return s}static stringToByteArray(t){const e=t.length,i=new Uint8Array(e);for(let r=0;r<e;r++)i[r]=255&t.charCodeAt(r);return i}}class ti{constructor(t){this.actionDispatcher=z.createStandAlone()}async update(t,e){if(t<100){const i=Math.floor(10*t)/10;await this.actionDispatcher.dispatch(_t.creatUpdateAction(null,{progress:i,msg:e}))}}async comple(t){await this.actionDispatcher.dispatch(_t.creatCompleatAction(null,{msg:t}))}async open(t){await this.actionDispatcher.dispatch(_t.creatAddAction(null,{msg:"",title:t}))}async close(){await this.actionDispatcher.dispatch(_t.creatRemoveAction())}}class ei{constructor(){this.ms=Se.getInstance(),this.em=this.ms.em,this.tm=this.ms.tm,this.ip=this.ms.ip,this.previewMaxWidth=1e3,this.previewMaxHeight=1e3,this.pbp=new ti,this.progress=0}async loadPreviews(){await this.pbp.open("Create Previews"),this.progress=0,this.pbp.update(this.progress,"loading Settings");const t=(await this.tm.load()).pages,e=[],i=t.length,r=100/(4*i);let s=0;const a=await this.em.getAsMap(t);for(let n of t){const t="["+ ++s+"/"+i+"]";if(this.progress+=r,this.pbp.update(this.progress,"load pageEnitity"+t),!n){e.push(null);continue}const o=a[n];if(!o){e.push(null);continue}const l=o.previewThumbnail,c=o.baseImage;if(c)if(l){this.progress+=3*r,this.pbp.update(this.progress,"load binaryEntity"+t);const i=await this.em.get(l);i.parent=o,i.parentPk=n,e.push(i)}else{this.progress+=r,this.pbp.update(this.progress,"load imageEntity"+t);const i=await this.em.get(c);this.progress+=r,this.pbp.update(this.progress,"load binaryEntity"+t);const s=await this.em.get(i.binary);this.progress+=r,this.pbp.update(this.progress,"resize As Paper B5_72dpi"+t),s._ab=await this.ip.resizeAsPaperB5_72(s._ab),s.parent=o,s.parentPk=n,e.push(s)}else e.push(null)}return this.progress=100,await this.pbp.update(this.progress,"end all!"),e}async shapeListBySets(t,e,i){const r=ei.getCratePageDataFunc();if(e){const e=[];for(let i in t)e.push(r(1*i+1,!1,!1,t,this.dummyClass));return await this.pbp.comple(this.progress),e}{const e=1*i.pageNum;return this.pageNum=e,await this.pbp.comple(this.progress),ei.buildPageFrames(i,t,r,this.dummyClass)}}static getCratePageDataFunc(){return(t,e,i,r,s)=>{const a=r[t-1];return{pageNo:t,parent:a?a.parent:null,parentPk:a?a.parentPk:null,isDummy:e===s,isRight:i,binary:a}}}static buildPageFrames(t,e,i,r){const s=[],a=t.startPage,n=1*t.pageNum,o=t.pageDirection,l="r2l"===o,c="r"===a,h=Math.ceil(n/2),d=n%2==1,u=0===o.indexOf(a),p=1*h+1*(d?1:u?0:1),g=l&&c||!l&&!c,m=!c||g?"":r,f=c||g?"":r,y=d&&(!g||g&&!l)||!d&&(!l||g)?"":r,w=d&&(!g||g&&l)||!d&&(l||g)?"":r,b=p-1;let A=0,v=0;for(let t=0;t<p;t++){const a=(l?1:0)+v+A,n=(l?0:1)+v+A,o=[];if(s.push(o),0===t){const t=l&&g?2:l?1:g?1:0,s=l&&g?1:l?0:g?2:1;o.push(i(t,m,!1,e,r)),o.push(i(s,f,!0,e,r)),v=1,A+=g?2:1}else t===b?(o.push(i(a,y,!1,e,r)),o.push(i(n,w,!0,e,r))):(o.push(i(a,"",!1,e,r)),o.push(i(n,"",!0,e,r)),A+=2)}return s}async updatePage(t,e){const i=await this.em.Pages.get(t);ei.getCratePageDataFunc();if(i){const t=i[e];i[e]=!t,await this.em.Pages.save(i)}return i}}class ii{constructor(){}toArrayBuffer(){}static joinU8as(t){let e=0,i=0;const r=[];for(let i of t){const t=e,s=e+=i.byteLength;r.push({start:t,end:s})}console.log("joinU8as.len:"+e);const s=new Uint8Array(e);for(let e of t){const t=r[i],a=t.start,n=t.end;for(let t=a;t<n;t++)s[t]=e[t-a];i++}return s}static hexString2U8a(t){const e=[],i=t.split(",");console.log("BinaryUtil.hexString2U8a hexStr:"+t+" /len:"+i.length),console.log(i);for(let t of i)t&&!Number.isNaN(parseInt(t,16))&&e.push(parseInt(t,16));return new Uint8Array(e)}static convertDataUri2U8a(t){const e=t.split(",")[1],i=atob(e),r=i.length,s=new Uint8Array(new ArrayBuffer(r));for(let t=0;t<r;t++)s[t]=i.charCodeAt(t);return s}convertStr2Ab(t){const e=btoa(unescape(encodeURIComponent(t))).split(""),i=e.length,r=new Uint8Array(i);for(let t=0;t<i;t++)r[t]=e[t].charCodeAt(0);return r.buffer}uintToString(t){const e=new Uint8Array(t);for(let t=0;t<len;t++)e[t]=charList[t].charCodeAt(0);const i=String.fromCharCode.apply(null,uintArray);return decodeURIComponent(escape(atob(i)))}convertHexToAb(t){const e=t.length,i=new Uint8Array(e);for(let r=0;r<e;r++){const e=t[r];i[r]=parseInt(e,16)}return i.buffer}unicodeStringToTypedArray(t){const e=encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,function(t,e){return String.fromCharCode("0x"+e)}),i=new Uint8Array(e.length);return Array.prototype.forEach.call(e,function(t,e){i[e]=t.charCodeAt(0)}),i}typedArrayToUnicodeString(t){const e=Array.prototype.map.call(t,function(t){return String.fromCharCode(t)}).join("").replace(/(.)/g,function(t,e){const i=e.charCodeAt(e).toString(16).toUpperCase();return i.length<2&&(i="0"+i),"%"+i});return decodeURIComponent(e)}}class ri{static surrogatePairToCodePoint(t,e){return((1023&t)<<10)+(1023&e)+65536}static stringToCodePointArray(t){const e=[];if(!t)return e;const i=t.length;for(let r=0;r<i;r++){const i=t.charCodeAt(r);55296==(63488&i)?e.push(ri.surrogatePairToCodePoint(i,t.charCodeAt(++r))):e.push(i)}return e}static codePointArrayToString(t){let e="";const i=t.length;for(let r=0;r<i;++r){let i=null;const s=t[r];if(s>65535){const t=s-65536;i=[55296+(t>>10),56320+(1023&t)]}else i=[s];e+=String.fromCharCode.apply(String,i)}return e}static encodeUTF8(t){const e=ri.stringToCodePointArray(t),i=e.length,r=[];for(let t=0;t<i;t++){const i=e[t];i<=127?r.push(i):i<=2047?r.push(192|i>>>6,128|191&i):i<=65535?r.push(224|i>>>12,128|i>>>6&191,128|191&i):i<=131071&&r.push(240|i>>>18,128|i>>>12&191,128|i>>>6&191,128|191&i)}return new Uint8Array(r)}static encodeUTF16(t,e){const i=ri.stringToCodePointArray(t),r=i.length,s=e?"LE"===e?[255,254]:[254,255]:[];for(let t=0;t<r;t++){const r=i[t];"LE"===e?s.push(255&r,r>>>8&255):s.push(r>>>8&255,255&r)}return new Uint8Array(s)}decodeUTF8(t){let e="";const i=t.length;for(let r=0;r<i;r++){const i=t[r];e+=i<=127?String.fromCharCode(i):i<=223&&i>=194?String.fromCharCode((31&i)<<6|63&t[++r]):i<=239&&i>=224?String.fromCharCode((15&i)<<12|(63&t[++r])<<6|63&t[++r]):i<=247&&i>=240?String.fromCharCode(55296|((7&i)<<8|(63&t[++r])<<2|t[++r]>>>4&3)-64,56320|(15&t[r++])<<6|63&t[r]):String.fromCharCode(65533)}return e}decodeUTF16(t){let e="BE",i=0;const r=t.length;let s="";for(t[0]*t[1]==64770&&(e=255===t[0]?"LE":"BE",i=2);i<r;i+=2)s+=String.fromCharCode("LE"===e?t[i+1]<<8|t[i]:t[i]<<8|t[i+1]);return s}static stringToByteArray(t){const e=t.length,i=new Uint8Array(e);for(let r=0;r<e;r++)i[r]=255&t.charCodeAt(r);return i}}const si={Type:!0,Subtype:!0,BaseFont:!0,PDF:!0,ColorSpace:!0,Filter:!0,ProcSet:!0},ai={A6:{x:105,y:148},B6:{x:128,y:182},A5:{x:148,y:210},B5:{x:182,y:257},A4:{x:210,y:297},B4:{x:257,y:364},A3:{x:297,y:420}},ni=(()=>{const t={};for(let e in ai){const i=ai[e],r=Math.floor(10*i.x*(1/25.4*72))/10,s=Math.floor(10*i.y*(1/25.4*72))/10;t[e]=[0,0,r,s]}return t})(),oi=new Map,li="\n",ci=[];class hi{constructor(){this.exportText="",this.map={},this.isBePlaneMap=!1,this.afterRegsterRefMap=[],this.isRoot=!1,this.isInfo=!1}createExport(){}static getRefMap(){return oi}static init(){const t=ci.length;for(let e=0;e<t;e++)ci.pop();oi.clear()}static getRefList(){return ci}registerAfterRefMap(t){this.afterRegsterRefMap.push(t)}registerRefMap(){ci.push(this);let t=1;for(let e of ci){const i=t+" 0 ";oi.set(e,i),t++}for(let t of this.afterRegsterRefMap)t.registerRefMap()}getRefNo(){return oi.get(this)}isRegisterd(){return oi.has(this)}setBePlaneMap(){this.isBePlaneMap=!0}setElm(t,e){this.map[t]=e}static getNewLine(){return li}createFile(){}static getAsU8a(t){return ri.encodeUTF8(t+li)}createObject(){const t=this.createStream(this.map),e=ri.encodeUTF8(this.getRefNo()+"obj"+li),i=ri.encodeUTF8(this.createMap("",this.map)),r=ri.encodeUTF8("endobj"+li);return ii.joinU8as([e,i,t,r])}createMap(t,e){let i="";if(null===e||void 0===e);else if("string"==typeof e)si[t]?i+="/"+e:i+="("+e+")";else if("number"==typeof e)i+=e;else if("object"==typeof e&&Array.isArray(e)){const r=[];for(let i in e){const s=e[i];r.push(this.createMap(t,s))}i+="[ "+r.join(" ")+" ]"}else if("object"==typeof e&&e.isRegisterd&&e.isRegisterd())i+=e.getRefNo()+"R";else if("object"==typeof e&&e.isRegisterd&&e.map){i+="<<"+li;for(let t in e.map){const r=e.map[t];i+="/"+t+" "+this.createMap(t,r)+li}i+=">>"}else if("object"==typeof e){i+="<<"+li;for(let t in e){const r=e[t];i+="/"+t+" "+this.createMap(t,r)+li}i+=">>"+li}return i}createStream(){return ri.encodeUTF8("")}}const di=hi.getNewLine();class ui{static getText(){return"%PDF-1.ï¼”"+di+"%"}static getU8a(){const t=ri.encodeUTF8(ui.getText()),e=ii.hexString2U8a("e2,e3,cf,d3"),i=ri.encodeUTF8(di);return ii.joinU8as([t,e,i])}}class pi extends hi{constructor(t){super(),this.setElm("Type","Catalog"),this.setElm("Pages",t),this.registerAfterRefMap(t),this.isRoot=!0}}class gi extends hi{constructor(t){super(),this.setElm("Length",0),this.imageId=t}setParentPage(t){this.pageObj=t,this.pageWidth=this.pageObj.width,this.pageHeight=this.pageObj.height}createStream(){const t=hi.getNewLine(),e=[];let i="";e.push(hi.getAsU8a("stream")),i+="q"+t,i+=this.pageWidth+" 0 0 "+this.pageHeight+" 0 0 cm"+t,i+="/"+this.imageId+" Do"+t,i+="Q";const r=hi.getAsU8a(i),s=r.byteLength;return this.setElm("Length",s),e.push(r),e.push(hi.getAsU8a("endstream")),ii.joinU8as(e)}}class mi extends hi{constructor(t){super(),this.setElm("ProcSet",["PDF","ImageC"]),this.imageId=t}setImageXObject(t){const e=new hi;e.setBePlaneMap();const i=t.getImageId();e.setElm(i,t),t.registerRefMap(),this.setElm("XObject",e)}}class fi extends hi{constructor(t,e,i,r){super(),this.setElm("Type","XObject"),this.setElm("Subtype","Image"),this.setElm("Width",i),this.setElm("Height",r),this.setElm("BitsPerComponent",8),this.setElm("Length",0),this.setElm("ColorSpace","DeviceRGB"),this.setElm("Filter","DCTDecode"),this.imageId=t,console.log("ImageXObject.constructor u8a:"+e.byteLength),this.jpegU8a=e}getImageId(){return this.imageId}createStream(){const t=hi.getNewLine(),e=[];e.push(hi.getAsU8a("stream"));const i=this.jpegU8a.byteLength;this.setElm("Length",i),e.push(this.jpegU8a),e.push(hi.getAsU8a(t+"endstream")),console.log("ImageXObject.createStream this.jpegU8a:"+this.jpegU8a.byteLength);const r=ii.joinU8as(e);return console.log("ImageXObject.createStream result:"+r.byteLength),r}}const yi=/yyyy/,wi=/MM/,bi=/dd/,Ai=/hh/,vi=/mm/,xi=/ss/,Pi=()=>{return((t,e="yyyy-MM-dd hh:mm:ss")=>{const i=new Date(t),r=i.getFullYear(),s=("0"+(1*i.getMonth()+1)).slice(-2),a=("0"+i.getDate()).slice(-2),n=("0"+i.getHours()).slice(-2),o=("0"+i.getMinutes()).slice(-2),l=("0"+i.getSeconds()).slice(-2);return e.replace(yi,r).replace(wi,s).replace(bi,a).replace(Ai,n).replace(vi,o).replace(xi,l)})((new Date).getTime(),"D:yyyyMMddhhmmss+0:00")};class Si extends hi{constructor(){super(),this.setElm("Type","Info"),this.setElm("Creator","It is me!"),this.setElm("CreationDate",Pi()),this.setElm("ModDate",Pi()),this.setElm("Producer","aaa"),this.isInfo=!0}}class Di extends hi{constructor(t="A4"){super(),this.setElm("Type","Page");const e=ni[t];this.width=e[2],this.height=e[3],this.setElm("MediaBox",e)}setParent(t){this.setElm("Parent",t)}setResources(t){this.setElm("Resources",t),t.registerRefMap()}setContents(t){t.setParentPage&&t.setParentPage(this),this.setElm("Contents",t),t.registerRefMap()}getFontName(){return this.fontName}}class ki extends hi{constructor(){super(),this.setElm("Type","Pages"),this.pages=[],this.setElm("Kids",this.pages),this.setElm("Count",this.pages.length)}addPage(t){this.pages.push(t),t.registerRefMap(),t.setParent(this),this.setElm("Kids",this.pages),this.setElm("Count",this.pages.length)}}const Bi="\r\n";class Ii extends hi{constructor(){super()}setRoot(t){t.registerRefMap()}setInfo(t){t.registerRefMap()}createXref(t){const e=hi.getNewLine();let i="xref"+e;const r=hi.getRefList(),s=r.length;i+="0 "+s+e;const a=[];let n=null,o=null;i+="0000000000 65535 f"+Bi;let l=t;for(let t=0;t<s;t++){const e=r[t],s=e.createObject();i+=("0000000000"+l).slice(-10)+" 00000 n"+Bi,l+=s.length,a.push(s),e.isRoot&&(n=e),e.isInfo&&(o=e)}i+="trailer"+e,i+="<<"+e,i+="/Root "+n.getRefNo()+"R"+e,o&&(i+="/Info "+o.getRefNo()+"R"+e),i+="/Size "+s+e,i+=">>"+e,i+="startxref"+e,i+=l+e,i+="%%EOF";const c=hi.getAsU8a(i);return a.push(c),ii.joinU8as(a)}}class Ei{constructor(t){hi.init(),this.pageSize=t,this.info=new Si,this.pages=new ki,this.root=new pi(this.pages),this.trailer=new Ii,this.trailer.setRoot(this.root),this.trailer.setInfo(this.info),this.imageCount=0}addDummyPage(){new Di(this.pageSize)}addImagePage(t,e,i,r){let s=new Uint8Array(e),a=i,n=r;t||e||(s=new Uint8Array([255,255,255,255]),a=1,n=1);const o="img"+this.imageCount,l=new gi(o),c=new mi(o),h=new Di(this.pageSize),d=t?ii.convertDataUri2U8a(t):s,u=new fi(o,d,a,n);this.pages.addPage(h),h.setContents(l),h.setResources(c),c.setImageXObject(u),this.imageCount++}createFile(){const t=[],e=ui.getU8a();console.log("headerU8a:"+e.byteLength),t.push(e);const i=this.trailer.createXref(e.byteLength);return t.push(i),ii.joinU8as(t)}}class Ci{constructor(){}createDoc(t){}createImagesDoc(t="A4",e){const i=new Ei(t);for(let t of e){if(!t||"object"!=typeof t){i.addDummyPage();continue}const e=t.dataUri,r=t.ab,s=t.height,a=t.width;i.addImagePage(e,r,a,s)}return i.createFile()}}class Ki{constructor(t){this.pp=t,this.ms=Se.getInstance(),this.em=this.ms.em,this.bm=this.ms.bm,this.im=this.ms.im,this.ip=this.ms.ip,this.paper=new fe,this.delList=[]}async createPdf(t,e,i,r){const s=[],a=r.pageNum,n={data:new Uint8Array(i.x*i.y*4),width:i,height:i.y};let o=0;for(let t of e){if(a<++o)break;if(!t||!t.outputExpandImage){s.push({});continue}const e=await this.loadBinaryWidCleanUp(t.outputExpandImage);n.data=new Uint8ClampedArray(e._ab),n.width=e.width,n.height=e.height;let i=this.ip.getArrayBufferFromImageBitmapDataAsJpg(n,1);s.push({ab:i,width:n.width,height:n.height})}const l=(new Ci).createImagesDoc(t,s);return this.delOnList(),l}async loadBinaryWidCleanUp(t){if(!t)return null;const e=await this.em.get(t);return this.delList.push(t),e}async delOnList(){for(let t of this.delList);}}var Ni=i(15);const Li={orderName:"MangaPaperA4ExpandTatikiri",basePaper:"mangaPaperA4ExpandTatikiri",dpiName:"dpi600"};class Ti{constructor(t){this.pp=t,this.ms=Se.getInstance(),this.em=this.ms.em,this.sm=this.ms.sm,this.bm=this.ms.bm,this.im=this.ms.im,this.iom=this.ms.iom,this.ip=this.ms.ip,this.tm=this.ms.tm,this.paper=new fe,this.imageMerger=new ye.a,this.imageResizer=new we.a,this.imageCropper=new Je,this.imageFilter=new Qe,this.pbp=new ti,this.epp=new Ki,this.progress=0,this.delList=[]}async exportZipExecute(t=[Li]){return await this.exportExecute(t,!0)}async exportPdfExecute(t){return await this.exportExecute(t,!1)}async exportExecute(t=[Li],e=!0){await this.pbp.open("Export and save files for print as "+(e?"zip":"pdf")),this.progress=0,this.pbp.update(this.progress,"loading Settings");const i=await this.tm.loadSettings().catch(t=>{console.error(t)});this.progress=1,this.pbp.update(this.progress,"loading pages");const r=await this.pp.loadPages().catch(t=>{console.error(t)});this.progress=2,await this.pbp.update(this.progress,"start executess");const s=await this.executeParOrder(i,r,t[0],e).catch(t=>{console.error("ExportImageProcessor exportExecute executeParOrder"),console.error(t.stack),console.error(t),console.error(t.currentTarget),console.error(t.returnValue),console.error(t.srcElement),console.error(t.target),console.error(t.type),console.error(t.eventPhase),console.error(t.timeStamp),console.error(t.message),console.error(t.lineno),console.error(t.error)});return await this.pbp.comple(this.progress),s}async executeParOrder(t,e,i,r){const s=this.paper.getDpi(i.dpiName),a=this.paper.getTargetPaperSize(i.basePaper,i.dpiName),n=this.paper.calcClopOffsetPixcel(i.basePaper,s),o=this.paper.getPaperFrameSizeMm(i.basePaper),l=i.isGrayscale,c=i.isMaxSize10M,h=i.isLanczose,d={x:this.paper.calcPixcel(s,o.x),y:this.paper.calcPixcel(s,o.y)};return this.progress=3,this.pbp.update(this.progress,"expandAndCropSize"),await this.expandAndCropSize(a,o,d,n,e,l,h,t.pageNum).catch(t=>{console.error("ExportImageProcessor exportExecute executeParOrder"),console.error(t.stack),console.error(t),console.error(t.currentTarget),console.error(t.returnValue),console.error(t.srcElement),console.error(t.target),console.error(t.type),console.error(t.eventPhase),console.error(t.timeStamp),console.error(t.message),console.error(t.lineno),console.error(t.error)}),r?await this.executeAsZip(a,t,e,c):await this.executeAsPdf(i.basePaper,t,e,c)}async executeAsZip(t,e,i,r){const s="r2l"===e.pageDirection,a="r"===e.startPage,n=s&&a||!s&&!a,o=i.length%2>0;this.progress=60,this.pbp.update(this.progress,"start exportDualImage4Print"),await this.exportDualImage4Print(t,e,i,n,o,s,r).catch(t=>{console.error("ExportImageProcessor exportExecute executeParOrder"),console.error(t.stack),console.error(t),console.error(t.currentTarget),console.error(t.returnValue),console.error(t.srcElement),console.error(t.target),console.error(t.type),console.error(t.eventPhase),console.error(t.timeStamp),console.error(t.message),console.error(t.lineno),console.error(t.error)}),this.progress=85,this.pbp.update(this.progress,"start exoprtAsZip"),await this.delOnList();const l=await this.exoprtAsZip(i).catch(t=>{console.error("ExportImageProcessor exportExecute executeParOrder"),console.error(t.stack),console.error(t),console.error(t.currentTarget),console.error(t.returnValue),console.error(t.srcElement),console.error(t.target),console.error(t.type),console.error(t.eventPhase),console.error(t.timeStamp),console.error(t.message),console.error(t.lineno),console.error(t.error)});return await this.commonEnd(l,"zip")}async executeAsPdf(t,e,i,r){e.pageDirection,e.startPage,i.length;this.progress=60,this.pbp.update(this.progress,"start exportDualImage4Print"),this.progress=85,this.pbp.update(this.progress,"start exoprtAsPdf");const s=this.paper.getTragetPaper(t),a=await this.epp.createPdf(s,i,t,e).catch(t=>{console.error("ExportImageProcessor exportExecute executeParOrder"),console.error(t.stack),console.error(t),console.error(t.currentTarget),console.error(t.returnValue),console.error(t.srcElement),console.error(t.target),console.error(t.type),console.error(t.eventPhase),console.error(t.timeStamp),console.error(t.message),console.error(t.lineno),console.error(t.error)});return await this.commonEnd(a,"pdf")}async commonEnd(t,e){const i=await this.tm.getExports();let r=null,s=null;for(let t of i){const i=await this.iom.load(t);if(i&&i.type===e){r=t,s=i.binary;break}}const a=await this.bm.save(s,"expandPage",t),n=t.byteLength,o=(new Date).getTime(),l=je(o,"yyyyMMddThhmmss"),c=await this.tm.loadSettings(),h=await this.tm.getCurrentTitleName(),d=c.name?c.name:h,u=await this.iom.save(r,d+l+"."+e,a,e,Li.orderName,n);return u&&(i.push(u),await this.tm.saveCurrent()),await this.delOnList(),this.progress=100,this.pbp.update(this.progress,"end all!"),this.pbp.comple(this.progress),i}async expandAndCropSize(t,e,i,r,s,a,n,o){const l={data:new Uint8ClampedArray(i.x*i.y*4),width:i.x,height:i.y},c={data:new Uint8ClampedArray(t.x*t.y*4),width:t.x,height:t.y},h=(new Uint8ClampedArray(t.x*t.y*4),t.x,t.y,t.x/t.y);let d=null;this.progress=5,this.pbp.update(this.progress,"start pages");const u=o,p=50/(9*u);let g=0;for(let t of s){if(++g>u)break;const i="["+g+"/"+u+"]";if(t&&t.baseImage){this.pbp.update(this.progress,"load baseImageEntity"+i);const s=await this.em.get(t.baseImage);this.progress+=p,this.pbp.update(this.progress,"load baseBinaryEntity"+i);const o=s.width,u=s.height,g=await this.em.get(s.binary);d=g._ab,this.progress+=p,this.pbp.update(this.progress,"get ImageDataFromArrayBuffer"+i);const m=await this.ip.getImageDataFromArrayBuffer(g._ab),f=o/u>h,y=f?o:u,w=f?e.x:e.y,b=(this.paper.calcDpi(y,w),f?o:Math.floor(u*h)),A=f?Math.floor(o/h):u,v=f?0:Math.floor((b-o)/2),x=f?Math.floor((A-u)/2):0,P={data:new Uint8ClampedArray(b*A*4),width:b,height:A};m.offsetX=v,m.offsetY=x,this.progress+=p,this.pbp.update(this.progress,"maege Replace origin to whitePaper"+i),console.time("maege Replace origin to whitePaper"+i),a&&!t.isForceColor?await this.imageMerger.margeReplace(P,[this.imageFilter.beGrascale(m)],!0,!0):await this.imageMerger.margeReplace(P,[m],!0,!0),console.timeEnd("maege Replace origin to whitePaper"+i),this.progress+=p,this.pbp.update(this.progress,(n?"expand resizeAsLanczos":"expand resizeAsByCubic")+i),console.time((n?"expand resizeAsLanczos":"expand resizeAsByCubic")+i),t.isNoCropping?(n?await this.imageResizer.resizeAsLanczos(P,c,!0):await this.imageResizer.resizeAsByCubic(P,c,!0),this.progress+=p,this.pbp.update(this.progress,"No crop!"+i)):(n?await this.imageResizer.resizeAsLanczos(P,l,!0):await this.imageResizer.resizeAsByCubic(P,l,!0),this.progress+=p,this.pbp.update(this.progress,"crop!"+i),await this.imageCropper.corpImageToData(l,c,r)),console.timeEnd((n?"expand resizeAsLanczos":"expand resizeAsByCubic")+i),this.progress+=p,this.pbp.update(this.progress,"get ArrayBuffer From ImageBitmapData"+i),d=c.data.buffer;const S=t.outputExpandImage;this.progress+=p,this.pbp.update(this.progress,"save ArrayBuffer"+i);const D=await this.bm.save(S,"expandPage",d,{width:c.width,height:c.height});t.outputExpandImage=D,this.progress+=p,this.pbp.update(this.progress,"save pageEntity"+i),await this.em.Pages.save(t)}else this.progress+=9*p,this.pbp.update(this.progress,"save pageEntity"+i)}}async exoprtAsZip(t){console.time("exoprtAsZip");const e=new Ni.Zlib.Zip({compress:!1});let i=0,r=null;for(let s of t)if(s&&s.outputDualImage){if(s.outputDualImage===r){s.outputDualImage=null;continue}i++,r=s.outputDualImage;const t=await this.em.get(r);if(t){const s=2*i,a=s-1;e.addFile(new Uint8Array(t._ab),{filename:$e.stringToByteArray("page"+a+"-"+s+".jpg")}),this.delList.push(r)}}const s=e.compress();return console.timeEnd("exoprtAsZip"),s}async exportDualImage4Print(t,e,i,r,s,a,n){const o={data:new Uint8ClampedArray(t.x*t.y*8),width:2*t.x,height:t.y},l={right:null,left:null,rightBin:null,leftBin:null};const c=[],h=[];let d=0;console.time("exportDualImage4Print A1:");for(let t of i){0===d&&r&&c.push(null);const e={pageNo:++d,isDummy:!1,isRight:d%2>0&&r,binary:t&&null!==t.baseImage?t:null};c.push(e)}console.timeEnd("exportDualImage4Print A1:"),console.time("exportDualImage4Print A2:");for(let t=0;t<c.length;t++){const e=[null,null];e[0]=c[t],++t<c.length&&(e[1]=c[t]),h.push(e)}this.progress=61,this.pbp.update(this.progress,"start exportDualImage4Print");const u=h.length;let p=0;const g=20/(9*u);console.timeEnd("exportDualImage4Print A2:"),console.time("exportDualImage4Print A3:");for(let e of h){const i="["+ ++p+"/"+u+"]";this.progress+=g,this.pbp.update(this.progress,"exportDualImage4Print"+i),await this.buildDualImage(t,o,l,e,a,n,i,g)}console.timeEnd("exportDualImage4Print A3:")}async buildDualImage(t,e,i,r,s,a,n,o){console.time("exportDualImage4Print buildDualImageA3 pageStep:"+n);const l=r[0],c=r[1],h=s?l:c,d=s?c:l;i.right=null===h||h.isDummy?null:h.binary,i.left=null===d||d.isDummy?null:d.binary,i.rightBin=null,i.leftBin=null;let u=null;if(this.progress+=o,this.pbp.update(this.progress,"load pairPages.right"+n),i.right&&i.right.outputExpandImage&&(i.rightBin=await this.loadBinaryWidCleanUp(i.right.outputExpandImage),u=i.right),this.progress+=o,this.pbp.update(this.progress,"load pairPages.left"+n),i.left&&i.left.outputExpandImage&&(i.leftBin=await this.loadBinaryWidCleanUp(i.left.outputExpandImage),u=i.left),!u)return this.progress+=7*o,void this.pbp.update(this.progress,"load null"+n);if(this.imageMerger.beWhiteImage(e,!0),this.progress+=o,this.pbp.update(this.progress,"set Left"+n),i.leftBin){const t=i.leftBin._ab,r={data:new Uint8Array(t),width:i.leftBin.width,height:i.leftBin.height,offsetX:0,offsetY:0};await this.imageMerger.margeReplace(e,[r],!1,!0)}if(this.progress+=o,this.pbp.update(this.progress,"set right"+n),i.rightBin){const r=i.rightBin._ab,s={data:new Uint8Array(r),width:i.rightBin.width,height:i.rightBin.height};s.offsetX=t.x,s.offsetY=0,await this.imageMerger.margeReplace(e,[s],!1,!0)}this.progress+=o,this.pbp.update(this.progress,"convert to jepg"+n);let p=this.ip.getArrayBufferFromImageBitmapDataAsJpg(e,1);const g=p.byteLength;if(a&&1e7<g){const t=1e7/g;ropedPaperDualAb=this.ip.getArrayBufferFromImageBitmapDataAsJpg(e,t)}const m=u.outputDualImage;this.progress+=o,this.pbp.update(this.progress,"save jepg binary"+n);const f=await this.bm.save(m,"expandDualPage",p);this.progress+=o,this.pbp.update(this.progress,"save right and delete temp files"+n),i.right&&i.right.outputExpandImage&&(i.right.outputDualImage=f,await this.em.Pages.save(i.right),await this.em.delete(i.rightBin)),this.progress+=o,this.pbp.update(this.progress,"save left and delete temp files"+n),i.left&&i.left.outputExpandImage&&(i.left.outputDualImage=f,await this.em.Pages.save(i.left),await this.em.delete(i.leftBin)),console.timeEnd("exportDualImage4Print buildDualImageA3 pageStep:"+n)}async loadBinaryWidCleanUp(t){const e=await this.em.get(t);return this.delList.push(t),e}async delOnList(){for(let t of this.delList)await this.bm.remove(t)}}class Oi{constructor(){this.ms=Se.getInstance(),this.em=this.ms.em,this.bm=this.ms.bm,this.im=this.ms.im,this.iom=this.ms.iom,this.tm=this.ms.tm}async load(){const t=await this.tm.getExports();return await this.getZipPdfPair(t)}async remove(t=-1){const e=await this.tm.getExports();if(e){for(let t in e){const i=e[t];delete e[t],await this.iom.remove(i)}await this.tm.saveCurrent()}}async loadZip(t){if(!t){const t=(await this.load()).zip;if(t&&t.binary){const e=await this.bm.load(t.binary);t.ab=e._ab}return t}return alert("ExportUtilProcessor loadZip is NULL!"),null}async loadPdf(t){if(!t){const t=(await this.load()).pdf;if(t&&t.binary){const e=await this.bm.load(t.binary);t.ab=e._ab}return t}return alert("ExportUtilProcessor loadPdf exportPk is NULL!"),null}async getZipPdfPair(t){const e={pdf:null,zip:null};if(!1==!!t)return e;for(let i of t){const t=await this.iom.load(i);t&&"zip"===t.type&&(e.zip=t),t&&"pdf"===t.type&&(e.pdf=t)}return e}}let Mi=null;class Ri extends ${constructor(){super(),this.ms=Se.getInstance(),this.im=this.ms.im,this.bm=this.ms.bm,this.iom=this.ms.iom,this.tm=this.ms.tm,this.exportExecuteAction=Ge.createExecuteAction(),this.exportExecuteAllAction=Ge.creatExecuteAllAction(),this.exportRemoveAction=Ge.creatRemoveAction(),this.exportsLoadAction=Ge.creatLoadAction(),this.exportDownloadAction=Ge.createDownloadAction(),this.exportExecutePdfAction=Ge.createExecutePdfAction(),this.exportDownloadPdfAction=Ge.createDownloadPdfAction(),this.selectOrderAction=Ge.createSelectOrderAction(),this.atatch(this.exportExecuteAction),this.atatch(this.exportExecuteAllAction),this.atatch(this.exportRemoveAction),this.atatch(this.exportsLoadAction),this.atatch(this.exportDownloadAction),this.atatch(this.exportExecutePdfAction),this.atatch(this.exportDownloadPdfAction),this.atatch(this.selectOrderAction),this.pp=new Ke,this.eip=new Ti(this.pp),this.eup=new Oi(this.pp),this.storeKey=Ge.getStoreKey(),this.storePdfDLKey=Ge.getStorePdfDLKey(),this.storeZipDLKey=Ge.getStoreZipDLKey(),this.storeRemoveResultKey=Ge.getStoreRemoveResultKey(),this.storeExportResultKey=Ge.getStoreExportResultKey(),this.storeSelectedOrderKey=Ge.getStoreSelectedOrderKey(),this.addInitializeKey(this.storeKey),this.addInitializeKey(this.storePdfDLKey),this.addInitializeKey(this.storeZipDLKey),this.addInitializeKey(this.storeRemoveResultKey),this.addInitializeKey(this.storeExportResultKey),this.addInitializeKey(this.storeSelectedOrderKey)}static register(){Mi||(Mi=new Ri)}async reduce(t,e){if(this.exportExecuteAction.type===e.type){const i=await this.exportExecute(e.data.exportOrders);t[this.storeKey]=i,t[this.storeExportResultKey]=i}else if(this.exportExecuteAllAction.type===e.type)t[this.storeExportResultKey]=await this.exportExecute(e.data.exportOrders),t[this.storeExportResultKey]=await this.exportPdfExecute(e.data.exportOrders);else if(this.exportRemoveAction.type===e.type){const i=await this.remove(e.data.exportPk);t[this.storeRemoveResultKey]=i}else if(this.exportsLoadAction.type===e.type)t[this.storeKey]=await this.load();else if(this.exportDownloadAction.type===e.type)t[this.storeZipDLKey]=await this.loadZip(e.data.exportPk);else if(this.exportExecutePdfAction.type===e.type){const i=await this.exportPdfExecute(e.data.exportOrders);t[this.storeKey]=i,t[this.storeExportResultKey]=i}else if(this.exportDownloadPdfAction.type===e.type)t[this.storePdfDLKey]=await this.loadPdf(e.data.exportPk);else if(this.selectOrderAction.type===e.type&&e.data.selectOrder&&e.data.selectOptions){const i={selectOptions:e.data.selectOptions,selectOrder:e.data.selectOrder};t[this.storeSelectedOrderKey]=i}return t}async exportExecute(t){const e=await this.eip.exportZipExecute(t);return await this.eup.getZipPdfPair(e)}async exportPdfExecute(t){const e=await this.eip.exportPdfExecute(t);return await this.eup.getZipPdfPair(e)}async loadZip(t){return await this.eup.loadZip(t)}async loadPdf(t){return await this.eup.loadPdf(t)}async remove(t){return await this.eup.remove(t),await this.eup.load()}async load(){return await this.eup.load()}}class zi extends it{constructor(){super("ExportAllButton","ExportAllButton",!0),this.storeKey=Ge.getStoreKey(),this.storePdfDLKey=Ge.getStorePdfDLKey(),this.storeZipDLKey=Ge.getStoreZipDLKey(),this.storeRemoveResultKey=Ge.getStoreRemoveResultKey(),this.storeExportResultKey=Ge.getStoreExportResultKey()}render(t,e){return V(this.id,[this.id+"Frame"],{on:{click:this.click()}},[V("",["button"],"make zip and pdf!")])}async onAfterAttach(t,e){}async onViewShow(t,e){if(t[this.storeKey]){const e=t[this.storeKey];e.pdf&&e.zip}}click(){return t=>{const e=Ge.creatExecuteAllAction();return this.dispatch(e),t.stopPropagation(),!1}}}class Ui{constructor(){}static creatOpenAction(t,e,i=null){return B.createBaseAction("openDialog",t,e,i)}static creatAlertAction(t,e,i=null){return B.createBaseAction("openAlertDialogX",t,e,i)}static creatConfirmAction(t,e,i=null){return B.createBaseAction("openConfirmDialog",t,e,i)}static creatCloseAction(t,e,i=null){return B.createBaseAction("closeDialog",t,e,i)}static getStoreKey(){return"dialog"}}let Fi=null;class _i extends ${constructor(){super(),this.dialogOpenAction=Ui.creatOpenAction(),this.dialogAlertAction=Ui.creatAlertAction(),this.dialogConfirmAction=Ui.creatConfirmAction(),this.dialogCloseAction=Ui.creatCloseAction(),this.atatch(this.dialogOpenAction),this.atatch(this.dialogAlertAction),this.atatch(this.dialogConfirmAction),this.atatch(this.dialogCloseAction),this.storeKey=Ui.getStoreKey(),this.addInitializeKey(this.storeKey)}static register(){Fi||(Fi=new _i)}async reduce(t,e){return this.dialogOpenAction.type===e.type?t[this.storeKey]=this.createDialog(!0,e.type,e.data.msg,e.data.title,e.data.nextActions):this.dialogAlertAction.type===e.type?t[this.storeKey]=this.createDialog(!0,e.type,e.data.msg,e.data.title):this.dialogConfirmAction.type===e.type?t[this.storeKey]=this.createDialog(!0,e.type,e.data.msg,e.data.title):this.dialogCloseAction.type===e.type&&(t[this.storeKey]=this.createDialog(!1,e.type)),t}createDialog(t,e,i,r,s){return{isVisible:t,type:e,msg:i,title:r,nextActions:s}}}let Vi=null;class ji extends it{constructor(){super("Dialog",["Dialog",it.ModalWindowClass()]),this.storeKey=Ui.getStoreKey(),this.dialogOpenAction=Ui.creatOpenAction(),this.dialogAlertAction=Ui.creatAlertAction(),this.dialogConfirmAction=Ui.creatConfirmAction(),this.title="Dialog",Vi=this,this.resolv=null,this.reject=null}async onAfterAttach(t,e){this.close(),_i.register()}static async opneAlert(t,e){return new Promise((i,r)=>{Vi.showAlertDialog(t,e),Vi.resolv=i,Vi.reject=r})}static async opneConfirm(t,e){return new Promise((i,r)=>{Vi.showConfirmDialog(t,e),Vi.resolv=i,Vi.reject=r})}showAlertDialog(t,e){const i=Ui.creatAlertAction(this,{title:t,msg:e});this.dispatch(i)}showConfirmDialog(t,e){const i=Ui.creatConfirmAction(this,{title:t,msg:e});this.dispatch(i)}render(){return V("".DialogView,{style:{display:"none"}},[V("",["dialogTitle"],this.title),V("",["dialogFrame"],[V("",["dialog"],{style:{width:this.initPoint}})]),V("",["dialogInfo"],[V("",["dialogMessage"],"")]),V("",["dialogDeside"],[V("",["dialogOk"],{on:{click:this.onOK()}},"OK"),V("",["dialogCancel"],{on:{click:this.onCancel()}},"Cancel")])])}async onViewShow(t,e){t[this.storeKey]&&this.showDialog(t[this.storeKey])}onOK(){return t=>{const e=Ui.creatCloseAction(this,{});return this.resolv&&(this.resolv(!0),this.resolv=null,this.reject=null),this.dispatch(e),t.stopPropagation(),!1}}onCancel(){return t=>{const e=Ui.creatCloseAction(this,{});return this.resolv&&(this.resolv(!1),this.resolv=null,this.reject=null),this.dispatch(e),t.stopPropagation(),!1}}showDialog(t){const{isVisible:e,type:i,msg:r,title:s}=t;if(s&&(this.title=s),e){this.show(),this.prePatch(".dialog",V("",["dialog"],{style:{}})),this.prePatch(".dialogTitle",V("",["dialogTitle"],{},this.title)),this.prePatch(".dialogMessage",V("",["dialogMessage"],{},r));const t=[];t.push(V("",["dialogOk"],{on:{click:this.onOK()}},"OK")),this.dialogConfirmAction.type===i&&t.push(V("",["dialogCancel"],{on:{click:this.onCancel()}},"Cancel")),this.prePatch(".dialogDeside",V("",["dialogDeside"],t))}else this.close(),this.prePatch(".dialog",V("",["dialog"],{style:{width:"0%"}})),this.prePatch(".dialogPoints",V("",["dialogPoints"],{},this.initPoint))}}class Wi extends it{constructor(){super("ExportImgZipButton","ExportImgZipButton",!0),this.storeSelectedOrderKey=Ge.getStoreSelectedOrderKey(),this.storeKey=Ge.getStoreKey(),this.storePdfDLKey=Ge.getStorePdfDLKey(),this.storeZipDLKey=Ge.getStoreZipDLKey(),this.storeRemoveResultKey=Ge.getStoreRemoveResultKey(),this.storeExportResultKey=Ge.getStoreExportResultKey(),this.stateId="exportedStateZip",this.isExported=!1,this.exportOrderData=null,this.startTime=null}render(t,e){const i=V("",["buttonName"],"make zip!"),r=V(this.stateId,["exportedStateNone"],"no export");return V(this.id,[this.id+"Frame"],{on:{click:this.click()}},[V("",["button"],[i,r])])}async onAfterAttach(t,e){}async onViewShow(t,e){if(t[this.storeExportResultKey]){const e=t[this.storeExportResultKey],i=e.zip,r=this.buildButton(e),s=(We()-this.startTime)/1e3;r&&this.startTime&&(this.startTime=null,setTimeout(()=>{ji.opneAlert("Build Zip File Complete!","OK download zip file! "+i.size+"byte  Duration:"+s+"sec")},1e3))}else t[this.storeKey]&&this.buildButton(t[this.storeKey]);if(t[this.storeSelectedOrderKey]){const e=t[this.storeSelectedOrderKey],i=e.selectOptions,r=e.selectOrder;this.exportOrderData={basePaper:r.basePaper,orderName:r.orderName,dpiName:i.dpiName,isGrayscale:i.isGrayscale,isMaxSize10M:i.isMaxSize10M,isLanczose:i.isLanczose}}}buildButton(t){if(t&&t.zip){const e=t.zip,i="*Last Exported One* "+e.name+" / "+e.orderName+" /size: "+e.size+"byte / "+je(e.updateDate);return this.prePatch("#"+this.stateId,V(this.stateId,["exportedState"],i)),this.isExported=!0,!0}return this.isExported=!1,this.prePatch("#"+this.stateId,V(this.stateId,["exportedStateNone"],"no export")),!1}click(){return async t=>{if(!this.exportOrderData)return void ji.opneAlert("I'm need ExportSettings!","Export Order is not Selected!");const e=await ji.opneConfirm("Comfirm","is export orverride ok?");if(!this.isExported||this.isExported&&e){this.startTime=We();const t=Ge.createExecuteAction(this,{exportOrders:[this.exportOrderData]});this.dispatch(t)}return t.stopPropagation(),!1}}}class Zi extends it{constructor(){super("ExportPdfButton","ExportPdfButton",!0),this.storeSelectedOrderKey=Ge.getStoreSelectedOrderKey(),this.storeKey=Ge.getStoreKey(),this.storePdfDLKey=Ge.getStorePdfDLKey(),this.storeZipDLKey=Ge.getStoreZipDLKey(),this.storeRemoveResultKey=Ge.getStoreRemoveResultKey(),this.storeExportResultKey=Ge.getStoreExportResultKey(),this.stateId="exportedStatePdf",this.isExported=!1,this.exportOrderData=null}render(t,e){const i=V("",["buttonName"],"make pdf!"),r=V(this.stateId,["exportedStateNone"],"no export");return V(this.id,[this.id+"Frame"],{on:{click:this.click()}},[V("",["button"],[i,r])])}async onAfterAttach(t,e){}async onViewShow(t,e){if(t[this.storeExportResultKey]){const e=t[this.storeExportResultKey],i=e.pdf,r=this.buildButton(e),s=(1*We()-this.startTime)/1e3;r&&this.startTime&&(this.startTime=null,setTimeout(()=>{ji.opneAlert("Build Pdf File Complete!","OK download pdf file! "+i.size+"byte  Duration:"+s+"sec")},1e3))}else t[this.storeKey]&&this.buildButton(t[this.storeKey]);if(t[this.storeSelectedOrderKey]){const e=t[this.storeSelectedOrderKey],i=e.selectOptions,r=e.selectOrder;this.exportOrderData={basePaper:r.basePaper,orderName:r.orderName,dpiName:i.dpiName,isGrayscale:i.isGrayscale,isMaxSize10M:i.isMaxSize10M,isLanczose:i.isLanczose}}}buildButton(t){if(t&&t.pdf){const e=t.pdf,i="*Last Exported One* "+e.name+" / "+e.orderName+" /size: "+e.size+"byte / "+je(e.updateDate);return this.prePatch("#"+this.stateId,V(this.stateId,["exportedState"],i)),this.isExported=!0,!0}return this.isExported=!1,this.prePatch("#"+this.stateId,V(this.stateId,["exportedStateNone"],"no export")),!1}click(){return async t=>{if(!this.exportOrderData)return void ji.opneAlert("I'm need ExportSettings!","Export Order is not Selected!");const e=await ji.opneConfirm("Comfirm","is export orverride ok?");if(!this.isExported||this.isExported&&e){this.startTime=1*We();const t=Ge.createExecutePdfAction(this,{exportOrders:[this.exportOrderData]});this.dispatch(t)}return t.stopPropagation(),!1}}}class Xi{static download(t,e,i="text/plain"){const r=new Blob([e],{type:i}),s=document.createElement("a");s.style.display="none",s.download=t,s.href=window.URL.createObjectURL(r),s.dataset.downloadurl=[i,t,s.href].join(":"),document.body.appendChild(s),s.click(),setTimeout(()=>{document.body.removeChild(s)})}}class Yi extends it{constructor(){super("DownloadLastExportZipButton","DownloadLastExportZipButton",!0),this.storeKey=Ge.getStoreKey(),this.storeZipDLKey=Ge.getStoreZipDLKey(),this.stateId=this.id+"Button",this.isExported=!1}render(t,e){const i=V(this.stateId,["button","disable"],"-no export Zip-");return V(this.id,[this.id+"Frame"],{},[i])}async onAfterAttach(t,e){}async onViewShow(t,e){if(t[this.storeZipDLKey]){const e=t[this.storeZipDLKey];e.ab?Xi.download(e.name,e.ab,"application/zip"):alert("not exported!")}else if(t[this.storeKey]){if(t[this.storeKey].zip){const t=V(this.stateId,["button","enable"],{on:{click:this.click()}},"download Zip!");this.prePatch("#"+this.stateId,t),this.isExported=!0}else{const t=V(this.stateId,["button","disable"],"no export Zip");this.prePatch("#"+this.stateId,t),this.isExported=!1}}}click(){return t=>{if(this.isExported){const t=Ge.createDownloadAction();this.dispatch(t)}return t.stopPropagation(),!1}}}class Hi extends it{constructor(){super("DownloadLastExportPdfButton","DownloadLastExportPdfButton",!0),this.storeKey=Ge.getStoreKey(),this.storePdfDLKey=Ge.getStorePdfDLKey(),this.stateId=this.id+"Button",this.isExported=!1}render(t,e){const i=V(this.stateId,["button","disable"],"-no export PDF-");return V(this.id,[this.id+"Frame"],{on:{click:this.click()}},[i])}async onAfterAttach(t,e){}async onViewShow(t,e){if(t[this.storePdfDLKey]){const e=t[this.storePdfDLKey];e.ab?Xi.download(e.name,e.ab,"application/pdf"):alert("not exported!")}else if(t[this.storeKey]){if(t[this.storeKey].pdf){const t=V(this.stateId,["button","enable"],{on:{click:this.click()}},"download PDF!");this.prePatch("#"+this.stateId,t),this.isExported=!0}else{const t=V(this.stateId,["button","disable"],"no export PDF");this.prePatch("#"+this.stateId,t),this.isExported=!1}}}click(){return t=>{if(this.isExported){const t=Ge.createDownloadPdfAction();this.dispatch(t)}return t.stopPropagation(),!1}}}class Gi extends it{constructor(){super("DeleteExportOneButton","DeleteExportOneButton",!0),this.storeKey=Ge.getStoreKey(),this.storePdfDLKey=Ge.getStorePdfDLKey(),this.storeZipDLKey=Ge.getStoreZipDLKey(),this.storeRemoveResultKey=Ge.getStoreRemoveResultKey(),this.storeExportResultKey=Ge.getStoreExportResultKey()}render(t,e){return V(this.id,[this.id+"Frame"],{on:{click:this.click()}},[V("",["button"],"delete Exports!")])}async onAfterAttach(t,e){}async onViewShow(t,e){if(t[this.storeRemoveResultKey]){const t=Ge.creatLoadAction(this);this.dispatch(t)}}click(){return async t=>{if(await ji.opneConfirm("Let's start!","delete exports?")){const t=Ge.creatRemoveAction();this.dispatch(t)}return t.stopPropagation(),!1}}}class Ji extends it{constructor(){super("ExportButton","ExportButtonFrame"),this.storeKey=Ge.getStoreKey(),this.exportAllButton=new zi,this.exportImgZipButton=new Wi,this.exportPdfButton=new Zi,this.downloadLastExportZipButton=new Yi,this.downloadLastExportPdfButton=new Hi,this.deleteExportOneButton=new Gi}async onAfterAttach(t,e){await this.exportAllButton.attach(this),await this.exportImgZipButton.attach(this),await this.exportPdfButton.attach(this),await this.downloadLastExportZipButton.attach(this),await this.downloadLastExportPdfButton.attach(this),await this.deleteExportOneButton.attach(this),Ri.register();const i=Ge.creatLoadAction(this);await this.dispatch(i)}async onViewShow(t,e){t[this.storeKey]}render(t,e){return V("",["ExportButtons"],[V(this.exportAllButton.id),V(this.exportImgZipButton.id),V(this.exportPdfButton.id),V(this.downloadLastExportZipButton.id),V(this.downloadLastExportPdfButton.id),V(this.deleteExportOneButton.id)])}}class qi extends it{constructor(t){super("ExportOrderRow","ExportOrderRow"),this.parent=t,this.selectOrder=null,this.ordersMap={},this.orderOptions={isGrayscale:!1,dpiName:"dpi72",isMaxSize10M:!1,isLanczose:!1},this.activeClassName="active"}render(t,e){const i=V("",["TitleName"],"TitleName");return V("",[this.id+"Frame"],[i,V(this.imageAreaID,["ImageDetailA"],this.id+"aaaaa")])}async onAfterAttach(t,e){}async onViewShow(t,e){}getCurrentSelected(){return this.ordersMap[this.selectOrder]}getSelectOrder(t){return e=>{t&&(this.selectOrder=t);const i=Ge.createSelectOrderAction(this.parent,{selectOrder:this.ordersMap[this.selectOrder],selectOptions:this.parent.getCurrentOptions()});return this.dispatch(i),e.stopPropagation(),!1}}buildRows(t){const e=[],i=me,r=t&&t.selectOrder?t.selectOrder:null;for(let t of i){const i=t.orderName,s=r&&r.orderName&&t.orderName===r.orderName?this.activeClassName:"";this.ordersMap[i]=t;const a=j("",[i+"Text"],[i]),n=V("ExportOrderRow-"+i,[i,s],{on:{click:this.getSelectOrder(i)}},[a]);e.push(n)}return e}}class Qi extends it{constructor(){super("ExportOrdrList","ExportOrdrList"),this.exportOrderRow=new qi(this),this.storeSelectedOrderKey=Ge.getStoreSelectedOrderKey(),this.listFrameId=this.id+"ListFrame",this.listId=this.id+"List",this.checkboxIsGrascale="checkboxIsGrascaleAt"+this.Id,this.selectBoxDpiName="selectBoxDpiNameAt"+this.Id,this.checkboxIsMaxSize10M="checkboxIsMaxSize10MAt"+this.Id,this.checkboxIsLanczose="checkboxIsLanczoseAt"+this.Id}render(t,e){const i=V("",["ExportOrdrs"],"Export Orders List"),r="ExportOrdersOptions",s=H("",[r],[Y(this.checkboxIsGrascale,[""],{on:{change:this.exportOrderRow.getSelectOrder()}},""),"isGrayscale?"]);let a="";for(let t in de){a=de[t];break}const n=H("",[r],[" ",J(this.selectBoxDpiName,[],"",de,{}[a],{change:this.exportOrderRow.getSelectOrder()}),"dpi"]),o=H("",[r],[Y(this.checkboxIsMaxSize10M,[""],{on:{change:this.exportOrderRow.getSelectOrder()}},""),"isMaxSize10MB/Paper?"]),l=H("",[r],[Y(this.checkboxIsLanczose,[""],{on:{change:this.exportOrderRow.getSelectOrder()}},""),"isLanczose Or ByCubic?"]),c=V("",["ExportOrdrs"],["Options:",n,s,o,l]),h=V(this.listFrameId,["ExportOrdrs"],this.buildRows());return V(this.listId,[this.id+"Frame"],[i,h,c])}async onAfterAttach(t,e){}async onViewShow(t,e){if(t[this.storeSelectedOrderKey]){const e="ExportOrdrs",i=t[this.storeSelectedOrderKey],r=V(this.listFrameId,[e],this.buildRows(i));this.prePatch("#"+this.listFrameId,r)}}getCurrentOptions(){return{isGrayscale:document.getElementById(this.checkboxIsGrascale).checked,dpiName:document.getElementById(this.selectBoxDpiName).value,isMaxSize10M:document.getElementById(this.checkboxIsMaxSize10M).checked,isLanczose:document.getElementById(this.checkboxIsLanczose).checked}}buildRows(t=null){return this.exportOrderRow.buildRows(t)}}class $i extends it{constructor(){super("ExportArea","ExportArea"),this.text="ExportArea",this.exportButton=new Ji,this.exportOrderList=new Qi}async onAfterAttach(t,e){await this.exportOrderList.attach(this),await this.exportButton.attach(this);const i=Ge.creatLoadAction();await this.dispatch(i)}render(){return V(this.id,["ExportArea"],[V("",["ExportAreaTitle"],this.text),V(this.exportOrderList.id),V(this.exportButton.id)])}}const tr="PLANE",er="WINDOW",ir="DOUBLE",rr="HELF",sr="QUAD",ar="FULL";class nr extends it{constructor(){super("ImageDetail","ImageDetail"),this.imageAreaID=this.id+"child",this.isOnScroll=!1,this.startX=0,this.startY=0,this.previewMode=tr,this.pk=null}render(t,e){const i=V(this.id+"toNativeSizeButton",["toNativeSizeButton"],{on:{click:this.toNativeSize()}},"1:1"),r=V(this.id+"toWindowSizeButton",["toWindowSizeButton"],{on:{click:this.toWindowSize()}},"W"),s=V(this.id+"toDoubleWindowSizeButton",["toDoubleWindowSizeButton"],{on:{click:this.toDoubleWindowSize()}},"Wx2"),a=V(this.id+"toQuadWindowSizeButton",["toQuadWindowSizeButton"],{on:{click:this.toQuadWindowSize()}},"Wx4"),n=V(this.id+"toHelfWindowSizeButton",["toHelfWindowSizeButton"],{on:{click:this.toHelfWindowSize()}},"W/2"),o=V(this.id+"toFullWindowSizeButton",["toFullWindowSizeButton"],{on:{click:this.toFullWindowSize()}},"FW"),l=j("",["ImageDetailTitleText"],"ImageDetailTitle"),c=V("",["ImageDetailTitle"],[l,i,r,s,a,n,o]);return V("",[""],[c,V(this.imageAreaID,["ImageDetailA"],"No Image Selected")])}async onViewShow(t,e){t.imagesDetailData&&(await this.showImage(t.imagesDetailData),this.startX=0,this.startY=0,this.offsetX=0,this.offsetY=0,this.isOnScroll=!1)}async onAfterAttach(t,e){this.setSelectStyle("toNativeSizeButton",tr),this.setSelectStyle("toWindowSizeButton",er),this.setSelectStyle("toDoubleWindowSizeButton",ir),this.setSelectStyle("toQuadWindowSizeButton",sr),this.setSelectStyle("toHelfWindowSizeButton",rr),this.setSelectStyle("toFullWindowSizeButton",ar)}async showImage(t){const{imageEntity:e,binaryEntity:i,imageText:r}=t,s=e.getPk();this.pk!==s&&(this.previewMode=tr),this.setSelectStyle("toNativeSizeButton",tr),this.setSelectStyle("toWindowSizeButton",er),this.setSelectStyle("toDoubleWindowSizeButton",ir),this.setSelectStyle("toQuadWindowSizeButton",sr),this.setSelectStyle("toHelfWindowSizeButton",rr),this.setSelectStyle("toFullWindowSizeButton",ar),this.pk=s;const a=At.a.arrayBuffer2DataURI(i._ab),n=W(s+"_image",e.name,e.name,a,{}),o=j(s+"_text",["thumbnail_text"],t.imageText),l=[V("",["image"],[n]),V("",[o])];this.prePatch("#"+this.imageAreaID,V(this.imageAreaID,["image_detail_block",this.previewMode],{on:{mousedown:this.onMouseOn(),mousemove:this.onMouseMove(),click:this.onClick()},style:{top:0,left:0}},l))}onClick(){return t=>{this.previewMode===ar&&this.toNativeSize()(t)}}setSelectStyle(t,e){const i=document.getElementById(this.id+t);this.previewMode===e?i.classList.add("active"):i.classList.remove("active")}toNativeSize(){return t=>{if(this.previewMode=tr,this.pk){const t=Ee.creatDetailAction(this,{imagePK:this.pk});this.dispatch(t)}}}toWindowSize(){return t=>{if(this.previewMode=er,this.pk){const t=Ee.creatDetailAction(this,{imagePK:this.pk});this.dispatch(t)}}}toDoubleWindowSize(){return t=>{if(this.previewMode=ir,this.pk){const t=Ee.creatDetailAction(this,{imagePK:this.pk});this.dispatch(t)}}}toHelfWindowSize(){return t=>{if(this.previewMode=rr,this.pk){const t=Ee.creatDetailAction(this,{imagePK:this.pk});this.dispatch(t)}}}toQuadWindowSize(){return t=>{if(this.previewMode=sr,this.pk){const t=Ee.creatDetailAction(this,{imagePK:this.pk});this.dispatch(t)}}}toFullWindowSize(){return t=>{if(this.previewMode=ar,this.pk){const t=Ee.creatDetailAction(this,{imagePK:this.pk});this.dispatch(t)}}}onMouseOn(){return t=>{this.startX=this.offsetX?t.clientX+0*this.offsetX-this.offsetXï¼‘:t.clientX,this.startY=this.offsetY?t.clientY+0*this.offsetY-this.offsetYï¼‘:t.clientY;t.target;this.isOnScroll=!this.isOnScroll}}onMouseOff(){return t=>{t.target;this.isOnScroll=!1}}onMouseMove(){return t=>{const e=t.target;if(this.isOnScroll){const i=t.clientX,r=t.clientY,s=i-this.startX,a=r-this.startY,n=e.parentNode.parentNode;n.style.top=a+"px",n.style.left=s+"px",this.offsetX=this.startX,this.offsetY=this.startY,this.offsetXï¼‘=s,this.offsetYï¼‘=a}}}}class or extends it{constructor(t,e,i){super("PageImage"+e,"PageImage"),this.ip=this.ms.ip,this.parent=t,this.draggableArea=i,this.listing=e,this.thumbnail=null,this.thumbnail_block="thumbnail_block",this.draggableArea.toDropPage=(t=>{this.doDrop(t)})}render(){return this.button=V(this.id+"child","PageImageA",this.id),V([this.button])}async setPageData(t,e){if(this.pageData=t,this.imageData=e,!t)return;this.pk=t.getPk();const i=this.imageData?this.imageData.binaryEntity:null;if(i){const t={name:"page_"+this.listing,ab:i._ab,type:i.type};this.thumbnail=await this.ip.createImageNodeByData(t).catch(t=>{throw console.error(t),t})}else this.thumbnail=null}render(t,e){return V("","")}remove(t){return e=>{if(window.confirm("delete ok?")){const e=Ce.creatRemoveAction(this,{imagePKforDelete:t});this.dispatch(e)}}}handleDragStart(t){return e=>{const i=e.target;if(this.parent.dropElm=null,!i.classList||!i.classList.contains(this.thumbnail_block))return;i.style.opacity="0.4",this.draggableArea.nowSelectedElm=i,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",i.innerHTML);let r=document.createElement("img");r.src=t,r.width=100,e.dataTransfer.setDragImage(r,-10,-10)}}handleDragOver(){return t=>{const e=t.target;if(e.classList&&e.classList.contains(this.thumbnail_block))return t.preventDefault(),t.dataTransfer.dropEffect="move",!1}}handleDragEnter(){return t=>{const e=t.target;e.classList&&e.classList.contains(this.thumbnail_block)&&e.classList.add("over")}}handleDragLeave(){return t=>{const e=t.target;e.classList&&e.classList.contains(this.thumbnail_block)&&e.classList.remove("over")}}handleDrop(t){return t=>{t.stopPropagation(),t.preventDefault();const e=t.target;if(e.classList&&e.classList.contains(this.thumbnail_block))return this.doDrop(e),!1}}doDrop(t){this.parent.dropElm=t;const e=this.draggableArea.nowSelectedElm;if(e&&e.dataset.pk&&e!==t){const i=e.dataset.pk,r=t.dataset.pk;if(i&&e.dataset.is_image){const t=Ce.creatAddPageAction(this,{imagePk:i,pagePk:r});this.dispatch(t)}else if(i&&e.dataset.is_page){const t=Ce.creatSortPagesAction(this,{formPk:i,toPk:r});this.dispatch(t)}}r.clearSideElmClass(t,"over")}handleDragEnd(t){return t=>{const e=t.target,i=e.dataset.pk;if(e.classList&&e.classList.contains(this.thumbnail_block)&&(this.draggableArea.nowSelectedElm=null,r.clearSideElmClass(e,"over"),null!==this.draggableArea.cancelPageArea)){const t=Ce.creatRemovePageAction(this,{pagePk:i});this.dispatch(t)}}}handleTouchStart(t){return t=>{const e=t.target;this.parent.dropElm=null,e.classList&&e.classList.contains(this.thumbnail_block)&&(window.blockMenuHeaderScroll=!0,e.style.opacity="0.4",this.draggableArea.nowSelectedElm=e)}}handleTouchMove(){return t=>{const e=t.target;if(!e.classList||!e.classList.contains(this.thumbnail_block))return;const i=r.getCurrentPointedElm(t);this.pointedElm&&this.pointedElm!==i&&r.clearSideElmClass(this.pointedElm,"over"),this.pointedElm=i,i.getAttribute("draggable")&&i!==e&&i.classList.add("over")}}handleTouchEnd(){return t=>{window.blockMenuHeaderScroll=!1;const e=t.target,i=e.dataset.pk;r.clearSideElmClass(e,"over");const s=this.pointedElm;if(s&&s!==e){if(this.pointedElm=null,r.clearSideElmClass(s,"over"),!s.classList||!s.classList.contains(s.thumbnail_block)){if("thumnailsImageArea"===s.id||s.getAttribute("draggable")){const t=Ce.creatRemovePageAction(this,{pagePk:i});this.dispatch(t)}return this.doDrop(s),void(this.draggableArea.nowSelectedElm=null)}s.getAttribute("draggable")&&(this.doDrop(s),this.draggableArea.nowSelectedElm=null)}}}selectImage(t){return t=>{t.stopPropagation(),t.preventDefault();t.target;if(this.pageData&&this.pageData.baseImage){const t=Ee.creatDetailAction(this,{imagePK:this.pageData.baseImage});this.dispatch(t)}return!1}}renderVnode(t){const e=this.pageData;if(!e)return V(this.id,["aaaaaaa"+this.listing],"null"+this.listing);const i=this.thumbnail?this.thumbnail.src:null,r=i?{"background-image":"url("+i+")"}:{},s=V("",["page_block"],[]),a=V("",["checkNoCropping",e.isNoCropping?"enable":"disable"],"isNoCropping"),n=V("",["checkForceColor",e.isForceColor?"enable":"disable"],"isForceColor"),o=V("",["options_block"],[n,a]),l=V(this.id,["thumbnail_block"],{on:{dragstart:this.handleDragStart(i),dragover:this.handleDragOver(),dragenter:this.handleDragEnter(),dragleave:this.handleDragLeave(),drop:this.handleDrop(),dragend:this.handleDragEnd(),click:this.selectImage(),touchstart:this.handleTouchStart(),touchmove:this.handleTouchMove(),touchend:this.handleTouchEnd()},dataset:{pk:this.pk,is_page:!0},style:r,props:{draggable:"true"}},[s,o]);return t.prePatch("#"+this.id,l),l}createVnode(){}}class lr{constructor(){}static creatOpenAction(t,e,i=null){return B.createBaseAction("openPreview",t,e,i)}static creatCloseAction(t,e,i=null){return B.createBaseAction("closePreview",t,e,i)}static creatNextAction(t,e,i=null){return B.createBaseAction("nextPreview",t,e,i)}static creatBackAction(t,e,i=null){return B.createBaseAction("backPreview",t,e,i)}static creatUpdateAction(t,e,i=null){return B.createBaseAction("updateOnPreview",t,e,i)}static getStorePreviewKey(){return"previewCommand"}static getStoreUpdatePreviewKey(){return"previewUpdateCommand"}}class cr extends it{constructor(t){super("PageImages","PageImages"),this.storeKey=Ze.getStoreKey(),this.childId=this.id+"child",this.thumbnails={},this.dummyClass="Dummy",this.pages=[],this.storeImagesKey=Ee.getStoreImagesKey(),this.storePagesKey=Ce.getStorePagesKey();for(let e=0;e<32;e++)this.pages.push(new or(this,e,t));this.dropElm=null,this.lastSettingOne=null,this.lastPagesData=null,this.lastImagesData=null}render(){return this.setting=V(this.id+"child",["PageImagesA"],this.id),V(this.id,"PageImages",[this.setting])}async onViewShow(t,e){const i=t[this.storePagesKey],r=t[this.storeImagesKey],s=JSON.stringify(i),a=JSON.stringify(r);if(t[this.storeKey]){const e=t[this.storeKey],i=JSON.stringify(e);if(i!==this.lastSettingOne){const t=this.buildPageFrames(e);this.prePatch("#"+this.childId,V(this.childId,t)),this.lastSettingOne=i}}r&&i&&(this.lastPagesData!==s||this.lastImagesData!==a)&&(await this.showPages(i,r),this.lastPagesData=s,this.lastImagesData=a)}addPage(t,e){const i=Ce.creatAddPageAction(this,{imagePk:t,pagePk:e});this.dispatch(i)}async showPages(t,e){const i={};for(let t of e){if(!t)continue;i[t.imageEntity.getPk()]=t}let r=0;for(let e of t){const t=this.pages[r];if(r++,!e)continue;e.getPk();const s=i[e.baseImage];await t.setPageData(e,s),t.renderVnode(this)}}creatPageFrame(t,e,i){const r=[];if(e===this.dummyClass)return r;const s="pageFrameHeader"+(i?"Right":"Left");r.push(V("",["pageFrameHeader",s],t+""));const a=t-1,n=this.pages[a].renderVnode(this);return r.push(n),r}showPreviewSingle(){return t=>{const e=lr.creatOpenAction(this,{isSingle:!0});this.dispatch(e)}}showPreviewDual(){return t=>{const e=lr.creatOpenAction(this,{isSingle:!1});this.dispatch(e)}}buildPreviewButtons(){const t=V("",["previewCallButton"],{on:{click:this.showPreviewSingle()}},"Preview Single"),e=V("",["previewCallButton"],{on:{click:this.showPreviewDual()}},"Preview Dual");return V("",["previewFrame"],[t,e])}buildPageFrames(t){const e=[];e.push(this.buildPreviewButtons());const i=t.startPage,r=1*t.pageNum;this.pageNum=r;const s=t.pageDirection,a="r2l"===s,n="r"===i,o=Math.ceil(r/2),l=r%2==1,c=s&&0===s.indexOf(i),h=1*o+1*(l?1:c?0:1),d=this.dummyClass,u=a&&n||!a&&!n,p=!n||u?"":d,g=n||u?"":d,m=l&&(!u||u&&!a)||!l&&(!a||u)?"":d,f=l&&(!u||u&&a)||!l&&(a||u)?"":d,y=h-1;let w=0,b=0;for(let t=0;t<h;t++){const i=(a?1:0)+b+w,r=(a?0:1)+b+w,s=[];if(0===t){const t=a&&u?2:a?1:u?1:0,e=a&&u?1:a?0:u?2:1;s.push(V("",["Page",p],this.creatPageFrame(t,p,!1),h+"L"+t+" "+c)),s.push(V("",["Page",g],this.creatPageFrame(e,g,!0),o+"R"+e+" "+l)),b=1,w+=u?2:1}else t===y?(s.push(V("",["Page",m],this.creatPageFrame(i,m,!1),"L"+i)),s.push(V("",["Page",f],this.creatPageFrame(r,f,!0),"R"+r))):(s.push(V("",["Page"],this.creatPageFrame(i,"",!1),"L"+i)),s.push(V("",["Page"],this.creatPageFrame(r,"",!0),"R"+r)),w+=2);e.push(V("",["PageFrame"],s,"pageFrame index:"+t))}return e}}let hr=null;class dr extends ${constructor(){super(),this.ms=Se.getInstance(),this.tm=this.ms.tm,this.pvp=new ei,this.previewOpenAction=lr.creatOpenAction(),this.previewCloseAction=lr.creatCloseAction(),this.previewNextAction=lr.creatNextAction(),this.previewBackAction=lr.creatBackAction(),this.previewUpdateAction=lr.creatUpdateAction(),this.atatch(this.previewOpenAction),this.atatch(this.previewCloseAction),this.atatch(this.previewNextAction),this.atatch(this.previewBackAction),this.atatch(this.previewUpdateAction),this.storeKey=lr.getStorePreviewKey(),this.storeUpdateKey=lr.getStoreUpdatePreviewKey(),this.storeSettingKey=Ze.getStoreKey(),this.addInitializeKey(this.storeKey),this.addInitializeKey(this.storeUpdateKey),this.addInitializeKey(this.storeSettingKey)}static register(){hr||(hr=new dr)}async reduce(t,e){if(this.previewOpenAction.type===e.type){const i=e.data.isSingle,r=await this.tm.loadSettings().catch(t=>{console.log(t)}),s=await this.loadPreviews(r,i);t[this.storeKey]={isSingle:i,list:s,setting:r}}else this.previewCloseAction.type===e.type?t[this.storeKey]={type:this.previewCloseAction.type}:this.previewNextAction.type===e.type?t[this.storeKey]={isSingle:e.data.isSingle,nowSetNum:e.data.pageNo,type:this.previewNextAction.type}:this.previewBackAction.type===e.type?t[this.storeKey]={isSingle:e.data.isSingle,nowSetNum:e.data.pageNo,type:this.previewBackAction.type}:this.previewUpdateAction.type===e.type&&(t[this.storeUpdateKey]={pk:e.data.pk,page:await this.pvp.updatePage(e.data.pk,e.data.key)});return t}async loadPreviews(t,e){const i=await this.pvp.loadPreviews();return await this.pvp.shapeListBySets(i,e,t)}}class ur extends it{constructor(){super("Preview",["Preview",it.ModalWindowClass()],!0),this.storeKey=lr.getStorePreviewKey(),this.storeUpdateKey=lr.getStoreUpdatePreviewKey(),this.previewOpenAction=lr.creatOpenAction(),this.previewCloseAction=lr.creatCloseAction(),this.previewNextAction=lr.creatNextAction(),this.previewBackAction=lr.creatBackAction(),this.list=[],this.currentSetNum=0,this.isSingle=!0,this.classNameRight="previeRight",this.classNameLeft="previeLeft",this.dummyClassName="dummy",this.closeActionType=this.previewCloseAction.type}onAfterAttach(t,e){dr.register()}render(){const t=V("",["previewFrame",it.ModalWindowClass()],[V("",["previewLeft"],"<"),V("",["previewFrameA"],{style:{width:"100%"}}),V("",["previewRight"],">")]);return V(this.id,["Preview"],{style:{display:"none"},on:{click:this.beClose()}},[t])}async onViewShow(t,e){const i=t[this.storeKey],r=t[this.storeUpdateKey];if(r&&this.list){const{page:t,pk:e}=r;for(let i in this.list){const r=this.list[i];if(Array.isArray(r)){const i=r[0];if(i.parentPk===e){i.parent=t,this.showPreview(this.list,this.isSingle,this.pageNo,this.isR2L);break}const s=r[1];if(s.parentPk===e){s.parent=t,this.showPreview(this.list,this.isSingle,this.pageNo,this.isR2L);break}}else if(r.parentPk===e){r.parent=t,this.showPreview(this.list,this.isSingle,this.pageNo,this.isR2L);break}}}if(i){const{isSingle:t,nowSetNum:e,list:r,type:s,setting:a}=i;if(void 0!==t&&(this.isSingle=t),a&&(this.setting=a),r)this.list=r;else if(s===this.previewCloseAction.type)return this.list=null,void this.close();this.currentVnode.elm.style.display="block";const n=this.list.length;if(this.isR2L="r2l"===this.setting.pageDirection,r){const e=1;this.pageNo=e,this.showPreview(this.list,t,this.pageNo,this.isR2L)}else if(this.previewNextAction.type===s){if(!(n>e))return;{const i=1*e+1;this.pageNo=i,this.showPreview(this.list,t,this.pageNo,this.isR2L)}}else if(this.previewBackAction.type===s){if(!(e>1))return;{const i=1*e-1;this.pageNo=i,this.showPreview(this.list,t,this.pageNo,this.isR2L)}}}}showPreview(t,e,i,r){const s=t[i-1];let a=null;const n=r?"Next":"Back",o=r?"Back":"Next",l=V("",["previewLeft","button"],{on:{click:this.goNextOrBack(!1)}},[j("",["dummy","button","symbol"],""),j("",[n,"button","symbol"],"<"),j("",[n,"button","text"],n)]),c=V("",["previewRight","button"],{on:{click:this.goNextOrBack(!0)}},[j("",["close","button","symbol"],{on:{click:this.beClose()}},"X"),j("",[o,"button","symbol"],">"),j("",[o,"button","text"],o)]);if(e){const t=this.buildImageArea(s,i,null);a=V("",["preview_single"],{style:{width:"100%"},on:{click:this.doNothing()}},[t])}else{const t=2*(i-1)+(r?1:0),e=2*(i-1)+(r?0:1),n=s[0],o=s[1],l=this.buildImageArea(n,t,!1),c=this.buildImageArea(o,e,!0);a=V("",["preview_dual"],{style:{width:"100%"},on:{click:this.doNothing()}},[l,c])}this.prePatch(".previewFrame",V("",["previewFrame",it.ModalWindowClass()],{style:{}},[l,a,c]))}buildImageArea(t,e,i){const r=t.parent;this.parentPkRight=i?t.parentPk:this.parentPkRight,this.parentPkLeft=i?this.parentPkLeft:t.parentPk;const s=t.binary,a=r?r.isForceColor:null,n=r?r.isNoCropping:null,o=a?"enable":"disable",l=n?"enable":"disable";null===i||(i?this.classNameRight:this.classNameLeft);if(s){const t=At.a.arrayBuffer2DataURI(s._ab),r=W(s.pk+"_preview","preview_"+e,"",t,{}),a=V("",["pageNo"],{},"pageNo:"+e),n=V("",["checkForceColor",o],{on:{click:this.onCheckUpdate("isForceColor",i)}},"isForceColor"),c=V("",["checkNoCropping",l],{on:{click:this.onCheckUpdate("isNoCropping",i)}},"isNoCropping:"),h=null===i?"":i?"right":"left",d=V("",["previewInfo"],{},[a,V("",["options"],[n,c])]);return V("",["previewImageFrame"],{},[d,V("",["img",h],[r])])}{const t=void 0===s,i=t?"no Page":"no image set",r=t?this.dummyClassName:"",a=t?"----":"pageNo:"+e,n=V("",["previewInfo"],{},i),o=V("",["previewInfo"],{},a);return V("",["previewImageFrame",r],{},[o,n])}}onCheckUpdate(t,e){return i=>{const r=lr.creatUpdateAction(this,{pk:e?this.parentPkRight:this.parentPkLeft,key:t});return this.dispatch(r),i.stopPropagation(),!1}}beClose(){return t=>{const e=lr.creatCloseAction(this,{isSingle:this.isSingle});this.dispatch(e);const i=Ee.creatLoadImagesAction(this,{});return this.dispatch(i),t.stopPropagation(),!1}}doNothing(){return t=>(t.stopPropagation(),!1)}goNextOrBack(t){return e=>{const i=t&&this.isR2L||!t&&!this.isR2L?lr.creatBackAction(this,{isSingle:this.isSingle,pageNo:this.pageNo}):lr.creatNextAction(this,{isSingle:this.isSingle,pageNo:this.pageNo});return this.dispatch(i),e.stopPropagation(),!1}}}class pr extends it{constructor(t,e){super("Thumnail"+t.id,"Thumnail"),this.parent=t,this.draggableArea=e,this.ip=this.ms.ip,this.draggableArea.nowSelectedElm=null,this.thumbnail_block="thumbnail_block",this.displayNone="display_none",this.draggableArea.toDropTumnails=(t=>{this.doDrop(t)})}setImageData(t){this.imageData=t}render(t,e){return V("","")}remove(t){return async e=>{if(await ji.opneConfirm("Clicked Image Delete Button!","delete ok?")){const e=Ee.creatRemoveAction(this,{imagePKforDelete:t});this.dispatch(e)}}}handleDragStart(t){return e=>{const i=e.target;if(!i.classList||!i.classList.contains(this.thumbnail_block))return;i.style.opacity="0.4",this.draggableArea.nowSelectedElm=i,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",i.innerHTML);let r=document.createElement("img");r.src=t,r.width=100,e.dataTransfer.setDragImage(r,-10,-10)}}handleDragOver(){return t=>{const e=t.target;if(e.classList&&e.classList.contains(this.thumbnail_block))return t.preventDefault(),t.dataTransfer.dropEffect="move",!1}}handleDragEnter(){return t=>{const e=t.target;e.classList&&e.classList.contains(this.thumbnail_block)&&e.classList.add("over")}}handleDragLeave(){return t=>{const e=t.target;e.classList&&e.classList.contains(this.thumbnail_block)&&e.classList.remove("over")}}handleDrop(t){return t=>{t.stopPropagation(),t.preventDefault();const e=t.target;if(e.classList&&e.classList.contains(this.thumbnail_block))return this.doDrop(e),!1}}doDrop(t){const e=this.draggableArea.nowSelectedElm;if(e&&e.dataset.pk&&e!==t){const i=e.dataset.pk;if(e.dataset.is_image){const e=Ee.creatSortImagesAction(this,{imagePKmove:i,imagePKdrop:t.dataset.pk});this.dispatch(e)}else if(e.dataset.is_page){const t=Ce.creatRemovePageAction(this,{pagePk:i});this.dispatch(t)}this.draggableArea.nowSelectedElm=null}r.clearSideElmClass(t,"over")}handleDragEnd(t){return t=>{const e=t.target;if(!e.classList||!e.classList.contains(this.thumbnail_block))return;window.blockMenuHeaderScroll=!0;this.draggableArea.nowSelectedElm;r.clearSideElmClass(e,"over")}}handleTouchStart(t){return t=>{const e=t.target;e.classList&&e.classList.contains(this.thumbnail_block)&&(e.style.opacity="0.4",this.draggableArea.nowSelectedElm=e)}}handleTouchMove(){return t=>{window.blockMenuHeaderScroll=!1,t.preventDefault();const e=t.target;if(!e.classList||!e.classList.contains(this.thumbnail_block))return;const i=r.getCurrentPointedElm(t);return this.pointedElm&&this.pointedElm!==i&&r.clearSideElmClass(this.pointedElm,"over"),this.pointedElm=i,i.getAttribute("draggable")&&i!==e?(i.classList.add("over"),!1):void 0}}handleTouchEnd(){return t=>{const e=t.target;if(!e.classList||!e.classList.contains(this.thumbnail_block))return;this.draggableArea.nowSelectedElm;r.clearSideElmClass(e,"over");const i=this.pointedElm;i&&i.getAttribute("draggable")&&i!==e&&(this.pointedElm=null,i.classList&&i.classList.contains(i.thumbnail_block)?(r.clearSideElmClass(i,"over"),this.doDrop(e)):this.draggableArea.toDropPage(i))}}selectImage(t){return t=>{t.stopPropagation(),t.preventDefault();const e=t.target,i=Ee.creatDetailAction(this,{imagePK:e.dataset.pk});return this.dispatch(i),!1}}async crateDataLine(t,e={}){const i=t.imageEntity,r=t.binaryEntity,s={name:i.name,ab:r._ab,type:i.type},a=await this.ip.createImageNodeByData(s).catch(t=>{throw console.error(t),t}),n=i.getPk(),o=j(n+"_text",["thumbnail_text"],t.imageText),l=j(n+"_delButton",["delButton"],{on:{click:this.remove(n)}},"x"),c=(V("",["image_block"],{on:{dragstart:this.handleDragStart(a.src),dragover:this.handleDragOver(),dragenter:this.handleDragEnter(),dragleave:this.handleDragLeave(),drop:this.handleDrop(),dragend:this.handleDragEnd(),click:this.selectImage(),touchstart:this.handleTouchStart(a.src),touchmove:this.handleTouchMove(),touchend:this.handleTouchEnd()},dataset:{pk:n,is_image:!0},props:{draggable:"true"}}),{});return c[this.displayNone]=e[n],V("",[this.thumbnail_block],{on:{dragstart:this.handleDragStart(a.src),dragover:this.handleDragOver(),dragenter:this.handleDragEnter(),dragleave:this.handleDragLeave(),drop:this.handleDrop(),dragend:this.handleDragEnd(),click:this.selectImage(),touchstart:this.handleTouchStart(a.src),touchmove:this.handleTouchMove(),touchend:this.handleTouchEnd()},style:{"background-image":"url("+a.src+")"},class:c,dataset:{pk:n,is_image:!0},props:{draggable:"true"}},[l,o])}}class gr extends it{constructor(t){super("Thumnails","Thumnails"),this.imageAreaID="thumnailsImageArea",this.thumbnail=new pr(this,t),this.ip=this.ms.ip,this.storePagesKey=Ce.getStorePagesKey(),this.storeImagesKey=Ee.getStoreImagesKey(),this.pageMap={},this.thumbnails_block="thumbnails_block",this.draggableArea=t,this.draggableArea.cancelPageArea=null}async onAfterAttach(t,e){const i=Ee.creatLoadImagesAction(this,{});await this.dispatch(i)}async onViewShow(t,e){const i=t[this.storePagesKey],r=t[this.storeImagesKey];r&&i&&(this.updatePageMap(i),await this.showImages(r).catch(t=>{console.error(t)}))}render(t,e){return V(this.imageAreaID,"Thumnails")}updatePageMap(t){for(let t in this.pageMap)delete this.pageMap[t];for(let e of t){if(!e)continue;const t=e.baseImage;t&&(this.pageMap[t]=!0)}}handleDragEnter(){return t=>{const e=t.target;e.classList&&e.classList.contains(this.thumbnails_block)&&(e.classList.add("over"),this.draggableArea.cancelPageArea=e)}}handleDragLeave(){return t=>{const e=t.target;e.classList&&e.classList.contains(this.thumbnails_block)&&(e.classList.remove("over"),setTimeout(()=>{this.draggableArea.cancelPageArea=null},100))}}handleDrop(t){return t=>{t.stopPropagation(),t.preventDefault();t.target;return!1}}reset(){return t=>{t.target}}async showImages(t){const e=[];for(let i of t){if(!i)continue;i.imageEntity.getPk();const t=await this.thumbnail.crateDataLine(i,this.pageMap).catch(t=>{console.error(t)});e.push(t)}const i=V(this.imageAreaID,[this.thumbnails_block],{on:{dragover:this.handleDragEnter(),dragstart:this.handleDragEnter(),dragenter:this.handleDragEnter(),dragleave:this.handleDragLeave(),drop:this.handleDrop(),dragend:this.handleDrop(),click:this.reset()},props:{draggable:"true"}},e);this.prePatch("#"+this.imageAreaID,i)}}let mr=null;class fr extends ${constructor(){super(),this.ms=Se.getInstance(),this.im=this.ms.im,this.pageAddAction=Ce.creatAddPageAction(),this.pageRemoveAction=Ce.creatRemovePageAction(),this.pagesResetAction=Ce.creatResetPagesAction(),this.pagesSortAction=Ce.creatSortPagesAction(),this.atatch(this.dropImageToPageAction),this.atatch(this.pageAddAction),this.atatch(this.pageRemoveAction),this.atatch(this.pagesResetAction),this.atatch(this.pagesSortAction),this.pp=new Ke,this.storeKey=Ce.getStorePagesKey(),this.storeImagesKey=Ee.getStoreImagesKey()}static register(){mr||(mr=new fr)}async reduce(t,e){return this.pageAddAction.type===e.type?(t[this.storeKey]=await this.add(e.data.imagePk,e.data.pagePk),t[this.storeImagesKey]=await this.loadImages()):this.pageRemoveAction.type===e.type?(t[this.storeKey]=await this.remove(e.data.pagePk),t[this.storeImagesKey]=await this.loadImages()):this.pagesResetAction.type===e.type?(t[this.storeKey]=await this.reset(),t[this.storeImagesKey]=await this.loadImages()):this.pagesSortAction.type===e.type&&(t[this.storeKey]=await this.move(e.data.formPk,e.data.toPk),t[this.storeImagesKey]=await this.loadImages()),t}async loadImages(){return await this.im.loadImages()}async add(t,e){return await this.pp.add(t,e),await this.pp.loadPages()}async remove(t){return await this.pp.remove(t),await this.pp.loadPages()}async reset(){return await this.pp.resetPagesFull()}async move(t,e){return await this.pp.move(t,e),await this.pp.loadPages()}}class yr extends it{constructor(){super("FilesArea","FilesArea"),this.nowSelectedElm=null,this.imageDetail=new nr,this.pageImages=new cr(this),this.thumbnails=new gr(this),this.preview=new ur,Le.register(),fr.register()}async onAfterAttach(t,e){await this.imageDetail.attach(this),await this.pageImages.attach(this),await this.thumbnails.attach(this),await this.preview.attach(this)}render(){return V("",[V(this.pageImages.id),V(this.thumbnails.id),V(this.imageDetail.id),V(this.preview.id)])}}let wr=null;class br extends ${constructor(){super(),this.progressBarAddAction=_t.creatAddAction(),this.progressBarRemoveAction=_t.creatRemoveAction(),this.progressBarUpdateAction=_t.creatUpdateAction(),this.progressBarCompleatSortAction=_t.creatCompleatAction(),this.atatch(this.progressBarAddAction),this.atatch(this.progressBarRemoveAction),this.atatch(this.progressBarUpdateAction),this.atatch(this.progressBarCompleatSortAction),this.storeKey="progress",this.addInitializeKey(this.storeKey)}static register(){wr||(wr=new br)}async reduce(t,e){return this.progressBarAddAction.type===e.type?t[this.storeKey]=this.createProgress(!0,0,!1,e.data.msg,e.data.title):this.progressBarRemoveAction.type===e.type?t[this.storeKey]=this.createProgress(!1,0,!1):this.progressBarUpdateAction.type===e.type?t[this.storeKey]=this.createProgress(!0,e.data.progress,!1,e.data.msg):this.progressBarCompleatSortAction.type===e.type&&(t[this.storeKey]=this.createProgress(!0,100,!0,e.data.msg)),t}createProgress(t,e,i,r,s){return{isVisible:t,progress:e,msg:r,isComple:i,title:s}}}class Ar extends it{constructor(){super("ProgressBar",["ProgressBar",it.ModalWindowClass()]),this.storeKey="progress",this.initPoint="0%",this.title="ProgressBar"}async onAfterAttach(t,e){br.register()}render(){return V("".ProgressBarView,{style:{display:"none"}},[V("",["progeressTitle"],""),V("",["progeressFrame"],[V("",["progeress"],{style:{width:this.initPoint}})]),V("",["progeressInfo"],[V("",["progeressPoints"],this.initPoint),V("",["progeressMessage"],"")])])}async onViewShow(t,e){t[this.storeKey]&&this.showProgress(t[this.storeKey])}showProgress(t){const{isVisible:e,progress:i,isComple:r,msg:s,title:a}=t;a&&(this.title=a),e?(this.currentVnode.elm.style.display="block",this.prePatch(".progeress",V("",["progeress"],{style:{width:i+"%"}})),this.prePatch(".progeressTitle",V("",["progeressTitle"],{},this.title)),this.prePatch(".progeressPoints",V("",["progeressPoints"],{},i+"%")),this.prePatch(".progeressMessage",V("",["progeressMessage"],{},s)),r&&(this.currentVnode.elm.style.display="none")):(this.currentVnode.elm.style.display="none",this.prePatch(".progeress",V("",["progeress"],{style:{width:"0%"}})),this.prePatch(".progeressPoints",V("",["progeressPoints"],{},this.initPoint)))}}class vr{constructor(){}static creatAction(t,e,i=null){return B.createBaseAction("creatTitle",t,e,i)}static creatRemoveAction(t,e,i=null){return B.createBaseAction("removeTitle",t,e,i)}static creatLoadAction(t,e,i=null){return B.createBaseAction("loadTitle",t,e,i)}static creatChangeAction(t,e,i=null){return B.createBaseAction("changeTitle",t,e,i)}static creatUpdateAction(t,e,i=null){return B.createBaseAction("updateTitle",t,e,i)}static creatClearAllAction(t,e,i=null){return B.createBaseAction("clearAllTitle",t,e,i)}static getStoreCurrentKey(){return"titlesCurrentData"}static getStoreKey(){return"titlesData"}}class xr{constructor(){}static creatAddAction(t,e,i=null){return B.createBaseAction("addSplashr",t,e,i)}static creatRemoveAction(t,e,i=null){return B.createBaseAction("removeSplash",t,e,i)}static getStoreKey(){return"splash"}}class Pr extends it{constructor(){super("StorageMeter","StorageMeter"),this.storeKey=vr.getStoreKey(),this.storeCurrentKey=vr.getStoreCurrentKey()}render(t,e){const i=V("",["StorageMeter"],"Storage now usage:"),r=j("",["StorageMeterCounter"],"0"),s=j("",["StorageMeterUnit"]," byte"),a=j("",["StorageMeterUnit","button"],{on:{click:this.onReculc()}},"reculc!"),n=V("",["StorageMeter"],[r,s,a]);return V("",[this.id+"Frame"],[i,n])}async onAfterAttach(t,e){}async onViewShow(t,e){if(t[this.storeKey]){const{list:e,totalSize:i}=t[this.storeKey],r=j("",["StorageMeterCounter"],i+"");this.prePatch(".StorageMeterCounter",r);const s=xr.creatRemoveAction(this);this.dispatch(s)}else t[this.storeCurrentKey]&&alert("bbbbbb")}onReculc(){return t=>{ji.opneAlert("onReculc!","Taking several time...");const e=vr.creatLoadAction(this);return this.dispatch(e),t.preventDefault(),!1}}}class Sr extends it{constructor(){super("TitleRow","TitleRow")}render(t,e){const i=V("",["TitleName"],"TitleName");return V("",[this.id+"Frame"],[i,V(this.imageAreaID,["ImageDetailA"],this.id+"aaaaa")])}async onAfterAttach(t,e){}async onViewShow(t,e){}buildRows(t){const e=[];for(let i of t)e.push(this.creatRow(i));return e}creatRow(t){const e=V("",["TitleId"],this.titleId),i=V("",["prefix"],this.prefix),r=V("",["TitleName"],t.name),s=V("",["TitleName"],t.size+" byte"),a=V("",["TitleUpdate","button"],{on:{click:this.onUpdate()}},"update"),n=V("",["TitleDelete","button"],{on:{click:this.onDelete()}},"del");return V("",[this.id+"Row"],[e,i,r,s,a,n])}onUpdate(){return t=>{alert("onUpdate");const e=vr.creatLoadAction(this);return this.dispatch(e),t.preventDefault(),!1}}onDelete(){return t=>{alert("onDelete");const e=vr.creatLoadAction(this);return this.dispatch(e),t.preventDefault(),!1}}}class Dr extends it{constructor(){super("TitleList","TitleList"),this.storeKey=vr.getStoreKey(),this.storeCurrentKey=vr.getStoreCurrentKey(),this.titleRow=new Sr}render(t,e){const i=V("",["TitleListName"],"Titles List"),r=V("",["TitleListRows"],this.id+"-----------");return V("",[this.id+"Frame"],[i,r])}async onAfterAttach(t,e){}async onViewShow(t,e){if(t[this.storeKey]){const{list:e,totalSize:i}=t[this.storeKey];this.buildRows(e)}else t[this.storeCurrentKey]&&alert("bbbbbb")}buildRows(t){const e=this.titleRow.buildRows(t),i=V("",["TitleListRows"],e);this.prePatch(".TitleListRows",i)}}class kr extends it{constructor(){super("TitleNewone","TitleNewone"),this.storeKey=vr.getStoreKey(),this.storeCurrentKey=vr.getStoreCurrentKey(),this.idOfName=this.id+"name"}render(t,e){const i=V("",["TitleNewone"],"TitleNewone"),r=this.createInputRow("name","NameInput"),s=this.createInputRow("prefix","NameInput"),a=this.createInputRow("titleId","titleIdInput"),n=V("",["titleIdInput","button"],{on:{click:this.onClick()}},"create new title.");return V("",[this.id+"Frame"],[i,a,s,r,n])}async onAfterAttach(t,e){}async onViewShow(t,e){if(t[this.storeKey]){this.ids={};const{list:e,totalSize:i}=t[this.storeKey];for(let t of e)this.ids[t.getPk()]=!0}else t[this.storeCurrentKey]}onClick(){return t=>{if(alert("onClick"),elm.classList&&elm.classList.contains(this.thumbnail_block))return t.preventDefault(),!1}}getCurrentOptions(){return{isGrayscale:document.getElementById(this.checkboxIsGrascale).checked,dpiName:document.getElementById(this.selectBoxDpiName).value,isMaxSize10M:document.getElementById(this.checkboxIsMaxSize10M).checked,isLanczose:document.getElementById(this.checkboxIsLanczose).checked}}createInputRow(t,e,i="",r=""){const s=this.id+"Label",a=j("",[s],t+":"),n=X(this.id+e,[this.id+e],{props:{name:this.id+e},attr:{pattern:i}},"text",r);return V("",[this.id+"Row"],[a,n])}}class Br{constructor(t,e){this.em=t,this.tm=e,this.actionDispatcher=z.createStandAlone(),this.totalSize=0}async loadAll(){console.time("TitleProcessor.loadAll");const t=await this.tm.loadTitleList();this.totalSize=0;for(let e of t){this.titleSizeCache={};const t=await this.getSizes(e);e.size=t,this.totalSize+=t}return console.timeEnd("TitleProcessor.loadAll"),{list:t,totalSize:this.totalSize}}getTotalSum(){return this.totalSize}async getSizes(t){if(!t)return 1;let e=await S.calcSize(this.em,t);const i=t.getRefCols();for(let r of i){const i=t[r];if(i)if(Array.isArray(i))for(let t of i)if(t){if(void 0===this.titleSizeCache[t]){const i=await this.em.get(t,!0),r=Number.isInteger(i)?i:await this.getSizes(i);this.titleSizeCache[t]=!0,e+=r}}else e+=2;else if("string"==typeof i&&void 0===this.titleSizeCache[i]){const t=await this.em.get(i,!0),r=Number.isInteger(t)?t:await this.getSizes(t);this.titleSizeCache[i]=!0,e+=r}}return e}async clearAll(){const t=await this.tm.loadTitleList();for(let e of t)await this.removeDescendant(e);for(let e of t)await this.removeDescendant(e);return await this.loadAll()}async removeDescendant(t){if(!t)return;const e=t.getRefCols();for(let i of e){const e=t[i];if(e)if(Array.isArray(e)){for(let t of e)await this.removeExecute(t);for(let t in e)delete e[t]}else"string"==typeof e&&await this.removeExecute(e)}}async removeExecute(t){if(!t)return this.tm.loadCurrent();const e=await this.em.get(t);if(e){if(await this.removeDescendant(e),e.pages)for(let t in e.pages)delete e.pages[t];await this.em.delete(t);const i=await this.tm.loadTitleList();return i&&i.length>0?i[0]:null}return this.tm.loadCurrent()}async create(t,e,i){return await this.tm.isExist(t)?await this.tm.load(t):await this.tm.createTitle(t,e,i)}async remove(t){return await this.tm.isExist(t)?await this.removeExecute(t):this.tm.loadCurrent()}async changeTtitle(t){return await this.tm.changeTitle(t)}async update(t,e){const i=await this.tm.load(t);return i.name=e,await this.tm.saveTitle(i),this.tm.loadCurrent()}}let Ir=null;class Er extends ${constructor(){super(),this.ms=Se.getInstance(),this.tm=this.ms.tm,this.em=this.ms.em,this.tp=new Br(this.em,this.tm),this.titleCreatAction=vr.creatAction(),this.titleRemoveAction=vr.creatRemoveAction(),this.titleLoadAction=vr.creatLoadAction(),this.titleChangection=vr.creatChangeAction(),this.titleUpdateAction=vr.creatUpdateAction(),this.titleClearAllAction=vr.creatClearAllAction(),this.atatch(this.titleCreatAction),this.atatch(this.titleRemoveAction),this.atatch(this.titleLoadAction),this.atatch(this.titleChangection),this.atatch(this.titleUpdateAction),this.atatch(this.titleClearAllAction),this.storeKey=vr.getStoreKey(),this.storeCurrentKey=vr.getStoreCurrentKey(),this.addInitializeKey(this.storeKey),this.addInitializeKey(this.storeCurrentKey)}static register(){Ir||(Ir=new Er)}async reduce(t,e){return this.titleCreatAction.type===e.type?(t[this.storeCurrentKey]=await this.tp.create(e.data.titleId,e.data.titlePrefix,e.data.name),t[this.storeKey]=await this.tp.loadAll()):this.titleRemoveAction.type===e.type?(t[this.storeCurrentKey]=await this.tp.remove(e.data.titleId),t[this.storeKey]=await this.tp.loadAll()):this.titleLoadAction.type===e.type?(t[this.storeCurrentKey]=await this.tp.loadAll(),t[this.storeKey]=await this.tp.loadAll()):this.titleChangection.type===e.type?(t[this.storeKey]=await this.tp.loadAll(),t[this.storeCurrentKey]=await this.tp.changeTtitle(e.data.titleId)):this.titleUpdateAction.type===e.type?(t[this.storeKey]=await this.tp.loadAll(),t[this.storeCurrentKey]=await this.tp.update(e.data.titleId,e.data.name)):this.titleClearAllAction.type===e.type&&(t[this.storeKey]=await this.tp.clearAll()),t}}class Cr extends it{constructor(){super("StorageInitializer","StorageInitializer"),this.storeKey=vr.getStoreKey(),this.storeCurrentKey=vr.getStoreCurrentKey()}render(t,e){const i=V("",["StorageInitializer"],"StorageInitializer"),r=V("",["StorageInitializerButton button"],{on:{click:this.onClearAll()}},"Init!");return V("",[this.id+"Frame"],[i,r])}async onAfterAttach(t,e){Er.register();const i=vr.creatLoadAction(this);this.dispatch(i)}async onViewShow(t,e){if(t[this.storeKey]){const{list:e,totalSize:i}=t[this.storeKey]}else t[this.storeCurrentKey]&&alert("bbbbbb")}onClearAll(){return async t=>{if(await ji.opneConfirm("onClearAll","is Clear All Data? This Exection is Not recoverable. ")){const e=vr.creatClearAllAction(this,{});return this.dispatch(e),t.stopPropagation(),!1}}}}class Kr extends it{constructor(){super("TitleMng","TitleMng"),this.text="TitleMng",this.storageMeter=new Pr(this),this.titleList=new Dr(this),this.titleNewone=new kr(this),this.storageInitializer=new Cr(this)}async onAfterAttach(t,e){await this.storageMeter.attach(this),await this.titleList.attach(this),await this.titleNewone.attach(this),await this.storageInitializer.attach(this)}render(){return V(this.id+"Frame",["TitleMng"],[V("",["name"],"Title Manager"),V(this.storageMeter.id),V(this.titleList.id),V(this.titleNewone.id),V(this.storageInitializer.id)])}}class Nr extends it{constructor(){super("container","main-container"),this.fileUploadArea=new Me,this.titleSettings=new He,this.filesArea=new yr,this.exportArea=new $i,this.progressBar=new Ar,this.titleMng=new Kr,this.dialog=new ji,this.contentsScrollTops=[],this.contentsScrollRanges=[],this.contentsIdMap={}}async onAfterAttach(t,e){await this.progressBar.attach(this),await this.dialog.attach(this),await this.addScrollMap(this.titleSettings),await this.addScrollMap(this.fileUploadArea),await this.addScrollMap(this.filesArea),await this.addScrollMap(this.exportArea),await this.addScrollMap(this.titleMng),this.buildFinish(),this.currentVnode.elm.childNodes[0].addEventListener("scroll",this.onScroll()),this.currentCheck()}async addScrollMap(t){await t.attach(this);const e=t.currentVnode.elm.getBoundingClientRect().top;this.contentsScrollTops.push(e),this.contentsIdMap[e]=t.id,this.timer=null}buildFinish(){const t=this.contentsScrollTops.length;for(let e=0;e<t;e++){const i={current:this.contentsScrollTops[e],next:e===t-1?9999:this.contentsScrollTops[e+1]};this.contentsScrollRanges.push(i)}}render(){return V("",["scroll-container"],{style:{color:"#000"}},[V(this.progressBar.id),V(this.dialog.id),V(this.titleSettings.id),V(this.fileUploadArea.id),V(this.filesArea.id),V(this.exportArea.id),V(this.titleMng.id)],"container")}onScroll(){return t=>{this.currentCheck(t)}}currentCheck(t){this.timer&&clearTimeout(this.timer),this.currentVnode&&(this.timer=setTimeout(()=>{const t=this.currentVnode.elm.getBoundingClientRect().top+120,e=this.currentVnode.elm.childNodes[0].scrollTop+t,i=this.contentsScrollRanges.length;for(let t=0;t<i;t++){const i=this.contentsScrollRanges[t];if((0===t||i.current<e)&&i.next+0>e){const t=this.contentsIdMap[i.current],e=st.creatSelectAction(this,{id:t});return void this.dispatch(e)}}},100))}}class Lr extends it{constructor(){super("footer","footer"),this.copyright="copyright:ryunosinfx - Licenced MIT"}render(){return V({style:{color:"#000"}},[V("copyright",["copyright"],this.copyright)])}}let Tr=null;class Or extends ${constructor(){super(),this.splashAddAction=xr.creatAddAction(),this.splashRemoveAction=xr.creatRemoveAction(),this.atatch(this.splashAddAction),this.atatch(this.splashRemoveAction),this.storeKey=xr.getStoreKey(),this.addInitializeKey(this.storeKey)}static register(){Tr||(Tr=new Or)}async reduce(t,e){return this.splashAddAction.type===e.type?t[this.storeKey]=this.createSplash(!0,0,!1,e.data.msg,e.data.title):this.splashRemoveAction.type===e.type&&(t[this.storeKey]=this.createSplash(!1,0,!1)),t}createSplash(t,e,i,r,s){return{isVisible:t,progress:e,msg:r,isComple:i,title:s}}}class Mr extends it{constructor(){super("Splash",["Splash",it.ModalWindowClass()],!0),this.splashAddAction=xr.creatAddAction(),this.splashRemoveAction=xr.creatRemoveAction(),this.storeKey=xr.getStoreKey(),this.titleText=this.ms.getAppTitle(),this.Version=this.ms.getAppVersion(),this.message="Now loading..."}async onAfterAttach(t,e){Or.register()}render(){const t=V("",["appTitle"],[V("",["text"],this.titleText)]),e=V("",["appVerion"],[V("",["text"],this.Version)]),i=[],r=this.message.split("");for(let t of r)i.push(j("",[],t));const s=V("",["message"],[V("",[this.id+"MsgText","loader"],i)]),a=V("",["splashTitle"],[t,e,s]);return V(this.id,["Splash",it.ModalWindowClass()],[a])}async onViewShow(t,e){const i=t[this.storeKey];i&&!1===i.isVisible&&this.close()}}class Rr extends it{constructor(t){super("frame","frame"),this.ms=t,it.setMainService(t),this.initialize()}initialize(){this.header=new rt(this.ms),this.footer=new Lr,this.container=new Nr,this.menu=new Be,this.baseFrame=null,this.view="",this.splash=new Mr,this.initialPatch()}async onViewShow(t,e){this.header.attach(this,"#header"),this.menu.attach(this,"#menu"),this.container.attach(this,"#container"),this.footer.attach(this,"#footer"),this.splash.attach(this)}render(t){return V("frame",["frame"],{},[V("header",{style:{color:"#000"}},"hellow!!"),V("menu",{style:{color:"#000"}},"menu!!"),V("container",{style:{color:"#000"}},[V("content",{style:{color:"#000"}},"content!!")],"container!!"),V("footer",{style:{color:"#000"}},"footer!!?"),V(this.splash.id)])}}i.d(e,"default",function(){return Fr});const zr="CopiBon",Ur="v0.0.8alpha";class Fr{constructor(){this.mainService=Se.getInstance()}async init(){await this.mainService.init(zr,Ur),this.mf=new Rr(this.mainService)}static main(){(new Fr).init()}}Fr.main()},function(t,e,i){"use strict";function r(t,e,i,r,s){return{sel:t,data:e,children:i,text:r,elm:s,key:void 0===e?void 0:e.key}}i.r(e);var s=r,a=Array.isArray;function n(t){return"string"==typeof t||"number"==typeof t}var o={createElement:function(t){return document.createElement(t)},createElementNS:function(t,e){return document.createElementNS(t,e)},createTextNode:function(t){return document.createTextNode(t)},createComment:function(t){return document.createComment(t)},insertBefore:function(t,e,i){t.insertBefore(e,i)},removeChild:function(t,e){t.removeChild(e)},appendChild:function(t,e){t.appendChild(e)},parentNode:function(t){return t.parentNode},nextSibling:function(t){return t.nextSibling},tagName:function(t){return t.tagName},setTextContent:function(t,e){t.textContent=e},getTextContent:function(t){return t.textContent},isElement:function(t){return 1===t.nodeType},isText:function(t){return 3===t.nodeType},isComment:function(t){return 8===t.nodeType}};function l(t,e,i){var s,o,l,c={};if(void 0!==i?(c=e,a(i)?s=i:n(i)?o=i:i&&i.sel&&(s=[i])):void 0!==e&&(a(e)?s=e:n(e)?o=e:e&&e.sel?s=[e]:c=e),void 0!==s)for(l=0;l<s.length;++l)n(s[l])&&(s[l]=r(void 0,void 0,void 0,s[l],void 0));return"s"!==t[0]||"v"!==t[1]||"g"!==t[2]||3!==t.length&&"."!==t[3]&&"#"!==t[3]||function t(e,i,r){if(e.ns="http://www.w3.org/2000/svg","foreignObject"!==r&&void 0!==i)for(var s=0;s<i.length;++s){var a=i[s].data;void 0!==a&&t(a,i[s].children,i[s].sel)}}(c,s,t),r(t,c,s,o,void 0)}function c(t,e){e.elm=t.elm,t.data.fn=e.data.fn,t.data.args=e.data.args,e.data=t.data,e.children=t.children,e.text=t.text,e.elm=t.elm}function h(t){var e=t.data;c(e.fn.apply(void 0,e.args),t)}function d(t,e){var i,r=t.data,s=e.data,a=r.args,n=s.args;if(r.fn===s.fn&&a.length===n.length){for(i=0;i<n.length;++i)if(a[i]!==n[i])return void c(s.fn.apply(void 0,n),e);c(t,e)}else c(s.fn.apply(void 0,n),e)}var u=function(t,e,i,r){return void 0===r&&(r=i,i=e,e=void 0),l(t,{key:e,hook:{init:h,prepatch:d},fn:i,args:r})};function p(t){return void 0===t}function g(t){return void 0!==t}i.d(e,"init",function(){return b}),i.d(e,"h",function(){return l}),i.d(e,"thunk",function(){return u});var m=s("",{},[],void 0,void 0);function f(t,e){return t.key===e.key&&t.sel===e.sel}function y(t,e,i){var r,s,a,n={};for(r=e;r<=i;++r)null!=(a=t[r])&&void 0!==(s=a.key)&&(n[s]=r);return n}var w=["create","update","remove","destroy","pre","post"];function b(t,e){var i,r,l={},c=void 0!==e?e:o;for(i=0;i<w.length;++i)for(l[w[i]]=[],r=0;r<t.length;++r){var h=t[r][w[i]];void 0!==h&&l[w[i]].push(h)}function d(t,e){return function(){if(0==--e){var i=c.parentNode(t);c.removeChild(i,t)}}}function u(t,e){var i,r=t.data;void 0!==r&&g(i=r.hook)&&g(i=i.init)&&(i(t),r=t.data);var s=t.children,o=t.sel;if("!"===o)p(t.text)&&(t.text=""),t.elm=c.createComment(t.text);else if(void 0!==o){var h=o.indexOf("#"),d=o.indexOf(".",h),f=h>0?h:o.length,y=d>0?d:o.length,w=-1!==h||-1!==d?o.slice(0,Math.min(f,y)):o,b=t.elm=g(r)&&g(i=r.ns)?c.createElementNS(i,w):c.createElement(w);for(f<y&&b.setAttribute("id",o.slice(f+1,y)),d>0&&b.setAttribute("class",o.slice(y+1).replace(/\./g," ")),i=0;i<l.create.length;++i)l.create[i](m,t);if(a(s))for(i=0;i<s.length;++i){var A=s[i];null!=A&&c.appendChild(b,u(A,e))}else n(t.text)&&c.appendChild(b,c.createTextNode(t.text));g(i=t.data.hook)&&(i.create&&i.create(m,t),i.insert&&e.push(t))}else t.elm=c.createTextNode(t.text);return t.elm}function b(t,e,i,r,s,a){for(;r<=s;++r){var n=i[r];null!=n&&c.insertBefore(t,u(n,a),e)}}function A(t){var e,i,r=t.data;if(void 0!==r){for(g(e=r.hook)&&g(e=e.destroy)&&e(t),e=0;e<l.destroy.length;++e)l.destroy[e](t);if(void 0!==t.children)for(i=0;i<t.children.length;++i)null!=(e=t.children[i])&&"string"!=typeof e&&A(e)}}function v(t,e,i,r){for(;i<=r;++i){var s=void 0,a=void 0,n=void 0,o=e[i];if(null!=o)if(g(o.sel)){for(A(o),a=l.remove.length+1,n=d(o.elm,a),s=0;s<l.remove.length;++s)l.remove[s](o,n);g(s=o.data)&&g(s=s.hook)&&g(s=s.remove)?s(o,n):n()}else c.removeChild(t,o.elm)}}function x(t,e,i){var r,s;g(r=e.data)&&g(s=r.hook)&&g(r=s.prepatch)&&r(t,e);var a=e.elm=t.elm,n=t.children,o=e.children;if(t!==e){if(void 0!==e.data){for(r=0;r<l.update.length;++r)l.update[r](t,e);g(r=e.data.hook)&&g(r=r.update)&&r(t,e)}p(e.text)?g(n)&&g(o)?n!==o&&function(t,e,i,r){for(var s,a,n,o=0,l=0,h=e.length-1,d=e[0],g=e[h],m=i.length-1,w=i[0],A=i[m];o<=h&&l<=m;)null==d?d=e[++o]:null==g?g=e[--h]:null==w?w=i[++l]:null==A?A=i[--m]:f(d,w)?(x(d,w,r),d=e[++o],w=i[++l]):f(g,A)?(x(g,A,r),g=e[--h],A=i[--m]):f(d,A)?(x(d,A,r),c.insertBefore(t,d.elm,c.nextSibling(g.elm)),d=e[++o],A=i[--m]):f(g,w)?(x(g,w,r),c.insertBefore(t,g.elm,d.elm),g=e[--h],w=i[++l]):(void 0===s&&(s=y(e,o,h)),p(a=s[w.key])?(c.insertBefore(t,u(w,r),d.elm),w=i[++l]):((n=e[a]).sel!==w.sel?c.insertBefore(t,u(w,r),d.elm):(x(n,w,r),e[a]=void 0,c.insertBefore(t,n.elm,d.elm)),w=i[++l]));(o<=h||l<=m)&&(o>h?b(t,null==i[m+1]?null:i[m+1].elm,i,l,m,r):v(t,e,o,h))}(a,n,o,i):g(o)?(g(t.text)&&c.setTextContent(a,""),b(a,null,o,0,o.length-1,i)):g(n)?v(a,n,0,n.length-1):g(t.text)&&c.setTextContent(a,""):t.text!==e.text&&c.setTextContent(a,e.text),g(s)&&g(r=s.postpatch)&&r(t,e)}}return function(t,e){var i,r,a,n=[];for(i=0;i<l.pre.length;++i)l.pre[i]();for(function(t){return void 0!==t.sel}(t)||(t=function(t){var e=t.id?"#"+t.id:"",i=t.className?"."+t.className.split(" ").join("."):"";return s(c.tagName(t).toLowerCase()+e+i,{},[],void 0,t)}(t)),f(t,e)?x(t,e,n):(r=t.elm,a=c.parentNode(r),u(e,n),null!==a&&(c.insertBefore(a,e.elm,c.nextSibling(r)),v(a,[t],0,0))),i=0;i<n.length;++i)n[i].data.hook.insert(n[i]);for(i=0;i<l.post.length;++i)l.post[i]();return e}}}]);
//# sourceMappingURL=bundle.js.map