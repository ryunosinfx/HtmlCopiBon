!function(t){var e={};function a(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=t,a.c=e,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)a.d(i,r,function(e){return t[e]}.bind(null,r));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/dest/",a(a.s=18)}([function(t,e,a){"use strict";a.d(e,"a",function(){return r});const i="./dest/worker.js";class r{constructor(t=i){this.worker=new Worker(t)}postMessage(t,e){return new Promise((a,i)=>{const{transObject:s,tranceArray:n}=r.buildPostObj(t,e);this.worker.postMessage(s,n),this.worker.onmessage=(t=>{a(t.data)}),this.worker.onerror=(t=>{i(t)})})}static buildPostObj(t,e){const a=[],i={key:t};if(e){if(Array.isArray(e)){let t=0;for(let e of dataList)e.buffer?a.push(e.buffer):e.byteLength&&a.push(e),i[t]=e,t++}else if("object"==typeof e&&Object.keys(e).length>0)for(let t in Object.keys(e)){const r=e[e];i[t]=r,r.buffer?a.push(r.buffer):r.byteLength&&a.push(r)}}else;return{transObject:i,tranceArray:a}}close(){this.worker.terminate()}}},function(t,e,a){"use strict";function i(t,e,a,i,r){return{sel:t,data:e,children:a,text:i,elm:r,key:void 0===e?void 0:e.key}}Object.defineProperty(e,"__esModule",{value:!0}),e.vnode=i,e.default=i},function(t,e,a){"use strict";function i(t,e){var a,i,r=e.elm,s=t.data.class,n=e.data.class;if((s||n)&&s!==n){for(i in s=s||{},n=n||{},s)n[i]||r.classList.remove(i);for(i in n)(a=n[i])!==s[i]&&r.classList[a?"add":"remove"](i)}}Object.defineProperty(e,"__esModule",{value:!0}),e.classModule={create:i,update:i},e.default=e.classModule},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="undefined"!=typeof window&&window.requestAnimationFrame||setTimeout,r=function(t){i(function(){i(t)})};function s(t,e,a){r(function(){t[e]=a})}function n(t,e){var a,i,r=e.elm,n=t.data.style,o=e.data.style;if((n||o)&&n!==o){n=n||{},o=o||{};var l="delayed"in n;for(i in n)o[i]||("-"===i[0]&&"-"===i[1]?r.style.removeProperty(i):r.style[i]="");for(i in o)if(a=o[i],"delayed"===i&&o.delayed)for(var c in o.delayed)a=o.delayed[c],l&&a===n.delayed[c]||s(r.style,c,a);else"remove"!==i&&a!==n[i]&&("-"===i[0]&&"-"===i[1]?r.style.setProperty(i,a):r.style[i]=a)}}e.styleModule={create:n,update:n,destroy:function(t){var e,a,i=t.elm,r=t.data.style;if(r&&(e=r.destroy))for(a in e)i.style[a]=e[a]},remove:function(t,e){var a=t.data.style;if(a&&a.remove){var i,r=t.elm,s=0,n=a.remove,o=0,l=[];for(i in n)l.push(i),r.style[i]=n[i];for(var c=getComputedStyle(r)["transition-property"].split(", ");s<c.length;++s)-1!==l.indexOf(c[s])&&o++;r.addEventListener("transitionend",function(t){t.target===r&&--o,0===o&&e()})}else e()}},e.default=e.styleModule},function(t,e,a){"use strict";function i(t,e){var a,i,r=e.elm,s=t.data.props,n=e.data.props;if((s||n)&&s!==n){for(a in s=s||{},n=n||{},s)n[a]||delete r[a];for(a in n)i=n[a],s[a]===i||"value"===a&&r[a]===i||(r[a]=i)}}Object.defineProperty(e,"__esModule",{value:!0}),e.propsModule={create:i,update:i},e.default=e.propsModule},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="http://www.w3.org/1999/xlink",r="http://www.w3.org/XML/1998/namespace",s=58,n=120;function o(t,e){var a,o=e.elm,l=t.data.attrs,c=e.data.attrs;if((l||c)&&l!==c){for(a in l=l||{},c=c||{}){var h=c[a];l[a]!==h&&(!0===h?o.setAttribute(a,""):!1===h?o.removeAttribute(a):a.charCodeAt(0)!==n?o.setAttribute(a,h):a.charCodeAt(3)===s?o.setAttributeNS(r,a,h):a.charCodeAt(5)===s?o.setAttributeNS(i,a,h):o.setAttribute(a,h))}for(a in l)a in c||o.removeAttribute(a)}}e.attributesModule={create:o,update:o},e.default=e.attributesModule},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=/[A-Z]/g;function r(t,e){var a,r=e.elm,s=t.data.dataset,n=e.data.dataset;if((s||n)&&s!==n){s=s||{},n=n||{};var o=r.dataset;for(a in s)n[a]||(o?a in o&&delete o[a]:r.removeAttribute("data-"+a.replace(i,"-$&").toLowerCase()));for(a in n)s[a]!==n[a]&&(o?o[a]=n[a]:r.setAttribute("data-"+a.replace(i,"-$&").toLowerCase(),n[a]))}}e.datasetModule={create:r,update:r},e.default=e.datasetModule},function(t,e,a){"use strict";function i(t,e){var a=t.type,i=e.data.on;i&&i[a]&&function t(e,a,i){if("function"==typeof e)e.call(a,i,a);else if("object"==typeof e)if("function"==typeof e[0])if(2===e.length)e[0].call(a,e[1],i,a);else{var r=e.slice(1);r.push(i),r.push(a),e[0].apply(a,r)}else for(var s=0;s<e.length;s++)t(e[s])}(i[a],e,t)}function r(t,e){var a,r=t.data.on,s=t.listener,n=t.elm,o=e&&e.data.on,l=e&&e.elm;if(r!==o){if(r&&s)if(o)for(a in r)o[a]||n.removeEventListener(a,s,!1);else for(a in r)n.removeEventListener(a,s,!1);if(o){var c=e.listener=t.listener||function t(e){i(e,t.vnode)};if(c.vnode=e,r)for(a in o)r[a]||l.addEventListener(a,c,!1);else for(a in o)l.addEventListener(a,c,!1)}}}Object.defineProperty(e,"__esModule",{value:!0}),e.eventListenersModule={create:r,update:r,destroy:r},e.default=e.eventListenersModule},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(1),r=a(16);function s(t,e,a){var s,n,o,l={};if(void 0!==a?(l=e,r.array(a)?s=a:r.primitive(a)?n=a:a&&a.sel&&(s=[a])):void 0!==e&&(r.array(e)?s=e:r.primitive(e)?n=e:e&&e.sel?s=[e]:l=e),r.array(s))for(o=0;o<s.length;++o)r.primitive(s[o])&&(s[o]=i.vnode(void 0,void 0,void 0,s[o],void 0));return"s"!==t[0]||"v"!==t[1]||"g"!==t[2]||3!==t.length&&"."!==t[3]&&"#"!==t[3]||function t(e,a,i){if(e.ns="http://www.w3.org/2000/svg","foreignObject"!==i&&void 0!==a)for(var r=0;r<a.length;++r){var s=a[r].data;void 0!==s&&t(s,a[r].children,a[r].sel)}}(l,s,t),i.vnode(t,l,s,n,void 0)}e.h=s,e.default=s},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(1),r=a(17);function s(t,e){var a,n=void 0!==e?e:r.default;if(n.isElement(t)){var o,l=t.id?"#"+t.id:"",c=t.getAttribute("class"),h=c?"."+c.split(" ").join("."):"",d=n.tagName(t).toLowerCase()+l+h,u={},p=[],g=void 0,m=void 0,f=t.attributes,y=t.childNodes;for(g=0,m=f.length;g<m;g++)"id"!==(o=f[g].nodeName)&&"class"!==o&&(u[o]=f[g].nodeValue);for(g=0,m=y.length;g<m;g++)p.push(s(y[g]));return i.default(d,{attrs:u},p,void 0,t)}return n.isText(t)?(a=n.getTextContent(t),i.default(void 0,void 0,void 0,a,t)):n.isComment(t)?(a=n.getTextContent(t),i.default("!",{},[],a,t)):i.default("",{},[],void 0,t)}e.toVNode=s,e.default=s},function(t,e){
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */(function(){"use strict";var t=void 0,e=!0,a=this;function i(e,i){var r,s=e.split("."),n=a;!(s[0]in n)&&n.execScript&&n.execScript("var "+s[0]);for(;s.length&&(r=s.shift());)s.length||i===t?n=n[r]?n[r]:n[r]={}:n[r]=i}var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function s(t,e){if(this.index="number"==typeof e?e:0,this.f=0,this.buffer=t instanceof(r?Uint8Array:Array)?t:new(r?Uint8Array:Array)(32768),2*this.buffer.length<=this.index)throw Error("invalid index");this.buffer.length<=this.index&&n(this)}function n(t){var e,a=t.buffer,i=a.length,s=new(r?Uint8Array:Array)(i<<1);if(r)s.set(a);else for(e=0;e<i;++e)s[e]=a[e];return t.buffer=s}s.prototype.b=function(t,e,a){var i,r=this.buffer,s=this.index,o=this.f,l=r[s];if(a&&1<e&&(t=8<e?(u[255&t]<<24|u[t>>>8&255]<<16|u[t>>>16&255]<<8|u[t>>>24&255])>>32-e:u[t]>>8-e),8>e+o)l=l<<e|t,o+=e;else for(i=0;i<e;++i)l=l<<1|t>>e-i-1&1,8==++o&&(o=0,r[s++]=u[l],l=0,s===r.length&&(r=n(this)));r[s]=l,this.buffer=r,this.f=o,this.index=s},s.prototype.finish=function(){var t,e=this.buffer,a=this.index;return 0<this.f&&(e[a]<<=8-this.f,e[a]=u[e[a]],a++),r?t=e.subarray(0,a):(e.length=a,t=e),t};var o,l=new(r?Uint8Array:Array)(256);for(o=0;256>o;++o){for(var c=d=o,h=7,d=d>>>1;d;d>>>=1)c<<=1,c|=1&d,--h;l[o]=(c<<h&255)>>>0}var u=l;function p(e){var a,i=t,r="number"==typeof i?i:i=0,s=e.length;for(a=-1,r=7&s;r--;++i)a=a>>>8^m[255&(a^e[i])];for(r=s>>3;r--;i+=8)a=(a=(a=(a=(a=(a=(a=(a=a>>>8^m[255&(a^e[i])])>>>8^m[255&(a^e[i+1])])>>>8^m[255&(a^e[i+2])])>>>8^m[255&(a^e[i+3])])>>>8^m[255&(a^e[i+4])])>>>8^m[255&(a^e[i+5])])>>>8^m[255&(a^e[i+6])])>>>8^m[255&(a^e[i+7])];return(4294967295^a)>>>0}var g=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],m=r?new Uint32Array(g):g;function f(t){this.buffer=new(r?Uint16Array:Array)(2*t),this.length=0}function y(t,e){this.k=b,this.l=0,this.input=r&&t instanceof Array?new Uint8Array(t):t,this.e=0,e&&(e.lazy&&(this.l=e.lazy),"number"==typeof e.compressionType&&(this.k=e.compressionType),e.outputBuffer&&(this.c=r&&e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.e=e.outputIndex)),this.c||(this.c=new(r?Uint8Array:Array)(32768))}f.prototype.getParent=function(t){return 2*((t-2)/4|0)},f.prototype.push=function(t,e){var a,i,r,s=this.buffer;for(a=this.length,s[this.length++]=e,s[this.length++]=t;0<a&&(i=this.getParent(a),s[a]>s[i]);)r=s[a],s[a]=s[i],s[i]=r,r=s[a+1],s[a+1]=s[i+1],s[i+1]=r,a=i;return this.length},f.prototype.pop=function(){var t,e,a,i,r,s=this.buffer;for(e=s[0],t=s[1],this.length-=2,s[0]=s[this.length],s[1]=s[this.length+1],r=0;!((i=2*r+2)>=this.length)&&(i+2<this.length&&s[i+2]>s[i]&&(i+=2),s[i]>s[r]);)a=s[r],s[r]=s[i],s[i]=a,a=s[r+1],s[r+1]=s[i+1],s[i+1]=a,r=i;return{index:t,value:e,length:this.length}};var w,b=2,v=[];for(w=0;288>w;w++)switch(e){case 143>=w:v.push([w+48,8]);break;case 255>=w:v.push([w-144+400,9]);break;case 279>=w:v.push([w-256+0,7]);break;case 287>=w:v.push([w-280+192,8]);break;default:throw"invalid literal: "+w}y.prototype.g=function(){var a,i,n,o,l=this.input;switch(this.k){case 0:for(n=0,o=l.length;n<o;){var c,h,d,u=i=r?l.subarray(n,n+65535):l.slice(n,n+65535),p=(n+=i.length)===o,g=t,m=t,f=this.c,y=this.e;if(r){for(f=new Uint8Array(this.c.buffer);f.length<=y+u.length+5;)f=new Uint8Array(f.length<<1);f.set(this.c)}if(c=p?1:0,f[y++]=0|c,d=65536+~(h=u.length)&65535,f[y++]=255&h,f[y++]=h>>>8&255,f[y++]=255&d,f[y++]=d>>>8&255,r)f.set(u,y),y+=u.length,f=f.subarray(0,y);else{for(g=0,m=u.length;g<m;++g)f[y++]=u[g];f.length=y}this.e=y,this.c=f}break;case 1:var w=new s(r?new Uint8Array(this.c.buffer):this.c,this.e);w.b(1,1,e),w.b(1,2,e);var A,x,D,k=P(this,l);for(A=0,x=k.length;A<x;A++)if(D=k[A],s.prototype.b.apply(w,v[D]),256<D)w.b(k[++A],k[++A],e),w.b(k[++A],5),w.b(k[++A],k[++A],e);else if(256===D)break;this.c=w.finish(),this.e=this.c.length;break;case b:var E,I,N,O,K,L,C,R,M,T,V,F,_,U,z,j=new s(r?new Uint8Array(this.c.buffer):this.c,this.e),Z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],W=Array(19);for(E=b,j.b(1,1,e),j.b(E,2,e),I=P(this,l),C=S(L=B(this.p,15)),M=S(R=B(this.o,7)),N=286;257<N&&0===L[N-1];N--);for(O=30;1<O&&0===R[O-1];O--);var X,Y,G,H,q,J,$=N,Q=O,tt=new(r?Uint32Array:Array)($+Q),et=new(r?Uint32Array:Array)(316),at=new(r?Uint8Array:Array)(19);for(X=Y=0;X<$;X++)tt[Y++]=L[X];for(X=0;X<Q;X++)tt[Y++]=R[X];if(!r)for(X=0,H=at.length;X<H;++X)at[X]=0;for(X=q=0,H=tt.length;X<H;X+=Y){for(Y=1;X+Y<H&&tt[X+Y]===tt[X];++Y);if(G=Y,0===tt[X])if(3>G)for(;0<G--;)et[q++]=0,at[0]++;else for(;0<G;)(J=138>G?G:138)>G-3&&J<G&&(J=G-3),10>=J?(et[q++]=17,et[q++]=J-3,at[17]++):(et[q++]=18,et[q++]=J-11,at[18]++),G-=J;else if(et[q++]=tt[X],at[tt[X]]++,3>--G)for(;0<G--;)et[q++]=tt[X],at[tt[X]]++;else for(;0<G;)(J=6>G?G:6)>G-3&&J<G&&(J=G-3),et[q++]=16,et[q++]=J-3,at[16]++,G-=J}for(a=r?et.subarray(0,q):et.slice(0,q),T=B(at,7),U=0;19>U;U++)W[U]=T[Z[U]];for(K=19;4<K&&0===W[K-1];K--);for(V=S(T),j.b(N-257,5,e),j.b(O-1,5,e),j.b(K-4,4,e),U=0;U<K;U++)j.b(W[U],3,e);for(U=0,z=a.length;U<z;U++)if(F=a[U],j.b(V[F],T[F],e),16<=F){switch(U++,F){case 16:_=2;break;case 17:_=3;break;case 18:_=7;break;default:throw"invalid code: "+F}j.b(a[U],_,e)}var it,rt,st,nt,ot,lt,ct,ht,dt=[C,L],ut=[M,R];for(ot=dt[0],lt=dt[1],ct=ut[0],ht=ut[1],it=0,rt=I.length;it<rt;++it)if(st=I[it],j.b(ot[st],lt[st],e),256<st)j.b(I[++it],I[++it],e),nt=I[++it],j.b(ct[nt],ht[nt],e),j.b(I[++it],I[++it],e);else if(256===st)break;this.c=j.finish(),this.e=this.c.length;break;default:throw"invalid compression type"}return this.c};var A=function(){function t(t){switch(e){case 3===t:return[257,t-3,0];case 4===t:return[258,t-4,0];case 5===t:return[259,t-5,0];case 6===t:return[260,t-6,0];case 7===t:return[261,t-7,0];case 8===t:return[262,t-8,0];case 9===t:return[263,t-9,0];case 10===t:return[264,t-10,0];case 12>=t:return[265,t-11,1];case 14>=t:return[266,t-13,1];case 16>=t:return[267,t-15,1];case 18>=t:return[268,t-17,1];case 22>=t:return[269,t-19,2];case 26>=t:return[270,t-23,2];case 30>=t:return[271,t-27,2];case 34>=t:return[272,t-31,2];case 42>=t:return[273,t-35,3];case 50>=t:return[274,t-43,3];case 58>=t:return[275,t-51,3];case 66>=t:return[276,t-59,3];case 82>=t:return[277,t-67,4];case 98>=t:return[278,t-83,4];case 114>=t:return[279,t-99,4];case 130>=t:return[280,t-115,4];case 162>=t:return[281,t-131,5];case 194>=t:return[282,t-163,5];case 226>=t:return[283,t-195,5];case 257>=t:return[284,t-227,5];case 258===t:return[285,t-258,0];default:throw"invalid length: "+t}}var a,i,r=[];for(a=3;258>=a;a++)i=t(a),r[a]=i[2]<<24|i[1]<<16|i[0];return r}(),x=r?new Uint32Array(A):A;function P(a,i){function s(t,a){var i,r,s,n,o=t.n,l=[],c=0;switch(i=x[t.length],l[c++]=65535&i,l[c++]=i>>16&255,l[c++]=i>>24,e){case 1===o:r=[0,o-1,0];break;case 2===o:r=[1,o-2,0];break;case 3===o:r=[2,o-3,0];break;case 4===o:r=[3,o-4,0];break;case 6>=o:r=[4,o-5,1];break;case 8>=o:r=[5,o-7,1];break;case 12>=o:r=[6,o-9,2];break;case 16>=o:r=[7,o-13,2];break;case 24>=o:r=[8,o-17,3];break;case 32>=o:r=[9,o-25,3];break;case 48>=o:r=[10,o-33,4];break;case 64>=o:r=[11,o-49,4];break;case 96>=o:r=[12,o-65,5];break;case 128>=o:r=[13,o-97,5];break;case 192>=o:r=[14,o-129,6];break;case 256>=o:r=[15,o-193,6];break;case 384>=o:r=[16,o-257,7];break;case 512>=o:r=[17,o-385,7];break;case 768>=o:r=[18,o-513,8];break;case 1024>=o:r=[19,o-769,8];break;case 1536>=o:r=[20,o-1025,9];break;case 2048>=o:r=[21,o-1537,9];break;case 3072>=o:r=[22,o-2049,10];break;case 4096>=o:r=[23,o-3073,10];break;case 6144>=o:r=[24,o-4097,11];break;case 8192>=o:r=[25,o-6145,11];break;case 12288>=o:r=[26,o-8193,12];break;case 16384>=o:r=[27,o-12289,12];break;case 24576>=o:r=[28,o-16385,13];break;case 32768>=o:r=[29,o-24577,13];break;default:throw"invalid distance"}for(i=r,l[c++]=i[0],l[c++]=i[1],l[c++]=i[2],s=0,n=l.length;s<n;++s)f[y++]=l[s];b[l[0]]++,v[l[3]]++,w=t.length+a-1,p=null}var n,o,l,c,h,d,u,p,g,m={},f=r?new Uint16Array(2*i.length):[],y=0,w=0,b=new(r?Uint32Array:Array)(286),v=new(r?Uint32Array:Array)(30),A=a.l;if(!r){for(l=0;285>=l;)b[l++]=0;for(l=0;29>=l;)v[l++]=0}for(b[256]=1,n=0,o=i.length;n<o;++n){for(l=h=0,c=3;l<c&&n+l!==o;++l)h=h<<8|i[n+l];if(m[h]===t&&(m[h]=[]),d=m[h],!(0<w--)){for(;0<d.length&&32768<n-d[0];)d.shift();if(n+3>=o){for(p&&s(p,-1),l=0,c=o-n;l<c;++l)g=i[n+l],f[y++]=g,++b[g];break}0<d.length?(u=D(i,n,d),p?p.length<u.length?(g=i[n-1],f[y++]=g,++b[g],s(u,0)):s(p,-1):u.length<A?p=u:s(u,0)):p?s(p,-1):(g=i[n],f[y++]=g,++b[g])}d.push(n)}return f[y++]=256,b[256]++,a.p=b,a.o=v,r?f.subarray(0,y):f}function D(t,e,a){var i,r,s,n,o,l,c=0,h=t.length;n=0,l=a.length;t:for(;n<l;n++){if(i=a[l-n-1],s=3,3<c){for(o=c;3<o;o--)if(t[i+o-1]!==t[e+o-1])continue t;s=c}for(;258>s&&e+s<h&&t[i+s]===t[e+s];)++s;if(s>c&&(r=i,c=s),258===s)break}return new function(t,e){this.length=t,this.n=e}(c,e-r)}function B(t,e){var a,i,s,n,o,l=t.length,c=new f(572),h=new(r?Uint8Array:Array)(l);if(!r)for(n=0;n<l;n++)h[n]=0;for(n=0;n<l;++n)0<t[n]&&c.push(n,t[n]);if(a=Array(c.length/2),i=new(r?Uint32Array:Array)(c.length/2),1===a.length)return h[c.pop().index]=1,h;for(n=0,o=c.length/2;n<o;++n)a[n]=c.pop(),i[n]=a[n].value;for(s=function(t,e,a){function i(t){var a=g[t][m[t]];a===e?(i(t+1),i(t+1)):--u[a],++m[t]}var s,n,o,l,c,h=new(r?Uint16Array:Array)(a),d=new(r?Uint8Array:Array)(a),u=new(r?Uint8Array:Array)(e),p=Array(a),g=Array(a),m=Array(a),f=(1<<a)-e,y=1<<a-1;for(h[a-1]=e,n=0;n<a;++n)f<y?d[n]=0:(d[n]=1,f-=y),f<<=1,h[a-2-n]=(h[a-1-n]/2|0)+e;for(h[0]=d[0],p[0]=Array(h[0]),g[0]=Array(h[0]),n=1;n<a;++n)h[n]>2*h[n-1]+d[n]&&(h[n]=2*h[n-1]+d[n]),p[n]=Array(h[n]),g[n]=Array(h[n]);for(s=0;s<e;++s)u[s]=a;for(o=0;o<h[a-1];++o)p[a-1][o]=t[o],g[a-1][o]=o;for(s=0;s<a;++s)m[s]=0;for(1===d[a-1]&&(--u[0],++m[a-1]),n=a-2;0<=n;--n){for(l=s=0,c=m[n+1],o=0;o<h[n];o++)(l=p[n+1][c]+p[n+1][c+1])>t[s]?(p[n][o]=l,g[n][o]=e,c+=2):(p[n][o]=t[s],g[n][o]=s,++s);m[n]=0,1===d[n]&&i(n)}return u}(i,i.length,e),n=0,o=a.length;n<o;++n)h[a[n].index]=s[n];return h}function S(t){var e,a,i,s,n=new(r?Uint16Array:Array)(t.length),o=[],l=[],c=0;for(e=0,a=t.length;e<a;e++)o[t[e]]=1+(0|o[t[e]]);for(e=1,a=16;e<=a;e++)l[e]=c,c+=0|o[e],c<<=1;for(e=0,a=t.length;e<a;e++)for(c=l[t[e]],l[t[e]]+=1,i=n[e]=0,s=t[e];i<s;i++)n[e]=n[e]<<1|1&c,c>>>=1;return n}function k(t){t=t||{},this.files=[],this.d=t.comment}var E=[80,75,1,2],I=[80,75,3,4],N=[80,75,5,6];function O(t,e){var a,i=65535&t[2]|2;return a=i*(1^i)>>8&255,K(t,e),a^e}function K(t,e){t[0]=(m[255&(t[0]^e)]^t[0]>>>8)>>>0,t[1]=1+(6681*(20173*(t[1]+(255&t[0]))>>>0)>>>0)>>>0,t[2]=(m[255&(t[2]^t[1]>>>24)]^t[2]>>>8)>>>0}function L(t,e){var a,r,s,n;if(Object.keys)a=Object.keys(e);else for(r in a=[],s=0,e)a[s++]=r;for(s=0,n=a.length;s<n;++s)i(t+"."+(r=a[s]),e[r])}k.prototype.m=function(t,a){a=a||{};var i,s=t.length,n=0;if(r&&t instanceof Array&&(t=new Uint8Array(t)),"number"!=typeof a.compressionMethod&&(a.compressionMethod=8),a.compress)switch(a.compressionMethod){case 0:break;case 8:n=p(t),t=new y(t,a.deflateOption).g(),i=e;break;default:throw Error("unknown compression method:"+a.compressionMethod)}this.files.push({buffer:t,a:a,j:i,r:!1,size:s,h:n})},k.prototype.q=function(t){this.i=t},k.prototype.g=function(){var a,i,s,n,o,l,c,h,d,u,g,m,f,w,b,v,A,x,P,D,B,S,k,L,C=this.files,R=0,M=0;for(B=0,S=C.length;B<S;++B){if(f=(a=C[B]).a.filename?a.a.filename.length:0,w=a.a.comment?a.a.comment.length:0,!a.j)switch(a.h=p(a.buffer),a.a.compressionMethod){case 0:break;case 8:a.buffer=new y(a.buffer,a.a.deflateOption).g(),a.j=e;break;default:throw Error("unknown compression method:"+a.a.compressionMethod)}if(a.a.password!==t||this.i!==t){var T,V=a.a.password||this.i,F=[305419896,591751049,878082192],_=t;for(r&&(F=new Uint32Array(F)),_=0,T=V.length;_<T;++_)K(F,255&V[_]);for(D=F,x=a.buffer,r?((P=new Uint8Array(x.length+12)).set(x,12),x=P):x.unshift(0,0,0,0,0,0,0,0,0,0,0,0),k=0;12>k;++k)x[k]=O(D,11===B?255&a.h:256*Math.random()|0);for(L=x.length;k<L;++k)x[k]=O(D,x[k]);a.buffer=x}R+=30+f+a.buffer.length,M+=46+f+w}for(i=new(r?Uint8Array:Array)(R+M+(22+(this.d?this.d.length:0))),s=0,o=(n=R)+M,B=0,S=C.length;B<S;++B){if(f=(a=C[B]).a.filename?a.a.filename.length:0,w=a.a.comment?a.a.comment.length:0,l=s,i[s++]=I[0],i[s++]=I[1],i[s++]=I[2],i[s++]=I[3],i[n++]=E[0],i[n++]=E[1],i[n++]=E[2],i[n++]=E[3],i[n++]=20,i[n++]=a.a.os||0,i[s++]=i[n++]=20,c=i[s++]=i[n++]=0,(a.a.password||this.i)&&(c|=1),i[s++]=i[n++]=255&c,i[s++]=i[n++]=c>>8&255,h=a.a.compressionMethod,i[s++]=i[n++]=255&h,i[s++]=i[n++]=h>>8&255,d=a.a.date||new Date,i[s++]=i[n++]=(7&d.getMinutes())<<5|d.getSeconds()/2|0,i[s++]=i[n++]=d.getHours()<<3|d.getMinutes()>>3,i[s++]=i[n++]=(d.getMonth()+1&7)<<5|d.getDate(),i[s++]=i[n++]=(d.getFullYear()-1980&127)<<1|d.getMonth()+1>>3,u=a.h,i[s++]=i[n++]=255&u,i[s++]=i[n++]=u>>8&255,i[s++]=i[n++]=u>>16&255,i[s++]=i[n++]=u>>24&255,g=a.buffer.length,i[s++]=i[n++]=255&g,i[s++]=i[n++]=g>>8&255,i[s++]=i[n++]=g>>16&255,i[s++]=i[n++]=g>>24&255,m=a.size,i[s++]=i[n++]=255&m,i[s++]=i[n++]=m>>8&255,i[s++]=i[n++]=m>>16&255,i[s++]=i[n++]=m>>24&255,i[s++]=i[n++]=255&f,i[s++]=i[n++]=f>>8&255,i[s++]=i[n++]=0,i[s++]=i[n++]=0,i[n++]=255&w,i[n++]=w>>8&255,i[n++]=0,i[n++]=0,i[n++]=0,i[n++]=0,i[n++]=0,i[n++]=0,i[n++]=0,i[n++]=0,i[n++]=255&l,i[n++]=l>>8&255,i[n++]=l>>16&255,i[n++]=l>>24&255,b=a.a.filename)if(r)i.set(b,s),i.set(b,n),s+=f,n+=f;else for(k=0;k<f;++k)i[s++]=i[n++]=b[k];if(v=a.a.extraField)if(r)i.set(v,s),i.set(v,n),s+=0,n+=0;else for(k=0;k<w;++k)i[s++]=i[n++]=v[k];if(A=a.a.comment)if(r)i.set(A,n),n+=w;else for(k=0;k<w;++k)i[n++]=A[k];if(r)i.set(a.buffer,s),s+=a.buffer.length;else for(k=0,L=a.buffer.length;k<L;++k)i[s++]=a.buffer[k]}if(i[o++]=N[0],i[o++]=N[1],i[o++]=N[2],i[o++]=N[3],i[o++]=0,i[o++]=0,i[o++]=0,i[o++]=0,i[o++]=255&S,i[o++]=S>>8&255,i[o++]=255&S,i[o++]=S>>8&255,i[o++]=255&M,i[o++]=M>>8&255,i[o++]=M>>16&255,i[o++]=M>>24&255,i[o++]=255&R,i[o++]=R>>8&255,i[o++]=R>>16&255,i[o++]=R>>24&255,w=this.d?this.d.length:0,i[o++]=255&w,i[o++]=w>>8&255,this.d)if(r)i.set(this.d,o);else for(k=0,L=w;k<L;++k)i[o++]=this.d[k];return i},i("Zlib.Zip",k),i("Zlib.Zip.prototype.addFile",k.prototype.m),i("Zlib.Zip.prototype.compress",k.prototype.g),i("Zlib.Zip.prototype.setPassword",k.prototype.q),L("Zlib.Zip.CompressionMethod",{STORE:0,DEFLATE:8}),L("Zlib.Zip.OperatingSystem",{MSDOS:0,UNIX:3,MACINTOSH:7})}).call(this)},function(t,e,a){var i=a(12);"string"==typeof i&&(i=[[t.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};a(14)(i,r);i.locals&&(t.exports=i.locals)},function(t,e,a){(t.exports=a(13)(!1)).push([t.i,"html, body {\n  min-height: 100%;\n  width: 100%;\n  padding: 0;\n  margin: 0;\n}\n\ndiv {\n  box-sizing: border-box;\n}\n\ndiv.frame {\n  min-height: 99%;\n  width: 100%;\n  margin-left: auto;\n  margin-right: auto;\n  margin: 0;\n  border: solid 1px blue;\n}\n\ndiv.footer {\n  min-height: 100%;\n  width: 100%;\n  border: solid 1px red;\n  padding: 0.5em;\n}\n\ndiv.copyright {\n  width: 100%;\n  padding: 0.5em;\n  text-align: center;\n}\n\ndiv.header {\n  min-height: 100%;\n  width: 100%;\n  border: solid 1px green;\n  padding: 0.2em;\n}\n\ndiv.title {\n  font-size: 2em;\n  font-weight: bold;\n  background-color: #c23cc1;\n  padding: 0.5em;\n}\n\ndiv.FileUploadArea input {\n  position: absolute;\n  left: -100;\n}\n\ndiv.FileUploadArea {\n  display: block;\n  min-height: 100%;\n  width: 100%;\n  border: dotted 1px black;\n  background-color: #a8bae0;\n  padding-top: 5em;\n  padding-bottom: 5em;\n  text-align: center;\n  font-size: 2em;\n}\n\ninput.FileUploadFile {\n  position: absolute;\n  top: -10em;\n  left: 10em;\n  visibility: hidden;\n}\n\ndiv.FilesArea {\n  min-height: 100%;\n  width: 100%;\n  border: dotted 1px black;\n  background-color: rgb(124, 110, 241);\n  padding-top: 1em;\n  padding-bottom: 1em;\n  text-align: center;\n  font-size: 2em;\n}\n\nspan.imageDataLine {\n  display: inline-block;\n  font-size: 50%;\n  padding: 0.2em;\n}\n\ndiv.delButton {\n  display: inline-block;\n  font-size: 50%;\n  width: 3em;\n  padding: 0.2em;\n  line-height: 1em;\n  text-align: center;\n  cursor: pointer;\n  background-color: #675275;\n}\n\ndiv.delButton:active {\n  color: red;\n}\n\ndiv.delButton:hover {\n  color: #d48a60;\n  background-color: #7b4f99;\n}\n\ncanvas.hidden {\n  position: absolute;\n  top: -10000px;\n}\n\n[draggable] {\n  user-select: none;\n}\n\n.column {\n  height: 150px;\n  width: 150px;\n  float: left;\n  border: 2px solid #666666;\n  background-color: #ccc;\n  margin-right: 5px;\n  border-radius: 10px;\n  box-shadow: inset 0 0 3px #000;\n  text-align: center;\n  cursor: move;\n}\n\n.column.over {\n  border: 2px dashed #000;\n}\n\n.column header {\n  color: #fff;\n  text-shadow: #000 0 1px;\n  box-shadow: 5px;\n  border-bottom: 1px solid #ddd;\n  border-top-left-radius: 10px;\n  border-top-right-radius: 10px;\n}\n\n.FilesArea>div {\n  width: 100%;\n  min-width: 630px;\n  display: flex;\n  flex-wrap: wrap;\n  flex-direction: row;\n}\n\n.FilesArea>div>div {\n  display: flex;\n  min-width: 160px;\n  overflow: hidden;\n}\n\n.FilesArea>div>div.PageImages {\n  min-width: 320px;\n  max-width: 50%;\n}\n\n.FilesArea>div>div.ImageDetail {\n  min-width: 160px;\n  max-width: 25%;\n}\n\n.ImageDetail .ImageDetailTitle {\n  position: relative;\n  z-index: 1000;\n  font-size: 12px;\n  background-color: rgb(227, 169, 159);\n  text-align: left;\n  padding: 10px;\n}\n\n.Thumnails {\n  flex-direction: column;\n  background-color: rgba(200, 200, 200, 1);\n}\n.Thumnails .thumbnails_block {\n  background-color: rgba(220, 220, 220, 1);\n  border: 0px dotted #dfd;\n  height:100%;\n}\n.Thumnails .thumbnails_block.over {\n  background-color: rgba(190, 190, 190, 0.8);\n  border: 2px dotted #dfd;\n}\n\n.thumbnail_block {\n  display: flex;\n  flex-direction: column;\n  background-color: green;\n  border: 1px solid #fdd;\n  width: 150px;\n  cursor: pointer;\n  background-repeat:no-repeat;\n  background-size:contain;\n  background-position:center;\n}\n\n.thumbnail_block.over {\n  background-color: rgba(24, 129, 12, 0.8);\n  width: 148px;\n  border: 2px dotted #dfd;\n}\n\n.thumbnail_block div {\n  display: flex;\n  height: auto;\n  margin: auto;\n}\n\n.thumbnail_text {\n  display: block;\n  background-color: blue;\n  border: 1px solid #fdd;\n  font-size: 0.5em\n}\n\n.image_detail_block {\n  position: relative;\n  top: -10px;\n  left: -30px;\n}\n\n.ProgressBar,.Preview {\n  top: 0;\n  left: 0;\n  position: fixed;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(118, 118, 118, 0.80);\n  z-index: 1001;\n  display: none;\n}\n\n.ProgressBar>div{\n  position: fixed;\n  top: 50%;\n  left: 5%;\n  margin: 0 auto;\n  width: 90%;\n  height: 5em;\n  background-color: rgba(238, 118, 238, 1);\n  z-index: 1000;\n  padding: 10px\n}\n\n.ProgressBar>div .progeressFrame {\n  margin: 0 auto;\n  width: 95%;\n  height: 3em;\n  background-color: rgb(193, 165, 200);\n  z-index: 1000;\n  padding: 0px\n}\n.ProgressBar>div .progeressInfo>div{\n  width:70%;\n  float: left;\n}\n.ProgressBar>div .progeressInfo>div.progeressPoints{\n  width:5em;\n}\n\n.progeress {\n  position: relative;\n  top: 0;\n  left: 0;\n  height: 3em;\n  background-color: rgb(120, 231, 194);\n}\n.Preview>div {\n  position: fixed;\n  top: 2%;\n  left: 2%;\n  margin: 0 auto;\n  width: 96%;\n  height: 96%;\n  background-color: rgb(197, 206, 213);\n  z-index: 1000;\n  padding: 0px\n}\n.Preview>div img{\n  max-width: 100%;\n  max-height: 100%;\n}\n.Preview>div .previewLeft,.Preview>div .previewRight{\n  cursor: pointer;\n  padding: 10px;\n  background-color: rgba(95, 161, 212, 0.58);\n\n}\n.Preview>div .previewInfo{\n  font-size: 60%;\n  padding: 10px;\n  color: rgb(43, 176, 218)\n}\n\n.Preview>div .preview_dual {\n  display: flex;\n}\n.Preview>div .preview_dual .previewImageFrame{\n  width:50%;\n}\n.Preview>div .preview_dual .previewImageFrame.dummy{\n  background-color: rgb(174, 181, 184);\n}\n.TitleSettings {\n  background-color: rgb(159, 117, 242);\n  padding: 0.1em;\n  margin: 0.1em 0;\n}\n\n.TitleSettingsTitle {\n  padding: 0.3em;\n  margin-bottom: 0.3em;\n  font-weight: bold;\n  font-size: 110%;\n  width: 100%;\n  text-align: center;\n  background-color: rgb(139, 87, 242);\n}\n\n.TitleSettingsFrame {\n  display: flex;\n}\n\n.TitleSettingsFrame>div {\n  width: 50%;\n}\n\n.TitleSettingsRow>span, .TitleSettingsRow>input {\n  display: inline-flex;\n  width: 40%;\n}\n\n.TitleSettingsUpdate {\n  width: 70%;\n  background-color: rgb(3, 21, 186);\n  color: white;\n  font-weight: bold;\n  text-align: center;\n  margin: 0.5em auto;\n  padding: 0.5em;\n  border-radius: 1em;\n  cursor: pointer;\n}\n\n.previewFrame {\n  display: flex;\n}\n\n.previewCallButton {\n  width: 150px;\n  background-color: rgb(156, 111, 146);\n  font-size: 50%;\n  padding: 10px;\n  margin: 1px;\n  cursor: pointer;\n  border-radius: 5px;\n}\n\n.pageFrameHeader {\n  font-size: 60%;\n  background-color: rgb(59, 2, 62);\n  color: white;\n  padding: 5px;\n}\n\n.pageFrameHeaderLeft {\n  text-align: left;\n}\n\n.pageFrameHeaderRight {\n  text-align: right;\n}\n\n.PageFrame {\n  display: inline-block;\n  display: flex;\n  background-color: rgb(166, 121, 191);\n  width: 300px;\n  height: 150px;\n  font-size: 1em;\n  margin: 0.1em auto;\n  padding: 0.25em 1em;\n}\n\n.PageFrame .Page {\n  width: 110px;\n  border: 2px solid rgb(126, 100, 113);\n  background-color: rgb(172, 148, 185);\n  height: 140px;\n  margin: 0.0em auto;\n}\n\n.PageFrame .Dummy {\n  background-color: rgb(106, 91, 115);\n}\n\n.PageFrame .Page .thumbnail_block {\n  height: 104px;\n  width: 106px;\n  margin: 0.0em auto;\n  background-color: rgb(227, 209, 238);\n}\n.thumbnail_block .image_block{\n  height: 104px;\n  width: 106px;\n  margin: 0.0em auto;\n  background-color: rgb(227, 209, 238);\n  cursor: pointer;\n  background-repeat:no-repeat;\n  background-size:contain;\n  background-position:center;\n}\n.MenuFrame {\n  display: flex;\n}\n\n.MenuFrame div {\n  width: 20%;\n  cursor: pointer;\n  padding: 5px 10px;\n  margin: 2px 1px 0 1px;\n  border: 1px solid rgb(83, 122, 134);\n  border-bottom-width: 0;\n  border-top-left-radius: 10px;\n  border-top-right-radius: 10px;\n  background-color: rgb(170, 185, 210);\n  color: rgb(222, 240, 222)\n}\n.ExportArea .ExportArea{\n  background-color: rgb(195, 240, 204);\n  border:1px solid rgb(87, 158, 17);\n  padding: 10px;\n}\n.ExportOrdrList .ExportOrdersListTitle{\n    background-color: rgb(162, 233, 176);\n    padding:10px;\n    margin-bottom: 0.3em;\n}\n.ExportOrdrList .ExportOrdrListFrame{\n    background-color: rgb(222, 232, 219);\n    padding:15px;\n    border:1px solid rgb(87, 158, 17);\n    margin-bottom: 0.5em;\n}\n.ExportOrdrList .ExportOrdrs{\n  margin-bottom: 0.5em;\n}\n.ExportButtons{\n  display: flex;\n  flex-direction: row;\n}\ndiv.button>div.exportedState{\n  background-color:rgb(148, 222, 164);\n  padding: 0.2em;\n  font-size:60%;\n}\n.ExportButtons>div{\n  display: flex;\n  width:200px;\n  padding:15px;\n  margin:2px;\n  border:1px solid rgb(87, 158, 17);\n  cursor: pointer;\n  border-radius: 3px;\n      background-color: rgb(141, 233, 159);\n}\ndiv.DownloadLastExportZipButtonFrame,div.DownloadLastExportPdfButtonFrame{\n  padding: 0em;\n}\ndiv.button.disable,div.button.enable{\n  background-color:rgb(104, 131, 116);\n  padding:10px;\n  margin: 0em;\n}\ndiv.button.enable{\n  background-color:rgb(148, 219, 86);\n}\n.ExportArea .ExportOrdrs>div{\n  margin:0.1em;\n  padding: 0.4em;\n  padding-left: 2em;\n  border: 1px solid #aaa;\n  cursor: pointer;\n  background-color: rgb(232, 242, 229);\n}\n.ExportArea .ExportOrdrs>div:active{\n  border: 1px solid #666;\n  background-color: rgb(242, 252, 239);\n}\n.ExportArea .ExportOrdrs>div:hover{\n  border: 1px solid #999;\n  background-color: rgb(237, 247, 234);\n}\n.ExportArea .ExportOrdrs>div.active{\n  font-weight: bold;\n  color:rgb(223, 238, 218);\n  background-color: rgb(70, 187, 35);\n}\n.ExportArea .ExportOrdrs>label{\n  display: inline-block;\n  line-height: 2em;\n  margin:0.1em;\n  padding: 0.4em 0.6em;\n  border: 0px solid #aaa;\n  cursor: pointer;\n  background-color: rgb(232, 242, 229);\n}\n.ExportArea .ExportOrdrs>label:active{\n  background-color: rgb(174, 223, 160);\n}\n.ExportArea .ExportOrdrs>label:hover{\n  background-color: rgb(237, 247, 234);\n}\n.display_none{\n  display:none;\n}\n",""])},function(t,e){t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var a=function(t,e){var a=t[1]||"",i=t[3];if(!i)return a;if(e&&"function"==typeof btoa){var r=function(t){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t))))+" */"}(i),s=i.sources.map(function(t){return"/*# sourceURL="+i.sourceRoot+t+" */"});return[a].concat(s).concat([r]).join("\n")}return[a].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+a+"}":a}).join("")},e.i=function(t,a){"string"==typeof t&&(t=[[null,t,""]]);for(var i={},r=0;r<this.length;r++){var s=this[r][0];"number"==typeof s&&(i[s]=!0)}for(r=0;r<t.length;r++){var n=t[r];"number"==typeof n[0]&&i[n[0]]||(a&&!n[2]?n[2]=a:a&&(n[2]="("+n[2]+") and ("+a+")"),e.push(n))}},e}},function(t,e,a){var i={},r=function(t){var e;return function(){return void 0===e&&(e=t.apply(this,arguments)),e}}(function(){return window&&document&&document.all&&!window.atob}),s=function(t){var e={};return function(t){if("function"==typeof t)return t();if(void 0===e[t]){var a=function(t){return document.querySelector(t)}.call(this,t);if(window.HTMLIFrameElement&&a instanceof window.HTMLIFrameElement)try{a=a.contentDocument.head}catch(t){a=null}e[t]=a}return e[t]}}(),n=null,o=0,l=[],c=a(15);function h(t,e){for(var a=0;a<t.length;a++){var r=t[a],s=i[r.id];if(s){s.refs++;for(var n=0;n<s.parts.length;n++)s.parts[n](r.parts[n]);for(;n<r.parts.length;n++)s.parts.push(f(r.parts[n],e))}else{var o=[];for(n=0;n<r.parts.length;n++)o.push(f(r.parts[n],e));i[r.id]={id:r.id,refs:1,parts:o}}}}function d(t,e){for(var a=[],i={},r=0;r<t.length;r++){var s=t[r],n=e.base?s[0]+e.base:s[0],o={css:s[1],media:s[2],sourceMap:s[3]};i[n]?i[n].parts.push(o):a.push(i[n]={id:n,parts:[o]})}return a}function u(t,e){var a=s(t.insertInto);if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var i=l[l.length-1];if("top"===t.insertAt)i?i.nextSibling?a.insertBefore(e,i.nextSibling):a.appendChild(e):a.insertBefore(e,a.firstChild),l.push(e);else if("bottom"===t.insertAt)a.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var r=s(t.insertInto+" "+t.insertAt.before);a.insertBefore(e,r)}}function p(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=l.indexOf(t);e>=0&&l.splice(e,1)}function g(t){var e=document.createElement("style");return void 0===t.attrs.type&&(t.attrs.type="text/css"),m(e,t.attrs),u(t,e),e}function m(t,e){Object.keys(e).forEach(function(a){t.setAttribute(a,e[a])})}function f(t,e){var a,i,r,s;if(e.transform&&t.css){if(!(s=e.transform(t.css)))return function(){};t.css=s}if(e.singleton){var l=o++;a=n||(n=g(e)),i=w.bind(null,a,l,!1),r=w.bind(null,a,l,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(a=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",m(e,t.attrs),u(t,e),e}(e),i=function(t,e,a){var i=a.css,r=a.sourceMap,s=void 0===e.convertToAbsoluteUrls&&r;(e.convertToAbsoluteUrls||s)&&(i=c(i));r&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */");var n=new Blob([i],{type:"text/css"}),o=t.href;t.href=URL.createObjectURL(n),o&&URL.revokeObjectURL(o)}.bind(null,a,e),r=function(){p(a),a.href&&URL.revokeObjectURL(a.href)}):(a=g(e),i=function(t,e){var a=e.css,i=e.media;i&&t.setAttribute("media",i);if(t.styleSheet)t.styleSheet.cssText=a;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(a))}}.bind(null,a),r=function(){p(a)});return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else r()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=r()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var a=d(t,e);return h(a,e),function(t){for(var r=[],s=0;s<a.length;s++){var n=a[s];(o=i[n.id]).refs--,r.push(o)}t&&h(d(t,e),e);for(s=0;s<r.length;s++){var o;if(0===(o=r[s]).refs){for(var l=0;l<o.parts.length;l++)o.parts[l]();delete i[o.id]}}}};var y=function(){var t=[];return function(e,a){return t[e]=a,t.filter(Boolean).join("\n")}}();function w(t,e,a,i){var r=a?"":i.css;if(t.styleSheet)t.styleSheet.cssText=y(e,r);else{var s=document.createTextNode(r),n=t.childNodes;n[e]&&t.removeChild(n[e]),n.length?t.insertBefore(s,n[e]):t.appendChild(s)}}},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var a=e.protocol+"//"+e.host,i=a+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(t,e){var r,s=e.trim().replace(/^"(.*)"$/,function(t,e){return e}).replace(/^'(.*)'$/,function(t,e){return e});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(s)?t:(r=0===s.indexOf("//")?s:0===s.indexOf("/")?a+s:i+s.replace(/^\.\//,""),"url("+JSON.stringify(r)+")")})}},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.array=Array.isArray,e.primitive=function(t){return"string"==typeof t||"number"==typeof t}},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.htmlDomApi={createElement:function(t){return document.createElement(t)},createElementNS:function(t,e){return document.createElementNS(t,e)},createTextNode:function(t){return document.createTextNode(t)},createComment:function(t){return document.createComment(t)},insertBefore:function(t,e,a){t.insertBefore(e,a)},removeChild:function(t,e){t.removeChild(e)},appendChild:function(t,e){t.appendChild(e)},parentNode:function(t){return t.parentNode},nextSibling:function(t){return t.nextSibling},tagName:function(t){return t.tagName},setTextContent:function(t,e){t.textContent=e},getTextContent:function(t){return t.textContent},isElement:function(t){return 1===t.nodeType},isText:function(t){return 3===t.nodeType},isComment:function(t){return 8===t.nodeType}},e.default=e.htmlDomApi},function(t,e,a){"use strict";a.r(e);a(11);class i{constructor(){}static create(t,e,a){return i.ce("div",t,e,a)}static createInput(t,e,a){return i.ce("input",t,e,a)}static createText(t,e,a){return i.ce("text",t,e,a)}static createFile(t,e,a){return i.ce("input",t,e,a,"file")}static createCanvas(t,e,a){return i.ce("canvas",t,e,a)}static createImage(t,e,a){return i.ce("img",t,e,a)}static createUl(t,e,a){return i.ce("ul",t,e,a)}static createLabel(t,e,a,r){const s=i.ce("label",t,e,a);return s.setAttribute("for",r),s}static createLi(t,e,a){return i.ce("li",t,e,a)}static createSpan(t,e,a){return i.ce("span",t,e,a)}static createStrong(t,e,a){return i.ce("strong",t,e,a)}static createA(t,e,a){return i.ce("a",t,e,a)}static ce(t,e,a,i,r){const s=document.createElement(t);return s.className=a,e&&(s.id=e),"input"===t&&i?(s.setAttribute("value",i),r&&s.setAttribute("type",r)):i&&(s.textContent=i),s}static on(t,e,a){t.addEventListener(e,a,!1)}static off(t,e,a){t.removeEventListener(e,a,!1)}static append(t,e){t.appendChild(e)}static insertFirst(t,e){t.hasChildNodes()?t.insertBefore(e,t.childNodes[0]):t.appendChild(e)}static getBodyElm(){return document.getElementsByTagName("body")[0]}static attachBody(t){document.getElementsByTagName("body")[0].appendChild(t)}static detacthBodyById(t){const e=documet.getElementById(t);document.getElementsByTagName("body")[0].removeChild(e)}static removeChild(t){t.parentNode.removeChild(t)}static remove(t){const e=documet.getElementById(t);e.parentNode&&e.parentNode.removeChild(e)}static removeChildren(t){const e=documet.getElementById(t);for(;e.firstChild;)e.removeChild(e.firstChild)}static setStyles(t,e){for(let a in e)t.style[a]=e[a]}static text(t,e){t.textContent=e}static emit(t,e,a=!0,i=!0){const r=document.createEvent("HTMLEvents");return r.initEvent(e,a,i),t.dispatchEvent(r)}}var r=a(2),s=a.n(r),n=a(3),o=a.n(n),l=a(4),c=a.n(l),h=a(5),d=a.n(h),u=a(6),p=a.n(u),g=a(7),m=a.n(g),f=a(8),y=a.n(f),w=a(9),b=a.n(w);let v=a(19);console.log(v);const A=y.a,x=(b.a,v.init([s.a,o.a,c.a,d.a,p.a,m.a])),P=[];class D{static addBaseCLassese(t){if(t)if(Array.isArray(t))for(let e of t)P.push(e);else P.push(t)}static deepClone(t){const e=new MessageChannel,a=e.port1,i=e.port2;return new Promise(e=>{a.onmessage=(t=>{e(t.data)}),i.postMessage(t)})}static simpleDeepCloneSerialized(t){return JSON.parse(JSON.stringify(t))}static simpleDeepClone(t,e,a=0){const i=a+1,r=e||(Array.isArray(t)?[]:{});if(i>10)return console.log(t),console.log(i),r;for(let e in t){const a=t[e];if(a&&"object"==typeof a&&!a.byteLength){let t=null;for(let e of P)if(a instanceof e){t=new e;break}r[e]=D.simpleDeepClone(a,t,i)}else try{r[e]=a}catch(t){throw console.log(t),console.log(r),t}}return r}static singleDeepClone(t){const e={};for(let a in t){let i=t[a];e[a]=i}return e}static singleDeepCloneWithoutFuncs(t){const e={};for(let a in t){let i=t[a];"function"!=typeof i&&(e[a]=i)}return e}static deepVnodeClone(t){if(!t)return t;const e={sel:t.sel,data:D.simpleDeepClone(t.data),children:void 0,text:t.text,elm:t.elm,key:t.key};for(let a in t.data)t.data[a]&&(e.data[a]=t.data[a]);if(t.children&&t.children.length>0){e.children=[];for(let a of t.children)e.children.push(D.deepVnodeClone(a))}return e}}class B{constructor(){this.selectorMap=new Map}getElementById(t,e){let a=this.getElements(t,"#"+e);return a.length<1?null:a[0]}getElementsByClass(t,e){return this.getElements(t,"."+e)}patch(t,e,a){if(!a&&"string"==typeof e)return console.log("patch00a ★ERROR★ of Patch newNode:"+a+"/selector:"+e),t;if(!a){this.isValidNode(t,"vnode");x(t,e);return e}if(!e){this.isValidNode(t,"vnode");x(t,a);return a}const i=this.prePatch(t,e,a);x(t,i),this.getElements(i,e,!1,new Map,null);return this.isValidNode(i,"cloneNode"),i}isValidNode(t,e,a,i){if(t){if(t.elm&&!t.elm.parentNode){if(a){a.childNodes.length>i?t.elm=a.childNodes[i]:a.appendChild(t.elm)}}else if(!t.elm&&a){const e=a.childNodes.length;e>i?t.elm=a.childNodes[i]:console.log("★★★invalid parent index!"+i+"/length:"+e+"/vnode.sel:"+t.sel)}if(t.children)for(let a in t.children){let i=t.children[a];i&&this.isValidNode(i,e+"_c_",t.elm?t.elm.parentNode:null,a)}}else console.log("★★null node!"+e+"/parentNode:"+a)}prePatch(t,e,a){const i=D.deepVnodeClone(t),r=new Map,s=this.getElements(i,e,!1,r,null);let n=!1;for(let t of s){let e=D.deepVnodeClone(a);for(let[a,i]of r)if(a===t){let a=i.children;for(let i in a){if(a[i]===t){a[i]=e,n=!0;break}}break}}return n?i:t}getElements(t,e,a=!1,i=new Map,r){let s=[];if(!e||"string"!=typeof e)return s;let n=e.split(/ |>/),o=e;if(n.length>=1){let l=n.shift();if(!l)return s;if(this.isMatch(t.sel,l)){if(n.length<1)return s.push(t),r&&i.set(t,r),s;o=e.substring(l.length+1,e.length)}else{if(a)return s;o=e}if(!t.children)return s;let c=">"===e.substring(l.length,l.length+1);for(let e of t.children)s=s.concat(this.getElements(e,o,c,i,t))}return s}getSelectorMap(t){let e=this.selectorMap.get(t);if(e)return e;if(e=new Map,!t)return e;const a=t.split(/\.|#/g),i=t.indexOf("#")>=0?t.split(/#/g)[1].split(/\./g)[0]:"",r=[];let s="",n="";for(let e of a)i===e?s=e:t.indexOf("."+e)>=0?r.push(e):n=e;return e.set("id",s),e.set("class",r),e.set("tag",n),this.selectorMap.set(t,e),e}isMatch(t,e){const a=this.getSelectorMap(t),i=this.getSelectorMap(e),r=i.get("tag"),s=i.get("id");if(""!==r&&a.get("tag")!==r)return!1;if(""!==s&&a.get("id")!==s)return!1;const n=a.get("class"),o=i.get("class");for(let t of o){let e=!1;for(let a of n)t===a&&(e=!0);if(!1===e)return!1}return""!==e}}const S=["Attach"];class k{constructor(){}static getBaseActions(){return S}static createAction(t,e,a=null){return{type:t,data:e,storeKey:a}}static createBaseAction(t,e,a,i=null){const r=a&&"object"==typeof a?a:{};return r.targetView=e,r.selector=e?e.id:null,r.storeKey=i,{type:t,data:r}}static creatAttachAction(t,e,a,i=null){const r=a&&"object"==typeof a?a:{};return r.parentView=t,r.selector=e.id,r.storeKey=i,{type:"Attach",data:r}}static createShowViewAction(t,e,a,i,r=null){return k.createGoOtherViewAction(t,null,e,a,i,r)}static createGoOtherViewAction(t,e,a,i,r,s=null){let n=r;return e||a?(r||(n={}),n.view=e,n.oldVnode=a,n.selector=i,{type:t,data:n,storeKey:s}):(console.log("createGoOtherViewAction is null!"),{type:t,data:n,storeKey:s})}static isEquals(t,e){return!(!t||!e||t.type!==e.type)}}const E={},I=[];class N{constructor(){this.queue=[]}addActiveView(t,e,a){const i=t.id,r=e.id,s=this.findActivViews(E,i);if(s&&s.primaryView){const t=s[r];t&&t.primaryView?(t.primaryView=e,t.parent=s):a?(a.parent=s,s[r]=a):s[r]={primaryView:e,parent:s}}else E[r]=a||{primaryView:e,parent:E};this.loadAllActiveViews()}changeActiveView(t,e,a){const i=t.id,r=this.findActivViews(E,i);if(!r)return;const s=r.parent;delete s[i];const n=e.id;return a&&a.primaryView?(s[n]=a,a.primaryView=e,a.parent=s):s[n]={primaryView:e,parent:s},this.loadAllActiveViews(),r}removeActiveView(t){const e=t.id,a=this.findActivViews(E,e);if(a)return delete a.parent[e],this.loadAllActiveViews(),a}findActivViews(t,e,a,i){let r=null;const s=i?i+1:1;if(s>5)return null;if(t)for(let i in t){if(void 0===i||"undefined"===i||"parent"===i||"primaryView"===i)continue;const n=t[i];n.primaryView&&n.parent&&(a&&a(n),i===e?r=n:n&&"view"!==i&&"0"!==i&&(r=this.findActivViews(n,e,a,s)))}return r}loadAllActiveViews(){const t=[];this.findActivViews(E,"all",e=>{t.push(e)});const e=I.length;for(let t=0;t<e;t++)I.pop();for(let e of t)e.primaryView&&e.parent&&I.push(e.primaryView);return I}getActiveViewList(){return I}}const O=new Map,K="aaa";class L{constructor(t){}static getStore(t){const e=t||K,a=O.has(e)?O.get(e):null,i=a?D.simpleDeepClone(a):{};return i.oldVnode=a?a.oldVnode:null,i}static setStore(t,e){const a=e||K,i=t?D.simpleDeepClone(t):{};i.oldVnode=t?t.oldVnode:null,O.set(a,i)}}const C=new N,R=new Map;class M{constructor(t){this.view=t,this.updateMap=new Map,this.updateQueue=[]}static add(t,e){if(!t)return!1;const a=t.type;if(!a)return!1;if(R.has(a)){const t=R.get(a);if(t.includes(e))return!1;t.push(e)}else R.set(a,[e]);return!0}static remove(t){const e=t.type;if(!e)return!1;if(R.has(e)){const t=R.get(e);if(t.includes(reducer))return!1;{const e=t.indexof(reducer);t.splice(e,1)}}return!0}async dispatch(t){const e=t.type;if(!e)return!1;const a=t.data,i=t.storeKey;let r=L.getStore(i),s=this.view;if(R.has(e)){const a=R.get(e);for(let e of a)await e.preReduce(r,t).catch(t=>{console.log(t)}),await e.reduce(r,t).catch(t=>{console.log(t)}),await e.postReduce(r,t).catch(t=>{console.log(t)});L.setStore(r)}L.getStore(i);if(r.isOrverride&&t.data.view){if(s=t.data.views,!1===this.view.onViewHide(s,a))return;this.callUpdate(s,a,i),this.view.onViewHidden(s,a)}else this.callUpdate(s,a,i);return!0}callUpdate(t,e,a){const i=C.getActiveViewList();for(let r of i){const i=L.getStore(a);if(t===r){const a=t.updateReactiveTheTargetView(i,e);if(a){if(!a.then)return void alert("your view has override method name 'updateReactiveTheTargetView'! activeView.id):"+r.id);a.then(()=>{},t=>{console.log(t)})}else console.log(r)}else{const t=r.updateReactive(i,e);if(t){if(!t.then)return void alert("your view has override method name 'updateReactive'! activeView.id):"+r.id);t.then(()=>{},t=>{console.log(t)})}}}}}class T{constructor(){}static create(t){return new M(t)}static createStandAlone(){return new M(!1)}}const V=(t,e)=>{let a={};t&&"object"==typeof t?(t.props||(t.props={}),a=t):a={props:{}};for(let t in e)a.props[t]=e[t];return a},F=(t,e,a,i={},r,s)=>{const n=t+(e&&"string"==typeof e?"#"+e:"")+(a?Array.isArray(a)&&a.length>0&&"string"==typeof a[0]?"."+a.join("."):Array.isArray(e)&&e.length>0&&"string"==typeof e[0]?"."+e.join("."):"":""),o=r&&Array.isArray(r)?r:i&&Array.isArray(i)?i:Array.isArray(a)&&a.length>0&&"object"==typeof a[0]?a:[],l=s||(r&&"string"==typeof r?r:i&&"string"==typeof i?i:a&&"string"==typeof a?a:"");let c="string"==typeof i||Array.isArray(i)?{}:i;void 0!==r&&void 0===s&&a&&!Array.isArray(a)&&"object"==typeof a?c=a:void 0===r&&void 0===s&&e&&!Array.isArray(e)&&"object"==typeof e&&(c=e);Object.prototype.toString;const h=o.length>0?o:l;return A(n,c,h)},_=(t,e,a,i,r)=>F("div",t,e,a,i,r),U=(t,e,a,i,r)=>F("span",t,e,a,i,r),z=(t,e,a,i,r)=>F("img",t,e,V(r,{alt:a,src:i}),null,null),j=(t,e,a,i,r)=>F("input",t,e,V(a,{type:"file"}),null,r),Z=(t,e,a,i,r)=>F("input",t,e,V(a,{type:i,value:r}),null,r),W=(t,e,a,i)=>F("input",t,e,V(a,{type:"checkbox",value:i}),null,i),X=(t,e,a,i,r)=>F("label",t,e,a,i,r),Y=(t,e,a,i,r)=>F("option",t,e,a,i,r),G=(t,e,a,i,r,s,n="")=>{const o=[],l=Array.isArray(i);for(let t in i){const e=i[t];if(!l&&t===r||l&&e+""==r+""){const a=Y("",[""],{attrs:{value:l?e:t,selected:"true"}},e+n);o.push(a)}else{const a=Y("",[""],{attrs:{value:l?e:t}},e+n);o.push(a)}}const c={props:{name:a}};return s&&(c.on=s),((t,e,a,i,r)=>F("select",t,e,a,i,r))(t,e,c,o)};class H{constructor(){}static getGotoAnotherViewAction(t,e,a){return t||console.log("getGotoAnotherViewAction view:"+t),k.createGoOtherViewAction("GotoAnotherView",t,null,e,a)}static getShowViewAction(t,e,a){return t||console.log("getShowViewAction oldVnode:"+t),k.createShowViewAction("ShowView",t,e,a)}}class q{constructor(t){if(this.isBaseUse=t,t){const t=k.getBaseActions();for(let e in t){const a=t[e];this.atatch({type:a})}}}atatch(t){M.add(t,this)}detach(t){M.delete(t,this)}async preReduce(t,e){return t.isOrverride=!1,t}async reduce(t,e){return t.isOrverride=!0,t.oldVnode=e.data.oldVnode,t.selector="#"+e.data.selector,t}async postReduce(t,e){return t}}new q(!0);new class extends q{constructor(){super(),this.atatch(H.getGotoAnotherViewAction()),this.atatch(H.getShowViewAction())}async reduce(t,e){return k.isEquals(H.getGotoAnotherViewAction(),e)||k.isEquals(H.getShowViewAction(),e)&&(t.isOrverride=!0,t.oldVnode=e.data.oldVnode,t.selector="#"+e.data.selector),t}};const J=new N,$={rootVnode:null,ms:null};class Q{constructor(t,e,a=!1){this.dispatcher=T.create(this),this.id=t,this.className=e,this.isNotRenderWrap=a,this.ms=$.ms,this.es=new B;const i=L.getStore();this.onViewLoad(i),this.currentVnode=null,this.onViewLoaded(i),this.updateReactiveCallCount=0,this.updateReactiveCallTimer=null,this.updateCount=0}static setRootVnode(t){$.rootVnode=t}static setMainService(t){t&&($.ms=t)}patch(t,e){return this.patchFromOtherVnode($.rootVnode,t,e)}initialPatch(){document.getElementsByTagName("body")[0].innerHTML='<div id="rootNodeA"><p>ｘ</p></div>';let t=document.getElementById("rootNodeA");this.updateCount<1&&(this.patchFromOtherVnode(t,null,this.render()),this.updateReactiveTheTargetView({oldVnode:this.currentVnode,selector:null,isOrverride:!0}).catch(t=>{console.log(t)}))}patchFromOtherVnode(t,e,a){let i=null!==e?$.rootVnode:t;const r=this.es.patch(i,e,a);return r.data.name=this.name+Date.now(),$.rootVnode=r,this.currentVnode=this.es.getElements(r,"#"+this.id)[0],r}prePatch(t,e){return this.currentVnode||(this.currentVnode=this.es.getElements($.rootVnode,"#"+this.id)[0]),this.currentVnode||console.log("!!!!prePatch nodeFrame.rootVnode: "+JSON.stringify($.rootVnode)),this.currentVnode.data.name=this.name+Date.now(),this.currentVnode=this.es.prePatch(this.currentVnode,t,e),this.currentVnode}async updateReactiveTheTargetView(t,e){const a=t.oldVnode,i=t.selector,r=t.isOrverride;console.log("A00 update --oldVnode:"+a+"/isOrverride="+r+"/selector="+i+"/this.currentVnode:"+this.currentVnode+"/"+typeof this.currentVnode),r?(this.onPreViewBuild(a,t),this.currentVnode=this.currentVnode?this.currentVnode:this.renderWrap(t)):this.currentVnode=this.es.getElements($.rootVnode,"#"+this.id)[0],await this.onViewShow(t,e).catch(t=>{console.log(t)}),r?a?this.patchFromOtherVnode(a,i,this.currentVnode):this.patchFromOtherVnode(null,"#"+this.id,this.currentVnode):this.patch("#"+this.id,this.currentVnode),this.updateCount++,this.updateCount<=2?(this.updateCount++,this.onAfterAttachWrap(t,e)):setTimeout(()=>{this.updateCount=0},2e3),await this.onViewShown(t,e).catch(t=>{console.log(t)})}async updateReactive(t,e){this.updateReactiveCallTimer&&clearTimeout(this.updateReactiveCallTimer),this.updateReactiveCallTimer=setTimeout(async()=>{const a=t.oldVnode,i=t.selector,r=t.isOrverride;this.currentVnode=this.es.getElements($.rootVnode,"#"+this.id)[0],console.log("A0101 --oldVnode:"+a+"/isOrverride="+r+"/selector="+i+"/id:"+this.id),await this.onViewShow(t,e).catch(t=>{console.log(t)}),this.patch("#"+this.id,this.currentVnode),await this.onViewShown(t,e).catch(t=>{console.log(t)})})}init(){}attach(t=this.parentView,e,a){this.parentView=t;let i=e;if(e||(console.warn("★attach selector is null :"+e+"/this.id:"+this.id),i=this.id),this.isAttached())return void alert("attached!!!");const r=L.getStore();this.onPreViewBuild(r),this.activeViewTree=J.addActiveView(t,this,this.activeViewTree),console.log("A08---attach ==selector:"+i+"/parentView:"+t.id+"/this.id:"+this.id);const s=k.creatAttachAction(t,this,a);this.dispatch(s)}isAttached(){return this.es.getElements($.rootVnode,"#"+this.id)[0]===this.currentVnode}dispatch(t){this.dispatcher.dispatch(t)}getElementById(t){const e=this.es.getElements(this.currentVnode,"#"+t);return e&&e.length>0?e[0]:null}onAfterAttachWrap(t,e){this.updateCount>2||this.onAfterAttach(t,e)}onAfterAttach(t,e){this.currentVnode}changeAnotherView(t,e,a){this.onViewHide(a,store,actionData);const i=k.creatAttachAction(t,this,data);this.dispatch(i),this.onViewHidden(a,store,actionData)}onViewLoad(t,e){console.log("m001 baseView.onViewLoad name:"+name+"/actionData:"+e+"/this.id:"+this.id)}onViewLoaded(t,e){console.log("m002 baseView.onViewLoaded name:"+name+"/actionData:"+e+"/this.id:"+this.id)}onPreViewBuild(t,e){console.log("m003a baseView.onPreViewBuild store:"+t+"/actionData:"+e+"/this.id:"+this.id)}async onViewShow(t,e){console.log("m003-- baseView.onViewShow newNode:/store:"+t+"/this.id:"+this.id)}async onViewShown(t,e){console.log("m004-- baseView.onViewShown newNode:/store:"+t+"/this.id:"+this.id)}async onViewHide(t,e,a){return console.log("m005 baseView.onViewHide nextView:"+t+"/actionData:"+a+"/this.id:"+this.id),!0}async onViewHidden(t,e,a){console.log("m006 baseView.onViewHidden nextView:"+t+"/actionData:"+a+"/this.id:"+this.id)}render(){return i.create("BaseView","BaseView")}renderWrap(t,e){return this.isNotRenderWrap?this.render(t,e):_(this.id,[this.className],{},[this.render(t,e)])}getAnker(){return this.elm}}class tt extends Q{constructor(t){super("header","header"),this.titleText=t}render(){return _("aaa",{style:{color:"#000"}},[_("title",["title"],this.titleText)])}}class et extends Q{constructor(){super("menu","Menu"),this.text="Menu",this.menuButtonClass="MenuButton",this.selected="",this.idOfStep0="step0",this.idOfStep1="step1",this.idOfStep2="step2",this.idOfStep3="step3",this.idOfStep4="step4"}render(){return _(this.id+"Frame",["MenuFrame"],this.createButtons())}onClick(t){return e=>{alert("onClick id:"+t)}}createButtons(){const t=[];return t.push(_("",[this.menuButtonClass],{on:{click:this.onClick(this.idOfStep0)}},"Step0 Select or New")),t.push(_("",[this.menuButtonClass],{on:{click:this.onClick(this.idOfStep1)}},"Step1 Work Setting")),t.push(_("",[this.menuButtonClass],{on:{click:this.onClick(this.idOfStep2)}},"Step2 Select Files")),t.push(_("",[this.menuButtonClass],{on:{click:this.onClick(this.idOfStep3)}},"Step3 Export")),t.push(_("",[this.menuButtonClass],{on:{click:this.onClick(this.idOfStep4)}},"Step4 Pref")),t}}class at{constructor(){}static creatAddAction(t,e,a=null){return k.createBaseAction("addProgressBar",t,e,a)}static creatRemoveAction(t,e,a=null){return k.createBaseAction("removeProgressBar",t,e,a)}static creatUpdateAction(t,e,a=null){return k.createBaseAction("updateProgressBar",t,e,a)}static creatCompleatAction(t,e,a=null){return k.createBaseAction("compleatProgressBar",t,e,a)}}var it={dbName:"CopiBon",ua:navigator.userAgent.replace(/[\.0-9]+/g,"x"),domain:window.location};class rt{static currentTables(t,e){return e||[t]}static isMutch(t,e){if(void 0===e||null===e)return!1;if(Array.isArray(e)){for(let a of e)if(rt.isMutch(t,a))return!0;return!1}for(let a in e){let i=e[a];if("object"==typeof i){if(rt.isMutch(t,i))return!0}else{if(t[a]!==i)return!1}}return!0}static makeKeyRange(t,e,a,i){return void 0===a&&void 0===i?IDBKeyRange.bound(t,e,!1,!1):IDBKeyRange.bound(t,e,a,i)}static makeKeyRangeUpper(t,e){return!0!==e?IDBKeyRange.upperBound(t):IDBKeyRange.upperBound(t,e)}static makeKeyRangeLower(t,e){return!0!==isNotEqualStart?KeyRange.lowerBound(t):IDBKeyRange.lowerBound(t,e)}static makeKeyRangeOnly(t){return!0!==isNotEqualStart?IDBKeyRange.only(t):IDBKeyRange.lowerBound(end,isNotEqualEnd)}static buildKeyPath(t,e,a,i,r){let s=[];return void 0!==t&&s.push((t+"").split("&").join("&amp;").split(".").join("&#046;")),void 0!==e&&s.push((e+"").split("&").join("&amp;").split(".").join("&#046;")),void 0!==a&&s.push((a+"").split("&").join("&amp;").split(".").join("&#046;")),void 0!==i&&s.push((i+"").split("&").join("&amp;").split(".").join("&#046;")),void 0!==r&&s.push((r+"").split("&").join("&amp;").split(".").join("&#046;")),s.join("")}}const st="readonly",nt="readwrite";class ot{constructor(t){this.IDBKeyRange=window.IDBKeyRange,this.indexedDB=window.indexedDB,this.dbName=t,this.keyPathMap={}}getOpenDB(t){return new Promise((e,a)=>{let i=this.indexedDB.open(this.dbName,t);i.onsuccess=(t=>{e(t.target.result)}),i.onupgradeneeded=(t=>{e(t.target.result)}),i.onabort=(t=>{e(t)}),i.onerror=(t=>{a(t)})})}getObjectStore(t,e,a,i){let r=t.transaction(a,i);return r.oncomplete=(e=>{t.close()}),r.onerror=(e=>{t.close()}),r.objectStore(e)}throwNewError(t){return e=>{throw e.stack?console.log(e.stack):console.log(e.message,e),console.error(t||"/"+e),new Error(e)}}getKeyPathByMap(t){return this.keyPathMap[t]}async getKeyPath(t){let e=this.keyPathMap[t];if(void 0!==e&&null!==e)return e;const a=await this.getOpenDB().catch(this.throwNewError("getKeyPath->getOpenDB"));let i=this.getObjectStore(a,t,[t],st);a.close();let r=i.keyPath;return this.keyPathMap[t]=r,r}async getCurrentVersion(){let t=await this.getOpenDB().catch(this.throwNewError("getCurrentVersion->getOpenDB"));const e=t.version;return t.close(),e}async selectAll(t){let{tableName:e,range:a,condetions:i}=t;return await this._selectAll(e,a,i)}async _selectAll(t,e,a){const i=await this.getOpenDB().catch(this.throwNewError("_selectAll->getOpenDB tableName:"+t));let r=this.getObjectStore(i,t,[t],st);return await this._selectAllExecute(r,e)}_selectAllExecute(t,e,a){return new Promise((i,r)=>{const s=[];let n=void 0===e?t.openCursor():t.openCursor(e);n.onsuccess=(t=>{let e=t.target.result;if(e){if(s.push(e.value),a)return void i(s[0]);e.continue()}else i(s)}),n.onerror=(t=>{r(t)})})}async selectByKey(t){let{tableName:e,key:a}=t;return await this._selectByKey(e,a)}async _selectByKey(t,e){const a=await this.getOpenDB().catch(this.throwNewError("_selectByKey->getOpenDB tableName:"+t));return console.log("_selectByKey tableName:"+t+"/pk:"+e),console.log(e),await this._selectByKeyOnTran(a,t,e).catch(this.throwNewError("_selectByKey->_selectByKeyOnTran tableName:"+t))}_selectByKeyOnTran(t,e,a,i){return new Promise((i,r)=>{let s=this.getObjectStore(t,e,[e],st).get(a);s.onsuccess=(t=>{i(s.result)}),s.onerror=(t=>{r(t)})})}async selectFirstOne(t){let{tableName:e,range:a,direction:i}=t;return await this._selectFirstOne(e,a,i)}async _selectFirstOne(t,e,a){const i=await this.getOpenDB().catch(this.throwNewError("_selectFirstOne->getOpenDB tableName:"+t));let r=this.getObjectStore(i,t,[t],st);return await this._selectAllExecute(r,e,!0)}async insertUpdate(t){let{tableName:e,data:a,callback:i}=t;const r=this.getKeyPathByMap();return await this._insertUpdate(e,r,a,i).catch(this.throwNewError("insertUpdate->_insertUpdate tableName:"+e))}async _insertUpdate(t,e,a,i){const r=a[e],s=await this.getOpenDB().catch(this.throwNewError("_insertUpdate->getOpenDB tableName:"+t)),n=rt.currentTables(t),o=await this._selectByKeyOnTran(s,t,r,n).catch(this.throwNewError("_insertUpdate->_selectByKeyOnTran tableName:"+t));return i&&i(o,a),void 0===o?await this._insertExecute(s,t,r,a,n).catch(this.throwNewError("_insertUpdate->_insertExecute tableName:"+t)):await this._updateExecute(s,t,r,a,n).catch(this.throwNewError("_insertUpdate->_updateExecute tableName:"+t))}_insertExecute(t,e,a,i,r){let s=this.getObjectStore(t,e,r,nt);return new Promise((t,e)=>{let r=s.add(i);r.onsuccess=(e=>{t({data:i,key:a})}),r.onerror=(t=>{e(t)})})}_updateExecute(t,e,a,i,r){return new Promise((s,n)=>{let o=this.getObjectStore(t,e,r,nt).put(i);o.onsuccess=(t=>{s({data:i,key:a})}),o.onerror=(t=>{s(t)})})}async deleteWithRange(t){let{tableName:e,range:a,condetions:i}=t;return await this._deleteWithRange(e,a,i)}async _deleteWithRange(t,e,a){const i=await this.getOpenDB().catch(this.throwNewError("_deleteWithRange->getOpenDB tableName:"+t)),r=rt.currentTables(t);return await this._deleteWithRangeExecute(i,t,e,a,r)}_deleteWithRangeExecute(t,e,a,i,r){return new Promise((s,n)=>{let o=this.getObjectStore(t,e,r,nt),l=o.openCursor(a);l.onsuccess=(t=>{let e=t.target.result,a=[];if(e){let t=e.value;if(rt.isMutch(t,i)){let i=o.delete(e.key);i.onsuccess=(e=>{a.push(t)}),i.onerror=(t=>{})}e.continue()}else s(a)}),l.onerror=(t=>{n(t)})})}async delete(t){let{tableName:e,key:a}=t;return await this._delete(e,a)}async _delete(t,e){const a=await this.getOpenDB().catch(this.throwNewError("_delete->getOpenDB tableName:"+t)),i=rt.currentTables(t);return await this._deleteOnTran(a,t,e,i)}_deleteOnTran(t,e,a,i){return new Promise((r,s)=>{let n=this.getObjectStore(t,e,i,nt).delete(a+"");n.onsuccess=(t=>{r({tableName:e,key:a})}),n.onerror=(t=>{s(t)})})}async truncate(t){let{tableName:e}=t;return await this._truncate(e)}async _truncate(t){const e=await this.getOpenDB().catch(this.throwNewError("_truncate->getOpenDB tableName:"+t)),a=rt.currentTables(t);return await this._truncateExecute(e,t,a)}_truncateExecute(t,e,a){return new Promise((i,r)=>{let s=this.getObjectStore(t,e,a,nt).clear();s.onsuccess=(t=>{i()}),s.onerror=(t=>{r(t)})})}async getObjectStoreNames(){const t=await this.getOpenDB().catch(this.throwNewError("getObjectStoreNames->getOpenDB")),e=t.objectStoreNames;return t.close(),e}async isExistsObjectStore(t){const e=await this.getOpenDB().catch(this.throwNewError("isExistsObjectStore->getOpenDB tableName:"+t));let a=!1;for(let i of e.objectStoreNames)if(i===t){a=!0;break}return e.close(),a}async createStore(t){let{tableName:e,keyPathName:a,isAutoIncrement:i}=t;return await this._createStore(e,a,i)}async _createStore(t,e,a){if(!1===await this.isExistsObjectStore()){const a=await this.getCurrentVersion()+1,i=await this.getOpenDB(a).catch(this.throwNewError("_createStore->getOpenDB tableName:"+t));let r=!1;for(let e of i.objectStoreNames)if(e===t){r=!0;break}if(!1===r){i.createObjectStore(t,{keyPath:e})}i.close()}}async dropStore(t){let{tableName:e}=t;return await this._dropStore(e)}async _dropStore(t){const e=await this.getCurrentVersion()+1,a=await this.getOpenDB(e).catch(this.throwNewError("_dropStore->getOpenDB tableName:"+t));a.deleteObjectStore(t),a.close()}}class lt{constructor(t,e="pk"){void 0===it.idbh&&(it.idbh=new ot(it.dbName)),this.idbh=it.idbh,this.keyPathName=e,this.objectStoreName=t}init(){return new Promise((t,e)=>{this.idbh._createStore(this.objectStoreName,this.keyPathName).then(()=>{t(!0)},t=>{throw e(t),t})})}isFished(){return new Promise((t,e)=>{this.firstPromise.then(()=>{t(!0)},t=>{throw t})})}async saveDataDefault(t,e,a){let i={pk:t,data:e};await this.saveData(i,void 0,a)}async saveData(t,e,a){let i=t;void 0===t[this.keyPathName]&&((i={data:t})[this.keyPathName]=e);await this.idbh._insertUpdate(this.objectStoreName,this.keyPathName,i,a)}async loadData(t){if(void 0!==t){return await this.idbh._selectByKey(this.objectStoreName,t)}return null}async loadDataDefault(t){let e=await this.loadData(t);return void 0===e||null===e?null:e.data}async loadAllData(){return await this.idbh._selectAll(this.objectStoreName)}async deleteData(t){return void 0!==t?await this.idbh._delete(this.objectStoreName,t):null}async getOsNames(){return await this.idbh.getObjectStoreNames()}}const ct="default",ht=new Map;class dt{constructor(t){this.entityClass=t,this.targetObj="string"==typeof t?t:new t,this.idbAccessor=null,this.entityName=this.targetObj.getEntityName?this.targetObj.getEntityName():t}getStoreNameKey(t=ct){return t+"_"+this.targetObj.getEntityName()}async createStore(t=ct){const e=this.getStoreNameKey(t);return await this.createStoreByName(e,t)}async createStoreByName(t,e=ct){const a=ht.has(t)?ht.get(t):new lt(t);return await a.init().catch(t=>{console.log(t)}),ht.set(t,a),this.idbAccessor=a,a}async setStore(t=ct){this.idbAccessor=await this.createStore(t)}async save(t,e){let a=e;return e.toObj&&(a=e.toObj()),await this.idbAccessor.saveDataDefault(t,a),e}async loadAll(){const t=await this.idbAccessor.loadAllData(),e=[];for(let a of t){const t=this.getEntity(a);e.push(t)}return e}async get(t){const e=t&&t.pk?t.pk:t,a=await this.idbAccessor.loadData(e);return this.getEntity(a)}getEntity(t){if(!t||!t.data)return t;if(t.data&&!this.targetObj.getEntityName)return t.data;const e=new this.entityClass;return e.load(t.data),e}async delete(t){return await this.idbAccessor.deleteData(t)}}class ut{constructor(t="BaseEntity",e="oid"){this.pk=e,this.entitiyName=t,this.refs=[]}isEntitiy(){return!0}getEntityName(){return this.entitiyName}create(){}update(){}setPk(t){return this[this.pk]=t}getPk(){return this[this.pk]}include(t){console.log("!=======BaseEntity.include====================!!")}exclude(t){console.log("!=======BaseEntity.exclude====================!!")}async deepClone(){return await D.deepClone(this)}load(t){for(let e in t)this[e]=t[e]}toObj(){let t=D.singleDeepCloneWithoutFuncs(this);return delete t.pk,delete t.refs,this.exclude(t),t}}class pt extends ut{constructor(t){super("Binary"),this._ab=t,this.createDate=Date.now(),this.updateDate=Date.now()}set ab(t){buffer&&!buffer.byteLength&&alert("not arrayBuffer!"),this._ab=t}get ab(){return this._ab}load(t){super.load(t),this._ab=new Uint8Array(this._ab).buffer}create(){return new pt}}const gt="-";class mt{constructor(t){this.pk=t}static getDelimiter(){return"-"}static assemblePK(t,e){return t.getEntityName()+gt+e}static isPrimaryKey(t){return t&&"string"==typeof t&&2===t.split(gt).length}static getPrimaryKey(t){return t?mt.isPrimaryKey(t)?t:t.getEntityName&&t.getPk?t.getPk():t.oid?t.oid:t.pk?t.pk:null:t}static getEntityName(t){return mt.getPrimaryKey(t).split(gt)[0]}}class ft{static binaryString2ArrayBuffer(t){return ft.binaryString2Uint8Array(t).buffer}static arrayBuffer2BinaryString(t){return ft.uint8Array2BinaryString(new Uint8Array(t))}static arrayBuffer2base64(t){return btoa(ft.uint8Array2BinaryString(new Uint8Array(t)))}static arrayBuffer2DataURI(t,e="application/octet-stream"){return"data:"+e+";base64,"+btoa(ft.arrayBuffer2BinaryString(t))}static binaryString2Uint8Array(t){t.split("");const e=t.length,a=new Uint8Array(new ArrayBuffer(e));for(let i=0;i<e;i++)a[i]=t.charCodeAt(i);return a}static uint8Array2BinaryString(t){let e=[];for(let a of t)e.push(String.fromCharCode(a));return e.join("")}static binaryString2DataURI(t,e="application/octet-stream"){return"data:"+e+";base64,"+btoa(t)}static base642DataURI(t,e="application/octet-stream"){return"data:"+e+";base64,"+t}static base642binaryString(t){return atob(t)}static base642ArrayBuffer(t){return ft.binaryString2ArrayBuffer(atob(t))}static dataURI2BinaryString(t){return atob(t.split(",")[1])}static dataURI2ArrayBuffer(t){return ft.binaryString2Uint8Array(atob(t.split(",")[1])).buffer}static uintArray2ArrayBuffer(t){return t.buffer}static arrayBuffer2Uint8Array(t){return new Uint8Array(t)}static arrayBuffer2Uint16Array(t){return new Uint16Array(t)}static arrayBuffer2Uint32Array(t){return new Uint32Array(t)}static ArrayBuffer2Blob(t,e="application/octet-stream"){return new Blob([t],{type:e})}static readBlob(t){const e=new FileReader,a=new Promise((t,a)=>{e.onload=(a=>{t(e.result)}),e.onerror=(t=>{a(e.error)})});return{asArrayBuffer:()=>(e.readAsArrayBuffer(t),a),asBinaryString:()=>(e.readAsBinaryString(t),a),asDataURL:()=>(e.readAsDataURL(t),a),asText:()=>(e.readAsText(t),a)}}}const yt="default",wt="pk_increment",bt="pk_row";class vt{constructor(t){this.ss=new dt(t+"_"+wt)}async acquirePKNo(t=yt,e,a=bt){e.getEntityName();await this.ss.createStoreByName(t+"_"+wt,t);let i=await this.ss.get(a),r=this.countUpUint32(i?i.data:0);i||(i={data:r});let{data:s,keyPath:n}=await this.ss.save(a,i,(t,e)=>{let a=this.countUpUint32(e.data);t.data=a});return ft.arrayBuffer2base64(s)}countUpUint32(t){let e=t;e||(e=new ArrayBuffer(4)),e.data&&(e=e.data);let a=new DataView(e),i=0|a.getUint32(0);return i++,a.setInt32(0,i>>>0),a.buffer}}const At="default",xt="BINALY_PK_ROW",Pt=new pt;class Dt{constructor(t,e,a=At){this.userId=a,this.entityClass=e,this.entity=new e,this.entityName=this.entity.getEntityName(),this.ss=new dt(e),this.pkais=new vt(a),this.em=t}async init(){return await this.ss.setStore(this.userId)}async save(t){return await this.saveExecute(t,!1)}async saveWithBinary(t){return await this.saveExecute(t,!0)}async saveExecute(t,e){if(!t||!t.getEntityName||!t.getPk||t.getEntityName()!==this.entityName)return void console.log("EntityManagerImpl save!!Z!! data:"+t.getEntityName()+"/this.entityName:"+this.entityName+"/data.getPk:"+t.getPk);let a=t.getPk();a||(a=mt.assemblePK(this.entity,await this.pkais.acquirePKNo(this.userId,this.entity))),e?(console.log("EntityManagerImpl saveBinary!!A!! data:"+t+"/isWithBinary:"+e),console.log(t),console.log("EntityManagerImpl saveBinary!!B!! data:"+t+"/isWithBinary:"+e)):await this.saveArrayBufferCols(t),t.setPk(a),console.log(t);const i=await this.ss.save(a,t);return console.log("EntityManagerImpl save!!B!! savedData:"+i),i}async saveArrayBufferCols(t){if(Pt.getEntityName()!==t.getEntityName()){console.log("saveArrayBufferCols save!!A!! data:"+t),console.log(t),console.log("saveArrayBufferCols save!!B!! data:"+t);for(let e in t){const a=t[e];if(a)if(Array.isArray(a))for(let t of a){const e=a[t];if(!e||e.byteLength)continue;const i=await this.saveArrayBufferData(e);a[t]=new mt(i)}else if(a.byteLength){const i=await this.saveArrayBufferData(a);t[e]=new mt(i)}}}}async saveArrayBufferData(t){if(console.log("saveArrayBufferData save!!A!! item:"+t),console.log(t),console.log("saveArrayBufferData save!!B!! item:"+t),!t.getEntityName&&t.byteLength){const e=new pt(t),a=await this.getBinaryPK();return e.setPk(a),console.log("saveArrayBufferData save!!C!! data:"+e),console.log(e),await this.em.Binary.saveWithBinary(e),a}if(t.getEntityName&&"PrimaryKey"===t.getEntityName())return t;if(t.getEntityName&&"Binary"===t.getEntityName()){const e=t.getPk();if(e)return t.setPk(e),console.log("saveArrayBufferData save!!D!! item:"+t),await this.em.Binary.saveWithBinary(t),e;{console.log("saveArrayBufferData save!!E!! item:"+t);const e=await this.getBinaryPK();return t.setPk(e),await this.em.Binary.saveWithBinary(t),e}}}async getBinaryPK(){const t=await this.pkais.acquirePKNo(this.userId,Pt,xt);return mt.assemblePK(Pt,t)}async loadAll(){return await this.ss.loadAll(this.entity)}async get(t){return await this.ss.get(t,this.entity)}async delete(t){return await this.ss.delete(t)}}const Bt="default";class St{constructor(){}async initAsNewUser(t,e=Bt){for(let a of t)await this.initParEntity(a,e);await this.initParEntity(pt,e)}async initParEntity(t,e){D.addBaseCLassese(t);const a=(new t).getEntityName();this[a]=new Dt(this,t,e),await this[a].init()}isPrimaryKey(t){return!(!t||"PrimaryKey"!==t.getEntityName())}async get(t){if(!t)return alert("pk:"+t),null;const e=mt.getPrimaryKey(t);if(!mt.isPrimaryKey(e))return console.log(e),null;const a=mt.getEntityName(e);return await this[a].get(e)}async delete(t){if(!t)return alert(t),null;const e=mt.getEntityName(t);return await this[e].delete(t)}}class kt{constructor(){}getIndigator(t){return!1==!!this.pb&&(this.pb=new me(t)),this.pb}}class Et extends ut{constructor(t,e,a){super("Title"),this.id=t,this.prefix=e,this.name=a,this.target="",this.no="",this.date="",this.pageNo=0,this.setting=null,this.series=null,this.pageNum=-1,this.images=[],this.pages=[],this.outputsPars=[],this.exports=[],this.direction="r2l",this.createDate=Date.now(),this.updateDate=Date.now(),this.listing=0}}class It extends ut{constructor(){super("Images"),this.name=null,this.binary=null,this.type=null,this.thumbnail=null,this.modifyDate=null,this.width=null,this.height=null,this.createDate=Date.now(),this.updateDate=Date.now(),this.listing=0}}class Nt extends ut{constructor(){super("Thumbnales"),this.name=null,this.binary=null,this.type=null,this.width=null,this.height=null,this.createDate=Date.now(),this.updateDate=Date.now(),this.listing=0}}class Ot extends ut{constructor(t){super("Series"),this.name=t,this.target=null,this.no="",this.date="",this.pageNo=0}}class Kt{constructor(){}static asc(t,e){const a=Kt.execute([{colName:e,isDESC:!1}]);t.sort(a)}static desc(t,e){const a=Kt.execute([{colName:e,isDESC:!0}]);t.sort(a)}static orderBy(t,e){const a=Kt.execute(e);t.sort(a)}static execute(t){return(e,a)=>{for(let i of t){const{colName:t,isDESC:r}=i;if(e===a)return 0;if(!e)return r?1:-1;if(!a)return r?-1:1;let s=e[t],n=a[t];if(s<n)return r?1:-1;if(s>n)return r?-1:1}return 0}}static thinningNullData(t){const e=[];for(let a in t){const i=t[a];null!==i&&void 0!==i&&e.push(i)}const a=t.length;for(let e=0;e<a;e++)t.pop();for(let a in e){const i=e[a];t.push(i)}}static typeof(){}}class Lt{constructor(){this.actionDispatcher=T.createStandAlone(),this.name="FileUploader",this.ms=ue.getInstance()}async readAsArrayBuffer(t){return await this.read(t,"ArrayBuffer")}async readAsBinaryString(t){return await this.read(t,"BinaryString")}async readAsDataURL(t){return await this.read(t,"DataURL")}async readAsText(t){return await this.read(t,"text")}read(t,e="binaryString"){return new Promise((a,i)=>{this.reader=new FileReader,this.reader.onerror=(t=>{i(this.errorHandler(t))}),this.reader.onprogress=(t=>{this.updateProgress(t)}),this.reader.onabort=(t=>{alert("File read cancelled")}),this.reader.onloadstart=(t=>{this.onLoadStart(t)}),this.reader.onload=(t=>{a(this.onload(t))}),"ArrayBuffer"===e?this.reader.readAsArrayBuffer(t):"BinaryString"===e?this.reader.readAsBinaryString(t):"DataURL"===e?this.reader.readAsDataURL(t):this.reader.readAsText(t)})}abortRead(){this.reader&&this.reader.abort(),this.actionDispatcher.dispatch(at.creatRemoveAction())}errorHandler(t){switch(t.target.error.code){case t.target.error.NOT_FOUND_ERR:alert("File Not Found!");break;case t.target.error.NOT_READABLE_ERR:alert("File is not readable");break;case t.target.error.ABORT_ERR:break;default:alert("An error occurred reading this file.")}}updateProgress(t){const e=Math.round(t.loaded/t.total*100);e<100&&this.actionDispatcher.dispatch(at.creatUpdateAction(null,{progress:e}))}onload(t){return this.actionDispatcher.dispatch(at.creatCompleatAction()),this.reader.result}onLoadStart(){this.actionDispatcher.dispatch(at.creatAddAction())}}const Ct="CopiBon",Rt="DefaultName",Mt="title_";class Tt{constructor(t,e){this.em=t,this.ms=ue.getInstance(),this.ip=this.ms.ip,this.im=this.ms.im,this.tbm=this.ms.tbm,this.sm=this.ms.sm,console.log("title is new!!"+this.tbm)}async loadCurrent(){return this.currentTitle}async load(t=Ct){if(this.currentTitle&&this.currentTitle.getPk()===t)return this.currentTitle;let e=await this.em.Title.get(t);return e||(e=await this.createTitle(t)),this.currentTitle=e,e}async createTitle(t=Ct,e=Mt,a=Rt){const i=new Et(t,e,a);return i.setPk(t),i.setting=t,await this.sm.createDefault(t),await this.em.Title.save(i),i}async changeTitle(t){this.currentTitle=await this.loadTitle(t),this.currentTitle||(this.currentTitle=await this.createTitle(Ct,Mt,Rt))}async loadTitleList(){return await this.em.Title.loadAllData()}async saveTitle(t){if(t){t.updateDate=Date.now();const e=t.images;Kt.thinningNullData(e);for(let t in e){const a=e[t];mt.isPrimaryKey(a)||(e[t]=mt.getPrimaryKey(a))}this.currentTitle=await this.em.Title.save(t)}}async deleteTitleCascade(){this.titelId,this.titelPrefix}async addImageFiles(t){const e=await this.loadCurrent(),a=e.images;Kt.thinningNullData(a);const i=[];let r=a.length;for(let e of t){let{imagePk:t,imageEntity:s}=await this.im.saveImageFile(e,r);r++,a.push(t),i.push(s)}return await this.saveTitle(e),i}async addImage(t,e){}async removeImage(t){const e=await this.load(),a=e.images;for(let e in a){const i=a[e];mt.getPrimaryKey(i)===t&&(await this.im.remove(t),delete a[e])}await this.saveTitle(e)}async getExports(){const t=await this.loadCurrent();return t&&t.exports&&Array.isArray(t.exports)?t.exports:(t.exports=[],await this.saveTitle(t),t.exports)}async getCurrentTitleName(){return(await this.loadCurrent()).name}async saveCurrent(){const t=await this.loadCurrent();await this.saveTitle(t)}async loadSettings(){const t=(await this.loadCurrent()).getPk(),e=await this.sm.loadByPk(t);if(!e){return await this.sm.createDefault(t)}return e}async loadThumbnails(){const t=await this.loadCurrent();return await this.im.loadThumbnails(t.images)}async updateImagesListing(t){const e=await this.loadCurrent();return await this.im.updateImagesListing(e.images,t)}async exportPDF(){}async exportZip(){}}class Vt{constructor(t){this.em=t}async load(t){let e=t;return t||(e=mt.getPrimaryKey(t)),await this.em.Binary.get(e)}async remove(t){let e=t;return t||(e=mt.getPrimaryKey(t)),await this.em.Binary.delete(e)}async save(t,e,a){let i=null;t&&(i=await this.em.Binary.get(t)),i?(i.updateDate=Date.now(),i._ab=a):i=new pt(a);const r=await this.em.Binary.save(i);return mt.getPrimaryKey(r)}}class Ft extends ut{constructor(){super("Pages"),this.previewThumbnail=null,this.outputImage=null,this.outputExpandImage=null,this.outputDualImage=null,this.thumbnail=null,this.baseImage=null,this.createDate=Date.now(),this.updateDate=Date.now(),this.listing=0}}class _t{constructor(t){this.em=t}setTitleManager(t){this.tm=t}async loadFromImagePk(t){const e=mt.getPrimaryKey(t),a=await this.em.get(e);if(!a||!a.thumbnail)return null;const i=mt.getPrimaryKey(a.thumbnail),r=await this.em.get(i);return r.parentPk=e,r}async remove(t){const e=await this.em.Pages.get(t);e&&(e.previewThumbnail&&await this.em.Binary.delete(e.previewThumbnail),e.outputImage&&await this.em.Binary.delete(e.outputImage),await this.em.Pages.delete(t))}async removeImage(t){const e=await this.em.Pages.get(t);e&&(e.previewThumbnail&&await this.em.Binary.delete(e.previewThumbnail),e.outputImage&&await this.em.Binary.delete(e.outputImage),e.baseImage=null,e.thumbnail=null,await this.em.Pages.save(e))}async addPage(t,e){const a=(await this.tm.load()).pages,i=[];for(let r in a){const s=a[r];if(!s)continue;const n=await this.em.get(s);if(s===e){const e=await this.em.get(t),a=await this.em.get(e.thumbnail);await this.em.get(a.binary);n.thumbnail=e.thumbnail,n.baseImage=t,await this.em.Pages.save(n)}i.push(n)}return i}async move(t,e){const a=await this.em.Pages.get(t),i=await this.em.Pages.get(e),r=a.previewThumbnail,s=i.previewThumbnail,n=a.outputImage,o=i.outputImage,l=a.thumbnail,c=i.thumbnail,h=a.baseImage,d=i.baseImage;a.previewThumbnail=s,i.previewThumbnail=r,a.outputImage=o,i.outputImage=n,a.thumbnail=c,i.thumbnail=l,a.baseImage=d,i.baseImage=h,await this.em.Pages.save(a),await this.em.Pages.save(i)}async loadAll(){const t=[],e=this.em.Pages.loadAll();for(let a of e)t.push(a);return t}async load(t){return await this.em.Pages.get(t)}async save(t,e=null,a=null,i=null,r=null,s=0,n=null){let o=null;t&&(o=await this.em.Pages.get(t));let l=n?mt.getPrimaryKey(n):null;return o?o.updateDate=Date.now():o=new Ft,o.previewThumbnail=e||null===e?e:o.previewThumbnail,o.outputImage=l||n,o.outputImage=a||null===a?a:o.outputImage,o.thumbnail=i||null===i?i:o.thumbnail,o.baseImage=r||null===r?r:o.baseImage,o.listing=s||null===s?s:o.listing,await this.em.Pages.save(o)}}class Ut extends ut{constructor(){super("Settings"),this.name="",this.pageNum=0,this.startPage="l",this.pageDelection=0,this.outputProfile=null,this.createDate=Date.now(),this.updateDate=Date.now(),this.listing=0}}class zt{constructor(t,e){this.em=t,this.opm=e}async loadByPk(t){return await this.em.Settings.get(t)}async loadAll(){const t=[],e=this.em.Pages.loadAll();for(let a of e)t.push(a);return t}async createDefault(t){const e=new Ut;return e.setPk(t),e.pageNum=8,e.startPage="l",e.pageDelection="r2l",e.outputProfile=this.opm.getDefaultPk(),e.listing=0,await this.em.Settings.save(e)}async save(t,e,a,i,r,s,n=0){let o=null;return t&&(o=await this.em.Settings.get(t)),o?o.updateDate=Date.now():o=new Ut,o.name=e||null===e?e:o.name,o.pageNum=a||8,o.startPage=i||null===i?i:o.startPage,o.pageDirection=r||null===r?r:o.pageDirection,o.outputProfile=s||null===s?s:o.outputProfile,o.listing=n||null===n?n:o.listing,await this.em.Settings.save(o)}}class jt extends ut{constructor(t,e,a){super("OutputProfiles"),this.id=t,this.prefix=e,this.pageSize="A5",this.direction="r2l",this.createDate=Date.now(),this.updateDate=Date.now(),this.listing=0}}const Zt="copibondefa";class Wt{constructor(t){this.em=t,this.createDefault()}getDefaultPk(){return Zt}async loadAll(){const t=[],e=await this.em.OutputProfiles.loadAll();for(let a of e)t.push(a);return t.length<1&&t.push(await this.createDefault()),t}async loadByPk(t){const e=mt.getPrimaryKey(t);if(e){return await this.em.OutputProfiles.get(e)}return await this.em.OutputProfiles.get(t)}async createDefault(){const t=await this.loadByPk(Zt);if(t)return t;const e=new jt;return e.setPk(Zt),await this.em.OutputProfiles.save(e)}async save(t,e,a,i,r,s,n=0){let o=null;t&&(o=await this.em.OutputProfiles.get(t));let l=mt.getPrimaryKey(a);return o?o.updateDate=Date.now():o=new Setting,o.name=e||null===e?e:o.name,o.binary=l||a,o.type=i||null===i?i:o.type,o.width=r||null===r?r:o.width,o.height=s||null===s?s:o.height,o.listing=n||null===n?n:o.listing,await this.em.Thumbnales.save(o)}}class Xt extends ut{constructor(){super("ImageOutputs"),this.name=null,this.binary=null,this.type=null,this.thumbnail=null,this.orderName="",this.size=0,this.createDate=Date.now(),this.updateDate=Date.now(),this.listing=0}}class Yt{constructor(t){this.em=t}async load(t){let e=t;return t||(e=mt.getPrimaryKey(t)),await this.em.ImageOutputs.get(e)}async remove(t){const e=await this.em.ImageOutputs.get(t);e&&(e.binary&&await this.em.Binary.delete(e.binary),await this.em.ImageOutputs.delete(t))}async save(t,e,a,i,r,s,n=0){let o=null;t&&(o=await this.em.ImageOutputs.get(t));let l=mt.getPrimaryKey(a);o?o.updateDate=Date.now():o=new Xt,o.name=e||null===e?e:o.name,o.binary=l||a,o.type=i||null===i?i:o.type,o.orderName=r||null===r?r:o.orderName,o.size=s||null===s?s:o.size,o.listing=n||null===n?n:o.listing;const c=await this.em.ImageOutputs.save(o);return mt.getPrimaryKey(c)}}const Gt=new Map;class Ht{constructor(t){this.ms=ue.getInstance(),this.em=t,this.ip=this.ms.ip,this.tbm=this.ms.tbm}setTitleManager(t){this.tm=t}async load(t){let e=t;return"string"!=typeof t&&(e=mt.getPrimaryKey(t)),await this.em.Images.get(e)}async reloadLoadedImages(){return await this.createRetList(this.getEntitisAsList())}async loadImages(){const t=(await this.tm.load()).images,e=[];for(let a in t){const i=t[a];if(!i)continue;const r=await this.em.get(i);e.push(r)}return await this.createRetList(e)}async remove(t){const e=await this.em.get(t);console.log("removeImage imageEntity.thumbnail:"+e.thumbnail);const a=mt.getPrimaryKey(e.binary);console.log("removeImage binaryPk:"+a);const i=mt.getPrimaryKey(e.thumbnail);if(console.log("removeImage thumbnailPk:"+i),i){const t=await this.em.get(i);console.log("removeImage thumbnailEntity:"+t);const e=mt.getPrimaryKey(t.binary);console.log("removeImage thumbnailBinaryPk:"+e),await this.em.delete(e),await this.em.delete(i)}await this.em.delete(a),await this.em.delete(t)}async saveImageFile(t,e=0){const a=new Lt,i=await a.readAsArrayBuffer(t),r={name:t.name,ab:i,type:t.type},s=await this.ip.createImageNodeByData(r),n=await this.ip.createThumbnail(i,100,100,t.type),o=ft.dataURI2ArrayBuffer(n),l=await this.ip.createImageNodeByData({name:t.name,ab:o,type:t.type}),c=await this.tbm.save(null,t.name,o,t.type,l.width,l.height,0);console.log("addImageFiles thumbnailEntity:"+c);const h=mt.getPrimaryKey(c);console.log("addImageFiles thumbnailPk:"+h);const d=await this.save(null,t.name,i,t.type,s.width,s.height,h,e);return console.log("addImageFiles imageEntity:"+d),{imagePk:d.getPk(),imageEntity:d}}async save(t,e,a,i,r,s,n,o=0){let l=null;t&&(l=await this.em.Images.get(t)),console.log("ImageManager save!!9!! binary:"+a);let c=mt.getPrimaryKey(a);l?l.updateDate=Date.now():l=new It,console.log("ImageManager save!!A!! image:"+l),l.name=e||null===e?e:l.name,l.binary=c||a,l.type=i||null===i?i:l.type,l.width=r||null===r?r:l.width,l.height=s||null===s?s:l.height,l.thumbnail=n||null===n?n:mt.getPrimaryKey(l.thumbnail),l.listing=o||null===o?o:l.listing;const h=await this.em.Images.save(l);return console.log("ImageManager save!!B!! image:"+h),h}async loadThumbnails(t){const e=[],a=[];for(let e of t){const t=mt.getPrimaryKey(e),i=await this.load(t);a.push(i)}Kt.orderBy(a,[{colName:"listing",isDESC:!1}]);for(let t of a){const a=mt.getPrimaryKey(t),i=await this.tbm.loadFromImagePk(a);e.push(i)}return e}async createRetList(t){Kt.orderBy(t,[{colName:"listing",isDESC:!1},{colName:"updateDate",isDESC:!0}]);const e=[];for(let a of t){const t=a.getPk();if(Gt.has(t)){const a=Gt.get(t);e.push(a)}else{const i=await this.processParImage(a);Gt.set(t,i),e.push(i)}}return e}async processParImage(t){t.getPk();const e=await this.em.get(t.thumbnail),a=await this.em.get(e.binary),i=(await this.ip.createImageNodeByData({name:t.name,ab:a.ab,type:t.type}),a.ab?new Uint8Array(a.ab).length:0);return{imageEntity:t,binaryEntity:a,size:i,imageText:escape(t.name)+" ("+(t.type||"n/a")+") - "+i+"bytes, last modified: "+t.modifyDate+" size:"+t.width+"x"+t.height,isOnPage:!1}}removeLoaded(t){Gt.delete(t)}getRetObjsAsList(){const t=[];for(let[e,a]of Gt.entries())t.push(a);return t}getEntitisAsList(){const t=[];for(let[e,a]of Gt.entries())t.push(a.imageEntity);return t}getFromLoaded(t){return Gt.get(t)}}class qt{constructor(t){this.em=t}async loadFromImagePk(t){const e=mt.getPrimaryKey(t),a=await this.em.get(e);if(!a||!a.thumbnail)return null;const i=mt.getPrimaryKey(a.thumbnail),r=await this.em.get(i);return r.parentPk=e,r}async load(t){let e=t;return t||(e=mt.getPrimaryKey(t)),await this.em.Thumbnales.get(e)}async save(t,e,a,i,r,s,n=0){let o=null;t&&(o=await this.em.Thumbnales.get(t));let l=mt.getPrimaryKey(a);return o?o.updateDate=Date.now():o=new Nt,o.name=e||null===e?e:o.name,o.binary=l||a,o.type=i||null===i?i:o.type,o.width=r||null===r?r:o.width,o.height=s||null===s?s:o.height,o.listing=n||null===n?n:o.listing,await this.em.Thumbnales.save(o)}}navigator.userAgent.replace(/[\.0-9]+/g,"x"),window.location;const Jt={pageStart:{l:"fromLeft",r:"fromRight"},pageDirection:{l2r:"LeftToRight",r2l:"RightToLeft"},pageNums:[1,2,4,6,8,10,12,16]},$t={dpi72:72,dpi150:150,dpi300:300,dpi350:350,dpi600:600,dpi1200:1200,same:0},Qt={none:0,conbini:5},te={A5:{target:"A5",frame:"A5",multiple:1},B5:{target:"B5",frame:"B5",multiple:1},A4:{target:"A4",frame:"A4",multiple:1},mangaPaperB5:{target:"A5",frame:"B5",multiple:1},mangaPaperA4:{target:"B5",frame:"A4",multiple:1},mangaPaperA4ExpandTatikiri:{target:"B5",frame:"A4",multiple:274/257},mangaPaperB4:{target:"A4",frame:"B4",multiple:1},mangaPaperA3:{target:"B4",frame:"A3",multiple:1},pure_fit:{target:"same",frame:"same",multiple:1}},ee={A6:{x:105,y:148},B6:{x:128,y:182},A5:{x:148,y:210},B5:{x:182,y:257},A4:{x:210,y:297},B4:{x:257,y:364},A3:{x:297,y:420}},ae=[{orderName:"A5 none croping",basePaper:"A5"},{orderName:"B5 none croping",basePaper:"B5"},{orderName:"mangaPaperB5Tatikiri",basePaper:"mangaPaperB5"},{orderName:"MangaPaperA4ExpandTatikiriSpecial",basePaper:"mangaPaperA4ExpandTatikiri"}];class ie{constructor(){this.paparSize={}}calcClopOffsetPixcel(t,e){const a=this.calcClopOffsetMm(t);return{x:-1*this.calcPixcel(e,a.x),y:-1*this.calcPixcel(e,a.y)}}calcClopOffsetMm(t){const e=te[t],a={x:0,y:0};if(!e||"same"===e.target)return a;const i=this.getPaperSizeMm(e.target),r=this.getPaperSizeMm(e.frame),s=i.x*e.multiple,n=i.y*e.multiple;return a.x=(r.x-s)/2,a.y=(r.y-n)/2,a}getTargetPaperSizeMm(t){return t?this.getPaperSizeMm(t):{x:0,y:0}}getTargetPaperSize(t,e){const a=te[t],i={x:0,y:0};if(!a||"same"===a.target)return i;const r=this.getTargetPaperSizeMm(a.target),s=this.getDpi(e);return i.x=this.calcPixcel(r.x,s),i.y=this.calcPixcel(r.y,s),i}calcPixcel(t,e){return Math.floor(e*t/25.4)}calcDpi(t,e){return t/e*25.4}getPaperFrameSizeMm(t){const e=te[t];return ee[e.frame]}getPaperSizeMm(t){return ee[t]}getPrintMargin(t){return Qt[t]}getDpi(t){return $t[t]}getOffset(t,e){const a=this.getPrintMargin(e),i=this.getDpi(t)/25.4;return Math.floor(i*a)}getPixcelSizeBySelected(t,e,a="none"){const i=this.getPaperSizeMm(t),r=this.getPrintMargin(a),s=this.getDpi(e);return this.getPixcelSizeWithMargin(s,i.x,i.y,r)}getPixcelSize(t,e,a){const i=t/25.4;return{width:Math.floor(i*e),height:Math.floor(i*a)}}getPixcelSizeWithMargin(t,e,a,i){const r=2*i;return this.getPixcelSize(t,e-r,a-r)}}class re{trimByte(t){const e=Math.floor(t),a=e>255?255:e;return a<0?0:a}maegeReplace(t,e,a){this.beWhiteImage(t,a),this.mergeImages(t,e,this.replace())}maegeLinninr(t,e,a){this.beWhiteImage(t,a),this.mergeImages(t,e,this.linier())}maegeMultiplication(t,e,a){this.beWhiteImage(t,a),this.mergeImages(t,e,this.multiplication())}beWhiteImage(t,e){if(e){const e=t.data.length;for(let a=0;a<e;a++)t.data[a]=255}}mergeImages(t,e,a){const{data:i,width:r,height:s}=t;for(let t of e){const e=t.data,n=t.width,o=t.height,l=t.offsetY&&t.offsetY>0&&t.offsetY<s?t.offsetY:!t.offsetY||t.offsetY<s?0:s,c=t.offsetX&&t.offsetX>0&&t.offsetX<r?t.offsetX:!t.offsetX||t.offsetX<r?0:r,h=l+o,d=h>s?s:h,u=c+n,p=u>r?r:u;let g=0,m=0,f=0;for(let t=l;t<d;t++){const s=t-l;g=s;for(let o=c;o<p;o++){const l=o-c;f++,a(i,t*r+o,e,s*n+l),m=l}}}}replace(){return(t,e,a,i)=>{const r=4*e,s=4*i;t[r]=a[s],t[r+1]=a[s+1],t[r+2]=a[s+2],t[r+3]=255}}linier(){return(t,e,a,i)=>{const r=4*e,s=4*i;t[r]=t[r]+addOaddOffsetXne[s],t[r+1]=t[r+1]+a[s+1],t[r+2]=t[r+2]+a[s+2]}}multiplication(){return(t,e,a,i)=>{const r=4*e,s=4*i;t[r]=this.trimByte(t[r]*a[s]/255),t[r+1]=this.trimByte(t[r+1]*a[s+1]/255),t[r+2]=this.trimByte(t[r+2]*a[s+2]/255)}}}class se{static trimByte(t){const e=Math.floor(t),a=e>255?255:e;return a<0?0:a}}class ne{culcWeightByCubic(t){return e=>{let a=0;return e<=1?a=(t+2)*e*e*e-(t+3)*e*e+1:e<=2&&(a=t*e*e*e-5*t*e*e+8*t*e-4*t),a}}sincLanczos(t){return Math.sin(t*Math.PI)/(t*Math.PI)}lanczosWeight(t=3){return e=>0===e?1:Math.abs(e)<t?this.sincLanczos(e)*this.sincLanczos(e/t):0}resizeAsByCubic(t,e){const{data:a,width:i,height:r}=t,s=e.data,n=e.width,o=e.height;new Uint8ClampedArray(this.resizeByCubic(a,i,r,n,o,s));return e}resize(t,e,a,i){const{data:r,width:s,height:n}=t,o=i.data;new Uint8ClampedArray(this.resizeByCubic(r,s,n,e,a,o));return i}resizeLanczos(t,e,a,i,r,s){return this.resizeExecute(t,e,a,i,r,this.lanczosWeight(3),6,s)}resizeByCubic(t,e,a,i,r,s){return this.resizeExecute(t,e,a,i,r,this.culcWeightByCubic(-1),4,s)}resizeExecute(t,e,a,i,r,s,n,o){const l=Math.floor(i),c=Math.floor(r),h=Math.floor(e),d=4*h,u=h-1,p=Math.floor(a),g=p-1,m=h/l,f=p/c,y=t,w=o||new Uint8Array(l*c*4),b=n/2,v=b-1;for(let t=0;t<c;t++){const e=f*t,a=Math.floor(e),i=a-v,r=a+b,n=4*t*l;for(let t=0;t<l;t++){const o=m*t,l=Math.floor(o);let c=0,h=0,p=0;const f=l-v,A=l+b;for(let t=i;t<=r;t++){const i=s(Math.abs(e-t)),r=d*(t<0||t>g?a:t);for(let t=f;t<=A;t++){const e=s(Math.abs(o-t))*i;if(0===e)continue;const a=r+4*(t<0||t>u?l:t);c+=y[a]*e,h+=y[a+1]*e,p+=y[a+2]*e}}const x=n+4*t;w[x]=se.trimByte(c),w[x+1]=se.trimByte(h),w[x+2]=se.trimByte(p),w[x+3]=255}}return w.buffer}}const oe=/^image\/.+|application\/octet-stream/;class le{constructor(){this.canvas=i.createCanvas(null,"hidden"),this.ctx=this.canvas.getContext("2d"),this.paper=new ie,this.imageMerger=new re,this.imageResizer=new ne,window.onload=(()=>{document.body.appendChild(this.canvas)})}setDataURI(t){this.dataURI=t}async resize(t,e,a){const i=await this.getImageDataFromArrayBuffer(t);return this.resizeInMaxSize(i,e,a)}async resizeAsPaper(t,e,a,i){const r=await this.getImageDataFromArrayBuffer(t),s=this.paper.getPixcelSizeBySelected(e,a);let n=this.ctx.createImageData(s.width,s.height);const o=this.paper.getPixcelSizeBySelected(e,a,i),l=this.resizeInMaxSize(r,o.width,o.height),c=this.paper.getOffset(a,i),h={offsetY:c,offsetX:c,data:l.data,width:l.width,height:l.height},d=l.data.length;for(let t=0;t<d;t++)n.data[t]=l.data[t];this.canvas.width=n.width,this.canvas.height=n.height,this.imageMerger.maegeReplace(n,[h],!0),this.ctx.putImageData(n,0,0),n=void 0;let u=this.canvas.toDataURL();console.time("resize copy");const p=ft.dataURI2ArrayBuffer(u);return u=void 0,console.timeEnd("resize copy"),p}resizeInMaxSize(t,e,a){const{data:i,width:r,height:s}=t,n=r/s>=e/a,o=n?e/r:a/s,l=n?e:r*o,c=n?s*o:a;return this.resizeExecute(t,l,c)}resizeExecute(t,e,a){console.time("resize");const i=this.ctx.createImageData(e,a);return this.imageResizer.resize(t,e,a,i),console.timeEnd("resize"),i}getImageDataFromArrayBuffer(t){return console.time("resize getImageDataFromArrayBuffer"),new Promise((e,a)=>{let i=ft.arrayBuffer2DataURI(t);t=null;const r=new Image;r.src=i,r.onload=(()=>{i=null;const t=r.width,a=r.height;this.canvas.width=t,this.canvas.height=a,this.ctx.drawImage(r,0,0);const s=this.ctx.getImageData(0,0,t,a);e(s),console.timeEnd("resize getImageDataFromArrayBuffer")}),r.onerror=(t=>{a(t)})})}getArrayBufferFromImageBitmapDataAsJpg(t,e){const a={type:"image/jpeg",quority:e};return this.getArrayBufferFromImageBitmapData(t,a)}getArrayBufferFromImageBitmapDataAsPng(t){return this.getArrayBufferFromImageBitmapData(t)}getArrayBufferFromImageBitmapData(t,e){console.time("resize getArrayBufferFromImageBitmapData"),this.canvas.width=Math.floor(t.width),this.canvas.height=Math.floor(t.height);let a=this.ctx.createImageData(t.width,t.height);const i=t.data.length;for(let e=0;e<i;e++)a.data[e]=t.data[e];this.ctx.putImageData(a,0,0);let r=e?this.canvas.toDataURL(e.type,e.quority):this.canvas.toDataURL();const s=ft.dataURI2ArrayBuffer(r);return a=void 0,console.timeEnd("resize getArrayBufferFromImageBitmapData"),s}create(t,e,a,i){return new Promise((r,s)=>{const n=new Image;n.src=ft.arrayBuffer2DataURI(t,i),n.onload=(()=>{const t=e/n.width,i=a/n.height,s=t<=i?t:i;this.canvas.height=Math.floor(n.height*s),this.canvas.width=Math.floor(n.width*s),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.scale(s,s),this.ctx.drawImage(n,0,0),r(this.exportPng())}),n.onerror=(t=>{console.log("失敗"),console.log(t),s(null)})})}exportPng(){return this.canvas.toDataURL()}exportJpeg(t=1){return this.canvas.toDataURL("image/jpeg",t)}createImageNodeByData(t){return new Promise((e,a)=>{let{name:r,ab:s,type:n}=t,o=i.createImage();if(o.alt=escape(r),n||(n="application/octet-stream"),n&&n.match(oe))return o.src=ft.arrayBuffer2DataURI(s,n),o.onload=(()=>{t.height=o.height,t.width=o.width,e(o)}),void(o.onerror=(t=>{console.log("失敗"),console.log(t),a(t)}));e(o)})}}class ce{constructor(){this.ip=new le}async createThumbnail(t,e){const a=await this.ip.create(t,100,100,e);return console.log(a),a}async createImageNodeByData(t){return await this.ip.createImageNodeByData(t)}async resize(t,e,a){return await this.ip.resize(t,e,a)}async resizeAsPaperB5_72(t){return await this.ip.resizeAsPaper(t,"B5","dpi72","conbini")}async getImageDataFromArrayBuffer(t){return await this.ip.getImageDataFromArrayBuffer(t)}getArrayBufferFromImageBitmapData(t,e){return this.ip.getArrayBufferFromImageBitmapData(t,e)}getArrayBufferFromImageBitmapDataAsJpg(t,e){return this.ip.getArrayBufferFromImageBitmapDataAsJpg(t,e)}getArrayBufferFromImageBitmapDataAsPng(t){return this.ip.getArrayBufferFromImageBitmapDataAsPng(t)}}var he=a(0);const de=new class{constructor(){this.vpl=new kt,this.em=new St,this.ip=new ce}async init(){await this.em.initAsNewUser([It,Ot,Nt,Et,Ft,Ut,jt,Xt]),this.ip=new ce,this.bm=new Vt(this.em),this.tbm=new qt(this.em),this.pb=new qt(this.em),this.tbm=new qt(this.em),this.im=new Ht(this.em),this.pm=new _t(this.em),this.opm=new Wt(this.em),this.iom=new Yt(this.em),this.sm=new zt(this.em,this.opm),this.tm=new Tt(this.em),this.im.setTitleManager(this.tm),this.pm.setTitleManager(this.tm),await this.tm.load()}getViewPartsLoader(){return this.vpl}};class ue{static getInstance(){return(new he.a).postMessage("WASMcaller",""),de}async init(){await de.init()}}let pe=null;class ge extends q{constructor(){super(),this.progressBarAddAction=at.creatAddAction(),this.progressBarRemoveAction=at.creatRemoveAction(),this.progressBarUpdateAction=at.creatUpdateAction(),this.progressBarCompleatSortAction=at.creatCompleatAction(),this.atatch(this.progressBarAddAction),this.atatch(this.progressBarRemoveAction),this.atatch(this.progressBarUpdateAction),this.atatch(this.progressBarCompleatSortAction),this.storeKey="progress"}static register(){pe||(pe=new ge)}async reduce(t,e){return this.progressBarAddAction.type===e.type?t[this.storeKey]=this.createProgress(!0,0,!1):this.progressBarRemoveAction.type===e.type?t[this.storeKey]=this.createProgress(!1,0,!1):this.progressBarUpdateAction.type===e.type?t[this.storeKey]=this.createProgress(!0,e.data.progress,!1,e.data.msg):this.progressBarCompleatSortAction.type===e.type&&(t[this.storeKey]=this.createProgress(!0,100,!0,e.data.msg)),t}createProgress(t,e,a,i){return{isVisible:t,progress:e,msg:i,isComple:a}}}class me extends Q{constructor(){super("ProgressBar","ProgressBar"),this.storeKey="progress",this.initPoint="0%"}onAfterAttach(t,e){ge.register()}render(){return _("".ProgressBarView,{style:{display:"none"}},[_("",["progeressFrame"],[_("",["progeress"],{style:{width:this.initPoint}})]),_("",["progeressInfo"],[_("",["progeressPoints"],this.initPoint),_("",["progeressMessage"],"")])])}async onViewShow(t,e){t.progress&&await this.showProgress(t.progress)}showProgress(t){const{isVisible:e,progress:a,isComple:i,msg:r}=t;e?(this.currentVnode.elm.style.display="block",this.prePatch(".progeress",_("",["progeress"],{style:{width:a+"%"}})),this.prePatch(".progeressPoints",_("",["progeressPoints"],{},a+"%")),this.prePatch(".progeressMessage",_("",["progeressMessage"],{},r)),i&&setTimeout(()=>{this.currentVnode.elm.style.display="none"},1e3)):(this.currentVnode.elm.style.display="none",this.prePatch(".progeress",_("",["progeress"],{style:{width:"0%"}})),this.prePatch(".progeressPoints",_("",["progeressPoints"],{},this.initPoint)))}}class fe{constructor(){}}class ye{constructor(){}static creatAddAction(t,e,a=null){return k.createBaseAction("addImage",t,e,a)}static creatRemoveAction(t,e,a=null){return k.createBaseAction("removeImage",t,e,a)}static creatLoadImagesAction(t,e,a=null){return k.createBaseAction("loadImages",t,e,a)}static creatSortImagesAction(t,e,a=null){return k.createBaseAction("sortImages",t,e,a)}static creatChangeTitleImagesAction(t,e,a=null){return k.createBaseAction("changeTitle",t,e,a)}static creatDetailAction(t,e,a=null){return k.createBaseAction("detail",t,e,a)}static getStoreImagesKey(){return"imagesData"}}class we{constructor(){}static creatAddPageAction(t,e,a=null){return k.createBaseAction("addPage",t,e,a)}static creatRemovePageAction(t,e,a=null){return k.createBaseAction("removePage",t,e,a)}static creatResetPagesAction(t,e,a=null){return k.createBaseAction("resetPages",t,e,a)}static creatSortPagesAction(t,e,a=null){return k.createBaseAction("sortPages",t,e,a)}static getStorePagesKey(){return"pagesData"}}class be{constructor(){this.ms=ue.getInstance(),this.em=this.ms.em,this.pm=this.ms.pm,this.tm=this.ms.tm}async resetPagesFull(){const t=(await this.tm.loadSettings()).pageNum;return await this.resetPages(t)}async resetPages(t){const e=await this.tm.load(),a=e.pages,i=[],r=[],s={};if(a.length>t){for(let e in a){const n=a[e];if(!n||"string"!=typeof n){s[e]=!0;continue}const o=await this.em.get(n);o?(i.push(o),e>=t&&r.push(n)):s[e]=!0}for(let t in r){const e=r[t];for(let t in a){if(e===a[t]){delete a[t],this.pm.remove(e);break}}}for(let e in s){const i=1*e;if(i<t){const t=await this.pm.save(null,null,null,null,null,i);a[i]=t.getPk()}}}else{a.length;for(let e=a.length;e<t;e++){const t=await this.pm.save(null,null,null,null,null,e);a.push(t.getPk())}}await this.tm.saveTitle(e)}async loadPages(){const t=(await this.tm.load()).pages,e=[];for(let a in t){const i=t[a];if(!i)continue;const r=await this.em.get(i);e.push(r)}return e}async move(t,e){await this.pm.move(t,e)}async add(t,e){await this.pm.addPage(t,e)}async remove(t){await this.pm.removeImage(t)}}let ve=null;class Ae extends q{constructor(){super(),this.ms=ue.getInstance(),this.em=this.ms.em,this.im=this.ms.im,this.tm=this.ms.tm,this.imagAddAction=ye.creatAddAction(),this.imageRemoveAction=ye.creatRemoveAction(),this.imagesLoadAction=ye.creatLoadImagesAction(),this.imagesSortAction=ye.creatSortImagesAction(),this.imagesChangeTitleAction=ye.creatChangeTitleImagesAction(),this.imagesDetailAction=ye.creatDetailAction(),this.atatch(this.imagAddAction),this.atatch(this.imageRemoveAction),this.atatch(this.imagesLoadAction),this.atatch(this.imagesSortAction),this.atatch(this.imagesChangeTitleAction),this.atatch(this.imagesDetailAction),this.pp=new be,this.storeImagesKey=ye.getStoreImagesKey(),this.storePagesKey=we.getStorePagesKey()}static register(){ve||(ve=new Ae)}async reduce(t,e){return this.imagAddAction.type===e.type?(t[this.storeImagesKey]=await this.saveFiles(e.data.files),t[this.storePagesKey]=await this.loadPages()):this.imageRemoveAction.type===e.type?(t[this.storeImagesKey]=await this.remove(e.data.imagePKforDelete),t[this.storePagesKey]=await this.loadPages()):this.imagesLoadAction.type===e.type?(t[this.storeImagesKey]=await this.loadImages(),t[this.storePagesKey]=await this.loadPages()):this.imagesSortAction.type===e.type?(t[this.storeImagesKey]=await this.sort(e.data.imagePKmove,e.data.imagePKdrop),t[this.storePagesKey]=await this.loadPages()):this.imagesChangeTitleAction.type===e.type?t[this.storePagesKey]=await this.loadPages():this.imagesDetailAction.type===e.type&&(t.imagesDetailData=await this.loadAImage(e.data.imagePK)),t}async loadPages(){return await this.pp.loadPages()}async saveFiles(t){const e=await this.tm.addImageFiles(t),a=this.im.getEntitisAsList();for(let t of e)a.unshift(t);return await this.im.createRetList(a)}async sort(t,e){const a=this.im.getEntitisAsList();for(let t in a){const e=a[t];e.getPk();e.listing=t}Kt.orderBy(a,[{colName:"listing",isDESC:!1},{colName:"updateDate",isDESC:!0}]);const i={};i[t]=e,i[e]=t;for(let t in a){const e=a[t],r=e.getPk();console.log("sort pk:"+r+"/index:"+t+"/imageEntity.listing:"+e.listing);const s=i[r]?i[r]:r;if(s!==r){const e=this.im.getFromLoaded(s).imageEntity;e.listing=t,e.updateDate=Date.now(),await this.em.Images.save(e)}else e.listing=t}return await this.im.createRetList(a)}async loadAImage(t){if(!t)return;const e=await this.em.get(t),a=await this.em.get(e.binary),i=a._ab.byteLength;return{imageEntity:e,binaryEntity:a,imageText:escape(e.name)+" ("+(e.type||"n/a")+") - "+i+"bytes, last modified: "+e.modifyDate+" size:"+e.width+"x"+e.height}}async loadImages(){await this.pp.resetPagesFull();return await this.im.loadImages()}async remove(t){return await this.tm.removeImage(t),this.im.removeLoaded(t),this.im.getRetObjsAsList()}}class xe extends fe{constructor(t){super(),this.name="FileUploader",Ae.register()}handleFileSelect(t){return e=>{e.stopPropagation(),e.preventDefault();const a=e.target.files;this.handleFiles(t,a)}}handleDrop(t){return e=>{e.stopPropagation(),e.preventDefault();const a=e.dataTransfer.files;this.handleFiles(t,a)}}handleFiles(t,e){const a=ye.creatAddAction(t,{files:e});t.dispatch(a)}async areadParFile(t){return await areadParFile(t)}}const Pe="ここにファイルをアップロードしてください。";class De extends Q{constructor(){super("fuaPArent","FileUploadArea",!0),this.fu=new xe}render(){return this.FileUploadFile=j("FileUploadFile",["FileUploadFile"],{on:{change:this.fu.handleFileSelect(this)}}),this.fileUploadArea=_("FileUploadArea",["FileUploadAreaA"],Pe),_(this.id,["FileUploadArea"],{on:{dragover:this.fu.handleDrop(this),drop:this.fu.handleDrop(this),click:t=>{this.getElementById("FileUploadFile").elm.click()}}},[this.fileUploadArea,this.FileUploadFile])}onAfterAttach(t,e){}}const Be=/yyyy/,Se=/MM/,ke=/dd/,Ee=/hh/,Ie=/mm/,Ne=/ss/,Oe=(t,e="yyyy-MM-dd hh:mm:ss")=>{const a=new Date(t),i=a.getFullYear(),r=a.getMonth()+1,s=a.getDate(),n=("0"+a.getHours()).slice(-2),o=("0"+a.getMinutes()).slice(-2),l=("0"+a.getSeconds()).slice(-2);return e.replace(Be,i).replace(Se,r).replace(ke,s).replace(Ee,n).replace(Ie,o).replace(Ne,l)};class Ke{constructor(){}static creatAction(t,e,a=null){return k.createBaseAction("creatSetting",t,e,a)}static creatRemoveAction(t,e,a=null){return k.createBaseAction("removeSetting",t,e,a)}static creatLoadAction(t,e,a=null){return k.createBaseAction("loadSetting",t,e,a)}static creatUpdateAction(t,e,a=null){return k.createBaseAction("updateSetting",t,e,a)}static getStoreKey(){return"settings"}static getStoreKeyOpm(){return"settingsOpm"}}let Le=null;class Ce extends q{constructor(){super(),this.ms=ue.getInstance(),this.tm=this.ms.tm,this.sm=this.ms.sm,this.opm=this.ms.opm,this.creatAction=Ke.creatAction(),this.creatRemoveAction=Ke.creatRemoveAction(),this.creatLoadAction=Ke.creatLoadAction(),this.creatUpdateAction=Ke.creatUpdateAction(),this.atatch(this.creatAction),this.atatch(this.creatRemoveAction),this.atatch(this.creatLoadAction),this.atatch(this.creatUpdateAction),this.storeKey=Ke.getStoreKey(),this.storeKeyOpm=Ke.getStoreKeyOpm()}static register(){Le||(Le=new Ce)}async reduce(t,e){this.creatAction.type===e.type?(t[this.storeKey]=await this.load().catch(t=>{console.log(t)}),t[this.storeKeyOpm]=await this.opm.loadAll()):this.creatRemoveAction.type===e.type?(t[this.storeKey]=await this.reset(e.data).catch(t=>{console.log(t)}),t[this.storeKeyOpm]=await this.opm.loadAll()):this.creatLoadAction.type===e.type?(t[this.storeKey]=await this.load().catch(t=>{console.log(t)}),t[this.storeKeyOpm]=await this.opm.loadAll()):this.creatUpdateAction.type===e.type&&(t[this.storeKey]=await this.update(e.data).catch(t=>{console.log(t)}),t[this.storeKeyOpm]=await this.opm.loadAll())}async update(t){const e=(await this.tm.load()).getPk();this.sm.save(e,t.name,t.pageNum,t.startPage,t.pageDirection,t.outputProfile,t.listing);const a=await this.sm.loadByPk(e);if(!a){return await this.sm.createDefault(e)}return a}async reset(){const t=(await this.tm.load()).getPk();return await this.sm.createDefault(t)}async load(){return this.tm.loadSettings()}}class Re extends Q{constructor(){super("TitleSettings","TitleSettings"),this.text="TitleSettingsAAA",this.bodyId=this.id+"Child",this.storeKey=Ke.getStoreKey(),this.getStoreKeyOpm=Ke.getStoreKeyOpm()}render(){return _(this.bodyId,["TitleSettings"],this.text)}onAfterAttach(t,e){Ce.register();const a=Ke.creatLoadAction(this,{});this.dispatch(a)}async onViewShow(t,e){console.log("TitleSettings onViewShow 01 this.storeKey:"+this.storeKey+"/"+t[this.storeKey]),t[this.storeKey]&&await this.showSettings(t[this.storeKey],t[this.getStoreKeyOpm])}update(){return t=>{const e=document.getElementById(this.id+"NameInput").value,a=document.getElementById(this.id+"PageNumInput").value,i=document.getElementById(this.id+"StartPageInput").value,r=document.getElementById(this.id+"PageDirectionInput").value,s=document.getElementById(this.id+"OutputProfileInput").value,n=Ke.creatUpdateAction(this,{name:e,pageNum:a,startPage:i,pageDirection:r,outputProfile:s,listing:0});this.dispatch(n)}}async showSettings(t,e){console.log(t),console.log(e);const a=this.id+"Label",i=this.id+"Input",r=_("",[this.id+"Title"],"Setting for Output"),s=U("",[a],"name:"),n=Z(this.id+"NameInput",[this.id+"NameInput"],{props:{name:this.id+"NameInput"}},"text",t.name),o=_("",[this.id+"Row"],[s,n]),l=U("",[a],"pageNum:"),c=this.id+"PageNumInput",h=G(c,[i,c],c,Jt.pageNums,t.pageNum),d=_("",[this.id+"Row"],[l,h]),u=U("",[a],"startPage:"),p=this.id+"StartPageInput",g=G(p,[i,p],p,Jt.pageStart,t.startPage),m=_("",[this.id+"Row"],[u,g]),f=U("",[a],"pageDirection:"),y=this.id+"PageDirectionInput",w=G(y,[i,y],y,Jt.pageDirection,t.pageDirection),b=_("",[this.id+"Row"],[f,w]),v=U("",[a],"outputProfile:"),A=this.id+"OutputProfileInput",x=Z(A,[i,A],{props:{name:A}},"text",t.outputProfile),P=_("",[this.id+"Row"],[v,x]),D=_("",[this.id+"FrameL"],[o,d]),B=_("",[this.id+"FrameR"],[m,b,P]),S=[r,_("",[this.id+"Frame"],[D,B]),_("",[this.id+"Update"],{on:{click:this.update()}},"Save! LastUpdae:"+Oe(t.updateDate))];this.prePatch("#"+this.bodyId,_(this.bodyId,["TitleSettings"],S))}}class Me{constructor(){}static createExecuteAction(t,e,a=null){return k.createBaseAction("executeExport",t,e,a)}static creatExecuteAllAction(t,e,a=null){return k.createBaseAction("executeExportAll",t,e,a)}static creatRemoveAction(t,e,a=null){return k.createBaseAction("removeExported",t,e,a)}static creatLoadAction(t,e,a=null){return k.createBaseAction("loadExported",t,e,a)}static createDownloadAction(t,e,a=null){return k.createBaseAction("downloadExport",t,e,a)}static createExecutePdfAction(t,e,a=null){return k.createBaseAction("executePdfExport",t,e,a)}static createDownloadPdfAction(t,e,a=null){return k.createBaseAction("downloadPdfExport",t,e,a)}static createSelectOrderAction(t,e,a=null){return k.createBaseAction("selectOrderExport",t,e,a)}static getStoreKey(){return"exports"}static getStorePdfDLKey(){return"exportPdfDL"}static getStoreZipDLKey(){return"exportZipDL"}static getStoreRemoveResultKey(){return"exportRemoveResult"}static getStoreExportResultKey(){return"exportExportResult"}static getStoreSelectedOrderKey(){return"exportSelectedOrder"}}class Te{constructor(){this.imageMerger=new re}cropImage(t,e,a,i,r){const s={data:new Uint8ClampedArray(e*a*4),width:e,height:a};return t.offsetX=i,t.offsetY=r,this.imageMerger.maegeReplace(s,[t],!1),s}corpImageToData(t,e,a){t.offsetX=a.x,t.offsetY=a.y,this.imageMerger.maegeReplace(e,[t],!1)}}class Ve{constructor(){}beGrascale(t){const e=t.data,a=t.width,i=t.height;for(let t=0;t<i;t++)for(let i=0;i<a;i++){const r=4*(t*a+i),s=se.trimByte((e[r]+e[r+1]+e[r+2])/3);e[r]=s,e[r+1]=s,e[r+2]=s}return t}}class Fe{static surrogatePairToCodePoint(t,e){return((1023&t)<<10)+(1023&e)+65536}static stringToCodePointArray(t){const e=[],a=t.length;for(let i=0;i<a;i++){const a=t.charCodeAt(i);55296==(63488&a)?e.push(Fe.surrogatePairToCodePoint(a,t.charCodeAt(++i))):e.push(a)}return console.log(e),e}static codePointArrayToString(t){let e="";const a=t.length;for(let i=0;i<a;++i){let a=null;const r=t[i];if(r>65535){const t=r-65536;a=[55296+(t>>10),56320+(1023&t)]}else a=[r];e+=String.fromCharCode.apply(String,a)}return e}static encodeUTF8(t){const e=Fe.stringToCodePointArray(t),a=e.length,i=[];for(let t=0;t<a;t++){const a=e[t];a<=127?i.push(a):a<=2047?i.push(192|a>>>6,128|191&a):a<=65535?i.push(224|a>>>12,128|a>>>6&191,128|191&a):a<=131071&&i.push(240|a>>>18,128|a>>>12&191,128|a>>>6&191,128|191&a)}return new Uint8Array(i)}static encodeUTF16(t,e){const a=Fe.stringToCodePointArray(t),i=a.length,r=e?"LE"===e?[255,254]:[254,255]:[];for(let t=0;t<i;t++){const i=a[t];"LE"===e?r.push(255&i,i>>>8&255):r.push(i>>>8&255,255&i)}return new Uint8Array(r)}decodeUTF8(t){let e="";const a=t.length;for(let i=0;i<a;i++){const a=t[i];e+=a<=127?String.fromCharCode(a):a<=223&&a>=194?String.fromCharCode((31&a)<<6|63&t[++i]):a<=239&&a>=224?String.fromCharCode((15&a)<<12|(63&t[++i])<<6|63&t[++i]):a<=247&&a>=240?String.fromCharCode(55296|((7&a)<<8|(63&t[++i])<<2|t[++i]>>>4&3)-64,56320|(15&t[i++])<<6|63&t[i]):String.fromCharCode(65533)}return e}decodeUTF16(t){let e="BE",a=0;const i=t.length;let r="";for(t[0]*t[1]==64770&&(e=255===t[0]?"LE":"BE",a=2);a<i;a+=2)r+=String.fromCharCode("LE"===e?t[a+1]<<8|t[a]:t[a]<<8|t[a+1]);return r}static stringToByteArray(t){const e=t.length,a=new Uint8Array(e);for(let i=0;i<e;i++)a[i]=255&t.charCodeAt(i);return a}}class _e{constructor(){this.ms=ue.getInstance(),this.em=this.ms.em,this.tm=this.ms.tm,this.ip=this.ms.ip,this.previewMaxWidth=1e3,this.previewMaxHeight=1e3}async loadPreviews(){const t=(await this.tm.load()).pages,e=[];for(let a of t){const t=await this.em.get(a),i=t.previewThumbnail,r=t.baseImage;if(r)if(i){const t=await this.em.get(i);e.push(t)}else{const t=await this.em.get(r),a=await this.em.get(t.binary);a._ab=await this.ip.resizeAsPaperB5_72(a._ab),e.push(a)}else e.push(null)}return e}shapeListBySets(t,e,a){const i=_e.getCratePageDataFunc();if(e){const e=[];for(let a in t)e.push(i(1*a+1,!1,!1,t,this.dummyClass));return e}{const e=1*a.pageNum;return this.pageNum=e,_e.buildPageFrames(a,t,i,this.dummyClass)}}static getCratePageDataFunc(){return(t,e,a,i,r)=>({pageNo:t,isDummy:e===r,isRight:a,binary:i[t-1]})}static buildPageFrames(t,e,a,i){const r=[],s=t.startPage,n=1*t.pageNum,o=t.pageDirection,l="r2l"===o,c="r"===s,h=Math.ceil(n/2),d=n%2==1,u=0===o.indexOf(s),p=1*h+1*(d?1:u?0:1),g=l&&c||!l&&!c,m=!c||g?"":i,f=c||g?"":i,y=d&&(!g||g&&!l)||!d&&(!l||g)?"":i,w=d&&(!g||g&&l)||!d&&(l||g)?"":i,b=p-1;let v=0,A=0;for(let t=0;t<p;t++){const s=(l?1:0)+A+v,n=(l?0:1)+A+v,o=[];if(r.push(o),0===t){const t=l&&g?2:l?1:g?1:0,r=l&&g?1:l?0:g?2:1;o.push(a(t,m,!1,e,i)),o.push(a(r,f,!0,e,i)),A=1,v+=g?2:1}else t===b?(o.push(a(s,y,!1,e,i)),o.push(a(n,w,!0,e,i))):(o.push(a(s,"",!1,e,i)),o.push(a(n,"",!0,e,i)),v+=2)}return r}}class Ue{constructor(t){this.actionDispatcher=T.createStandAlone()}update(t,e){if(t<100){const a=Math.floor(10*t)/10;this.actionDispatcher.dispatch(at.creatUpdateAction(null,{progress:a,msg:e}))}}comple(t){this.actionDispatcher.dispatch(at.creatCompleatAction(null,{msg:t}))}open(t){this.actionDispatcher.dispatch(at.creatAddAction(null,{msg:t}))}close(){this.actionDispatcher.dispatch(at.creatRemoveAction())}}var ze=a(10);const je={orderName:"MangaPaperA4ExpandTatikiri",basePaper:"mangaPaperA4ExpandTatikiri",dpiName:"dpi600"};class Ze{constructor(t){this.pp=t,this.ms=ue.getInstance(),this.em=this.ms.em,this.sm=this.ms.sm,this.bm=this.ms.bm,this.im=this.ms.im,this.iom=this.ms.iom,this.ip=this.ms.ip,this.tm=this.ms.tm,this.paper=new ie,this.imageMerger=new re,this.imageResizer=new ne,this.imageCropper=new Te,this.imageFilter=new Ve,this.pbp=new Ue,this.progress=0}async exportExecute(t=[je]){this.pbp.open("Start page!"),this.progress=0,this.pbp.update(this.progress,"loading Settings");const e=await this.tm.loadSettings().catch(t=>{console.log(t)});this.progress=1,this.pbp.update(this.progress,"loading pages");const a=await this.pp.loadPages().catch(t=>{console.log(t)});this.progress=2,this.pbp.update(this.progress,"start executess");const i=await this.executeParOrder(e,a,t[0]);return console.error("pbp.comple!!!"),console.error("pbp.comple!!!"),this.pbp.comple(this.progress),i}async executeParOrder(t,e,a){const i=this.paper.getDpi(a.dpiName),r=this.paper.getTargetPaperSize(a.basePaper,a.dpiName),s=this.paper.calcClopOffsetPixcel(a.basePaper,i),n=this.paper.getPaperFrameSizeMm(a.basePaper),o=a.isGrascale,l=a.isMaxSize10M,c={x:this.paper.calcPixcel(i,n.x),y:this.paper.calcPixcel(i,n.y)};this.progress=3,this.pbp.update(this.progress,"expandAndCropSize"),await this.expandAndCropSize(r,n,c,s,e,o),console.log(e),console.log("aaaaaaaaaaaaaaaaaaaaaaaa5a-/");const h="r2l"===t.pageDirection,d="r"===t.startPage,u=h&&d||!h&&!d,p=e.length%2>0;this.progress=60,this.pbp.update(this.progress,"start exportDualImage4Print"),await this.exportDualImage4Print(r,t,e,u,p,h,l),console.log("aaaaaaaaaaaaaaaaaaaaaaaa5b-/"),this.progress=80,this.pbp.update(this.progress,"start exoprtAsZip");const g=await this.exoprtAsZip(e),m=await this.tm.getExports();let f=null,y=null;for(let t of m){const e=await this.iom.load(t);if(e&&"zip"===e.type){f=t,y=e.binary;break}}const w=await this.bm.save(y,"expandPage",g),b=g.byteLength;console.log("aaaaaaaaaaaaaaaaaaaaaaaa8b-/"+w+"/"+y+"/size:"+b);const v=(new Date).getTime(),A=Oe(v,"yyyyMMddThhmmss"),x=await this.iom.save(f,await this.tm.getCurrentTitleName()+A+".zip",w,"zip",a.orderName,b);return x&&(m.push(x),await this.tm.saveCurrent()),this.progress=100,this.pbp.update(this.progress,"end all!"),this.pbp.comple(this.progress),m}async expandAndCropSize(t,e,a,i,r,s){console.log("--targetSize--isGrascale:"+s),console.log(t);const n={data:new Uint8ClampedArray(a.x*a.y*4),width:a.x,height:a.y},o={data:new Uint8ClampedArray(t.x*t.y*4),width:t.x,height:t.y},l=(new Uint8ClampedArray(t.x*t.y*4),t.x,t.y,t.x/t.y);let c=null;this.progress=5,this.pbp.update(this.progress,"start pages");const h=r.length,d=50/(9*h);let u=0;for(let t of r){const a="["+ ++u+"/"+h+"]";if(t&&t.baseImage){this.pbp.update(this.progress,"load baseImageEntity"+a);const r=await this.em.get(t.baseImage);this.progress+=d,this.pbp.update(this.progress,"load baseBinaryEntity"+a);const h=r.width,u=r.height,p=await this.em.get(r.binary);console.log("aaaaaaaaaaaaaaaaaaaaaaaa0a"),c=p._ab,this.progress+=d,this.pbp.update(this.progress,"get ImageDataFromArrayBuffer"+a);const g=await this.ip.getImageDataFromArrayBuffer(p._ab);console.log("aaaaaaaaaaaaaaaaaaaaaaaa0a w:"+g.width+"/h:"+g.height);const m=h/u>l,f=m?h:u,y=m?e.x:e.y,w=(this.paper.calcDpi(f,y),m?h:Math.floor(u*l)),b=m?Math.floor(h/l):u,v=m?0:Math.floor((w-h)/2),A=m?Math.floor((b-u)/2):0,x={data:new Uint8ClampedArray(w*b*4),width:w,height:b};g.offsetX=v,g.offsetY=A,console.log("aaaaaaaaaaaaaaaaaaaaaaaa1a/"+x.data.length+"/w:"+w+"/h:"+b+"/isGrascale:"+s),this.progress+=d,this.pbp.update(this.progress,"maege Replace origin to whitePaper"+a),s?this.imageMerger.maegeReplace(x,[this.imageFilter.beGrascale(g)],!0):this.imageMerger.maegeReplace(x,[g],!0),console.log("aaaaaaaaaaaaaaaaaaaaaaaa2a/"+n.data.length),this.progress+=d,this.pbp.update(this.progress,"expand resizeAsByCubic"+a),this.imageResizer.resizeAsByCubic(x,n),console.log("aaaaaaaaaaaaaaaaaaaaaaaa3a/"+o.data.length),this.progress+=d,this.pbp.update(this.progress,"crop!"+a),this.imageCropper.corpImageToData(n,o,i),this.progress+=d,this.pbp.update(this.progress,"get ArrayBuffer From ImageBitmapData"+a),c=this.ip.getArrayBufferFromImageBitmapData(o);console.log("aaaaaaaaaaaaaaaaaaaaaaaa4a-/"),console.time("RawDeflate");const P=t.outputExpandImage;this.progress+=d,this.pbp.update(this.progress,"save ArrayBuffer"+a);const D=await this.bm.save(P,"expandPage",c);t.outputExpandImage=D,this.progress+=d,this.pbp.update(this.progress,"save pageEntity"+a),await this.em.Pages.save(t)}else this.progress+=9*d,this.pbp.update(this.progress,"save pageEntity"+a)}}async exoprtAsZip(t){const e=new ze.Zlib.Zip;let a=0,i=null;for(let r of t)if(a++,r&&r.outputDualImage){if(r.outputDualImage===i){r.outputDualImage=null;continue}i=r.outputDualImage;const t=await this.em.get(i);console.log("aaaaaaaaaaaaaaaaaaaaaaaa7a pageNum:"+a+"/outputBinaryEntity:"+t+"/lastOne:"+i),t&&(e.addFile(new Uint8Array(t._ab),{filename:Fe.stringToByteArray("page"+a+"-"+a+".jpg")}),await this.bm.remove(i))}return e.compress()}async exportDualImage4Print(t,e,a,i,r,s,n){const o={data:new Uint8ClampedArray(t.x*t.y*8),width:2*t.x,height:t.y};console.log(e);_e.getCratePageDataFunc();const l={right:null,left:null,rightBin:null,leftBin:null};const c=[],h=[];let d=0;for(let t of a){0===d&&i&&c.push(null);const e={pageNo:++d,isDummy:!1,isRight:d%2>0&&i,binary:t};c.push(e)}for(let t=0;t<c.length;t++){const e=[null,null];e[0]=c[t],++t<c.length&&(e[1]=c[t]),h.push(e)}this.progress=61,this.pbp.update(this.progress,"start exportDualImage4Print");const u=h.length;let p=0;const g=20/(9*u);for(let e of h){const a="["+ ++p+"/"+u+"]";this.progress+=g,this.pbp.update(this.progress,"exportDualImage4Print"+a),await this.buildDualImage(t,o,l,e,s,n,a,g)}}async buildDualImage(t,e,a,i,r,s,n,o){console.log(i);const l=i[0],c=i[1],h=r?l:c,d=r?c:l;a.right=null===h||h.isDummy?null:h.binary,a.left=null===d||d.isDummy?null:d.binary,a.rightBin=null,a.leftBin=null,console.log("aaaaaaaaaaaaaaaaaaaaaaaa6a shapedPagePair:"+i+"/left:"+a.left+"/right:"+a.right);let u=null;if(this.progress+=o,this.pbp.update(this.progress,"load pairPages.right"+n),a.right&&a.right.outputExpandImage&&(a.rightBin=await this.em.get(a.right.outputExpandImage),u=a.right),this.progress+=o,this.pbp.update(this.progress,"load pairPages.left"+n),a.left&&a.left.outputExpandImage&&(a.leftBin=await this.em.get(a.left.outputExpandImage),u=a.left),!u)return this.progress+=7*o,void this.pbp.update(this.progress,"load null"+n);if(this.imageMerger.beWhiteImage(e,!0),console.log("aaaaaaaaaaaaaaaaaaaaaaaa6a left:"+a.left+"/right:"+a.right),this.progress+=o,this.pbp.update(this.progress,"set Left"+n),a.leftBin){const t=await this.ip.getImageDataFromArrayBuffer(a.leftBin._ab);t.offsetX=0,t.offsetY=0,this.imageMerger.maegeReplace(e,[t],!1)}if(this.progress+=o,this.pbp.update(this.progress,"set right"+n),a.rightBin){const i=await this.ip.getImageDataFromArrayBuffer(a.rightBin._ab);i.offsetX=t.x,i.offsetY=0,this.imageMerger.maegeReplace(e,[i],!1)}this.progress+=o,this.pbp.update(this.progress,"convert to jepg"+n);let p=this.ip.getArrayBufferFromImageBitmapDataAsJpg(e,1);const g=p.byteLength;if(s&&1e7<g){const t=1e7/g;ropedPaperDualAb=this.ip.getArrayBufferFromImageBitmapDataAsJpg(e,t)}const m=u.outputDualImage;this.progress+=o,this.pbp.update(this.progress,"save jepg binary"+n);const f=await this.bm.save(m,"expandDualPage",p);this.progress+=o,this.pbp.update(this.progress,"save right and delete temp files"+n),a.right&&a.right.outputExpandImage&&(a.right.outputDualImage=f,await this.em.Pages.save(a.right),await this.em.delete(a.rightBin)),this.progress+=o,this.pbp.update(this.progress,"save left and delete temp files"+n),a.left&&a.left.outputExpandImage&&(a.left.outputDualImage=f,await this.em.Pages.save(a.left),await this.em.delete(a.leftBin))}exportPdfExecute(t){alert("ExportImageProcesser exportPdfExecute")}}class We{constructor(){this.ms=ue.getInstance(),this.em=this.ms.em,this.bm=this.ms.bm,this.im=this.ms.im,this.iom=this.ms.iom,this.tm=this.ms.tm}async load(){const t=await this.tm.getExports();return await this.getZipPdfPair(t)}async remove(t=-1){const e=await this.tm.getExports();if(e){for(let t in e){const a=e[t];delete e[t],await this.iom.remove(a)}await this.tm.saveCurrent()}alert("ExportImageProcesser remove")}async loadZip(t){if(!t){const t=(await this.load()).zip;if(t&&t.binary){const e=await this.bm.load(t.binary);t.ab=e._ab,console.error(t.ab)}return t}return alert("ExportImageProcesser loadZip is NULL!"),null}async loadPdf(t){if(!t){const t=(await this.load()).pdf;if(t&&t.binary){const e=await this.bm.load(t.binary);t.ab=e._ab}return t}return alert("ExportImageProcesser loadPdf exportPk is NULL!"),null}async getZipPdfPair(t){const e={pdf:null,zip:null};if(!1==!!t)return e;for(let a of t){const t=await this.iom.load(a);t&&"zip"===t.type&&(e.zip=t),t&&"pdf"===t.type&&(e.pdf=t)}return e}}let Xe=null;class Ye extends q{constructor(){super(),this.ms=ue.getInstance(),this.im=this.ms.im,this.bm=this.ms.bm,this.iom=this.ms.iom,this.tm=this.ms.tm,this.exportExecuteAction=Me.createExecuteAction(),this.exportExecuteAllAction=Me.creatExecuteAllAction(),this.exportRemoveAction=Me.creatRemoveAction(),this.exportsLoadAction=Me.creatLoadAction(),this.exportDownloadAction=Me.createDownloadAction(),this.exportExecutePdfAction=Me.createExecutePdfAction(),this.exportDownloadPdfAction=Me.createDownloadPdfAction(),this.selectOrderAction=Me.createSelectOrderAction(),this.atatch(this.exportExecuteAction),this.atatch(this.exportExecuteAllAction),this.atatch(this.exportRemoveAction),this.atatch(this.exportsLoadAction),this.atatch(this.exportDownloadAction),this.atatch(this.exportExecutePdfAction),this.atatch(this.exportDownloadPdfAction),this.atatch(this.selectOrderAction),this.pp=new be,this.eip=new Ze(this.pp),this.eup=new We(this.pp),this.storeKey=Me.getStoreKey(),this.storePdfDLKey=Me.getStorePdfDLKey(),this.storeZipDLKey=Me.getStoreZipDLKey(),this.storeRemoveResultKey=Me.getStoreRemoveResultKey(),this.storeExportResultKey=Me.getStoreExportResultKey(),this.storeSelectedOrderKey=Me.getStoreSelectedOrderKey()}static register(){Xe||(Xe=new Ye)}async reduce(t,e){if(delete t[this.storePdfDLKey],delete t[this.storeRemoveResultKey],delete t[this.storeExportResultKey],delete t[this.storeKey],delete t[this.storeZipDLKey],delete t[this.storeSelectedOrderKey],this.exportExecuteAction.type===e.type){const a=await this.exportExecute(e.data.exportOrders);t[this.storeKey]=a,t[this.storeExportResultKey]=a}else if(this.exportExecuteAllAction.type===e.type)t[this.storeExportResultKey]=await this.exportExecute(e.data.exportOrders),t[this.storeExportResultKey]=await this.exportPdfExecute(e.data.exportOrders);else if(this.exportRemoveAction.type===e.type){const a=await this.remove(e.data.exportPk);t[this.storeRemoveResultKey]=a}else if(this.exportsLoadAction.type===e.type)t[this.storeKey]=await this.load();else if(this.exportDownloadAction.type===e.type)t[this.storeZipDLKey]=await this.loadZip(e.data.exportPk);else if(this.exportExecutePdfAction.type===e.type){const a=await this.exportPdfExecute(e.data.exportOrders);t[this.storeKey]=a,t[this.storeExportResultKey]=a}else if(this.exportDownloadPdfAction.type===e.type)t[this.storePdfDLKey]=await this.loadPdf(e.data.exportPk);else if(this.selectOrderAction.type===e.type&&e.data.selectOrder&&e.data.selectOptions){const a={selectOptions:e.data.selectOptions,selectOrder:e.data.selectOrder};t[this.storeSelectedOrderKey]=a}return t}async exportExecute(t){const e=await this.eip.exportExecute(t);return await this.eup.getZipPdfPair(e)}async exportPdfExecute(t){return await this.eip.exportPdfExecute(t)}async loadZip(t){return await this.eup.loadZip(t)}async loadPdf(t){return await this.eup.loadPdf(t)}async remove(t){return await this.eup.remove(t),await this.eup.load()}async load(){return await this.eup.load()}}class Ge extends Q{constructor(){super("ExportAllButton","ExportAllButton",!0),this.storeKey=Me.getStoreKey(),this.storePdfDLKey=Me.getStorePdfDLKey(),this.storeZipDLKey=Me.getStoreZipDLKey(),this.storeRemoveResultKey=Me.getStoreRemoveResultKey(),this.storeExportResultKey=Me.getStoreExportResultKey()}render(t,e){return _(this.id,[this.id+"Frame"],{on:{click:this.click()}},[_("",["button"],"make zip and pdf!")])}onAfterAttach(t,e){}async onViewShow(t,e){if(t[this.storeKey]){const e=t[this.storeKey];e.pdf&&e.zip&&alert("OK All Exported!")}}click(){return t=>{const e=Me.creatExecuteAllAction();return this.dispatch(e),t.stopPropagation(),!1}}}class He{static download(t,e,a="text/plain"){const i=new Blob([e],{type:a}),r=document.createElement("a");r.style.display="none",r.download=t,r.href=window.URL.createObjectURL(i),r.dataset.downloadurl=[a,t,r.href].join(":"),document.body.appendChild(r),r.click(),setTimeout(()=>{document.body.removeChild(r)})}}class qe extends Q{constructor(){super("ExportImgZipButton","ExportImgZipButton",!0),this.storeSelectedOrderKey=Me.getStoreSelectedOrderKey(),this.storeKey=Me.getStoreKey(),this.storePdfDLKey=Me.getStorePdfDLKey(),this.storeZipDLKey=Me.getStoreZipDLKey(),this.storeRemoveResultKey=Me.getStoreRemoveResultKey(),this.storeExportResultKey=Me.getStoreExportResultKey(),this.stateId="exportedStateZip",this.isExported=!1,this.exportOrderData=null}render(t,e){const a=_("",["buttonName"],"make zip!"),i=_(this.stateId,["exportedStateNone"],"no export");return _(this.id,[this.id+"Frame"],{on:{click:this.click()}},[_("",["button"],[a,i])])}onAfterAttach(t,e){}async onViewShow(t,e){if(t[this.storeExportResultKey]){this.buildButton(t[this.storeExportResultKey])&&setTimeout(()=>{alert("OK download zip file!")},1e3)}else t[this.storeKey]&&this.buildButton(t[this.storeKey]);if(t[this.storeSelectedOrderKey]){const e=t[this.storeSelectedOrderKey],a=e.selectOptions,i=e.selectOrder;this.exportOrderData={basePaper:i.basePaper,orderName:i.orderName,dpiName:a.dpiName,isGrascale:a.isGrascale,isMaxSize10M:a.isMaxSize10M}}}buildButton(t){if(t&&t.zip){const e=t.zip,a="*Last Exported One* "+e.name+" / "+e.orderName+" /size: "+e.size+"byte / "+Oe(e.updateDate);return this.prePatch("#"+this.stateId,_(this.stateId,["exportedState"],a)),this.isExported=!0,!0}return this.isExported=!1,this.prePatch("#"+this.stateId,_(this.stateId,["exportedStateNone"],"no export")),!1}click(){return t=>{if(this.exportOrderData){if(!this.isExported||this.isExported&&window.confirm("is export orverride ok?")){const t=Me.createExecuteAction(this,{exportOrders:[this.exportOrderData]});this.dispatch(t)}return t.stopPropagation(),!1}alert("Export Order is not Selected!")}}}class Je extends Q{constructor(){super("ExportPdfButton","ExportPdfButton",!0),this.storeSelectedOrderKey=Me.getStoreSelectedOrderKey(),this.storeKey=Me.getStoreKey(),this.storePdfDLKey=Me.getStorePdfDLKey(),this.storeZipDLKey=Me.getStoreZipDLKey(),this.storeRemoveResultKey=Me.getStoreRemoveResultKey(),this.storeExportResultKey=Me.getStoreExportResultKey(),this.stateId="exportedStatePdf",this.isExported=!1,this.exportOrderData=null}render(t,e){const a=_("",["buttonName"],"make pdf!"),i=_(this.stateId,["exportedStateNone"],"no export");return _(this.id,[this.id+"Frame"],{on:{click:this.click()}},[_("",["button"],[a,i])])}onAfterAttach(t,e){}async onViewShow(t,e){if(t[this.storeKey]){const e=t[this.storeKey].pdf;if(e){const t=e.name+" / "+e.orderName+" / "+unixTimeToDateFormat(e.updateDate);this.prePatch("#"+this.stateId,_(this.stateId,["exportedState"],t)),this.isExported=!0}else this.prePatch("#"+this.stateId,_(this.stateId,["exportedStateNone"],"no export")),this.isExported=!1}else t[this.storeExportResultKey]&&alert("OK download zip file!");if(t[this.storeSelectedOrderKey]){const e=t[this.storeSelectedOrderKey],a=e.selectOptions,i=e.selectOrder;this.exportOrderData={basePaper:i.basePaper,orderName:i.orderName,dpiName:a.dpiName,isGrascale:a.isGrascale,isMaxSize10M:a.isMaxSize10M}}}click(){return t=>{if(!this.isExported||this.isExported&&window.confirm("is export orverride ok?")){const t=Me.createExecutePdfAction(this,{exportOrders:[this.exportOrderData]});this.dispatch(t)}return t.stopPropagation(),!1}}}class $e extends Q{constructor(){super("DownloadLastExportZipButton","DownloadLastExportZipButton",!0),this.storeKey=Me.getStoreKey(),this.storePdfDLKey=Me.getStorePdfDLKey(),this.storeZipDLKey=Me.getStoreZipDLKey(),this.storeRemoveResultKey=Me.getStoreRemoveResultKey(),this.storeExportResultKey=Me.getStoreExportResultKey(),this.stateId=this.id+"Button",this.isExported=!1}render(t,e){const a=_(this.stateId,["button","disable"],"-no export Zip-");return _(this.id,[this.id+"Frame"],{},[a])}onAfterAttach(t,e){}async onViewShow(t,e){if(t[this.storeZipDLKey]){const e=t[this.storeZipDLKey];e.ab?He.download(e.name,e.ab,"application/zip"):alert("not exported!")}else if(t[this.storeKey]){const e=t[this.storeKey].zip;if(e){e.name,e.orderName,Oe(e.updateDate);const t=_(this.stateId,["button","enable"],{on:{click:this.click()}},"download Zip!");this.prePatch("#"+this.stateId,t),this.isExported=!0}else{const t=_(this.stateId,["button","disable"],"no export Zip");this.prePatch("#"+this.stateId,t),this.isExported=!1}}}click(){return t=>{if(this.isExported){const t=Me.createDownloadAction();this.dispatch(t)}return t.stopPropagation(),!1}}}class Qe extends Q{constructor(){super("DownloadLastExportPdfButton","DownloadLastExportPdfButton",!0),this.storeKey=Me.getStoreKey(),this.storePdfDLKey=Me.getStorePdfDLKey(),this.storeZipDLKey=Me.getStoreZipDLKey(),this.storeRemoveResultKey=Me.getStoreRemoveResultKey(),this.storeExportResultKey=Me.getStoreExportResultKey(),this.stateId=this.id+"Button",this.isExported=!1}render(t,e){const a=_(this.stateId,["button","disable"],"-no export PDF-");return _(this.id,[this.id+"Frame"],{on:{click:this.click()}},[a])}onAfterAttach(t,e){}async onViewShow(t,e){if(t[this.storePdfDLKey]){const e=t[this.storePdfDLKey];e.ab?He.download(e.name,e.ab,"application/pdf"):alert("not exported!")}else if(t[this.storeKey]){const e=t[this.storeKey].pdf;if(e){e.name,e.orderName,Oe(e.updateDate);const t=_(this.stateId,["button","enable"],"download PDF!");this.prePatch("#"+this.id,_(this.id,[this.id+"Frame","enable"],{on:{click:this.click()}},[t])),this.isExported=!0}else{const t=_(this.stateId,["button","disable"],"no export PDF");this.prePatch("#"+this.id,_(this.id,[this.id+"Frame","disable"],{on:{click:this.click()}},[t])),this.isExported=!1}}}click(){return t=>{if(this.isExported){const t=Me.createDownloadPdfAction();this.dispatch(t)}return t.stopPropagation(),!1}}}class ta extends Q{constructor(){super("DeleteExportOneButton","DeleteExportOneButton",!0),this.storeKey=Me.getStoreKey(),this.storePdfDLKey=Me.getStorePdfDLKey(),this.storeZipDLKey=Me.getStoreZipDLKey(),this.storeRemoveResultKey=Me.getStoreRemoveResultKey(),this.storeExportResultKey=Me.getStoreExportResultKey()}render(t,e){return _(this.id,[this.id+"Frame"],{on:{click:this.click()}},[_("",["button"],"delete Exports!")])}onAfterAttach(t,e){}async onViewShow(t,e){if(t[this.storeRemoveResultKey]){alert("delete exports!");const t=Me.creatLoadAction(this);this.dispatch(t)}}click(){return t=>{const e=Me.creatRemoveAction();return this.dispatch(e),t.stopPropagation(),!1}}}class ea extends Q{constructor(){super("ExportButton","ExportButtonFrame"),this.storeKey=Me.getStoreKey(),this.exportAllButton=new Ge,this.exportImgZipButton=new qe,this.exportPdfButton=new Je,this.downloadLastExportZipButton=new $e,this.downloadLastExportPdfButton=new Qe,this.deleteExportOneButton=new ta}onAfterAttach(t,e){this.exportAllButton.attach(this),this.exportImgZipButton.attach(this),this.exportPdfButton.attach(this),this.downloadLastExportZipButton.attach(this),this.downloadLastExportPdfButton.attach(this),this.deleteExportOneButton.attach(this),Ye.register();const a=Me.creatLoadAction(this);this.dispatch(a)}async onViewShow(t,e){t[this.storeKey]}render(t,e){return _("",["ExportButtons"],[_(this.exportAllButton.id),_(this.exportImgZipButton.id),_(this.exportPdfButton.id),_(this.downloadLastExportZipButton.id),_(this.downloadLastExportPdfButton.id),_(this.deleteExportOneButton.id)])}}class aa extends Q{constructor(t){super("ExportOrderRow","ExportOrderRow"),this.parent=t,this.selectOrder=null,this.ordersMap={},this.orderOptions={isGrascale:!1,dpiName:"dpi72",isMaxSize10M:!1},this.activeClassName="active"}render(t,e){const a=_("",["TitleName"],"TitleName");return _("",[this.id+"Frame"],[a,_(this.imageAreaID,["ImageDetailA"],this.id+"aaaaa")])}onAfterAttach(t,e){}async onViewShow(t,e){}getCurrentSelected(){return this.ordersMap[this.selectOrder]}getSelectOrder(t){return e=>{t&&(this.selectOrder=t);const a=Me.createSelectOrderAction(this.parent,{selectOrder:this.ordersMap[this.selectOrder],selectOptions:this.parent.getCurrentOptions()});return this.dispatch(a),e.stopPropagation(),!1}}buildRows(t){const e=[],a=ae,i=t&&t.selectOrder?t.selectOrder:null;for(let t of a){const a=t.orderName,r=i&&i.orderName&&t.orderName===i.orderName?this.activeClassName:"";this.ordersMap[a]=t;const s=U("",[a+"Text"],[a]),n=_("ExportOrderRow-"+a,[a,r],{on:{click:this.getSelectOrder(a)}},[s]);e.push(n)}return e}}class ia extends Q{constructor(){super("ExportOrdrList","ExportOrdrList"),this.exportOrderRow=new aa(this),this.storeSelectedOrderKey=Me.getStoreSelectedOrderKey(),this.listFrameId=this.id+"ListFrame",this.listId=this.id+"List",this.checkboxIsGrascale="checkboxIsGrascaleAt"+this.Id,this.selectBoxDpiName="selectBoxDpiNameAt"+this.Id,this.checkboxIsMaxSize10M="checkboxIsMaxSize10MAt"+this.Id}render(t,e){const a=_("",["ExportOrdrs"],"Export Orders List"),i=X("",["ExportOrdersOptions"],[W(this.checkboxIsGrascale,[""],{on:{change:this.exportOrderRow.getSelectOrder()}},""),"isGrascale?"]),r={};let s="";for(let t in $t){s=$t[t];break}console.error(r);const n=X("",["ExportOrdersOptions"],[" ",G(this.selectBoxDpiName,[],"",$t,r[s],{change:this.exportOrderRow.getSelectOrder()}),"dpi"]),o=X("",["ExportOrdersOptions"],[W(this.checkboxIsMaxSize10M,[""],{on:{change:this.exportOrderRow.getSelectOrder()}},""),"isMaxSize10MB/Paper?"]),l=_("",["ExportOrdrs"],["Options:",n,i,o]),c=_(this.listFrameId,["ExportOrdrs"],this.buildRows());return _(this.listId,[this.id+"Frame"],[a,c,l])}onAfterAttach(t,e){}async onViewShow(t,e){if(t[this.storeSelectedOrderKey]){const e="ExportOrdrs",a=t[this.storeSelectedOrderKey],i=_(this.listFrameId,[e],this.buildRows(a));this.prePatch("#"+this.listFrameId,i)}}getCurrentOptions(){return{isGrascale:document.getElementById(this.checkboxIsGrascale).checked,dpiName:document.getElementById(this.selectBoxDpiName).value,isMaxSize10M:document.getElementById(this.checkboxIsMaxSize10M).checked}}buildRows(t=null){return this.exportOrderRow.buildRows(t)}}class ra extends Q{constructor(){super("ExportArea","ExportArea"),this.text="ExportArea",this.exportButton=new ea,this.exportOrderList=new ia}onAfterAttach(t,e){this.exportOrderList.attach(this),this.exportButton.attach(this);const a=Me.creatLoadAction();this.dispatch(a)}render(){return _(this.id,["ExportArea"],[_("",[""],this.text),_(this.exportOrderList.id),_(this.exportButton.id)])}}class sa extends Q{constructor(){super("ImageDetail","ImageDetail"),this.imageAreaID=this.id+"child",this.isOnScroll=!1,this.startX=0,this.startY=0}render(t,e){return _("",[""],[_("",["ImageDetailTitle"],"ImageDetailTitle"),_(this.imageAreaID,["ImageDetailA"],this.id+"aaaaa")])}async onViewShow(t,e){t.imagesDetailData&&(await this.showImage(t.imagesDetailData),this.startX=0,this.startY=0,this.offsetX=0,this.offsetY=0,this.isOnScroll=!1)}async showImage(t){const{imageEntity:e,binaryEntity:a,imageText:i}=t,r=e.getPk(),s=ft.arrayBuffer2DataURI(a._ab),n=z(r+"_image",e.name,e.name,s,{}),o=U(r+"_text",["thumbnail_text"],t.imageText),l=[_("",[""],[n]),_("",[o])];this.prePatch("#"+this.imageAreaID,_(this.imageAreaID,["image_detail_block"],{on:{mousedown:this.onMouseOn(),mousemove:this.onMouseMove()},style:{top:0,left:0}},l))}click(){return t=>{alert("click")}}onMouseOn(){return t=>{this.startX=this.offsetX?t.clientX+0*this.offsetX-this.offsetX１:t.clientX,this.startY=this.offsetY?t.clientY+0*this.offsetY-this.offsetY１:t.clientY;t.target;this.isOnScroll=!this.isOnScroll}}onMouseOff(){return t=>{t.target;this.isOnScroll=!1}}onMouseMove(){return t=>{const e=t.target;if(this.isOnScroll){const a=t.clientX,i=t.clientY,r=a-this.startX,s=i-this.startY,n=e.parentNode.parentNode;n.style.top=s+"px",n.style.left=r+"px",this.offsetX=this.startX,this.offsetY=this.startY,this.offsetX１=r,this.offsetY１=s}}}}class na extends Q{constructor(t,e,a){super("PageImage"+e,"PageImage"),this.ip=this.ms.ip,this.parent=t,this.draggableArea=a,this.listing=e,this.thumbnail=null,this.thumbnail_block="thumbnail_block"}render(){return this.button=_(this.id+"child","PageImageA",this.id),_([this.button])}async setPageData(t,e){if(this.pageData=t,this.imageData=e,!t)return;this.pk=t.getPk();const a=this.imageData?this.imageData.binaryEntity:null;if(a){const t={name:"page_"+this.listing,ab:a._ab,type:a.type};this.thumbnail=await this.ip.createImageNodeByData(t).catch(t=>{throw console.log(t),t})}else this.thumbnail=null}render(t,e){return _("","")}remove(t){return e=>{if(window.confirm("delete ok?")){const e=we.creatRemoveAction(this,{imagePKforDelete:t});this.dispatch(e)}}}handleDragStart(t){return e=>{const a=e.target;if(this.parent.dropElm=null,!a.classList||!a.classList.contains(this.thumbnail_block))return;a.style.opacity="0.4",this.draggableArea.nowSelectedElm=a,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",a.innerHTML);let i=document.createElement("img");i.src=t,i.width=100,e.dataTransfer.setDragImage(i,-10,-10)}}handleDragOver(){return t=>{const e=t.target;if(e.classList&&e.classList.contains(this.thumbnail_block))return t.preventDefault(),t.dataTransfer.dropEffect="move",!1}}handleDragEnter(){return t=>{const e=t.target;e.classList&&e.classList.contains(this.thumbnail_block)&&e.classList.add("over")}}handleDragLeave(){return t=>{const e=t.target;e.classList&&e.classList.contains(this.thumbnail_block)&&e.classList.remove("over")}}handleDrop(t){return t=>{t.stopPropagation(),t.preventDefault();const e=t.target;if(!e.classList||!e.classList.contains(this.thumbnail_block))return;this.parent.dropElm=e;const a=this.draggableArea.nowSelectedElm;if(a&&a.dataset.pk&&a!==e){const t=a.dataset.pk,i=e.dataset.pk;if(t&&a.dataset.is_image){const e=we.creatAddPageAction(this,{imagePk:t,pagePk:i});this.dispatch(e)}else if(t&&a.dataset.is_page){const e=we.creatSortPagesAction(this,{formPk:t,toPk:i});this.dispatch(e)}}const i=e.parentNode.childNodes;for(let t=0;t<i.length;t++){i[t].classList.remove("over")}return!1}}handleDragEnd(t){return t=>{const e=t.target,a=e.dataset.pk;if(console.log("sort handleDrop imagePKmove:"+this.draggableArea.nowSelectedElm+"/elm.dataset.pk:"+e.dataset.pk+"/targetPk:"+a),!e.classList||!e.classList.contains(this.thumbnail_block))return;this.draggableArea.nowSelectedElm=null,e.style.opacity="1";const i=e.parentNode.childNodes;for(let t=0;t<i.length;t++){i[t].classList.remove("over")}if(null!==this.draggableArea.cancelPageArea){const t=we.creatRemovePageAction(this,{pagePk:a});this.dispatch(t)}}}selectImage(t){return t=>{t.stopPropagation(),t.preventDefault();const e=t.target;if(console.log("sort selecImage imagePKmove:/elm.dataset.pk:"+e.dataset.pk+"/"+this.pageData),this.pageData&&this.pageData.baseImage){const t=ye.creatDetailAction(this,{imagePK:this.pageData.baseImage});this.dispatch(t)}return!1}}renderVnode(t){if(!this.pageData)return _(this.id,["aaaaaaa"+this.listing],"null"+this.listing);const e=this.thumbnail?this.thumbnail.src:"aaaaaaaaaaaaaaaaaaa",a=e?{"background-image":"url("+e+")"}:{},i=_(this.id,["thumbnail_block"],{on:{dragstart:this.handleDragStart(e),dragover:this.handleDragOver(),dragenter:this.handleDragEnter(),dragleave:this.handleDragLeave(),drop:this.handleDrop(),dragend:this.handleDragEnd(),click:this.selectImage()},dataset:{pk:this.pk,is_page:!0},style:a,props:{draggable:"true"}},[_("",["page_block"],[])]);return t.prePatch("#"+this.id,i),i}createVnode(){}}class oa{constructor(){}static creatOpenAction(t,e,a=null){return k.createBaseAction("openPreview",t,e,a)}static creatCloseAction(t,e,a=null){return k.createBaseAction("closePreview",t,e,a)}static creatNextAction(t,e,a=null){return k.createBaseAction("nextPreview",t,e,a)}static creatBackAction(t,e,a=null){return k.createBaseAction("backPreview",t,e,a)}static getStorePreviewKey(){return"previewCommand"}}class la extends Q{constructor(t){super("PageImages","PageImages"),this.storeKey=Ke.getStoreKey(),this.childId=this.id+"child",this.thumbnails={},this.dummyClass="Dummy",this.pages=[],this.storeImagesKey=ye.getStoreImagesKey(),this.storePagesKey=we.getStorePagesKey();for(let e=0;e<32;e++)this.pages.push(new na(this,e,t));this.dropElm=null,this.lastSettingOne=null,this.lastPagesData=null,this.lastImagesData=null}render(){return this.setting=_(this.id+"child",["PageImagesA"],this.id),_(this.id,"PageImages",[this.setting])}async onViewShow(t,e){const a=t[this.storePagesKey],i=t[this.storeImagesKey],r=JSON.stringify(a),s=JSON.stringify(i);if(i&&a&&(this.lastPagesData!==r||this.lastImagesData!==s)&&(await this.showPages(a,i),this.lastPagesData=r,this.lastImagesData=s),t[this.storeKey]){const e=t[this.storeKey],a=JSON.stringify(e);if(a===this.lastSettingOne)return;const i=this.buildPageFrames(e);this.prePatch("#"+this.childId,_(this.childId,i)),this.lastSettingOne=a}}addPage(t,e){const a=we.creatAddPageAction(this,{imagePk:t,pagePk:e});this.dispatch(a)}async showPages(t,e){const a={};for(let t of e){a[t.imageEntity.getPk()]=t}let i=0;for(let e of t){const t=this.pages[i];if(i++,!e)continue;e.getPk();const r=a[e.baseImage];await t.setPageData(e,r),t.renderVnode(this)}}creatPageFrame(t,e,a){const i=[];if(e===this.dummyClass)return i;const r="pageFrameHeader"+(a?"Right":"Left");i.push(_("",["pageFrameHeader",r],t+""));const s=t-1,n=this.pages[s].renderVnode(this);return i.push(n),i}showPreviewSingle(){return t=>{const e=oa.creatOpenAction(this,{isSingle:!0});this.dispatch(e)}}showPreviewDual(){return t=>{const e=oa.creatOpenAction(this,{isSingle:!1});this.dispatch(e)}}buildPreviewButtons(){const t=_("",["previewCallButton"],{on:{click:this.showPreviewSingle()}},"Preview Single"),e=_("",["previewCallButton"],{on:{click:this.showPreviewDual()}},"Preview Dual");return _("",["previewFrame"],[t,e])}buildPageFrames(t){const e=[];e.push(this.buildPreviewButtons());const a=t.startPage,i=1*t.pageNum;this.pageNum=i;const r=t.pageDirection,s="r2l"===r,n="r"===a,o=Math.ceil(i/2),l=i%2==1,c=0===r.indexOf(a),h=1*o+1*(l?1:c?0:1),d=this.dummyClass,u=s&&n||!s&&!n,p=!n||u?"":d,g=n||u?"":d,m=l&&(!u||u&&!s)||!l&&(!s||u)?"":d,f=l&&(!u||u&&s)||!l&&(s||u)?"":d,y=h-1;let w=0,b=0;for(let t=0;t<h;t++){const a=(s?1:0)+b+w,i=(s?0:1)+b+w,r=[];if(0===t){const t=s&&u?2:s?1:u?1:0,e=s&&u?1:s?0:u?2:1;r.push(_("",["Page",p],this.creatPageFrame(t,p,!1),h+"L"+t+" "+c)),r.push(_("",["Page",g],this.creatPageFrame(e,g,!0),o+"R"+e+" "+l)),b=1,w+=u?2:1}else t===y?(r.push(_("",["Page",m],this.creatPageFrame(a,m,!1),"L"+a)),r.push(_("",["Page",f],this.creatPageFrame(i,f,!0),"R"+i))):(r.push(_("",["Page"],this.creatPageFrame(a,"",!1),"L"+a)),r.push(_("",["Page"],this.creatPageFrame(i,"",!0),"R"+i)),w+=2);e.push(_("",["PageFrame"],r,"pageFrame index:"+t))}return e}}let ca=null;class ha extends q{constructor(){super(),this.ms=ue.getInstance(),this.tm=this.ms.tm,this.pvp=new _e,this.previewOpenAction=oa.creatOpenAction(),this.previewCloseAction=oa.creatCloseAction(),this.previewNextAction=oa.creatNextAction(),this.previewBackAction=oa.creatBackAction(),this.atatch(this.previewOpenAction),this.atatch(this.previewCloseAction),this.atatch(this.previewNextAction),this.atatch(this.previewBackAction),this.storeKey=oa.getStorePreviewKey(),this.storeSettingKey=Ke.getStoreKey()}static register(){ca||(ca=new ha)}async reduce(t,e){if(this.previewOpenAction.type===e.type){const a=e.data.isSingle,i=await this.tm.loadSettings().catch(t=>{console.log(t)}),r=await this.loadPreviews(i,a);t[this.storeKey]={isSingle:a,list:r,setting:i}}else this.previewCloseAction.type===e.type?t[this.storeKey]={type:this.previewCloseAction.type}:this.previewNextAction.type===e.type?t[this.storeKey]={isSingle:e.data.isSingle,nowSetNum:e.data.pageNo,type:this.previewNextAction.type}:this.previewBackAction.type===e.type&&(t[this.storeKey]={isSingle:e.data.isSingle,nowSetNum:e.data.pageNo,type:this.previewBackAction.type});return t}async loadPreviews(t,e){const a=await this.pvp.loadPreviews();return this.pvp.shapeListBySets(a,e,t)}}class da extends Q{constructor(){super("Preview","Preview",!0),this.storeKey=oa.getStorePreviewKey(),this.previewOpenAction=oa.creatOpenAction(),this.previewCloseAction=oa.creatCloseAction(),this.previewNextAction=oa.creatNextAction(),this.previewBackAction=oa.creatBackAction(),this.list=[],this.currentSetNum=0,this.isSingle=!0,this.classNameRight="previeRight",this.classNameLeft="previeLeft",this.dummyClassName="dummy",this.closeActionType=this.previewCloseAction.type}onAfterAttach(t,e){ha.register()}render(){const t=_("",["previewFrame"],[_("",["previewLeft"],"<"),_("",["previewFrameA"],{style:{width:"100%"}}),_("",["previewRight"],">")]);return _(this.id,["Preview"],{style:{display:"none"},on:{click:this.beClose()}},[t])}async onViewShow(t,e){const a=t[this.storeKey];if(a){const{isSingle:t,nowSetNum:e,list:i,type:r,setting:s}=a;if(void 0!==t&&(this.isSingle=t),s&&(this.setting=s),i)this.list=i;else if(r===this.previewCloseAction.type)return this.list=null,void this.closePreview();this.currentVnode.elm.style.display="block";const n=this.list.length,o="r2l"===this.setting.pageDirection;if(i){const e=1;this.pageNo=e,this.showPreview(this.list,t,this.pageNo,o)}else if(this.previewNextAction.type===r){if(!(n>e))return;{const a=1*e+1;this.pageNo=a,this.showPreview(this.list,t,this.pageNo,o)}}else if(this.previewBackAction.type===r){if(!(e>1))return;{const a=1*e-1;this.pageNo=a,this.showPreview(this.list,t,this.pageNo,o)}}}}showPreview(t,e,a,i){const r=t[a-1];let s=null;const n=_("",["previewLeft"],{on:{click:i?this.goNext():this.goBack()}},"<"),o=_("",["previewRight"],{on:{click:i?this.goBack():this.goNext()}},">");if(e){const t=r.binary,e=this.buildImageArea(t,a,null);s=_("",["preview_single"],{style:{width:"100%"},on:{click:this.doNothing()}},[e])}else{const t=2*(a-1)+(i?1:0),e=2*(a-1)+(i?0:1),n=this.buildImageArea(r[0].binary,t,!1),o=this.buildImageArea(r[1].binary,e,!0);s=_("",["preview_dual"],{style:{width:"100%"},on:{click:this.doNothing()}},[n,o])}this.prePatch(".previewFrame",_("",["previewFrame"],{style:{}},[n,s,o]))}buildImageArea(t,e,a){null===a||(a?this.classNameRight:this.classNameLeft);if(t){const a=ft.arrayBuffer2DataURI(t._ab),i=z(t.pk+"_preview","preview_"+e,"",a,{}),r=_("",["previewInfo"],{},"pageNo:"+e);return _("",["previewImageFrame"],{},[r,i])}{const a=void 0===t,i=a?"no Page":"no image set",r=a?this.dummyClassName:"",s=a?"----":"pageNo:"+e,n=_("",["previewInfo"],{},i),o=_("",["previewInfo"],{},s);return _("",["previewImageFrame",r],{},[o,n])}}beClose(){return t=>{const e=oa.creatCloseAction(this,{isSingle:this.isSingle});return this.dispatch(e),t.stopPropagation(),!1}}doNothing(){return t=>(t.stopPropagation(),!1)}goNext(){return t=>{const e=oa.creatNextAction(this,{isSingle:this.isSingle,pageNo:this.pageNo});return this.dispatch(e),t.stopPropagation(),!1}}goBack(){return t=>{const e=oa.creatBackAction(this,{isSingle:this.isSingle,pageNo:this.pageNo});return this.dispatch(e),t.stopPropagation(),!1}}closePreview(){this.currentVnode.elm.style.display="none"}}class ua extends Q{constructor(t,e){super("Thumnail"+t.id,"Thumnail"),this.parent=t,this.draggableArea=e,this.ip=this.ms.ip,this.draggableArea.nowSelectedElm=null,this.thumbnail_block="thumbnail_block",this.displayNone="display_none"}setImageData(t){this.imageData=t}render(t,e){return _("","")}remove(t){return e=>{if(window.confirm("delete ok?")){const e=ye.creatRemoveAction(this,{imagePKforDelete:t});this.dispatch(e)}}}handleDragStart(t){return e=>{const a=e.target;if(!a.classList||!a.classList.contains(this.thumbnail_block))return;a.style.opacity="0.4",this.draggableArea.nowSelectedElm=a,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",a.innerHTML);let i=document.createElement("img");i.src=t,i.width=100,e.dataTransfer.setDragImage(i,-10,-10)}}handleDragOver(){return t=>{const e=t.target;if(e.classList&&e.classList.contains(this.thumbnail_block))return t.preventDefault(),t.dataTransfer.dropEffect="move",!1}}handleDragEnter(){return t=>{const e=t.target;e.classList&&e.classList.contains(this.thumbnail_block)&&e.classList.add("over")}}handleDragLeave(){return t=>{const e=t.target;e.classList&&e.classList.contains(this.thumbnail_block)&&e.classList.remove("over")}}handleDrop(t){return t=>{t.stopPropagation(),t.preventDefault();const e=t.target;if(!e.classList||!e.classList.contains(this.thumbnail_block))return;const a=this.draggableArea.nowSelectedElm;if(a&&a.dataset.pk&&a!==e){const t=a.dataset.pk;if(a.dataset.is_image){const a=ye.creatSortImagesAction(this,{imagePKmove:t,imagePKdrop:e.dataset.pk});this.dispatch(a)}else if(a.dataset.is_page){const e=we.creatRemovePageAction(this,{pagePk:t});this.dispatch(e)}this.draggableArea.nowSelectedElm=null}const i=e.parentNode.childNodes;for(let t=0;t<i.length;t++){i[t].classList.remove("over")}return!1}}handleDragEnd(t){return t=>{const e=t.target;if(!e.classList||!e.classList.contains(this.thumbnail_block))return;const a=this.draggableArea.nowSelectedElm;console.log("handleDragEnd imagePKmove:"+(a?a.dataset.pk:a)+"/elm.dataset.pk:"+e.dataset.pk),e.style.opacity="1";const i=e.parentNode.childNodes;for(let t=0;t<i.length;t++){i[t].classList.remove("over")}}}selectImage(t){return t=>{t.stopPropagation(),t.preventDefault();const e=t.target;console.log(" selecImage imagePKmove:/elm.dataset.pk:"+e.dataset.pk);const a=ye.creatDetailAction(this,{imagePK:e.dataset.pk});return this.dispatch(a),!1}}async crateDataLine(t,e={}){const a=t.imageEntity,i=t.binaryEntity,r={name:a.name,ab:i._ab,type:a.type},s=await this.ip.createImageNodeByData(r).catch(t=>{throw console.log(t),t}),n=a.getPk(),o=U(n+"_text",["thumbnail_text"],t.imageText),l=U(n+"_delButton",["delButton"],{on:{click:this.remove(n)}},"x"),c=_("",["image_block"],{on:{dragstart:this.handleDragStart(s.src),dragover:this.handleDragOver(),dragenter:this.handleDragEnter(),dragleave:this.handleDragLeave(),drop:this.handleDrop(),dragend:this.handleDragEnd(),click:this.selectImage()},style:{"background-image":"url("+s.src+")"},dataset:{pk:n,is_image:!0},props:{draggable:"true"}}),h={};return h[this.displayNone]=e[n],_("",[this.thumbnail_block],{on:{dragstart:this.handleDragStart(s.src),dragover:this.handleDragOver(),dragenter:this.handleDragEnter(),dragleave:this.handleDragLeave(),drop:this.handleDrop(),dragend:this.handleDragEnd(),click:this.selectImage()},class:h,dataset:{pk:n,is_image:!0},props:{draggable:"true"}},[l,c,o])}}class pa extends Q{constructor(t){super("Thumnails","Thumnails"),this.imageAreaID="thumnailsImageArea",this.thumbnail=new ua(this,t),this.ip=this.ms.ip,this.storePagesKey=we.getStorePagesKey(),this.pageMap={},this.thumbnails_block="thumbnails_block",this.draggableArea=t,this.draggableArea.cancelPageArea=null}onAfterAttach(t,e){const a=ye.creatLoadImagesAction(this,{});this.dispatch(a)}async onViewShow(t,e){const a=t[this.storePagesKey];t.imagesData&&a&&(this.updatePageMap(a),await this.showImages(t.imagesData))}render(t,e){return _(this.imageAreaID,"Thumnails")}updatePageMap(t){for(let t in this.pageMap)delete this.pageMap[t];for(let e of t){const t=e.baseImage;t&&(this.pageMap[t]=!0)}}handleDragEnter(){return t=>{const e=t.target;e.classList&&e.classList.contains(this.thumbnails_block)&&(e.classList.add("over"),this.draggableArea.cancelPageArea=e)}}handleDragLeave(){return t=>{const e=t.target;e.classList&&e.classList.contains(this.thumbnails_block)&&(e.classList.remove("over"),setTimeout(()=>{this.draggableArea.cancelPageArea=null},100))}}handleDrop(t){return t=>{t.stopPropagation(),t.preventDefault();t.target;return!1}}reset(){return t=>{t.target}}async showImages(t){const e=[];for(let a of t){if(!a)continue;a.imageEntity.getPk();const t=await this.thumbnail.crateDataLine(a,this.pageMap).catch(t=>{console.log(t)});e.push(t)}const a=_(this.imageAreaID,[this.thumbnails_block],{on:{dragover:this.handleDragEnter(),dragstart:this.handleDragEnter(),dragenter:this.handleDragEnter(),dragleave:this.handleDragLeave(),drop:this.handleDrop(),dragend:this.handleDrop(),click:this.reset()},props:{draggable:"true"}},e);this.prePatch("#"+this.imageAreaID,a)}}let ga=null;class ma extends q{constructor(){super(),this.ms=ue.getInstance(),this.im=this.ms.im,this.pageAddAction=we.creatAddPageAction(),this.pageRemoveAction=we.creatRemovePageAction(),this.pagesResetAction=we.creatResetPagesAction(),this.pagesSortAction=we.creatSortPagesAction(),this.atatch(this.dropImageToPageAction),this.atatch(this.pageAddAction),this.atatch(this.pageRemoveAction),this.atatch(this.pagesResetAction),this.atatch(this.pagesSortAction),this.pp=new be,this.storeKey=we.getStorePagesKey(),this.storeImagesKey=ye.getStoreImagesKey()}static register(){ga||(ga=new ma)}async reduce(t,e){return this.pageAddAction.type===e.type?(t[this.storeKey]=await this.add(e.data.imagePk,e.data.pagePk),t[this.storeImagesKey]=await this.loadImages()):this.pageRemoveAction.type===e.type?(t[this.storeKey]=await this.remove(e.data.pagePk),t[this.storeImagesKey]=await this.loadImages()):this.pagesResetAction.type===e.type?(t[this.storeKey]=await this.reset(),t[this.storeImagesKey]=await this.loadImages()):this.pagesSortAction.type===e.type&&(t[this.storeKey]=await this.move(e.data.formPk,e.data.toPk),t[this.storeImagesKey]=await this.loadImages()),t}async loadImages(){return await this.im.loadImages()}async add(t,e){return await this.pp.add(t,e),await this.pp.loadPages()}async remove(t){return await this.pp.remove(t),await this.pp.loadPages()}async reset(){return await this.pp.resetPagesFull()}async move(t,e){return await this.pp.move(t,e),await this.pp.loadPages()}}class fa extends Q{constructor(){super("FilesArea","FilesArea"),this.nowSelectedElm=null,this.imageDetail=new sa,this.pageImages=new la(this),this.thumbnails=new pa(this),this.preview=new da,Ae.register(),ma.register()}onAfterAttach(t,e){this.imageDetail.attach(this),this.pageImages.attach(this),this.thumbnails.attach(this),this.preview.attach(this)}render(){return _("",[_(this.pageImages.id),_(this.thumbnails.id),_(this.imageDetail.id),_(this.preview.id)])}}class ya extends Q{constructor(){super("container","container"),this.fileUploadArea=new De,this.titleSettings=new Re,this.filesArea=new fa,this.exportArea=new ra,this.progressBar=new me}onAfterAttach(t,e){this.fileUploadArea.attach(this),this.titleSettings.attach(this),this.filesArea.attach(this),this.exportArea.attach(this),this.progressBar.attach(this)}render(){return _({style:{color:"#000"}},[_(this.fileUploadArea.id),_(this.progressBar.id),_(this.titleSettings.id),_(this.filesArea.id),_(this.exportArea.id)],"container")}}class wa extends Q{constructor(){super("footer","footer"),this.copyright="ryunosinfx"}render(){return _({style:{color:"#000"}},[_("copyright",["copyright"],this.copyright)])}}class ba extends Q{constructor(t,e){super("frame","frame"),this.ms=t,Q.setMainService(t),this.initialize(e)}initialize(t){this.header=new tt(t),this.footer=new wa,this.container=new ya,this.menu=new et,this.baseFrame=null,this.view="",this.initialPatch()}async onViewShow(t,e){this.header.attach(this,"#header"),this.menu.attach(this,"#menu"),this.container.attach(this,"#container"),this.footer.attach(this,"#footer")}render(t){return _("frame",["frame"],{},[_("header",{style:{color:"#000"}},"hellow!!"),_("menu",{style:{color:"#000"}},"menu!!"),_("container",{style:{color:"#000"}},[_("content",{style:{color:"#000"}},"content!!")],"container!!"),_("footer",{style:{color:"#000"}},"footer!!?")])}}a.d(e,"default",function(){return Aa});const va="CopiBon";class Aa{constructor(){this.mainService=ue.getInstance()}async init(){await this.mainService.init(),this.mf=new ba(this.mainService,va)}static main(){(new Aa).init()}}Aa.main()},function(t,e,a){"use strict";function i(t,e,a,i,r){return{sel:t,data:e,children:a,text:i,elm:r,key:void 0===e?void 0:e.key}}a.r(e);var r=i,s=Array.isArray;function n(t){return"string"==typeof t||"number"==typeof t}var o={createElement:function(t){return document.createElement(t)},createElementNS:function(t,e){return document.createElementNS(t,e)},createTextNode:function(t){return document.createTextNode(t)},createComment:function(t){return document.createComment(t)},insertBefore:function(t,e,a){t.insertBefore(e,a)},removeChild:function(t,e){t.removeChild(e)},appendChild:function(t,e){t.appendChild(e)},parentNode:function(t){return t.parentNode},nextSibling:function(t){return t.nextSibling},tagName:function(t){return t.tagName},setTextContent:function(t,e){t.textContent=e},getTextContent:function(t){return t.textContent},isElement:function(t){return 1===t.nodeType},isText:function(t){return 3===t.nodeType},isComment:function(t){return 8===t.nodeType}};function l(t,e,a){var r,o,l,c={};if(void 0!==a?(c=e,s(a)?r=a:n(a)?o=a:a&&a.sel&&(r=[a])):void 0!==e&&(s(e)?r=e:n(e)?o=e:e&&e.sel?r=[e]:c=e),s(r))for(l=0;l<r.length;++l)n(r[l])&&(r[l]=i(void 0,void 0,void 0,r[l],void 0));return"s"!==t[0]||"v"!==t[1]||"g"!==t[2]||3!==t.length&&"."!==t[3]&&"#"!==t[3]||function t(e,a,i){if(e.ns="http://www.w3.org/2000/svg","foreignObject"!==i&&void 0!==a)for(var r=0;r<a.length;++r){var s=a[r].data;void 0!==s&&t(s,a[r].children,a[r].sel)}}(c,r,t),i(t,c,r,o,void 0)}function c(t,e){e.elm=t.elm,t.data.fn=e.data.fn,t.data.args=e.data.args,e.data=t.data,e.children=t.children,e.text=t.text,e.elm=t.elm}function h(t){var e=t.data;c(e.fn.apply(void 0,e.args),t)}function d(t,e){var a,i=t.data,r=e.data,s=i.args,n=r.args;if(i.fn===r.fn&&s.length===n.length){for(a=0;a<n.length;++a)if(s[a]!==n[a])return void c(r.fn.apply(void 0,n),e);c(t,e)}else c(r.fn.apply(void 0,n),e)}var u=function(t,e,a,i){return void 0===i&&(i=a,a=e,e=void 0),l(t,{key:e,hook:{init:h,prepatch:d},fn:a,args:i})};function p(t){return void 0===t}function g(t){return void 0!==t}a.d(e,"init",function(){return b}),a.d(e,"h",function(){return l}),a.d(e,"thunk",function(){return u});var m=r("",{},[],void 0,void 0);function f(t,e){return t.key===e.key&&t.sel===e.sel}function y(t,e,a){var i,r,s,n={};for(i=e;i<=a;++i)null!=(s=t[i])&&void 0!==(r=s.key)&&(n[r]=i);return n}var w=["create","update","remove","destroy","pre","post"];function b(t,e){var a,i,l={},c=void 0!==e?e:o;for(a=0;a<w.length;++a)for(l[w[a]]=[],i=0;i<t.length;++i){var h=t[i][w[a]];void 0!==h&&l[w[a]].push(h)}function d(t,e){return function(){if(0==--e){var a=c.parentNode(t);c.removeChild(a,t)}}}function u(t,e){var a,i=t.data;void 0!==i&&g(a=i.hook)&&g(a=a.init)&&(a(t),i=t.data);var r=t.children,o=t.sel;if("!"===o)p(t.text)&&(t.text=""),t.elm=c.createComment(t.text);else if(void 0!==o){var h=o.indexOf("#"),d=o.indexOf(".",h),f=h>0?h:o.length,y=d>0?d:o.length,w=-1!==h||-1!==d?o.slice(0,Math.min(f,y)):o,b=t.elm=g(i)&&g(a=i.ns)?c.createElementNS(a,w):c.createElement(w);for(f<y&&b.setAttribute("id",o.slice(f+1,y)),d>0&&b.setAttribute("class",o.slice(y+1).replace(/\./g," ")),a=0;a<l.create.length;++a)l.create[a](m,t);if(s(r))for(a=0;a<r.length;++a){var v=r[a];null!=v&&c.appendChild(b,u(v,e))}else n(t.text)&&c.appendChild(b,c.createTextNode(t.text));g(a=t.data.hook)&&(a.create&&a.create(m,t),a.insert&&e.push(t))}else t.elm=c.createTextNode(t.text);return t.elm}function b(t,e,a,i,r,s){for(;i<=r;++i){var n=a[i];null!=n&&c.insertBefore(t,u(n,s),e)}}function v(t){var e,a,i=t.data;if(void 0!==i){for(g(e=i.hook)&&g(e=e.destroy)&&e(t),e=0;e<l.destroy.length;++e)l.destroy[e](t);if(void 0!==t.children)for(a=0;a<t.children.length;++a)null!=(e=t.children[a])&&"string"!=typeof e&&v(e)}}function A(t,e,a,i){for(;a<=i;++a){var r=void 0,s=void 0,n=void 0,o=e[a];if(null!=o)if(g(o.sel)){for(v(o),s=l.remove.length+1,n=d(o.elm,s),r=0;r<l.remove.length;++r)l.remove[r](o,n);g(r=o.data)&&g(r=r.hook)&&g(r=r.remove)?r(o,n):n()}else c.removeChild(t,o.elm)}}function x(t,e,a){var i,r;g(i=e.data)&&g(r=i.hook)&&g(i=r.prepatch)&&i(t,e);var s=e.elm=t.elm,n=t.children,o=e.children;if(t!==e){if(void 0!==e.data){for(i=0;i<l.update.length;++i)l.update[i](t,e);g(i=e.data.hook)&&g(i=i.update)&&i(t,e)}p(e.text)?g(n)&&g(o)?n!==o&&function(t,e,a,i){for(var r,s,n,o=0,l=0,h=e.length-1,d=e[0],g=e[h],m=a.length-1,w=a[0],v=a[m];o<=h&&l<=m;)null==d?d=e[++o]:null==g?g=e[--h]:null==w?w=a[++l]:null==v?v=a[--m]:f(d,w)?(x(d,w,i),d=e[++o],w=a[++l]):f(g,v)?(x(g,v,i),g=e[--h],v=a[--m]):f(d,v)?(x(d,v,i),c.insertBefore(t,d.elm,c.nextSibling(g.elm)),d=e[++o],v=a[--m]):f(g,w)?(x(g,w,i),c.insertBefore(t,g.elm,d.elm),g=e[--h],w=a[++l]):(void 0===r&&(r=y(e,o,h)),p(s=r[w.key])?(c.insertBefore(t,u(w,i),d.elm),w=a[++l]):((n=e[s]).sel!==w.sel?c.insertBefore(t,u(w,i),d.elm):(x(n,w,i),e[s]=void 0,c.insertBefore(t,n.elm,d.elm)),w=a[++l]));(o<=h||l<=m)&&(o>h?b(t,null==a[m+1]?null:a[m+1].elm,a,l,m,i):A(t,e,o,h))}(s,n,o,a):g(o)?(g(t.text)&&c.setTextContent(s,""),b(s,null,o,0,o.length-1,a)):g(n)?A(s,n,0,n.length-1):g(t.text)&&c.setTextContent(s,""):t.text!==e.text&&c.setTextContent(s,e.text),g(r)&&g(i=r.postpatch)&&i(t,e)}}return function(t,e){var a,i,s,n=[];for(a=0;a<l.pre.length;++a)l.pre[a]();for(function(t){return void 0!==t.sel}(t)||(t=function(t){var e=t.id?"#"+t.id:"",a=t.className?"."+t.className.split(" ").join("."):"";return r(c.tagName(t).toLowerCase()+e+a,{},[],void 0,t)}(t)),f(t,e)?x(t,e,n):(i=t.elm,s=c.parentNode(i),u(e,n),null!==s&&(c.insertBefore(s,e.elm,c.nextSibling(i)),A(s,[t],0,0))),a=0;a<n.length;++a)n[a].data.hook.insert(n[a]);for(a=0;a<l.post.length;++a)l.post[a]();return e}}}]);
//# sourceMappingURL=bundle.js.map