!function(e){var t={};function r(a){if(t[a])return t[a].exports;var s=t[a]={i:a,l:!1,exports:{}};return e[a].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(a,s,function(t){return e[t]}.bind(null,s));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/dest/",r(r.s=25)}({0:function(e,t,r){"use strict";r.d(t,"a",function(){return a});class a{static binaryString2ArrayBuffer(e){return a.binaryString2Uint8Array(e).buffer}static arrayBuffer2BinaryString(e){return a.uint8Array2BinaryString(new Uint8Array(e))}static arrayBuffer2base64(e){return btoa(a.uint8Array2BinaryString(new Uint8Array(e)))}static arrayBuffer2DataURI(e,t="application/octet-stream"){return"data:"+t+";base64,"+btoa(a.arrayBuffer2BinaryString(e))}static binaryString2Uint8Array(e){e.split("");const t=e.length,r=new Uint8Array(new ArrayBuffer(t));for(let a=0;a<t;a++)r[a]=e.charCodeAt(a);return r}static uint8Array2BinaryString(e){let t=[];for(let r of e)t.push(String.fromCharCode(r));return t.join("")}static binaryString2DataURI(e,t="application/octet-stream"){return"data:"+t+";base64,"+btoa(e)}static base642DataURI(e,t="application/octet-stream"){return"data:"+t+";base64,"+e}static base642binaryString(e){return atob(e)}static base642ArrayBuffer(e){return a.binaryString2ArrayBuffer(atob(e))}static dataURI2BinaryString(e){return atob(e.split(",")[1])}static dataURI2ArrayBuffer(e){return a.binaryString2Uint8Array(atob(e.split(",")[1])).buffer}static uintArray2ArrayBuffer(e){return e.buffer}static arrayBuffer2Uint8Array(e){return new Uint8Array(e)}static arrayBuffer2Uint16Array(e){return new Uint16Array(e)}static arrayBuffer2Uint32Array(e){return new Uint32Array(e)}static ArrayBuffer2Blob(e,t="application/octet-stream"){return new Blob([e],{type:t})}static readBlob(e){const t=new FileReader,r=new Promise((e,r)=>{t.onload=(r=>{e(t.result)}),t.onerror=(e=>{r(t.error)})});return{asArrayBuffer:()=>(t.readAsArrayBuffer(e),r),asBinaryString:()=>(t.readAsBinaryString(e),r),asDataURL:()=>(t.readAsDataURL(e),r),asText:()=>(t.readAsText(e),r)}}}},1:function(e,t,r){"use strict";r.d(t,"a",function(){return a});class a{static trimByte(e){const t=Math.floor(e),r=t>255?255:t;return r<0?0:r}}},2:function(e,t,r){"use strict";r.d(t,"a",function(){return s});const a="worker.js";class s{constructor(e=a){this.worker=new Worker(e)}postMessage(e,t){return new Promise((r,a)=>{const{transObject:o,tranceArray:n}=s.buildPostObj(e,t);try{this.worker.postMessage(o,n),this.worker.onmessage=(e=>{const t=e.data;r(t)}),this.worker.onerror=(e=>{console.log(e);const t=e;console.error(t.currentTarget),console.error(t.returnValue),console.error(t.srcElement),console.error(t.target),console.error(t.type),console.error(t.eventPhase),console.error(t.timeStamp),console.error(t.message),console.error(t.lineno),console.error(t.error),a(e)})}catch(e){console.error(e),console.error(e.stack)}})}static buildPostObj(e,t){const r=[];return t&&"object"==typeof t?t.key=e:t={key:e},s.buildPostObjExec(t,r),{transObject:t,tranceArray:r}}static buildPostObjExec(e,t){if(e)if(Array.isArray(e)){let r=0;for(let a of e)s.buildPostObjExecParValue(r,a,t),r++}else if("object"==typeof e&&Object.keys(e).length>0)for(let r in e){const a=e[r];void 0!==a&&s.buildPostObjExecParValue(r,a,t)}else s.buildPostObjExecParValue(null,e,t)}static buildPostObjExecParValue(e,t,r){console.log("trance buildPostObjExecParValue currentKey:"+e+"/"+r.length);const a=typeof t;let o=!1;t?t.buffer?(r.push(t.buffer),o=!0):t.byteLength?(r.push(t),o=!0):t instanceof ImageData?(r.push(t.data.buffer),o=!0):"boolean"!==a&&"number"!==a&&"string"!==a||(o=!0):o=!0,!o&&e&&s.buildPostObjExec(t,r)}close(){this.worker.terminate()}}},25:function(e,t,r){"use strict";r.r(t);var a=r(2);const s=new Map,o="DEFAULT_WORKER";class n{static getWorkerInstance(e){return s.has(e)?s.get(e):s.get(o)}constructor(e=o){this.key=e,s.set(this.key,this)}getWorkerKey(){return this.key}async execute(e){const t="hello world! now:"+Date.now();return console.log(t),t}}var i=r(3),c=r(5);const l="ImageWorker";new class extends n{constructor(){super(l);const e=new i.a,t=new c.a;this.classes={},this.classes[e.getClassName()]=e,this.classes[t.getClassName()]=t}static getKey(){return l}async execute(e){return await this.call(e).catch(e=>{console.log(e),console.error(e.stack)})}async call(e){const t=e.className,r=e.methodName,a=this.classes[t];if(a&&a[r])try{await a[r](e).catch(e=>{console.log(e),console.error(e.stack)})}catch(e){console.erroe(e)}return e}};r.d(t,"default",function(){return u});class u extends n{constructor(){super()}}new u;onmessage=(e=>{const t=e.data,r=t?t.key:"";n.getWorkerInstance(r).execute(t).then(e=>{const{transObject:t,tranceArray:s}=a.a.buildPostObj(r,e);postMessage(t,s)},e=>{console.error(e),console.error(e.stack);const t=data,{transObject:s,tranceArray:o}=a.a.buildPostObj(r,t);postMessage(s,o)})})},3:function(e,t,r){"use strict";r.d(t,"a",function(){return s});var a=r(4);class s extends a.a{constructor(){super("ImageMerger"),this.margeReplace=this.margeReplace,this.margeLinninr=this.margeLinninr,this.margeMultiplication=this.margeMultiplication}trimByte(e){const t=Math.floor(e),r=t>255?255:t;return r<0?0:r}async margeReplace(e,t,r,a){await this.margeExc(e,t,r,a,"margeReplace",this.replace())}async margeLinninr(e,t,r,a){await this.margeExc(e,t,r,a,"margeLinninr",this.linier())}async margeMultiplication(e,t,r,a){await this.margeExc(e,t,r,a,"margeMultiplication",this.multiplication())}async margeExc(e,t,r,a,s,o){let n=!0;t||a||(t=e.images,r=e.isBaseWhite,e=e.imageDataBase);const i=[];if(t)for(let e of t)e&&e.data&&e.data.length>0&&(n=!1,i.push(this.convertImageDataToObj(e)));if(!n){if(a){this.threadInit();const t={imageDataBase:e,images:i,isBaseWhite:r};return await this.execute(s,t).catch(e=>{console.log(e),console.error(e.stack)})}this.beWhiteImage(e,r),this.mergeImages(e,t,o)}}beWhiteImage(e,t){if(t){const t=e.data.length;for(let r=0;r<t;r++)e.data[r]=255}}mergeImages(e,t,r){const{data:a,width:s,height:o}=e;for(let e of t){const t=e.data,n=e.width,i=e.height,c=e.offsetY,l=e.offsetX,u=e.offsetY&&e.offsetY>0&&e.offsetY<o?e.offsetY:!e.offsetY||e.offsetY<o?0:o,f=e.offsetX&&e.offsetX>0&&e.offsetX<s?e.offsetX:!e.offsetX||e.offsetX<s?0:s,h=u+i,g=h>o?o:h,d=f+n,y=d>s?s:d;let b=0,m=0,p=0;for(let e=u;e<g;e++){const o=e-c;b=o;for(let i=f;i<y;i++){const c=i-l;p++,r(a,e*s+i,t,o*n+c),m=c}}}}replace(){return(e,t,r,a)=>{const s=4*t,o=4*a;e[s]=r[o],e[s+1]=r[o+1],e[s+2]=r[o+2],e[s+3]=255}}linier(){return(e,t,r,a)=>{const s=4*t,o=4*a;e[s]=e[s]+addOaddOffsetXne[o],e[s+1]=e[s+1]+r[o+1],e[s+2]=e[s+2]+r[o+2]}}multiplication(){return(e,t,r,a)=>{const s=4*t,o=4*a;e[s]=this.trimByte(e[s]*r[o]/255),e[s+1]=this.trimByte(e[s+1]*r[o+1]/255),e[s+2]=this.trimByte(e[s+2]*r[o+2]/255)}}}},4:function(e,t,r){"use strict";r.d(t,"a",function(){return n});var a=r(2);const s={},o="ImageWorker";class n{constructor(e){this.key=e,s[e]=this,this.workerKey}threadInit(){}async execute(e,t,r){t.methodName=e,t.className=this.key;const s={};for(let e in t){const r=t[e];r instanceof ImageData&&(s[e]=r),t[e]=this.convertImageDataToObj(r)}const n=new a.a,i=await n.postMessage(o,t).catch(e=>{console.error(e)});if(i)for(let e in t){const r=i[e];if(!r||!r.data||void 0===r.data.byteLength)continue;const a=t[e];a&&a.data&&void 0!==a.data.byteLength&&(r.data.byteLength>0&&a.data.byteLength<1&&(a.data=r.data))}return i}getClassName(){return this.key}static loadInstance(e){return s(e)}convertImageDataToObj(e){return e&&e.data&&e.data.length>0&&e instanceof ImageData?{width:e.width,height:e.height,data:e.data,offsetX:e.offsetX,offsetY:e.offsetY}:e}}},5:function(e,t,r){"use strict";r.d(t,"a",function(){return n});var a=r(1),s=r(4);r(0);const o=4;class n extends s.a{constructor(){super("ImageResizer"),this.resizeAsLanczos=this.resizeAsLanczos,this.resizeAsByCubic=this.resizeAsByCubic}culcWeightByCubic(e){return t=>{let r=0;return t<=1?r=(e+2)*t*t*t-(e+3)*t*t+1:t<=2&&(r=e*t*t*t-5*e*t*t+8*e*t-4*e),r}}sincLanczos(e){return Math.sin(e*Math.PI)/(e*Math.PI)}lanczosWeight(e=3){return t=>0===t?1:Math.abs(t)<e?this.sincLanczos(t)*this.sincLanczos(t/e):0}async resizeAsLanczos(e,t,r){return await this.resizeExc(e,t,r,"resizeAsLanczos").catch(e=>{console.log(e),console.error(e.stack)})}async resizeAsByCubic(e,t,r){return await this.resizeExc(e,t,r,"resizeAsByCubic").catch(e=>{console.error("resizeAsByCubic resizeExcWithThreadï¼›iamegData"),console.error(e.stack),console.error(e),console.error(e.currentTarget),console.error(e.returnValue),console.error(e.srcElement),console.error(e.target),console.error(e.type),console.error(e.eventPhase),console.error(e.timeStamp),console.error(e.message),console.error(e.lineno),console.error(e.error)})}async resizeExc(e,t,r,a){if(r){return t||(t=e.distImage,e=e.iamegData),this.threadInit(),await this.execute(a,{iamegData:e,distImage:t}).catch(e=>{console.log(e),console.error(e.stack)})}{let r=null,s=null;if(!t){if(!e.rowCount){return await this.resizeExcWithThread(e,t,a).catch(e=>{console.log(e),console.error(e.stack)})}r=e.rowCount,s=e.offsetY,t=e.distImage,e=e.iamegData}if("resizeAsByCubic"===a)return this.resizeAsByCubicExe(e,t,s,r);if("resizeAsLanczos"===a)return this.resizeAsLanczosExe(e,t,s,r)}}resizeExcWithThread(e,t,r){return new Promise((a,s)=>{t=e.distImage,e=e.iamegData,this.threadInit();const n=t.data,i=t.width,c=t.height,l=e.data,u=e.width,f=e.height,h=[];let g=0;const d=Math.floor(c/o);for(let e=0;e<o;e++){const t=o-1===e?c-g:d,a={data:new Uint8ClampedArray(4*i*t),width:i,height:c},s=l.length,n=new Uint8ClampedArray(s);for(let e=0;e<s;e++)n[e]=l[e];const y={data:n,width:u,height:f},b=this.execute(r,{iamegData:y,distImage:a,offsetY:g,rowCount:t});g+=t,h.push(b)}Promise.all(h).then(e=>{for(let t of e){const{data:e,width:r,height:a,offsetY:s,rowCount:o}=t.distImage,c=4*s*i;n.set(e,c)}a(n.buffer)}).catch(e=>{console.error(e.stack),console.error(e),console.error(e.currentTarget),console.error(e.returnValue),console.error(e.srcElement),console.error(e.target),console.error(e.type),console.error(e.eventPhase),console.error(e.timeStamp),console.error(e.message),console.error(e.lineno),console.error(e.error),s(e)})})}resizeAsLanczosExe(e,t,r,a){const{data:s,width:o,height:n}=e,i=t.data,c=t.width,l=t.height;t.offsetY=r,t.rowCount=a;new Uint8ClampedArray(this.resizeLanczos(s,o,n,c,l,i,r,a));return t}resizeAsByCubicExe(e,t,r,a){const{data:s,width:o,height:n}=e,i=t.data,c=t.width,l=t.height;t.offsetY=r,t.rowCount=a;new Uint8ClampedArray(this.resizeByCubic(s,o,n,c,l,i,r,a));return t}resize(e,t,r,a){const{data:s,width:o,height:n}=e,i=a.data;new Uint8ClampedArray(this.resizeByCubic(s,o,n,t,r,i));return a}resizeLanczos(e,t,r,a,s,o,n,i){return this.resizeExecute(e,t,r,a,s,this.lanczosWeight(3),6,o,n,i)}resizeByCubic(e,t,r,a,s,o,n,i){return this.resizeExecute(e,t,r,a,s,this.culcWeightByCubic(-1),4,o,n,i)}resizeExecute(e,t,r,s,o,n,i,c,l,u){const f=Math.floor(s),h=Math.floor(o),g=Math.floor(t),d=4*g,y=g-1,b=Math.floor(r),m=b-1,p=g/f,w=b/h,A=e,B=c||new Uint8Array(f*h*4),z=i/2,x=z-1,I=l||0,k=I+(u||h);for(let e=I;e<k;e++){const t=w*e,r=Math.floor(t),s=r-x,o=r+z,i=4*(e-I)*f;for(let e=0;e<f;e++){const c=p*e,l=Math.floor(c);let u=0,f=0,h=0;const g=l-x,b=l+z;for(let e=s;e<=o;e++){const a=n(Math.abs(t-e)),s=d*(e<0||e>m?r:e);for(let e=g;e<=b;e++){const t=n(Math.abs(c-e))*a;if(0===t)continue;const r=s+4*(e<0||e>y?l:e);u+=A[r]*t,f+=A[r+1]*t,h+=A[r+2]*t}}const w=i+4*e;B[w]=a.a.trimByte(u),B[w+1]=a.a.trimByte(f),B[w+2]=a.a.trimByte(h),B[w+3]=255}}return B.buffer}}}});
//# sourceMappingURL=worker.js.map